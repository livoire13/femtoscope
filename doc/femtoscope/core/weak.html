<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.0.0"/>
    <title>femtoscope.core.weak API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style><script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']]
        }
    };
</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
    /* Re-invoke MathJax when DOM content changes, for example during search. */
    document.addEventListener("DOMContentLoaded", () => {
        new MutationObserver(() => MathJax.typeset()).observe(
            document.querySelector("main.pdoc").parentNode,
            {childList: true}
        );
    })
</script>
<style>
    mjx-container {
        overflow-x: auto;
    }
</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../core.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;femtoscope.core</a>

            <img src="file://D:/hlevy/Documents/microscope2/femtoscope/images/logo.png" class="logo" alt="project logo"/>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#WeakForm">WeakForm</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#WeakForm.__init__">WeakForm</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.forbidden_mod_arg">forbidden_mod_arg</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.verbose">verbose</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.name">name</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.constcoeffs">constcoeffs</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.unknown_name">unknown_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.test_name">test_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.order">order</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.space">space</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.poly_space_base">poly_space_base</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.integral_name">integral_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.domain_name">domain_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.nterms">nterms</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.domain">domain</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.omega">omega</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.dimension">dimension</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.entity_functions">entity_functions</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.region_dic">region_dic</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.subomegas">subomegas</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.facets">facets</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.edges">edges</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.vertices">vertices</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.field">field</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.ndofs">ndofs</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.unknown">unknown</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.test">test</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.integral">integral</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.ebcs">ebcs</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.epbcs">epbcs</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.lcbcs">lcbcs</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.terms">terms</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.eqn">eqn</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.eqn_cst">eqn_cst</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.eqn_mod">eqn_mod</a>
                        </li>
                        <li>
                                <a class="function" href="#WeakForm.add_term">add_term</a>
                        </li>
                        <li>
                                <a class="function" href="#WeakForm.make_equation">make_equation</a>
                        </li>
                        <li>
                                <a class="function" href="#WeakForm.split_equation">split_equation</a>
                        </li>
                        <li>
                                <a class="function" href="#WeakForm.get_term_table_kw">get_term_table_kw</a>
                        </li>
                </ul>

            </li>
    </ul>


            <footer>Hugo LÃ©vy PhD Thesis</footer>

        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../../femtoscope.html">femtoscope</a><wbr>.<a href="./../core.html">core</a><wbr>.weak    </h1>

                        <div class="docstring"><p>Created on Wed Jan 26 12:36:29 2022</p>

<p>Tools for creating and manipulating weak form PDEs created out of Sfepy
objects.</p>

<p>@author: hlevy</p>
</div>

                        <input id="mod-weak-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-weak-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="c1"># -*- coding: utf-8 -*-</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="sd">Created on Wed Jan 26 12:36:29 2022</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="sd">Tools for creating and manipulating weak form PDEs created out of Sfepy</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="sd">objects.</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="sd">@author: hlevy</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="kn">from</span> <span class="nn">femtoscope.inout.meshfactory</span> <span class="kn">import</span> <span class="p">(</span><span class="n">get_meshsource</span><span class="p">,</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a>                                          <span class="n">get_physical_group_ids</span><span class="p">)</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="kn">import</span> <span class="nn">numbers</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="kn">from</span> <span class="nn">sfepy.discrete.fem</span> <span class="kn">import</span> <span class="n">Mesh</span><span class="p">,</span> <span class="n">FEDomain</span><span class="p">,</span> <span class="n">Field</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="kn">from</span> <span class="nn">sfepy.terms</span> <span class="kn">import</span> <span class="n">Term</span><span class="p">,</span> <span class="n">term_table</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="kn">from</span> <span class="nn">sfepy.discrete</span> <span class="kn">import</span> <span class="p">(</span><span class="n">FieldVariable</span><span class="p">,</span> <span class="n">Integral</span><span class="p">,</span> <span class="n">Equation</span><span class="p">,</span> <span class="n">Material</span><span class="p">,</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a>                            <span class="n">Function</span><span class="p">)</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="kn">from</span> <span class="nn">sfepy.discrete.conditions</span> <span class="kn">import</span> <span class="n">EssentialBC</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="kn">from</span> <span class="nn">femtoscope.misc.util</span> <span class="kn">import</span> <span class="n">get_default_args</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="kn">from</span> <span class="nn">femtoscope.misc.util</span> <span class="kn">import</span> <span class="n">numpyit</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="k">class</span> <span class="nc">WeakForm</span><span class="p">:</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd">    Class encapsulating all Sfepy objects for defining a weak form PDE.</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="sd">    Attributes</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="sd">    ----------</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="sd">    name : str</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="sd">        Name of the weak form.</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">    meshfile : str</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="sd">        Name of the meshfile e.g. &#39;my_mesh.vtk&#39; located in the specified mesh</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">        directory.</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">    terms : list</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">        List containing the terms of the weak form PDE. Each element of the</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">        list is a list containing:</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">            - a material function or None.</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">            - a Sfepy string of the term, e.g. &#39;dw_laplace&#39;, or</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">            &#39;dw_volume&#39;. https://sfepy.org/doc-devel/terms_overview.html.</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">            - a region&#39;s name e.g. &#39;facet200&#39;, &#39;subomega301&#39;, or None.</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="sd">    verbose : bool</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">        Display user&#39;s information. The default is False.</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">    mesh_dir : str</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd">        Absolute path to the directory containing meshfile. The default is</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="sd">        None.</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">    ext : str</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">        Extension given to the mesh file. The default is &#39;.vtk&#39;.</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd">    constcoeffs : list</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="sd">        Coefficients weighting the terms such that the weak form equation</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="sd">        reads</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="sd">            $$ \sum_{i=1}^{N_{\mathrm{terms}}} \texttt{constcoeffs[i]} \times</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="sd">            \texttt{terms[i]} = 0 $$</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="sd">    unknown : `sfepy.discrete.variables.FieldVariable`</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="sd">        Sfepy unknown variable.</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="sd">    unknown_name : str</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="sd">        Name of the unknown variable. The default is &#39;u&#39;.</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="sd">    test : `sfepy.discrete.variables.FieldVariable`</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">        Sfepy test variable.</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">    test_name : str</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="sd">        Name of the test variable. The default is &#39;v&#39;.</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a><span class="sd">    order : int</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a><span class="sd">        The FE approximation order. The default is 2.</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="sd">    space : str</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="sd">        The function space name. The default is &#39;H1&#39;.</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a><span class="sd">    poly_space_base : str</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a><span class="sd">        The name of polynomial space base. The default is &#39;lagrange&#39;.</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="sd">    integral : `sfepy.discrete.integrals.Integral`</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="sd">        Sfepy Integral instance.</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a><span class="sd">    integral_name : str</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="sd">        The integral name. The default is &#39;i&#39;.</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a><span class="sd">    domain : `sfepy.discrete.fem.domain.FEDomain`</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="sd">        Sfepy Domain instance.</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="sd">    domain_name : str</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="sd">        The domain name. The default is &#39;domain&#39;.</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">    omega : Region</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">        The whole domain over which the variable are defined.</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="sd">    dimension : int</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="sd">        Spatial dimension of the problem (3 is the maximum).</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a><span class="sd">    physical_group_ids : list of int</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="sd">        All distinct physical groups identifiers.</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="sd">    region_dic : dict</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">        Dictionary of all regions.</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="sd">    subomegas : list</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="sd">        List of sub regions of dimension D.</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="sd">    facets : list</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a><span class="sd">        List of sub regions of dimension D-1.</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="sd">    edges : list</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a><span class="sd">        List of sub regions of dimension 1.</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="sd">    vertices : list</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">        List of sub regions of dimension 0.</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="sd">    epbcs : list</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">        List of periodic boundary conditions.</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="sd">    lcbcs : list</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">        List of linear combination boundary conditions.</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="sd">    ebcs : list</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="sd">        List of essential boundary conditions.</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a><span class="sd">    ndofs : int</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a><span class="sd">        Number of degrees of freedom.</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="sd">    entity_functions : list of 2-tuple</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a><span class="sd">        List of tuples (dim, function) for manual entity selection.</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a><span class="sd">        The default is [].</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="sd">    Class variable `forbidden_mod_arg` is a list of material extra-arguments</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a><span class="sd">    (strings) which are not to be interpreted as &#39;mod&#39; terms. Any term having</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">    at least one extra-argument not contained in this list will be casted into</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a><span class="sd">    the `self.eqn_mod` attribute.</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>    <span class="n">forbidden_mod_arg</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;update_nl&#39;</span><span class="p">,</span> <span class="s1">&#39;rho&#39;</span><span class="p">,</span> <span class="s1">&#39;rho_vac&#39;</span><span class="p">,</span> <span class="s1">&#39;Rcut&#39;</span><span class="p">]</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">meshfile</span><span class="p">,</span> <span class="n">terms</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a><span class="sd">        Construct a WeakForm instance that is an object containing all the</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a><span class="sd">        necessary information related to a given weak form PDE.</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a><span class="sd">        Parameters</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a><span class="sd">        ----------</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a><span class="sd">        name : str</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a><span class="sd">            Name of the weak form.</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a><span class="sd">        meshfile : str</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a><span class="sd">            Name of the meshfile e.g. &#39;my_mesh.vtk&#39; located in the specified</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a><span class="sd">            mesh directory.</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a><span class="sd">        terms : list</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a><span class="sd">            List containing the terms of the weak form PDE. Each element of the</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a><span class="sd">            list is a list containing:</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a><span class="sd">                - a material function or None.</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a><span class="sd">                - a Sfepy string of the term, e.g. &#39;dw_laplace&#39;, or</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a><span class="sd">                &#39;dw_volume&#39;. https://sfepy.org/doc-devel/terms_overview.html.</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a><span class="sd">                - a region&#39;s name e.g. &#39;facet200&#39;, &#39;subomega301&#39;, or None.</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a><span class="sd">        Other Parameters</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a><span class="sd">        ----------------</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a><span class="sd">        mesh_dir : str</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a><span class="sd">            Directory where the mesh files are located. The default is None.</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a><span class="sd">        ext : str</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a><span class="sd">            Extension of the mesh file. The default is &#39;.vtk&#39;.</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a><span class="sd">        constcoeffs : list</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a><span class="sd">            Coefficients weighting the terms such that the weak form equation</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a><span class="sd">            reads</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a><span class="sd">                $$ \sum_{i=1}^{N_{\mathrm{terms}}} \texttt{constcoeffs[i]}</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a><span class="sd">                \times \texttt{terms[i]} = 0 $$</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a><span class="sd">        dirichlet_bc_facet : list</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a><span class="sd">            List of dirichlet boundary conditions applied to facets. This list</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a><span class="sd">            must be the same length as the number of facets defined in the</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a><span class="sd">            domain. Elements of the list are such that:</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a><span class="sd">                - if `dirichlet_bc_facet`[k] is None, then facets[k] is free of</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a><span class="sd">                any essential boundary condition.</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a><span class="sd">                - if `dirichlet_bc_facet`[k] is a number, then facets[k] is</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a><span class="sd">                constrained by a constant essential boundary condition.</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a><span class="sd">                - if `dirichlet_bc_facet`[k] is a function, then facets[k] is</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a><span class="sd">                constrained by a dirichlet boundary condition calculated by the</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a><span class="sd">                function.</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a><span class="sd">            The default is None.</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a><span class="sd">        dirichlet_bc_edge : list</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a><span class="sd">            List of dirichlet boundary conditions applied to edges. This list</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a><span class="sd">            must be the same length as the number of edges defined in the</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a><span class="sd">            domain. The default is None.</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a><span class="sd">        dirichlet_bc_vertex : list</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a><span class="sd">            List of dirichlet boundary conditions applied to vertices. This</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a><span class="sd">            list must be the same length as the number of edges defined in the</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a><span class="sd">            domain. The default is None.</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a><span class="sd">        verbose : bool</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a><span class="sd">            Display user&#39;s information. The default is False.</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a><span class="sd">        domain_name : str</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a><span class="sd">            The domain name. The default is &#39;domain&#39;.</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a><span class="sd">        integral_name : str</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a><span class="sd">            The integral name. The default is &#39;i&#39;.</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a><span class="sd">        space : str</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a><span class="sd">            The function space name. The default is &#39;H1&#39;.</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a><span class="sd">        poly_space_base : str</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a><span class="sd">            The name of polynomial space base. The default is &#39;lagrange&#39;.</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a><span class="sd">        test_name : str</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a><span class="sd">            Name of the test variable. The default is &#39;v&#39;.</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a><span class="sd">        unknown_name : str</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a><span class="sd">            Name of the unknown variable. The default is &#39;u&#39;.</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a><span class="sd">        densities : list</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a><span class="sd">            List of density functions or constants. The length of this list</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a><span class="sd">            must match the number of sub*domains in the mesh.</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a><span class="sd">            The default is None.</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a><span class="sd">        entity_functions : list of 2-tuple</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a><span class="sd">            List of tuples (dim, function) for manual entity selection.</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a><span class="sd">            The default is [].</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>        <span class="c1"># keyword arguments handling</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>        <span class="n">mesh_dir</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mesh_dir&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>        <span class="n">ext</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ext&#39;</span><span class="p">,</span> <span class="s1">&#39;.vtk&#39;</span><span class="p">)</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>        <span class="n">constcoeffs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;constcoeffs&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">terms</span><span class="p">))</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>        <span class="n">dirichlet_bc_vertex</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dirichlet_bc_vertex&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>        <span class="n">dirichlet_bc_edge</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dirichlet_bc_edge&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>        <span class="n">dirichlet_bc_facet</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dirichlet_bc_facet&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>        <span class="n">dbc_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">dirichlet_bc_vertex</span><span class="p">,</span> <span class="n">dirichlet_bc_edge</span><span class="p">,</span> <span class="n">dirichlet_bc_facet</span><span class="p">]</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;verbose&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">constcoeffs</span> <span class="o">=</span> <span class="n">constcoeffs</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unknown_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;unknown_name&#39;</span><span class="p">,</span> <span class="s1">&#39;u&#39;</span><span class="p">)</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">test_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;test_name&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">)</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;order&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">space</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;space&#39;</span><span class="p">,</span> <span class="s1">&#39;H1&#39;</span><span class="p">)</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">poly_space_base</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;poly_space_base&#39;</span><span class="p">,</span> <span class="s1">&#39;lagrange&#39;</span><span class="p">)</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">integral_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;integral_name&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">)</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">domain_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;domain_name&#39;</span><span class="p">,</span> <span class="s1">&#39;domain&#39;</span><span class="p">)</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nterms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">terms</span><span class="p">)</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">meshfile</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">meshfile</span> <span class="o">=</span> <span class="n">get_meshsource</span><span class="p">(</span><span class="n">meshfile</span><span class="p">,</span> <span class="n">mesh_dir</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meshfile</span><span class="p">)</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">physical_group_ids</span> <span class="o">=</span> <span class="n">get_physical_group_ids</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meshfile</span><span class="p">)</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">meshfile</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">physical_group_ids</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="n">FEDomain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">)</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">omega</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span><span class="s1">&#39;omega&#39;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">)</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">omega</span><span class="o">.</span><span class="n">dim</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">entity_functions</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;entity_functions&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">terms</span><span class="p">)</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">constcoeffs</span><span class="p">)</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>        <span class="c1"># Regions (cells, facets, edges, vertices):</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>        <span class="c1"># - embedded in the mesh file</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">region_dic</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;omega&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">omega</span><span class="p">}</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>        <span class="n">subomegas</span><span class="p">,</span> <span class="n">facets</span><span class="p">,</span> <span class="n">edges</span><span class="p">,</span> <span class="n">vertices</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>        <span class="c1"># subool = len([x for x in self.physical_group_ids if x &gt;= 300]) &gt;= 2</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>        <span class="k">for</span> <span class="n">group_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">physical_group_ids</span><span class="p">:</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>            <span class="k">if</span> <span class="n">group_id</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">group_id</span> <span class="o">&lt;=</span> <span class="mi">99</span><span class="p">:</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>                <span class="n">vertices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>                    <span class="s1">&#39;node</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">group_id</span><span class="p">,</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>                    <span class="s1">&#39;vertices of group </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">group_id</span><span class="p">,</span> <span class="c1"># selection of vertices</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>                    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;vertex&#39;</span><span class="p">))</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">region_dic</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">group_id</span><span class="p">)]</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>            <span class="k">elif</span> <span class="n">group_id</span> <span class="o">&gt;=</span> <span class="mi">100</span> <span class="ow">and</span> <span class="n">group_id</span> <span class="o">&lt;=</span> <span class="mi">199</span><span class="p">:</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>                <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>                    <span class="s1">&#39;edge</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">group_id</span><span class="p">,</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>                    <span class="s1">&#39;vertices of group </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">group_id</span><span class="p">,</span> <span class="c1"># selection of vertices</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>                    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;edge&#39;</span><span class="p">))</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">region_dic</span><span class="p">[</span><span class="s1">&#39;edge&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">group_id</span><span class="p">)]</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>            <span class="k">elif</span> <span class="n">group_id</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="ow">and</span> <span class="n">group_id</span> <span class="o">&lt;=</span> <span class="mi">299</span><span class="p">:</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>                <span class="n">facets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>                    <span class="s1">&#39;facet</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">group_id</span><span class="p">,</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>                    <span class="s1">&#39;vertices of group </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">group_id</span><span class="p">,</span> <span class="c1"># selection of vertices</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>                    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;facet&#39;</span><span class="p">))</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">region_dic</span><span class="p">[</span><span class="s1">&#39;facet&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">group_id</span><span class="p">)]</span> <span class="o">=</span> <span class="n">facets</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>            <span class="k">elif</span> <span class="n">group_id</span> <span class="o">&gt;=</span> <span class="mi">300</span><span class="p">:</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>                <span class="n">subomegas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>                    <span class="s1">&#39;subomega</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">group_id</span><span class="p">,</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>                    <span class="s1">&#39;cells of group </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">group_id</span><span class="p">,</span> <span class="c1"># selection of cells</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>                    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cell&#39;</span><span class="p">))</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">region_dic</span><span class="p">[</span><span class="s1">&#39;subomega&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">group_id</span><span class="p">)]</span> <span class="o">=</span> <span class="n">subomegas</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>        <span class="c1"># - specified manually through a function of coordinates</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>        <span class="k">for</span> <span class="n">dimFunc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entity_functions</span><span class="p">:</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>            <span class="n">dim</span><span class="p">,</span> <span class="n">func</span> <span class="o">=</span> <span class="n">dimFunc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dimFunc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>            <span class="n">funcname</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>            <span class="k">if</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>                <span class="n">nb</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>                <span class="n">vertices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>                    <span class="s1">&#39;node</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">nb</span><span class="p">,</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>                    <span class="s1">&#39;vertices by </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">funcname</span><span class="p">,</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>                    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;vertex&#39;</span><span class="p">,</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>                    <span class="n">functions</span><span class="o">=</span><span class="p">{</span><span class="n">funcname</span> <span class="p">:</span> <span class="n">func</span><span class="p">}))</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">region_dic</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nb</span><span class="p">)]</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>            <span class="k">elif</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>                <span class="n">nb</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>                <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>                    <span class="s1">&#39;edge</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">nb</span><span class="p">,</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>                    <span class="s1">&#39;vertices by </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">funcname</span><span class="p">,</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>                    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;edge&#39;</span><span class="p">,</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>                    <span class="n">functions</span><span class="o">=</span><span class="p">{</span><span class="n">funcname</span> <span class="p">:</span> <span class="n">func</span><span class="p">}))</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">region_dic</span><span class="p">[</span><span class="s1">&#39;edge&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nb</span><span class="p">)]</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>            <span class="k">elif</span> <span class="p">(</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>                    <span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>                <span class="n">nb</span> <span class="o">=</span> <span class="mi">200</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">facets</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>                <span class="n">facets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>                    <span class="s1">&#39;facet</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">nb</span><span class="p">,</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>                    <span class="s1">&#39;vertices by </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">funcname</span><span class="p">,</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>                    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;facet&#39;</span><span class="p">,</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>                    <span class="n">functions</span><span class="o">=</span><span class="p">{</span><span class="n">funcname</span> <span class="p">:</span> <span class="n">func</span><span class="p">}))</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">region_dic</span><span class="p">[</span><span class="s1">&#39;facet&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nb</span><span class="p">)]</span> <span class="o">=</span> <span class="n">facets</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>            <span class="k">elif</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>                <span class="n">nb</span> <span class="o">=</span> <span class="mi">300</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">subomegas</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>                <span class="n">subomegas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>                    <span class="s1">&#39;subomega</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">nb</span><span class="p">,</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>                    <span class="s1">&#39;cells by </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">funcname</span><span class="p">,</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>                    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cell&#39;</span><span class="p">,</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>                    <span class="n">functions</span><span class="o">=</span><span class="p">{</span><span class="n">funcname</span> <span class="p">:</span> <span class="n">func</span><span class="p">}))</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">region_dic</span><span class="p">[</span><span class="s1">&#39;subomega&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nb</span><span class="p">)]</span> <span class="o">=</span> <span class="n">subomegas</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">subomegas</span> <span class="o">=</span> <span class="n">subomegas</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">facets</span> <span class="o">=</span> <span class="n">facets</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">edges</span> <span class="o">=</span> <span class="n">edges</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="n">vertices</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>        <span class="c1"># Density profiles</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>        <span class="n">densities</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;densities&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>        <span class="k">if</span> <span class="n">densities</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">densities</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">subomegas</span><span class="p">):</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;More density profiles than sub-domains&quot;</span><span class="p">)</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">densities</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">densities</span><span class="p">)):</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="p">[</span><span class="n">subomegas</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">densities</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>        <span class="c1"># Field setup</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">field</span> <span class="o">=</span> <span class="n">Field</span><span class="o">.</span><span class="n">from_args</span><span class="p">(</span><span class="s1">&#39;fu&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="s1">&#39;scalar&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">omega</span><span class="p">,</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>                                     <span class="n">approx_order</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">space</span><span class="p">,</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>                                     <span class="n">poly_space_base</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">poly_space_base</span><span class="p">)</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ndofs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">n_nod</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unknown</span> <span class="o">=</span> <span class="n">FieldVariable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unknown_name</span><span class="p">,</span> <span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="p">)</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">test</span> <span class="o">=</span> <span class="n">FieldVariable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_name</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="p">,</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>                                  <span class="n">primary_var_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unknown_name</span><span class="p">)</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">integral</span> <span class="o">=</span> <span class="n">Integral</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">integral_name</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>        <span class="c1"># Dirichlet boundary conditions on entities of dimension &lt; D</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>        <span class="n">ent_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">facets</span><span class="p">]</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>        <span class="n">ebcs_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>        <span class="k">for</span> <span class="n">k_dbcs</span><span class="p">,</span> <span class="n">dbcs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dbc_list</span><span class="p">):</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>            <span class="k">if</span> <span class="n">dbcs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">dbcs</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">ent_list</span><span class="p">[</span><span class="n">k_dbcs</span><span class="p">])</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>                <span class="k">for</span> <span class="n">k_dbc</span><span class="p">,</span> <span class="n">dbc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dbcs</span><span class="p">):</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>                    <span class="k">if</span> <span class="n">dbc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>                        <span class="n">ebc_name</span> <span class="o">=</span> <span class="s1">&#39;ebc_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k_dbcs</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k_dbc</span><span class="p">)</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dbc</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>                            <span class="n">ebc</span> <span class="o">=</span> <span class="n">EssentialBC</span><span class="p">(</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>                                <span class="n">ebc_name</span><span class="p">,</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>                                <span class="n">ent_list</span><span class="p">[</span><span class="n">k_dbcs</span><span class="p">][</span><span class="n">k_dbc</span><span class="p">],</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>                                <span class="p">{</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.all&#39;</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">unknown_name</span> <span class="p">:</span> <span class="n">dbc</span><span class="p">})</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>                        <span class="k">elif</span> <span class="n">callable</span><span class="p">(</span><span class="n">dbc</span><span class="p">):</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a><span class="w">                            </span><span class="sd">&quot;&quot;&quot; Function signature should be </span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a><span class="sd">                            dbc(ts, coors, **kwargs) &quot;&quot;&quot;</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>                            <span class="n">ebc_func_name</span> <span class="o">=</span> <span class="s1">&#39;ebc_func_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k_dbcs</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k_dbc</span><span class="p">)</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>                            <span class="n">ebc_func</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="n">ebc_func_name</span><span class="p">,</span> <span class="n">dbc</span><span class="p">)</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>                            <span class="n">ebc</span> <span class="o">=</span> <span class="n">EssentialBC</span><span class="p">(</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>                                <span class="n">ebc_name</span><span class="p">,</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>                                <span class="n">ent_list</span><span class="p">[</span><span class="n">k_dbcs</span><span class="p">][</span><span class="n">k_dbc</span><span class="p">],</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>                                <span class="p">{</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.all&#39;</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">unknown_name</span> <span class="p">:</span> <span class="n">ebc_func</span><span class="p">})</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>                        <span class="n">ebcs_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ebc</span><span class="p">)</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ebcs</span> <span class="o">=</span> <span class="n">ebcs_list</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">epbcs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lcbcs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>        <span class="c1"># Terms definition</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_terms</span> <span class="o">=</span> <span class="n">terms</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">terms</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eqn</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>        <span class="k">for</span> <span class="n">materm</span> <span class="ow">in</span> <span class="n">terms</span><span class="p">:</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">add_term</span><span class="p">(</span><span class="n">materm</span><span class="p">)</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>        <span class="c1"># Equation</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eqn</span> <span class="o">=</span> <span class="n">WeakForm</span><span class="o">.</span><span class="n">make_equation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">terms</span><span class="p">,</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>                                          <span class="bp">self</span><span class="o">.</span><span class="n">constcoeffs</span><span class="p">,</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>                                          <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eqn_cst</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eqn_mod</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">split_equation</span><span class="p">()</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>        <span class="c1"># Display information for the user</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>    <span class="k">def</span> <span class="nf">add_term</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">materm</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">newcoeff</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a><span class="sd">        Add a term to the existing WeakForm object.</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a><span class="sd">        Parameters</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a><span class="sd">        ----------</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a><span class="sd">        materm : list of length 2 or 3 (one element of terms).</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a><span class="sd">            A list containing:</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a><span class="sd">                - a material function or None.</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a><span class="sd">                - a Sfepy string of the term, e.g. &#39;dw_laplace&#39;, or</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a><span class="sd">                &#39;dw_volume&#39;. https://sfepy.org/doc-devel/terms_overview.html</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a><span class="sd">                - a region&#39;s name e.g. &#39;facet200&#39;, &#39;subomega301&#39;, or None.</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a><span class="sd">        update : bool, optional</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a><span class="sd">            Update self.equation with new term. The default is False.</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a><span class="sd">        newcoeff : float, optional</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a><span class="sd">            If update, the new term multiplicative constant.</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a><span class="sd">            The default is 1.0.</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a><span class="sd">        Returns</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a><span class="sd">        -------</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a><span class="sd">        None.</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>        <span class="n">material</span> <span class="o">=</span> <span class="n">materm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>        <span class="n">term_str</span> <span class="o">=</span> <span class="n">materm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>        <span class="n">ttkw</span> <span class="o">=</span> <span class="n">WeakForm</span><span class="o">.</span><span class="n">get_term_table_kw</span><span class="p">(</span><span class="n">term_table</span><span class="p">,</span> <span class="n">term_str</span><span class="p">)</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>        
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>        <span class="c1"># Determine the region over which integral is defined</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">materm</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>            <span class="k">if</span> <span class="n">materm</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>                <span class="n">name</span> <span class="o">=</span> <span class="n">materm</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="c1"># the region&#39;s name was given by the user</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;omega&#39;</span> <span class="c1"># the region&#39;s name was not given, default is omega</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>            
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>        <span class="c1"># assert term_str in term_table</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">unknown_name</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">unknown</span><span class="p">,</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>                  <span class="bp">self</span><span class="o">.</span><span class="n">test_name</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">test</span><span class="p">}</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>        <span class="k">if</span> <span class="n">material</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>            <span class="k">if</span> <span class="s1">&#39;state&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ttkw</span> <span class="ow">and</span> <span class="s1">&#39;virtual/grad_state&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ttkw</span><span class="p">:</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>                <span class="n">new_term</span> <span class="o">=</span> <span class="n">Term</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>                    <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">term_str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_name</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">integral</span><span class="p">,</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">region_dic</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>                <span class="n">new_term</span> <span class="o">=</span> <span class="n">Term</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>                    <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">term_str</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">test_name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">unknown_name</span><span class="p">),</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">integral</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_dic</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>        <span class="k">elif</span> <span class="n">callable</span><span class="p">(</span><span class="n">material</span><span class="p">):</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>            <span class="n">mat_func</span>  <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="s1">&#39;mat_func&#39;</span><span class="p">,</span> <span class="n">material</span><span class="p">)</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>            <span class="n">extra_args</span> <span class="o">=</span> <span class="n">get_default_args</span><span class="p">(</span><span class="n">material</span><span class="p">)</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>            <span class="n">matname</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>            <span class="c1"># density profile linked to subregion</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>            <span class="k">if</span> <span class="s1">&#39;rho&#39;</span> <span class="ow">in</span> <span class="n">extra_args</span> <span class="ow">and</span> <span class="n">extra_args</span><span class="p">[</span><span class="s1">&#39;rho&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>                <span class="n">extra_args</span><span class="p">[</span><span class="s1">&#39;rho&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>                <span class="n">matname</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">name</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>            <span class="n">mat</span> <span class="o">=</span> <span class="n">Material</span><span class="p">(</span><span class="n">matname</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;stationary&#39;</span><span class="p">,</span> <span class="n">function</span><span class="o">=</span><span class="n">mat_func</span><span class="p">)</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>            <span class="n">mat</span><span class="o">.</span><span class="n">set_extra_args</span><span class="p">(</span><span class="o">**</span><span class="n">extra_args</span><span class="p">)</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>            <span class="n">kwargs</span><span class="p">[</span><span class="n">matname</span><span class="p">]</span> <span class="o">=</span> <span class="n">mat</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>            <span class="k">if</span> <span class="s1">&#39;state&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ttkw</span> <span class="ow">and</span> <span class="s1">&#39;virtual/grad_state&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ttkw</span><span class="p">:</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>                <span class="n">new_term</span> <span class="o">=</span> <span class="n">Term</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>                    <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%s</span><span class="s1">.val, </span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">term_str</span><span class="p">,</span> <span class="n">matname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_name</span><span class="p">),</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">integral</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_dic</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>                <span class="n">new_term</span> <span class="o">=</span> <span class="n">Term</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>                    <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%s</span><span class="s1">.val, </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">term_str</span><span class="p">,</span> <span class="n">matname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_name</span><span class="p">,</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">unknown_name</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">integral</span><span class="p">,</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">region_dic</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Material should be a function or None&quot;</span><span class="p">)</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">terms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_term</span><span class="p">)</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>        <span class="k">if</span> <span class="n">update</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_terms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">materm</span><span class="p">)</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">constcoeffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newcoeff</span><span class="p">)</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">eqn</span> <span class="o">=</span> <span class="n">WeakForm</span><span class="o">.</span><span class="n">make_equation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">terms</span><span class="p">,</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>                                              <span class="bp">self</span><span class="o">.</span><span class="n">constcoeffs</span><span class="p">,</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>                                              <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">split_equation</span><span class="p">()</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>    <span class="k">def</span> <span class="nf">make_equation</span><span class="p">(</span><span class="n">terms</span><span class="p">,</span> <span class="n">constcoeffs</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the eqn attribute of the WeakForm object.&quot;&quot;&quot;</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>        <span class="k">if</span> <span class="n">terms</span><span class="p">:</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>            <span class="n">eqn</span> <span class="o">=</span> <span class="n">terms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">constcoeffs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">constcoeffs</span><span class="p">)):</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>                <span class="n">eqn</span> <span class="o">=</span> <span class="n">eqn</span><span class="o">.</span><span class="fm">__add__</span><span class="p">(</span><span class="n">terms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">constcoeffs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>            <span class="n">eqn</span> <span class="o">=</span> <span class="n">Equation</span><span class="p">(</span><span class="s1">&#39;eqn_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">name</span><span class="p">,</span> <span class="n">eqn</span><span class="p">)</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>            <span class="k">return</span> <span class="n">eqn</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>    <span class="k">def</span> <span class="nf">split_equation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Split the equation into constant VS updatable equations.&quot;&quot;&quot;</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>        <span class="n">terms_cst</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>        <span class="n">terms_mod</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>        <span class="n">constcoeffs_cst</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>        <span class="n">constcoeffs_mod</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>        <span class="n">mats</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>        <span class="n">terms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_terms</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>        <span class="n">mats_aux</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eqn</span><span class="o">.</span><span class="n">collect_materials</span><span class="p">()</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mats_aux</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">terms</span><span class="p">):</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">terms</span><span class="p">)):</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>                <span class="n">func</span> <span class="o">=</span> <span class="n">terms</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>                <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>                    <span class="n">mats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>                    <span class="n">mats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mats_aux</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>            <span class="n">mats</span> <span class="o">=</span> <span class="n">mats_aux</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>        <span class="k">for</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">mat</span><span class="p">,</span> <span class="n">term</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">constcoeffs</span><span class="p">,</span> <span class="n">mats</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">terms</span><span class="p">):</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>            <span class="n">isconstant</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="s1">&#39;extra_args&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">mat</span><span class="o">.</span><span class="n">extra_args</span> <span class="o">!=</span> <span class="p">{}:</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>                <span class="n">extra_args</span> <span class="o">=</span> <span class="n">mat</span><span class="o">.</span><span class="n">extra_args</span> <span class="c1"># fetch material&#39;s extra-args dict</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a>                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">extra_args</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>                    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">WeakForm</span><span class="o">.</span><span class="n">forbidden_mod_arg</span><span class="p">:</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>                        <span class="n">isconstant</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>                        <span class="k">break</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a>            <span class="k">if</span> <span class="n">isconstant</span><span class="p">:</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>                <span class="n">terms_cst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">term</span><span class="p">)</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>                <span class="n">constcoeffs_cst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coeff</span><span class="p">)</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>                <span class="n">terms_mod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">term</span><span class="p">)</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>                <span class="n">constcoeffs_mod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coeff</span><span class="p">)</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>        <span class="k">if</span> <span class="n">terms_cst</span><span class="p">:</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">eqn_cst</span> <span class="o">=</span> <span class="n">WeakForm</span><span class="o">.</span><span class="n">make_equation</span><span class="p">(</span><span class="n">terms_cst</span><span class="p">,</span> <span class="n">constcoeffs_cst</span><span class="p">,</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>                                                  <span class="s1">&#39;eqn_cst&#39;</span><span class="p">)</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>        <span class="k">if</span> <span class="n">terms_mod</span><span class="p">:</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">eqn_mod</span> <span class="o">=</span> <span class="n">WeakForm</span><span class="o">.</span><span class="n">make_equation</span><span class="p">(</span><span class="n">terms_mod</span><span class="p">,</span> <span class="n">constcoeffs_mod</span><span class="p">,</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>                                                  <span class="s1">&#39;eqn_mod&#39;</span><span class="p">)</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>        <span class="n">string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a><span class="s2">        Weak Form:</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a><span class="s2">            name: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a><span class="s2">            &quot;&quot;&quot;</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;meshfile&#39;</span><span class="p">):</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>            <span class="n">string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a><span class="s2">            mesh location: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">meshfile</span><span class="si">}</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a><span class="s2">            &quot;&quot;&quot;</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a>            <span class="n">string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a><span class="s2">            Ndofs: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ndofs</span><span class="si">}</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a><span class="s2">            Approximation order: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="si">}</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a><span class="s2">            Space: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">space</span><span class="si">}</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a><span class="s2">            Polynomial space base: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">poly_space_base</span><span class="si">}</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a><span class="s2">            Unknown variable: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">unknown_name</span><span class="si">}</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a><span class="s2">            Test variable: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">test_name</span><span class="si">}</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a><span class="s2">            Integral, Order: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">integral</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">integral</span><span class="o">.</span><span class="n">order</span><span class="si">}</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a><span class="s2">            Physical Groups: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">physical_group_ids</span><span class="si">}</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a><span class="s2">            Dirichlet BC: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ebcs</span><span class="si">}</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a><span class="s2">            Periodic BC: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">epbcs</span><span class="si">}</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a><span class="s2">            Linear Combination BC: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lcbcs</span><span class="si">}</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a><span class="s2">            Terms: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">terms</span><span class="si">}</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a><span class="s2">            Constant coefficients: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">constcoeffs</span><span class="si">}</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a><span class="s2">            Equation name: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">eqn</span><span class="o">.</span><span class="n">name</span><span class="si">}</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a><span class="s2">            &quot;&quot;&quot;</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a>        <span class="k">return</span> <span class="n">string</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a>    <span class="k">def</span> <span class="nf">get_term_table_kw</span><span class="p">(</span><span class="n">term_table</span><span class="p">,</span> <span class="n">term_str</span><span class="p">):</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Utility method for getting the syntax of a term given by its string</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a><span class="sd">        identifier.  Might break with future Sfepy releases, see</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a><span class="sd">        https://github.com/sfepy/sfepy/issues/773&quot;&quot;&quot;</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>        <span class="n">entry</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">numpyit</span><span class="p">(</span><span class="n">term_table</span><span class="p">[</span><span class="n">term_str</span><span class="p">]</span><span class="o">.</span><span class="n">arg_types</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</span></pre></div>


            </section>
                <section id="WeakForm">
                            <input id="WeakForm-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">WeakForm</span>:

                <label class="view-source-button" for="WeakForm-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeakForm"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeakForm-25"><a href="#WeakForm-25"><span class="linenos"> 25</span></a><span class="k">class</span> <span class="nc">WeakForm</span><span class="p">:</span>
</span><span id="WeakForm-26"><a href="#WeakForm-26"><span class="linenos"> 26</span></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm-27"><a href="#WeakForm-27"><span class="linenos"> 27</span></a><span class="sd">    Class encapsulating all Sfepy objects for defining a weak form PDE.</span>
</span><span id="WeakForm-28"><a href="#WeakForm-28"><span class="linenos"> 28</span></a>
</span><span id="WeakForm-29"><a href="#WeakForm-29"><span class="linenos"> 29</span></a><span class="sd">    Attributes</span>
</span><span id="WeakForm-30"><a href="#WeakForm-30"><span class="linenos"> 30</span></a><span class="sd">    ----------</span>
</span><span id="WeakForm-31"><a href="#WeakForm-31"><span class="linenos"> 31</span></a><span class="sd">    name : str</span>
</span><span id="WeakForm-32"><a href="#WeakForm-32"><span class="linenos"> 32</span></a><span class="sd">        Name of the weak form.</span>
</span><span id="WeakForm-33"><a href="#WeakForm-33"><span class="linenos"> 33</span></a><span class="sd">    meshfile : str</span>
</span><span id="WeakForm-34"><a href="#WeakForm-34"><span class="linenos"> 34</span></a><span class="sd">        Name of the meshfile e.g. &#39;my_mesh.vtk&#39; located in the specified mesh</span>
</span><span id="WeakForm-35"><a href="#WeakForm-35"><span class="linenos"> 35</span></a><span class="sd">        directory.</span>
</span><span id="WeakForm-36"><a href="#WeakForm-36"><span class="linenos"> 36</span></a><span class="sd">    terms : list</span>
</span><span id="WeakForm-37"><a href="#WeakForm-37"><span class="linenos"> 37</span></a><span class="sd">        List containing the terms of the weak form PDE. Each element of the</span>
</span><span id="WeakForm-38"><a href="#WeakForm-38"><span class="linenos"> 38</span></a><span class="sd">        list is a list containing:</span>
</span><span id="WeakForm-39"><a href="#WeakForm-39"><span class="linenos"> 39</span></a><span class="sd">            - a material function or None.</span>
</span><span id="WeakForm-40"><a href="#WeakForm-40"><span class="linenos"> 40</span></a><span class="sd">            - a Sfepy string of the term, e.g. &#39;dw_laplace&#39;, or</span>
</span><span id="WeakForm-41"><a href="#WeakForm-41"><span class="linenos"> 41</span></a><span class="sd">            &#39;dw_volume&#39;. https://sfepy.org/doc-devel/terms_overview.html.</span>
</span><span id="WeakForm-42"><a href="#WeakForm-42"><span class="linenos"> 42</span></a><span class="sd">            - a region&#39;s name e.g. &#39;facet200&#39;, &#39;subomega301&#39;, or None.</span>
</span><span id="WeakForm-43"><a href="#WeakForm-43"><span class="linenos"> 43</span></a><span class="sd">    verbose : bool</span>
</span><span id="WeakForm-44"><a href="#WeakForm-44"><span class="linenos"> 44</span></a><span class="sd">        Display user&#39;s information. The default is False.</span>
</span><span id="WeakForm-45"><a href="#WeakForm-45"><span class="linenos"> 45</span></a><span class="sd">    mesh_dir : str</span>
</span><span id="WeakForm-46"><a href="#WeakForm-46"><span class="linenos"> 46</span></a><span class="sd">        Absolute path to the directory containing meshfile. The default is</span>
</span><span id="WeakForm-47"><a href="#WeakForm-47"><span class="linenos"> 47</span></a><span class="sd">        None.</span>
</span><span id="WeakForm-48"><a href="#WeakForm-48"><span class="linenos"> 48</span></a><span class="sd">    ext : str</span>
</span><span id="WeakForm-49"><a href="#WeakForm-49"><span class="linenos"> 49</span></a><span class="sd">        Extension given to the mesh file. The default is &#39;.vtk&#39;.</span>
</span><span id="WeakForm-50"><a href="#WeakForm-50"><span class="linenos"> 50</span></a><span class="sd">    constcoeffs : list</span>
</span><span id="WeakForm-51"><a href="#WeakForm-51"><span class="linenos"> 51</span></a><span class="sd">        Coefficients weighting the terms such that the weak form equation</span>
</span><span id="WeakForm-52"><a href="#WeakForm-52"><span class="linenos"> 52</span></a><span class="sd">        reads</span>
</span><span id="WeakForm-53"><a href="#WeakForm-53"><span class="linenos"> 53</span></a><span class="sd">            $$ \sum_{i=1}^{N_{\mathrm{terms}}} \texttt{constcoeffs[i]} \times</span>
</span><span id="WeakForm-54"><a href="#WeakForm-54"><span class="linenos"> 54</span></a><span class="sd">            \texttt{terms[i]} = 0 $$</span>
</span><span id="WeakForm-55"><a href="#WeakForm-55"><span class="linenos"> 55</span></a><span class="sd">    unknown : `sfepy.discrete.variables.FieldVariable`</span>
</span><span id="WeakForm-56"><a href="#WeakForm-56"><span class="linenos"> 56</span></a><span class="sd">        Sfepy unknown variable.</span>
</span><span id="WeakForm-57"><a href="#WeakForm-57"><span class="linenos"> 57</span></a><span class="sd">    unknown_name : str</span>
</span><span id="WeakForm-58"><a href="#WeakForm-58"><span class="linenos"> 58</span></a><span class="sd">        Name of the unknown variable. The default is &#39;u&#39;.</span>
</span><span id="WeakForm-59"><a href="#WeakForm-59"><span class="linenos"> 59</span></a><span class="sd">    test : `sfepy.discrete.variables.FieldVariable`</span>
</span><span id="WeakForm-60"><a href="#WeakForm-60"><span class="linenos"> 60</span></a><span class="sd">        Sfepy test variable.</span>
</span><span id="WeakForm-61"><a href="#WeakForm-61"><span class="linenos"> 61</span></a><span class="sd">    test_name : str</span>
</span><span id="WeakForm-62"><a href="#WeakForm-62"><span class="linenos"> 62</span></a><span class="sd">        Name of the test variable. The default is &#39;v&#39;.</span>
</span><span id="WeakForm-63"><a href="#WeakForm-63"><span class="linenos"> 63</span></a><span class="sd">    order : int</span>
</span><span id="WeakForm-64"><a href="#WeakForm-64"><span class="linenos"> 64</span></a><span class="sd">        The FE approximation order. The default is 2.</span>
</span><span id="WeakForm-65"><a href="#WeakForm-65"><span class="linenos"> 65</span></a><span class="sd">    space : str</span>
</span><span id="WeakForm-66"><a href="#WeakForm-66"><span class="linenos"> 66</span></a><span class="sd">        The function space name. The default is &#39;H1&#39;.</span>
</span><span id="WeakForm-67"><a href="#WeakForm-67"><span class="linenos"> 67</span></a><span class="sd">    poly_space_base : str</span>
</span><span id="WeakForm-68"><a href="#WeakForm-68"><span class="linenos"> 68</span></a><span class="sd">        The name of polynomial space base. The default is &#39;lagrange&#39;.</span>
</span><span id="WeakForm-69"><a href="#WeakForm-69"><span class="linenos"> 69</span></a><span class="sd">    integral : `sfepy.discrete.integrals.Integral`</span>
</span><span id="WeakForm-70"><a href="#WeakForm-70"><span class="linenos"> 70</span></a><span class="sd">        Sfepy Integral instance.</span>
</span><span id="WeakForm-71"><a href="#WeakForm-71"><span class="linenos"> 71</span></a><span class="sd">    integral_name : str</span>
</span><span id="WeakForm-72"><a href="#WeakForm-72"><span class="linenos"> 72</span></a><span class="sd">        The integral name. The default is &#39;i&#39;.</span>
</span><span id="WeakForm-73"><a href="#WeakForm-73"><span class="linenos"> 73</span></a><span class="sd">    domain : `sfepy.discrete.fem.domain.FEDomain`</span>
</span><span id="WeakForm-74"><a href="#WeakForm-74"><span class="linenos"> 74</span></a><span class="sd">        Sfepy Domain instance.</span>
</span><span id="WeakForm-75"><a href="#WeakForm-75"><span class="linenos"> 75</span></a><span class="sd">    domain_name : str</span>
</span><span id="WeakForm-76"><a href="#WeakForm-76"><span class="linenos"> 76</span></a><span class="sd">        The domain name. The default is &#39;domain&#39;.</span>
</span><span id="WeakForm-77"><a href="#WeakForm-77"><span class="linenos"> 77</span></a><span class="sd">    omega : Region</span>
</span><span id="WeakForm-78"><a href="#WeakForm-78"><span class="linenos"> 78</span></a><span class="sd">        The whole domain over which the variable are defined.</span>
</span><span id="WeakForm-79"><a href="#WeakForm-79"><span class="linenos"> 79</span></a><span class="sd">    dimension : int</span>
</span><span id="WeakForm-80"><a href="#WeakForm-80"><span class="linenos"> 80</span></a><span class="sd">        Spatial dimension of the problem (3 is the maximum).</span>
</span><span id="WeakForm-81"><a href="#WeakForm-81"><span class="linenos"> 81</span></a><span class="sd">    physical_group_ids : list of int</span>
</span><span id="WeakForm-82"><a href="#WeakForm-82"><span class="linenos"> 82</span></a><span class="sd">        All distinct physical groups identifiers.</span>
</span><span id="WeakForm-83"><a href="#WeakForm-83"><span class="linenos"> 83</span></a><span class="sd">    region_dic : dict</span>
</span><span id="WeakForm-84"><a href="#WeakForm-84"><span class="linenos"> 84</span></a><span class="sd">        Dictionary of all regions.</span>
</span><span id="WeakForm-85"><a href="#WeakForm-85"><span class="linenos"> 85</span></a><span class="sd">    subomegas : list</span>
</span><span id="WeakForm-86"><a href="#WeakForm-86"><span class="linenos"> 86</span></a><span class="sd">        List of sub regions of dimension D.</span>
</span><span id="WeakForm-87"><a href="#WeakForm-87"><span class="linenos"> 87</span></a><span class="sd">    facets : list</span>
</span><span id="WeakForm-88"><a href="#WeakForm-88"><span class="linenos"> 88</span></a><span class="sd">        List of sub regions of dimension D-1.</span>
</span><span id="WeakForm-89"><a href="#WeakForm-89"><span class="linenos"> 89</span></a><span class="sd">    edges : list</span>
</span><span id="WeakForm-90"><a href="#WeakForm-90"><span class="linenos"> 90</span></a><span class="sd">        List of sub regions of dimension 1.</span>
</span><span id="WeakForm-91"><a href="#WeakForm-91"><span class="linenos"> 91</span></a><span class="sd">    vertices : list</span>
</span><span id="WeakForm-92"><a href="#WeakForm-92"><span class="linenos"> 92</span></a><span class="sd">        List of sub regions of dimension 0.</span>
</span><span id="WeakForm-93"><a href="#WeakForm-93"><span class="linenos"> 93</span></a><span class="sd">    epbcs : list</span>
</span><span id="WeakForm-94"><a href="#WeakForm-94"><span class="linenos"> 94</span></a><span class="sd">        List of periodic boundary conditions.</span>
</span><span id="WeakForm-95"><a href="#WeakForm-95"><span class="linenos"> 95</span></a><span class="sd">    lcbcs : list</span>
</span><span id="WeakForm-96"><a href="#WeakForm-96"><span class="linenos"> 96</span></a><span class="sd">        List of linear combination boundary conditions.</span>
</span><span id="WeakForm-97"><a href="#WeakForm-97"><span class="linenos"> 97</span></a><span class="sd">    ebcs : list</span>
</span><span id="WeakForm-98"><a href="#WeakForm-98"><span class="linenos"> 98</span></a><span class="sd">        List of essential boundary conditions.</span>
</span><span id="WeakForm-99"><a href="#WeakForm-99"><span class="linenos"> 99</span></a><span class="sd">    ndofs : int</span>
</span><span id="WeakForm-100"><a href="#WeakForm-100"><span class="linenos">100</span></a><span class="sd">        Number of degrees of freedom.</span>
</span><span id="WeakForm-101"><a href="#WeakForm-101"><span class="linenos">101</span></a><span class="sd">    entity_functions : list of 2-tuple</span>
</span><span id="WeakForm-102"><a href="#WeakForm-102"><span class="linenos">102</span></a><span class="sd">        List of tuples (dim, function) for manual entity selection.</span>
</span><span id="WeakForm-103"><a href="#WeakForm-103"><span class="linenos">103</span></a><span class="sd">        The default is [].</span>
</span><span id="WeakForm-104"><a href="#WeakForm-104"><span class="linenos">104</span></a>
</span><span id="WeakForm-105"><a href="#WeakForm-105"><span class="linenos">105</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="WeakForm-106"><a href="#WeakForm-106"><span class="linenos">106</span></a>
</span><span id="WeakForm-107"><a href="#WeakForm-107"><span class="linenos">107</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm-108"><a href="#WeakForm-108"><span class="linenos">108</span></a><span class="sd">    Class variable `forbidden_mod_arg` is a list of material extra-arguments</span>
</span><span id="WeakForm-109"><a href="#WeakForm-109"><span class="linenos">109</span></a><span class="sd">    (strings) which are not to be interpreted as &#39;mod&#39; terms. Any term having</span>
</span><span id="WeakForm-110"><a href="#WeakForm-110"><span class="linenos">110</span></a><span class="sd">    at least one extra-argument not contained in this list will be casted into</span>
</span><span id="WeakForm-111"><a href="#WeakForm-111"><span class="linenos">111</span></a><span class="sd">    the `self.eqn_mod` attribute.</span>
</span><span id="WeakForm-112"><a href="#WeakForm-112"><span class="linenos">112</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="WeakForm-113"><a href="#WeakForm-113"><span class="linenos">113</span></a>    <span class="n">forbidden_mod_arg</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;update_nl&#39;</span><span class="p">,</span> <span class="s1">&#39;rho&#39;</span><span class="p">,</span> <span class="s1">&#39;rho_vac&#39;</span><span class="p">,</span> <span class="s1">&#39;Rcut&#39;</span><span class="p">]</span>
</span><span id="WeakForm-114"><a href="#WeakForm-114"><span class="linenos">114</span></a>
</span><span id="WeakForm-115"><a href="#WeakForm-115"><span class="linenos">115</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">meshfile</span><span class="p">,</span> <span class="n">terms</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="WeakForm-116"><a href="#WeakForm-116"><span class="linenos">116</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm-117"><a href="#WeakForm-117"><span class="linenos">117</span></a><span class="sd">        Construct a WeakForm instance that is an object containing all the</span>
</span><span id="WeakForm-118"><a href="#WeakForm-118"><span class="linenos">118</span></a><span class="sd">        necessary information related to a given weak form PDE.</span>
</span><span id="WeakForm-119"><a href="#WeakForm-119"><span class="linenos">119</span></a>
</span><span id="WeakForm-120"><a href="#WeakForm-120"><span class="linenos">120</span></a><span class="sd">        Parameters</span>
</span><span id="WeakForm-121"><a href="#WeakForm-121"><span class="linenos">121</span></a><span class="sd">        ----------</span>
</span><span id="WeakForm-122"><a href="#WeakForm-122"><span class="linenos">122</span></a><span class="sd">        name : str</span>
</span><span id="WeakForm-123"><a href="#WeakForm-123"><span class="linenos">123</span></a><span class="sd">            Name of the weak form.</span>
</span><span id="WeakForm-124"><a href="#WeakForm-124"><span class="linenos">124</span></a><span class="sd">        meshfile : str</span>
</span><span id="WeakForm-125"><a href="#WeakForm-125"><span class="linenos">125</span></a><span class="sd">            Name of the meshfile e.g. &#39;my_mesh.vtk&#39; located in the specified</span>
</span><span id="WeakForm-126"><a href="#WeakForm-126"><span class="linenos">126</span></a><span class="sd">            mesh directory.</span>
</span><span id="WeakForm-127"><a href="#WeakForm-127"><span class="linenos">127</span></a><span class="sd">        terms : list</span>
</span><span id="WeakForm-128"><a href="#WeakForm-128"><span class="linenos">128</span></a><span class="sd">            List containing the terms of the weak form PDE. Each element of the</span>
</span><span id="WeakForm-129"><a href="#WeakForm-129"><span class="linenos">129</span></a><span class="sd">            list is a list containing:</span>
</span><span id="WeakForm-130"><a href="#WeakForm-130"><span class="linenos">130</span></a><span class="sd">                - a material function or None.</span>
</span><span id="WeakForm-131"><a href="#WeakForm-131"><span class="linenos">131</span></a><span class="sd">                - a Sfepy string of the term, e.g. &#39;dw_laplace&#39;, or</span>
</span><span id="WeakForm-132"><a href="#WeakForm-132"><span class="linenos">132</span></a><span class="sd">                &#39;dw_volume&#39;. https://sfepy.org/doc-devel/terms_overview.html.</span>
</span><span id="WeakForm-133"><a href="#WeakForm-133"><span class="linenos">133</span></a><span class="sd">                - a region&#39;s name e.g. &#39;facet200&#39;, &#39;subomega301&#39;, or None.</span>
</span><span id="WeakForm-134"><a href="#WeakForm-134"><span class="linenos">134</span></a>
</span><span id="WeakForm-135"><a href="#WeakForm-135"><span class="linenos">135</span></a><span class="sd">        Other Parameters</span>
</span><span id="WeakForm-136"><a href="#WeakForm-136"><span class="linenos">136</span></a><span class="sd">        ----------------</span>
</span><span id="WeakForm-137"><a href="#WeakForm-137"><span class="linenos">137</span></a><span class="sd">        mesh_dir : str</span>
</span><span id="WeakForm-138"><a href="#WeakForm-138"><span class="linenos">138</span></a><span class="sd">            Directory where the mesh files are located. The default is None.</span>
</span><span id="WeakForm-139"><a href="#WeakForm-139"><span class="linenos">139</span></a><span class="sd">        ext : str</span>
</span><span id="WeakForm-140"><a href="#WeakForm-140"><span class="linenos">140</span></a><span class="sd">            Extension of the mesh file. The default is &#39;.vtk&#39;.</span>
</span><span id="WeakForm-141"><a href="#WeakForm-141"><span class="linenos">141</span></a><span class="sd">        constcoeffs : list</span>
</span><span id="WeakForm-142"><a href="#WeakForm-142"><span class="linenos">142</span></a><span class="sd">            Coefficients weighting the terms such that the weak form equation</span>
</span><span id="WeakForm-143"><a href="#WeakForm-143"><span class="linenos">143</span></a><span class="sd">            reads</span>
</span><span id="WeakForm-144"><a href="#WeakForm-144"><span class="linenos">144</span></a><span class="sd">                $$ \sum_{i=1}^{N_{\mathrm{terms}}} \texttt{constcoeffs[i]}</span>
</span><span id="WeakForm-145"><a href="#WeakForm-145"><span class="linenos">145</span></a><span class="sd">                \times \texttt{terms[i]} = 0 $$</span>
</span><span id="WeakForm-146"><a href="#WeakForm-146"><span class="linenos">146</span></a><span class="sd">        dirichlet_bc_facet : list</span>
</span><span id="WeakForm-147"><a href="#WeakForm-147"><span class="linenos">147</span></a><span class="sd">            List of dirichlet boundary conditions applied to facets. This list</span>
</span><span id="WeakForm-148"><a href="#WeakForm-148"><span class="linenos">148</span></a><span class="sd">            must be the same length as the number of facets defined in the</span>
</span><span id="WeakForm-149"><a href="#WeakForm-149"><span class="linenos">149</span></a><span class="sd">            domain. Elements of the list are such that:</span>
</span><span id="WeakForm-150"><a href="#WeakForm-150"><span class="linenos">150</span></a><span class="sd">                - if `dirichlet_bc_facet`[k] is None, then facets[k] is free of</span>
</span><span id="WeakForm-151"><a href="#WeakForm-151"><span class="linenos">151</span></a><span class="sd">                any essential boundary condition.</span>
</span><span id="WeakForm-152"><a href="#WeakForm-152"><span class="linenos">152</span></a><span class="sd">                - if `dirichlet_bc_facet`[k] is a number, then facets[k] is</span>
</span><span id="WeakForm-153"><a href="#WeakForm-153"><span class="linenos">153</span></a><span class="sd">                constrained by a constant essential boundary condition.</span>
</span><span id="WeakForm-154"><a href="#WeakForm-154"><span class="linenos">154</span></a><span class="sd">                - if `dirichlet_bc_facet`[k] is a function, then facets[k] is</span>
</span><span id="WeakForm-155"><a href="#WeakForm-155"><span class="linenos">155</span></a><span class="sd">                constrained by a dirichlet boundary condition calculated by the</span>
</span><span id="WeakForm-156"><a href="#WeakForm-156"><span class="linenos">156</span></a><span class="sd">                function.</span>
</span><span id="WeakForm-157"><a href="#WeakForm-157"><span class="linenos">157</span></a><span class="sd">            The default is None.</span>
</span><span id="WeakForm-158"><a href="#WeakForm-158"><span class="linenos">158</span></a><span class="sd">        dirichlet_bc_edge : list</span>
</span><span id="WeakForm-159"><a href="#WeakForm-159"><span class="linenos">159</span></a><span class="sd">            List of dirichlet boundary conditions applied to edges. This list</span>
</span><span id="WeakForm-160"><a href="#WeakForm-160"><span class="linenos">160</span></a><span class="sd">            must be the same length as the number of edges defined in the</span>
</span><span id="WeakForm-161"><a href="#WeakForm-161"><span class="linenos">161</span></a><span class="sd">            domain. The default is None.</span>
</span><span id="WeakForm-162"><a href="#WeakForm-162"><span class="linenos">162</span></a><span class="sd">        dirichlet_bc_vertex : list</span>
</span><span id="WeakForm-163"><a href="#WeakForm-163"><span class="linenos">163</span></a><span class="sd">            List of dirichlet boundary conditions applied to vertices. This</span>
</span><span id="WeakForm-164"><a href="#WeakForm-164"><span class="linenos">164</span></a><span class="sd">            list must be the same length as the number of edges defined in the</span>
</span><span id="WeakForm-165"><a href="#WeakForm-165"><span class="linenos">165</span></a><span class="sd">            domain. The default is None.</span>
</span><span id="WeakForm-166"><a href="#WeakForm-166"><span class="linenos">166</span></a><span class="sd">        verbose : bool</span>
</span><span id="WeakForm-167"><a href="#WeakForm-167"><span class="linenos">167</span></a><span class="sd">            Display user&#39;s information. The default is False.</span>
</span><span id="WeakForm-168"><a href="#WeakForm-168"><span class="linenos">168</span></a><span class="sd">        domain_name : str</span>
</span><span id="WeakForm-169"><a href="#WeakForm-169"><span class="linenos">169</span></a><span class="sd">            The domain name. The default is &#39;domain&#39;.</span>
</span><span id="WeakForm-170"><a href="#WeakForm-170"><span class="linenos">170</span></a><span class="sd">        integral_name : str</span>
</span><span id="WeakForm-171"><a href="#WeakForm-171"><span class="linenos">171</span></a><span class="sd">            The integral name. The default is &#39;i&#39;.</span>
</span><span id="WeakForm-172"><a href="#WeakForm-172"><span class="linenos">172</span></a><span class="sd">        space : str</span>
</span><span id="WeakForm-173"><a href="#WeakForm-173"><span class="linenos">173</span></a><span class="sd">            The function space name. The default is &#39;H1&#39;.</span>
</span><span id="WeakForm-174"><a href="#WeakForm-174"><span class="linenos">174</span></a><span class="sd">        poly_space_base : str</span>
</span><span id="WeakForm-175"><a href="#WeakForm-175"><span class="linenos">175</span></a><span class="sd">            The name of polynomial space base. The default is &#39;lagrange&#39;.</span>
</span><span id="WeakForm-176"><a href="#WeakForm-176"><span class="linenos">176</span></a><span class="sd">        test_name : str</span>
</span><span id="WeakForm-177"><a href="#WeakForm-177"><span class="linenos">177</span></a><span class="sd">            Name of the test variable. The default is &#39;v&#39;.</span>
</span><span id="WeakForm-178"><a href="#WeakForm-178"><span class="linenos">178</span></a><span class="sd">        unknown_name : str</span>
</span><span id="WeakForm-179"><a href="#WeakForm-179"><span class="linenos">179</span></a><span class="sd">            Name of the unknown variable. The default is &#39;u&#39;.</span>
</span><span id="WeakForm-180"><a href="#WeakForm-180"><span class="linenos">180</span></a><span class="sd">        densities : list</span>
</span><span id="WeakForm-181"><a href="#WeakForm-181"><span class="linenos">181</span></a><span class="sd">            List of density functions or constants. The length of this list</span>
</span><span id="WeakForm-182"><a href="#WeakForm-182"><span class="linenos">182</span></a><span class="sd">            must match the number of sub*domains in the mesh.</span>
</span><span id="WeakForm-183"><a href="#WeakForm-183"><span class="linenos">183</span></a><span class="sd">            The default is None.</span>
</span><span id="WeakForm-184"><a href="#WeakForm-184"><span class="linenos">184</span></a><span class="sd">        entity_functions : list of 2-tuple</span>
</span><span id="WeakForm-185"><a href="#WeakForm-185"><span class="linenos">185</span></a><span class="sd">            List of tuples (dim, function) for manual entity selection.</span>
</span><span id="WeakForm-186"><a href="#WeakForm-186"><span class="linenos">186</span></a><span class="sd">            The default is [].</span>
</span><span id="WeakForm-187"><a href="#WeakForm-187"><span class="linenos">187</span></a>
</span><span id="WeakForm-188"><a href="#WeakForm-188"><span class="linenos">188</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WeakForm-189"><a href="#WeakForm-189"><span class="linenos">189</span></a>
</span><span id="WeakForm-190"><a href="#WeakForm-190"><span class="linenos">190</span></a>        <span class="c1"># keyword arguments handling</span>
</span><span id="WeakForm-191"><a href="#WeakForm-191"><span class="linenos">191</span></a>        <span class="n">mesh_dir</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mesh_dir&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="WeakForm-192"><a href="#WeakForm-192"><span class="linenos">192</span></a>        <span class="n">ext</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ext&#39;</span><span class="p">,</span> <span class="s1">&#39;.vtk&#39;</span><span class="p">)</span>
</span><span id="WeakForm-193"><a href="#WeakForm-193"><span class="linenos">193</span></a>        <span class="n">constcoeffs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;constcoeffs&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">terms</span><span class="p">))</span>
</span><span id="WeakForm-194"><a href="#WeakForm-194"><span class="linenos">194</span></a>        <span class="n">dirichlet_bc_vertex</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dirichlet_bc_vertex&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="WeakForm-195"><a href="#WeakForm-195"><span class="linenos">195</span></a>        <span class="n">dirichlet_bc_edge</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dirichlet_bc_edge&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="WeakForm-196"><a href="#WeakForm-196"><span class="linenos">196</span></a>        <span class="n">dirichlet_bc_facet</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dirichlet_bc_facet&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="WeakForm-197"><a href="#WeakForm-197"><span class="linenos">197</span></a>        <span class="n">dbc_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">dirichlet_bc_vertex</span><span class="p">,</span> <span class="n">dirichlet_bc_edge</span><span class="p">,</span> <span class="n">dirichlet_bc_facet</span><span class="p">]</span>
</span><span id="WeakForm-198"><a href="#WeakForm-198"><span class="linenos">198</span></a>
</span><span id="WeakForm-199"><a href="#WeakForm-199"><span class="linenos">199</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;verbose&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="WeakForm-200"><a href="#WeakForm-200"><span class="linenos">200</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="WeakForm-201"><a href="#WeakForm-201"><span class="linenos">201</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">constcoeffs</span> <span class="o">=</span> <span class="n">constcoeffs</span>
</span><span id="WeakForm-202"><a href="#WeakForm-202"><span class="linenos">202</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unknown_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;unknown_name&#39;</span><span class="p">,</span> <span class="s1">&#39;u&#39;</span><span class="p">)</span>
</span><span id="WeakForm-203"><a href="#WeakForm-203"><span class="linenos">203</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">test_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;test_name&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">)</span>
</span><span id="WeakForm-204"><a href="#WeakForm-204"><span class="linenos">204</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;order&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="WeakForm-205"><a href="#WeakForm-205"><span class="linenos">205</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">space</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;space&#39;</span><span class="p">,</span> <span class="s1">&#39;H1&#39;</span><span class="p">)</span>
</span><span id="WeakForm-206"><a href="#WeakForm-206"><span class="linenos">206</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">poly_space_base</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;poly_space_base&#39;</span><span class="p">,</span> <span class="s1">&#39;lagrange&#39;</span><span class="p">)</span>
</span><span id="WeakForm-207"><a href="#WeakForm-207"><span class="linenos">207</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">integral_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;integral_name&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">)</span>
</span><span id="WeakForm-208"><a href="#WeakForm-208"><span class="linenos">208</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">domain_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;domain_name&#39;</span><span class="p">,</span> <span class="s1">&#39;domain&#39;</span><span class="p">)</span>
</span><span id="WeakForm-209"><a href="#WeakForm-209"><span class="linenos">209</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nterms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">terms</span><span class="p">)</span>
</span><span id="WeakForm-210"><a href="#WeakForm-210"><span class="linenos">210</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">meshfile</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="WeakForm-211"><a href="#WeakForm-211"><span class="linenos">211</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">meshfile</span> <span class="o">=</span> <span class="n">get_meshsource</span><span class="p">(</span><span class="n">meshfile</span><span class="p">,</span> <span class="n">mesh_dir</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span>
</span><span id="WeakForm-212"><a href="#WeakForm-212"><span class="linenos">212</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meshfile</span><span class="p">)</span>
</span><span id="WeakForm-213"><a href="#WeakForm-213"><span class="linenos">213</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">physical_group_ids</span> <span class="o">=</span> <span class="n">get_physical_group_ids</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meshfile</span><span class="p">)</span>
</span><span id="WeakForm-214"><a href="#WeakForm-214"><span class="linenos">214</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="WeakForm-215"><a href="#WeakForm-215"><span class="linenos">215</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">meshfile</span>
</span><span id="WeakForm-216"><a href="#WeakForm-216"><span class="linenos">216</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">physical_group_ids</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="WeakForm-217"><a href="#WeakForm-217"><span class="linenos">217</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="n">FEDomain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">)</span>
</span><span id="WeakForm-218"><a href="#WeakForm-218"><span class="linenos">218</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">omega</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span><span class="s1">&#39;omega&#39;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">)</span>
</span><span id="WeakForm-219"><a href="#WeakForm-219"><span class="linenos">219</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">omega</span><span class="o">.</span><span class="n">dim</span>
</span><span id="WeakForm-220"><a href="#WeakForm-220"><span class="linenos">220</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">entity_functions</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;entity_functions&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="WeakForm-221"><a href="#WeakForm-221"><span class="linenos">221</span></a>
</span><span id="WeakForm-222"><a href="#WeakForm-222"><span class="linenos">222</span></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">terms</span><span class="p">)</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">constcoeffs</span><span class="p">)</span>
</span><span id="WeakForm-223"><a href="#WeakForm-223"><span class="linenos">223</span></a>
</span><span id="WeakForm-224"><a href="#WeakForm-224"><span class="linenos">224</span></a>        <span class="c1"># Regions (cells, facets, edges, vertices):</span>
</span><span id="WeakForm-225"><a href="#WeakForm-225"><span class="linenos">225</span></a>        <span class="c1"># - embedded in the mesh file</span>
</span><span id="WeakForm-226"><a href="#WeakForm-226"><span class="linenos">226</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">region_dic</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;omega&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">omega</span><span class="p">}</span>
</span><span id="WeakForm-227"><a href="#WeakForm-227"><span class="linenos">227</span></a>        <span class="n">subomegas</span><span class="p">,</span> <span class="n">facets</span><span class="p">,</span> <span class="n">edges</span><span class="p">,</span> <span class="n">vertices</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
</span><span id="WeakForm-228"><a href="#WeakForm-228"><span class="linenos">228</span></a>        <span class="c1"># subool = len([x for x in self.physical_group_ids if x &gt;= 300]) &gt;= 2</span>
</span><span id="WeakForm-229"><a href="#WeakForm-229"><span class="linenos">229</span></a>        <span class="k">for</span> <span class="n">group_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">physical_group_ids</span><span class="p">:</span>
</span><span id="WeakForm-230"><a href="#WeakForm-230"><span class="linenos">230</span></a>            <span class="k">if</span> <span class="n">group_id</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">group_id</span> <span class="o">&lt;=</span> <span class="mi">99</span><span class="p">:</span>
</span><span id="WeakForm-231"><a href="#WeakForm-231"><span class="linenos">231</span></a>                <span class="n">vertices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span>
</span><span id="WeakForm-232"><a href="#WeakForm-232"><span class="linenos">232</span></a>                    <span class="s1">&#39;node</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">group_id</span><span class="p">,</span>
</span><span id="WeakForm-233"><a href="#WeakForm-233"><span class="linenos">233</span></a>                    <span class="s1">&#39;vertices of group </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">group_id</span><span class="p">,</span> <span class="c1"># selection of vertices</span>
</span><span id="WeakForm-234"><a href="#WeakForm-234"><span class="linenos">234</span></a>                    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;vertex&#39;</span><span class="p">))</span>
</span><span id="WeakForm-235"><a href="#WeakForm-235"><span class="linenos">235</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">region_dic</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">group_id</span><span class="p">)]</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="WeakForm-236"><a href="#WeakForm-236"><span class="linenos">236</span></a>            <span class="k">elif</span> <span class="n">group_id</span> <span class="o">&gt;=</span> <span class="mi">100</span> <span class="ow">and</span> <span class="n">group_id</span> <span class="o">&lt;=</span> <span class="mi">199</span><span class="p">:</span>
</span><span id="WeakForm-237"><a href="#WeakForm-237"><span class="linenos">237</span></a>                <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span>
</span><span id="WeakForm-238"><a href="#WeakForm-238"><span class="linenos">238</span></a>                    <span class="s1">&#39;edge</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">group_id</span><span class="p">,</span>
</span><span id="WeakForm-239"><a href="#WeakForm-239"><span class="linenos">239</span></a>                    <span class="s1">&#39;vertices of group </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">group_id</span><span class="p">,</span> <span class="c1"># selection of vertices</span>
</span><span id="WeakForm-240"><a href="#WeakForm-240"><span class="linenos">240</span></a>                    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;edge&#39;</span><span class="p">))</span>
</span><span id="WeakForm-241"><a href="#WeakForm-241"><span class="linenos">241</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">region_dic</span><span class="p">[</span><span class="s1">&#39;edge&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">group_id</span><span class="p">)]</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="WeakForm-242"><a href="#WeakForm-242"><span class="linenos">242</span></a>            <span class="k">elif</span> <span class="n">group_id</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="ow">and</span> <span class="n">group_id</span> <span class="o">&lt;=</span> <span class="mi">299</span><span class="p">:</span>
</span><span id="WeakForm-243"><a href="#WeakForm-243"><span class="linenos">243</span></a>                <span class="n">facets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span>
</span><span id="WeakForm-244"><a href="#WeakForm-244"><span class="linenos">244</span></a>                    <span class="s1">&#39;facet</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">group_id</span><span class="p">,</span>
</span><span id="WeakForm-245"><a href="#WeakForm-245"><span class="linenos">245</span></a>                    <span class="s1">&#39;vertices of group </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">group_id</span><span class="p">,</span> <span class="c1"># selection of vertices</span>
</span><span id="WeakForm-246"><a href="#WeakForm-246"><span class="linenos">246</span></a>                    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;facet&#39;</span><span class="p">))</span>
</span><span id="WeakForm-247"><a href="#WeakForm-247"><span class="linenos">247</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">region_dic</span><span class="p">[</span><span class="s1">&#39;facet&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">group_id</span><span class="p">)]</span> <span class="o">=</span> <span class="n">facets</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="WeakForm-248"><a href="#WeakForm-248"><span class="linenos">248</span></a>            <span class="k">elif</span> <span class="n">group_id</span> <span class="o">&gt;=</span> <span class="mi">300</span><span class="p">:</span>
</span><span id="WeakForm-249"><a href="#WeakForm-249"><span class="linenos">249</span></a>                <span class="n">subomegas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span>
</span><span id="WeakForm-250"><a href="#WeakForm-250"><span class="linenos">250</span></a>                    <span class="s1">&#39;subomega</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">group_id</span><span class="p">,</span>
</span><span id="WeakForm-251"><a href="#WeakForm-251"><span class="linenos">251</span></a>                    <span class="s1">&#39;cells of group </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">group_id</span><span class="p">,</span> <span class="c1"># selection of cells</span>
</span><span id="WeakForm-252"><a href="#WeakForm-252"><span class="linenos">252</span></a>                    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cell&#39;</span><span class="p">))</span>
</span><span id="WeakForm-253"><a href="#WeakForm-253"><span class="linenos">253</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">region_dic</span><span class="p">[</span><span class="s1">&#39;subomega&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">group_id</span><span class="p">)]</span> <span class="o">=</span> <span class="n">subomegas</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="WeakForm-254"><a href="#WeakForm-254"><span class="linenos">254</span></a>
</span><span id="WeakForm-255"><a href="#WeakForm-255"><span class="linenos">255</span></a>        <span class="c1"># - specified manually through a function of coordinates</span>
</span><span id="WeakForm-256"><a href="#WeakForm-256"><span class="linenos">256</span></a>        <span class="k">for</span> <span class="n">dimFunc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entity_functions</span><span class="p">:</span>
</span><span id="WeakForm-257"><a href="#WeakForm-257"><span class="linenos">257</span></a>            <span class="n">dim</span><span class="p">,</span> <span class="n">func</span> <span class="o">=</span> <span class="n">dimFunc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dimFunc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="WeakForm-258"><a href="#WeakForm-258"><span class="linenos">258</span></a>            <span class="n">funcname</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="WeakForm-259"><a href="#WeakForm-259"><span class="linenos">259</span></a>            <span class="k">if</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="WeakForm-260"><a href="#WeakForm-260"><span class="linenos">260</span></a>                <span class="n">nb</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span>
</span><span id="WeakForm-261"><a href="#WeakForm-261"><span class="linenos">261</span></a>                <span class="n">vertices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span>
</span><span id="WeakForm-262"><a href="#WeakForm-262"><span class="linenos">262</span></a>                    <span class="s1">&#39;node</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">nb</span><span class="p">,</span>
</span><span id="WeakForm-263"><a href="#WeakForm-263"><span class="linenos">263</span></a>                    <span class="s1">&#39;vertices by </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">funcname</span><span class="p">,</span>
</span><span id="WeakForm-264"><a href="#WeakForm-264"><span class="linenos">264</span></a>                    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;vertex&#39;</span><span class="p">,</span>
</span><span id="WeakForm-265"><a href="#WeakForm-265"><span class="linenos">265</span></a>                    <span class="n">functions</span><span class="o">=</span><span class="p">{</span><span class="n">funcname</span> <span class="p">:</span> <span class="n">func</span><span class="p">}))</span>
</span><span id="WeakForm-266"><a href="#WeakForm-266"><span class="linenos">266</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">region_dic</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nb</span><span class="p">)]</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="WeakForm-267"><a href="#WeakForm-267"><span class="linenos">267</span></a>
</span><span id="WeakForm-268"><a href="#WeakForm-268"><span class="linenos">268</span></a>            <span class="k">elif</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="WeakForm-269"><a href="#WeakForm-269"><span class="linenos">269</span></a>                <span class="n">nb</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span>
</span><span id="WeakForm-270"><a href="#WeakForm-270"><span class="linenos">270</span></a>                <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span>
</span><span id="WeakForm-271"><a href="#WeakForm-271"><span class="linenos">271</span></a>                    <span class="s1">&#39;edge</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">nb</span><span class="p">,</span>
</span><span id="WeakForm-272"><a href="#WeakForm-272"><span class="linenos">272</span></a>                    <span class="s1">&#39;vertices by </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">funcname</span><span class="p">,</span>
</span><span id="WeakForm-273"><a href="#WeakForm-273"><span class="linenos">273</span></a>                    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;edge&#39;</span><span class="p">,</span>
</span><span id="WeakForm-274"><a href="#WeakForm-274"><span class="linenos">274</span></a>                    <span class="n">functions</span><span class="o">=</span><span class="p">{</span><span class="n">funcname</span> <span class="p">:</span> <span class="n">func</span><span class="p">}))</span>
</span><span id="WeakForm-275"><a href="#WeakForm-275"><span class="linenos">275</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">region_dic</span><span class="p">[</span><span class="s1">&#39;edge&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nb</span><span class="p">)]</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="WeakForm-276"><a href="#WeakForm-276"><span class="linenos">276</span></a>
</span><span id="WeakForm-277"><a href="#WeakForm-277"><span class="linenos">277</span></a>            <span class="k">elif</span> <span class="p">(</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
</span><span id="WeakForm-278"><a href="#WeakForm-278"><span class="linenos">278</span></a>                    <span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
</span><span id="WeakForm-279"><a href="#WeakForm-279"><span class="linenos">279</span></a>                <span class="n">nb</span> <span class="o">=</span> <span class="mi">200</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">facets</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span>
</span><span id="WeakForm-280"><a href="#WeakForm-280"><span class="linenos">280</span></a>                <span class="n">facets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span>
</span><span id="WeakForm-281"><a href="#WeakForm-281"><span class="linenos">281</span></a>                    <span class="s1">&#39;facet</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">nb</span><span class="p">,</span>
</span><span id="WeakForm-282"><a href="#WeakForm-282"><span class="linenos">282</span></a>                    <span class="s1">&#39;vertices by </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">funcname</span><span class="p">,</span>
</span><span id="WeakForm-283"><a href="#WeakForm-283"><span class="linenos">283</span></a>                    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;facet&#39;</span><span class="p">,</span>
</span><span id="WeakForm-284"><a href="#WeakForm-284"><span class="linenos">284</span></a>                    <span class="n">functions</span><span class="o">=</span><span class="p">{</span><span class="n">funcname</span> <span class="p">:</span> <span class="n">func</span><span class="p">}))</span>
</span><span id="WeakForm-285"><a href="#WeakForm-285"><span class="linenos">285</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">region_dic</span><span class="p">[</span><span class="s1">&#39;facet&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nb</span><span class="p">)]</span> <span class="o">=</span> <span class="n">facets</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="WeakForm-286"><a href="#WeakForm-286"><span class="linenos">286</span></a>
</span><span id="WeakForm-287"><a href="#WeakForm-287"><span class="linenos">287</span></a>            <span class="k">elif</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="WeakForm-288"><a href="#WeakForm-288"><span class="linenos">288</span></a>                <span class="n">nb</span> <span class="o">=</span> <span class="mi">300</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">subomegas</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span>
</span><span id="WeakForm-289"><a href="#WeakForm-289"><span class="linenos">289</span></a>                <span class="n">subomegas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span>
</span><span id="WeakForm-290"><a href="#WeakForm-290"><span class="linenos">290</span></a>                    <span class="s1">&#39;subomega</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">nb</span><span class="p">,</span>
</span><span id="WeakForm-291"><a href="#WeakForm-291"><span class="linenos">291</span></a>                    <span class="s1">&#39;cells by </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">funcname</span><span class="p">,</span>
</span><span id="WeakForm-292"><a href="#WeakForm-292"><span class="linenos">292</span></a>                    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cell&#39;</span><span class="p">,</span>
</span><span id="WeakForm-293"><a href="#WeakForm-293"><span class="linenos">293</span></a>                    <span class="n">functions</span><span class="o">=</span><span class="p">{</span><span class="n">funcname</span> <span class="p">:</span> <span class="n">func</span><span class="p">}))</span>
</span><span id="WeakForm-294"><a href="#WeakForm-294"><span class="linenos">294</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">region_dic</span><span class="p">[</span><span class="s1">&#39;subomega&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nb</span><span class="p">)]</span> <span class="o">=</span> <span class="n">subomegas</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="WeakForm-295"><a href="#WeakForm-295"><span class="linenos">295</span></a>
</span><span id="WeakForm-296"><a href="#WeakForm-296"><span class="linenos">296</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">subomegas</span> <span class="o">=</span> <span class="n">subomegas</span>
</span><span id="WeakForm-297"><a href="#WeakForm-297"><span class="linenos">297</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">facets</span> <span class="o">=</span> <span class="n">facets</span>
</span><span id="WeakForm-298"><a href="#WeakForm-298"><span class="linenos">298</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">edges</span> <span class="o">=</span> <span class="n">edges</span>
</span><span id="WeakForm-299"><a href="#WeakForm-299"><span class="linenos">299</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="n">vertices</span>
</span><span id="WeakForm-300"><a href="#WeakForm-300"><span class="linenos">300</span></a>
</span><span id="WeakForm-301"><a href="#WeakForm-301"><span class="linenos">301</span></a>        <span class="c1"># Density profiles</span>
</span><span id="WeakForm-302"><a href="#WeakForm-302"><span class="linenos">302</span></a>        <span class="n">densities</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;densities&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="WeakForm-303"><a href="#WeakForm-303"><span class="linenos">303</span></a>        <span class="k">if</span> <span class="n">densities</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="WeakForm-304"><a href="#WeakForm-304"><span class="linenos">304</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">densities</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">subomegas</span><span class="p">):</span>
</span><span id="WeakForm-305"><a href="#WeakForm-305"><span class="linenos">305</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;More density profiles than sub-domains&quot;</span><span class="p">)</span>
</span><span id="WeakForm-306"><a href="#WeakForm-306"><span class="linenos">306</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">densities</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="WeakForm-307"><a href="#WeakForm-307"><span class="linenos">307</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">densities</span><span class="p">)):</span>
</span><span id="WeakForm-308"><a href="#WeakForm-308"><span class="linenos">308</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="p">[</span><span class="n">subomegas</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">densities</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="WeakForm-309"><a href="#WeakForm-309"><span class="linenos">309</span></a>
</span><span id="WeakForm-310"><a href="#WeakForm-310"><span class="linenos">310</span></a>        <span class="c1"># Field setup</span>
</span><span id="WeakForm-311"><a href="#WeakForm-311"><span class="linenos">311</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">field</span> <span class="o">=</span> <span class="n">Field</span><span class="o">.</span><span class="n">from_args</span><span class="p">(</span><span class="s1">&#39;fu&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="s1">&#39;scalar&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">omega</span><span class="p">,</span>
</span><span id="WeakForm-312"><a href="#WeakForm-312"><span class="linenos">312</span></a>                                     <span class="n">approx_order</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">space</span><span class="p">,</span>
</span><span id="WeakForm-313"><a href="#WeakForm-313"><span class="linenos">313</span></a>                                     <span class="n">poly_space_base</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">poly_space_base</span><span class="p">)</span>
</span><span id="WeakForm-314"><a href="#WeakForm-314"><span class="linenos">314</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ndofs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">n_nod</span>
</span><span id="WeakForm-315"><a href="#WeakForm-315"><span class="linenos">315</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unknown</span> <span class="o">=</span> <span class="n">FieldVariable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unknown_name</span><span class="p">,</span> <span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="p">)</span>
</span><span id="WeakForm-316"><a href="#WeakForm-316"><span class="linenos">316</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">test</span> <span class="o">=</span> <span class="n">FieldVariable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_name</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="p">,</span>
</span><span id="WeakForm-317"><a href="#WeakForm-317"><span class="linenos">317</span></a>                                  <span class="n">primary_var_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unknown_name</span><span class="p">)</span>
</span><span id="WeakForm-318"><a href="#WeakForm-318"><span class="linenos">318</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">integral</span> <span class="o">=</span> <span class="n">Integral</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">integral_name</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span><span id="WeakForm-319"><a href="#WeakForm-319"><span class="linenos">319</span></a>
</span><span id="WeakForm-320"><a href="#WeakForm-320"><span class="linenos">320</span></a>        <span class="c1"># Dirichlet boundary conditions on entities of dimension &lt; D</span>
</span><span id="WeakForm-321"><a href="#WeakForm-321"><span class="linenos">321</span></a>        <span class="n">ent_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">facets</span><span class="p">]</span>
</span><span id="WeakForm-322"><a href="#WeakForm-322"><span class="linenos">322</span></a>        <span class="n">ebcs_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="WeakForm-323"><a href="#WeakForm-323"><span class="linenos">323</span></a>        <span class="k">for</span> <span class="n">k_dbcs</span><span class="p">,</span> <span class="n">dbcs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dbc_list</span><span class="p">):</span>
</span><span id="WeakForm-324"><a href="#WeakForm-324"><span class="linenos">324</span></a>            <span class="k">if</span> <span class="n">dbcs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="WeakForm-325"><a href="#WeakForm-325"><span class="linenos">325</span></a>                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">dbcs</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">ent_list</span><span class="p">[</span><span class="n">k_dbcs</span><span class="p">])</span>
</span><span id="WeakForm-326"><a href="#WeakForm-326"><span class="linenos">326</span></a>                <span class="k">for</span> <span class="n">k_dbc</span><span class="p">,</span> <span class="n">dbc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dbcs</span><span class="p">):</span>
</span><span id="WeakForm-327"><a href="#WeakForm-327"><span class="linenos">327</span></a>                    <span class="k">if</span> <span class="n">dbc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="WeakForm-328"><a href="#WeakForm-328"><span class="linenos">328</span></a>                        <span class="n">ebc_name</span> <span class="o">=</span> <span class="s1">&#39;ebc_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k_dbcs</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k_dbc</span><span class="p">)</span>
</span><span id="WeakForm-329"><a href="#WeakForm-329"><span class="linenos">329</span></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dbc</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
</span><span id="WeakForm-330"><a href="#WeakForm-330"><span class="linenos">330</span></a>                            <span class="n">ebc</span> <span class="o">=</span> <span class="n">EssentialBC</span><span class="p">(</span>
</span><span id="WeakForm-331"><a href="#WeakForm-331"><span class="linenos">331</span></a>                                <span class="n">ebc_name</span><span class="p">,</span>
</span><span id="WeakForm-332"><a href="#WeakForm-332"><span class="linenos">332</span></a>                                <span class="n">ent_list</span><span class="p">[</span><span class="n">k_dbcs</span><span class="p">][</span><span class="n">k_dbc</span><span class="p">],</span>
</span><span id="WeakForm-333"><a href="#WeakForm-333"><span class="linenos">333</span></a>                                <span class="p">{</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.all&#39;</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">unknown_name</span> <span class="p">:</span> <span class="n">dbc</span><span class="p">})</span>
</span><span id="WeakForm-334"><a href="#WeakForm-334"><span class="linenos">334</span></a>                        <span class="k">elif</span> <span class="n">callable</span><span class="p">(</span><span class="n">dbc</span><span class="p">):</span>
</span><span id="WeakForm-335"><a href="#WeakForm-335"><span class="linenos">335</span></a><span class="w">                            </span><span class="sd">&quot;&quot;&quot; Function signature should be </span>
</span><span id="WeakForm-336"><a href="#WeakForm-336"><span class="linenos">336</span></a><span class="sd">                            dbc(ts, coors, **kwargs) &quot;&quot;&quot;</span>
</span><span id="WeakForm-337"><a href="#WeakForm-337"><span class="linenos">337</span></a>                            <span class="n">ebc_func_name</span> <span class="o">=</span> <span class="s1">&#39;ebc_func_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k_dbcs</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k_dbc</span><span class="p">)</span>
</span><span id="WeakForm-338"><a href="#WeakForm-338"><span class="linenos">338</span></a>                            <span class="n">ebc_func</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="n">ebc_func_name</span><span class="p">,</span> <span class="n">dbc</span><span class="p">)</span>
</span><span id="WeakForm-339"><a href="#WeakForm-339"><span class="linenos">339</span></a>                            <span class="n">ebc</span> <span class="o">=</span> <span class="n">EssentialBC</span><span class="p">(</span>
</span><span id="WeakForm-340"><a href="#WeakForm-340"><span class="linenos">340</span></a>                                <span class="n">ebc_name</span><span class="p">,</span>
</span><span id="WeakForm-341"><a href="#WeakForm-341"><span class="linenos">341</span></a>                                <span class="n">ent_list</span><span class="p">[</span><span class="n">k_dbcs</span><span class="p">][</span><span class="n">k_dbc</span><span class="p">],</span>
</span><span id="WeakForm-342"><a href="#WeakForm-342"><span class="linenos">342</span></a>                                <span class="p">{</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.all&#39;</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">unknown_name</span> <span class="p">:</span> <span class="n">ebc_func</span><span class="p">})</span>
</span><span id="WeakForm-343"><a href="#WeakForm-343"><span class="linenos">343</span></a>                        <span class="n">ebcs_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ebc</span><span class="p">)</span>
</span><span id="WeakForm-344"><a href="#WeakForm-344"><span class="linenos">344</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ebcs</span> <span class="o">=</span> <span class="n">ebcs_list</span>
</span><span id="WeakForm-345"><a href="#WeakForm-345"><span class="linenos">345</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">epbcs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="WeakForm-346"><a href="#WeakForm-346"><span class="linenos">346</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lcbcs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="WeakForm-347"><a href="#WeakForm-347"><span class="linenos">347</span></a>
</span><span id="WeakForm-348"><a href="#WeakForm-348"><span class="linenos">348</span></a>        <span class="c1"># Terms definition</span>
</span><span id="WeakForm-349"><a href="#WeakForm-349"><span class="linenos">349</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_terms</span> <span class="o">=</span> <span class="n">terms</span>
</span><span id="WeakForm-350"><a href="#WeakForm-350"><span class="linenos">350</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">terms</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="WeakForm-351"><a href="#WeakForm-351"><span class="linenos">351</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eqn</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WeakForm-352"><a href="#WeakForm-352"><span class="linenos">352</span></a>        <span class="k">for</span> <span class="n">materm</span> <span class="ow">in</span> <span class="n">terms</span><span class="p">:</span>
</span><span id="WeakForm-353"><a href="#WeakForm-353"><span class="linenos">353</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">add_term</span><span class="p">(</span><span class="n">materm</span><span class="p">)</span>
</span><span id="WeakForm-354"><a href="#WeakForm-354"><span class="linenos">354</span></a>
</span><span id="WeakForm-355"><a href="#WeakForm-355"><span class="linenos">355</span></a>        <span class="c1"># Equation</span>
</span><span id="WeakForm-356"><a href="#WeakForm-356"><span class="linenos">356</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eqn</span> <span class="o">=</span> <span class="n">WeakForm</span><span class="o">.</span><span class="n">make_equation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">terms</span><span class="p">,</span>
</span><span id="WeakForm-357"><a href="#WeakForm-357"><span class="linenos">357</span></a>                                          <span class="bp">self</span><span class="o">.</span><span class="n">constcoeffs</span><span class="p">,</span>
</span><span id="WeakForm-358"><a href="#WeakForm-358"><span class="linenos">358</span></a>                                          <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="WeakForm-359"><a href="#WeakForm-359"><span class="linenos">359</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eqn_cst</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WeakForm-360"><a href="#WeakForm-360"><span class="linenos">360</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eqn_mod</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WeakForm-361"><a href="#WeakForm-361"><span class="linenos">361</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">split_equation</span><span class="p">()</span>
</span><span id="WeakForm-362"><a href="#WeakForm-362"><span class="linenos">362</span></a>
</span><span id="WeakForm-363"><a href="#WeakForm-363"><span class="linenos">363</span></a>        <span class="c1"># Display information for the user</span>
</span><span id="WeakForm-364"><a href="#WeakForm-364"><span class="linenos">364</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="WeakForm-365"><a href="#WeakForm-365"><span class="linenos">365</span></a>            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span>
</span><span id="WeakForm-366"><a href="#WeakForm-366"><span class="linenos">366</span></a>
</span><span id="WeakForm-367"><a href="#WeakForm-367"><span class="linenos">367</span></a>    <span class="k">def</span> <span class="nf">add_term</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">materm</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">newcoeff</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
</span><span id="WeakForm-368"><a href="#WeakForm-368"><span class="linenos">368</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm-369"><a href="#WeakForm-369"><span class="linenos">369</span></a><span class="sd">        Add a term to the existing WeakForm object.</span>
</span><span id="WeakForm-370"><a href="#WeakForm-370"><span class="linenos">370</span></a>
</span><span id="WeakForm-371"><a href="#WeakForm-371"><span class="linenos">371</span></a><span class="sd">        Parameters</span>
</span><span id="WeakForm-372"><a href="#WeakForm-372"><span class="linenos">372</span></a><span class="sd">        ----------</span>
</span><span id="WeakForm-373"><a href="#WeakForm-373"><span class="linenos">373</span></a><span class="sd">        materm : list of length 2 or 3 (one element of terms).</span>
</span><span id="WeakForm-374"><a href="#WeakForm-374"><span class="linenos">374</span></a><span class="sd">            A list containing:</span>
</span><span id="WeakForm-375"><a href="#WeakForm-375"><span class="linenos">375</span></a><span class="sd">                - a material function or None.</span>
</span><span id="WeakForm-376"><a href="#WeakForm-376"><span class="linenos">376</span></a><span class="sd">                - a Sfepy string of the term, e.g. &#39;dw_laplace&#39;, or</span>
</span><span id="WeakForm-377"><a href="#WeakForm-377"><span class="linenos">377</span></a><span class="sd">                &#39;dw_volume&#39;. https://sfepy.org/doc-devel/terms_overview.html</span>
</span><span id="WeakForm-378"><a href="#WeakForm-378"><span class="linenos">378</span></a><span class="sd">                - a region&#39;s name e.g. &#39;facet200&#39;, &#39;subomega301&#39;, or None.</span>
</span><span id="WeakForm-379"><a href="#WeakForm-379"><span class="linenos">379</span></a><span class="sd">        update : bool, optional</span>
</span><span id="WeakForm-380"><a href="#WeakForm-380"><span class="linenos">380</span></a><span class="sd">            Update self.equation with new term. The default is False.</span>
</span><span id="WeakForm-381"><a href="#WeakForm-381"><span class="linenos">381</span></a><span class="sd">        newcoeff : float, optional</span>
</span><span id="WeakForm-382"><a href="#WeakForm-382"><span class="linenos">382</span></a><span class="sd">            If update, the new term multiplicative constant.</span>
</span><span id="WeakForm-383"><a href="#WeakForm-383"><span class="linenos">383</span></a><span class="sd">            The default is 1.0.</span>
</span><span id="WeakForm-384"><a href="#WeakForm-384"><span class="linenos">384</span></a>
</span><span id="WeakForm-385"><a href="#WeakForm-385"><span class="linenos">385</span></a><span class="sd">        Returns</span>
</span><span id="WeakForm-386"><a href="#WeakForm-386"><span class="linenos">386</span></a><span class="sd">        -------</span>
</span><span id="WeakForm-387"><a href="#WeakForm-387"><span class="linenos">387</span></a><span class="sd">        None.</span>
</span><span id="WeakForm-388"><a href="#WeakForm-388"><span class="linenos">388</span></a>
</span><span id="WeakForm-389"><a href="#WeakForm-389"><span class="linenos">389</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WeakForm-390"><a href="#WeakForm-390"><span class="linenos">390</span></a>        <span class="n">material</span> <span class="o">=</span> <span class="n">materm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="WeakForm-391"><a href="#WeakForm-391"><span class="linenos">391</span></a>        <span class="n">term_str</span> <span class="o">=</span> <span class="n">materm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="WeakForm-392"><a href="#WeakForm-392"><span class="linenos">392</span></a>        <span class="n">ttkw</span> <span class="o">=</span> <span class="n">WeakForm</span><span class="o">.</span><span class="n">get_term_table_kw</span><span class="p">(</span><span class="n">term_table</span><span class="p">,</span> <span class="n">term_str</span><span class="p">)</span>
</span><span id="WeakForm-393"><a href="#WeakForm-393"><span class="linenos">393</span></a>        
</span><span id="WeakForm-394"><a href="#WeakForm-394"><span class="linenos">394</span></a>        <span class="c1"># Determine the region over which integral is defined</span>
</span><span id="WeakForm-395"><a href="#WeakForm-395"><span class="linenos">395</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">materm</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
</span><span id="WeakForm-396"><a href="#WeakForm-396"><span class="linenos">396</span></a>            <span class="k">if</span> <span class="n">materm</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="WeakForm-397"><a href="#WeakForm-397"><span class="linenos">397</span></a>                <span class="n">name</span> <span class="o">=</span> <span class="n">materm</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="c1"># the region&#39;s name was given by the user</span>
</span><span id="WeakForm-398"><a href="#WeakForm-398"><span class="linenos">398</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="WeakForm-399"><a href="#WeakForm-399"><span class="linenos">399</span></a>            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;omega&#39;</span> <span class="c1"># the region&#39;s name was not given, default is omega</span>
</span><span id="WeakForm-400"><a href="#WeakForm-400"><span class="linenos">400</span></a>            
</span><span id="WeakForm-401"><a href="#WeakForm-401"><span class="linenos">401</span></a>        <span class="c1"># assert term_str in term_table</span>
</span><span id="WeakForm-402"><a href="#WeakForm-402"><span class="linenos">402</span></a>        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">unknown_name</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">unknown</span><span class="p">,</span>
</span><span id="WeakForm-403"><a href="#WeakForm-403"><span class="linenos">403</span></a>                  <span class="bp">self</span><span class="o">.</span><span class="n">test_name</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">test</span><span class="p">}</span>
</span><span id="WeakForm-404"><a href="#WeakForm-404"><span class="linenos">404</span></a>
</span><span id="WeakForm-405"><a href="#WeakForm-405"><span class="linenos">405</span></a>        <span class="k">if</span> <span class="n">material</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="WeakForm-406"><a href="#WeakForm-406"><span class="linenos">406</span></a>            <span class="k">if</span> <span class="s1">&#39;state&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ttkw</span> <span class="ow">and</span> <span class="s1">&#39;virtual/grad_state&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ttkw</span><span class="p">:</span>
</span><span id="WeakForm-407"><a href="#WeakForm-407"><span class="linenos">407</span></a>                <span class="n">new_term</span> <span class="o">=</span> <span class="n">Term</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
</span><span id="WeakForm-408"><a href="#WeakForm-408"><span class="linenos">408</span></a>                    <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">term_str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_name</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">integral</span><span class="p">,</span>
</span><span id="WeakForm-409"><a href="#WeakForm-409"><span class="linenos">409</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">region_dic</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="WeakForm-410"><a href="#WeakForm-410"><span class="linenos">410</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="WeakForm-411"><a href="#WeakForm-411"><span class="linenos">411</span></a>                <span class="n">new_term</span> <span class="o">=</span> <span class="n">Term</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
</span><span id="WeakForm-412"><a href="#WeakForm-412"><span class="linenos">412</span></a>                    <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">term_str</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">test_name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">unknown_name</span><span class="p">),</span>
</span><span id="WeakForm-413"><a href="#WeakForm-413"><span class="linenos">413</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">integral</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_dic</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="WeakForm-414"><a href="#WeakForm-414"><span class="linenos">414</span></a>
</span><span id="WeakForm-415"><a href="#WeakForm-415"><span class="linenos">415</span></a>        <span class="k">elif</span> <span class="n">callable</span><span class="p">(</span><span class="n">material</span><span class="p">):</span>
</span><span id="WeakForm-416"><a href="#WeakForm-416"><span class="linenos">416</span></a>            <span class="n">mat_func</span>  <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="s1">&#39;mat_func&#39;</span><span class="p">,</span> <span class="n">material</span><span class="p">)</span>
</span><span id="WeakForm-417"><a href="#WeakForm-417"><span class="linenos">417</span></a>            <span class="n">extra_args</span> <span class="o">=</span> <span class="n">get_default_args</span><span class="p">(</span><span class="n">material</span><span class="p">)</span>
</span><span id="WeakForm-418"><a href="#WeakForm-418"><span class="linenos">418</span></a>            <span class="n">matname</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="WeakForm-419"><a href="#WeakForm-419"><span class="linenos">419</span></a>            <span class="c1"># density profile linked to subregion</span>
</span><span id="WeakForm-420"><a href="#WeakForm-420"><span class="linenos">420</span></a>            <span class="k">if</span> <span class="s1">&#39;rho&#39;</span> <span class="ow">in</span> <span class="n">extra_args</span> <span class="ow">and</span> <span class="n">extra_args</span><span class="p">[</span><span class="s1">&#39;rho&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="WeakForm-421"><a href="#WeakForm-421"><span class="linenos">421</span></a>                <span class="n">extra_args</span><span class="p">[</span><span class="s1">&#39;rho&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
</span><span id="WeakForm-422"><a href="#WeakForm-422"><span class="linenos">422</span></a>                <span class="n">matname</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">name</span>
</span><span id="WeakForm-423"><a href="#WeakForm-423"><span class="linenos">423</span></a>            <span class="n">mat</span> <span class="o">=</span> <span class="n">Material</span><span class="p">(</span><span class="n">matname</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;stationary&#39;</span><span class="p">,</span> <span class="n">function</span><span class="o">=</span><span class="n">mat_func</span><span class="p">)</span>
</span><span id="WeakForm-424"><a href="#WeakForm-424"><span class="linenos">424</span></a>            <span class="n">mat</span><span class="o">.</span><span class="n">set_extra_args</span><span class="p">(</span><span class="o">**</span><span class="n">extra_args</span><span class="p">)</span>
</span><span id="WeakForm-425"><a href="#WeakForm-425"><span class="linenos">425</span></a>            <span class="n">kwargs</span><span class="p">[</span><span class="n">matname</span><span class="p">]</span> <span class="o">=</span> <span class="n">mat</span>
</span><span id="WeakForm-426"><a href="#WeakForm-426"><span class="linenos">426</span></a>            <span class="k">if</span> <span class="s1">&#39;state&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ttkw</span> <span class="ow">and</span> <span class="s1">&#39;virtual/grad_state&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ttkw</span><span class="p">:</span>
</span><span id="WeakForm-427"><a href="#WeakForm-427"><span class="linenos">427</span></a>                <span class="n">new_term</span> <span class="o">=</span> <span class="n">Term</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
</span><span id="WeakForm-428"><a href="#WeakForm-428"><span class="linenos">428</span></a>                    <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%s</span><span class="s1">.val, </span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">term_str</span><span class="p">,</span> <span class="n">matname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_name</span><span class="p">),</span>
</span><span id="WeakForm-429"><a href="#WeakForm-429"><span class="linenos">429</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">integral</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_dic</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="WeakForm-430"><a href="#WeakForm-430"><span class="linenos">430</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="WeakForm-431"><a href="#WeakForm-431"><span class="linenos">431</span></a>                <span class="n">new_term</span> <span class="o">=</span> <span class="n">Term</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
</span><span id="WeakForm-432"><a href="#WeakForm-432"><span class="linenos">432</span></a>                    <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%s</span><span class="s1">.val, </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">term_str</span><span class="p">,</span> <span class="n">matname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_name</span><span class="p">,</span>
</span><span id="WeakForm-433"><a href="#WeakForm-433"><span class="linenos">433</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">unknown_name</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">integral</span><span class="p">,</span>
</span><span id="WeakForm-434"><a href="#WeakForm-434"><span class="linenos">434</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">region_dic</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="WeakForm-435"><a href="#WeakForm-435"><span class="linenos">435</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="WeakForm-436"><a href="#WeakForm-436"><span class="linenos">436</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Material should be a function or None&quot;</span><span class="p">)</span>
</span><span id="WeakForm-437"><a href="#WeakForm-437"><span class="linenos">437</span></a>
</span><span id="WeakForm-438"><a href="#WeakForm-438"><span class="linenos">438</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">terms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_term</span><span class="p">)</span>
</span><span id="WeakForm-439"><a href="#WeakForm-439"><span class="linenos">439</span></a>        <span class="k">if</span> <span class="n">update</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
</span><span id="WeakForm-440"><a href="#WeakForm-440"><span class="linenos">440</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_terms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">materm</span><span class="p">)</span>
</span><span id="WeakForm-441"><a href="#WeakForm-441"><span class="linenos">441</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">constcoeffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newcoeff</span><span class="p">)</span>
</span><span id="WeakForm-442"><a href="#WeakForm-442"><span class="linenos">442</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">eqn</span> <span class="o">=</span> <span class="n">WeakForm</span><span class="o">.</span><span class="n">make_equation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">terms</span><span class="p">,</span>
</span><span id="WeakForm-443"><a href="#WeakForm-443"><span class="linenos">443</span></a>                                              <span class="bp">self</span><span class="o">.</span><span class="n">constcoeffs</span><span class="p">,</span>
</span><span id="WeakForm-444"><a href="#WeakForm-444"><span class="linenos">444</span></a>                                              <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="WeakForm-445"><a href="#WeakForm-445"><span class="linenos">445</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">split_equation</span><span class="p">()</span>
</span><span id="WeakForm-446"><a href="#WeakForm-446"><span class="linenos">446</span></a>
</span><span id="WeakForm-447"><a href="#WeakForm-447"><span class="linenos">447</span></a>    <span class="nd">@staticmethod</span>
</span><span id="WeakForm-448"><a href="#WeakForm-448"><span class="linenos">448</span></a>    <span class="k">def</span> <span class="nf">make_equation</span><span class="p">(</span><span class="n">terms</span><span class="p">,</span> <span class="n">constcoeffs</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span><span id="WeakForm-449"><a href="#WeakForm-449"><span class="linenos">449</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the eqn attribute of the WeakForm object.&quot;&quot;&quot;</span>
</span><span id="WeakForm-450"><a href="#WeakForm-450"><span class="linenos">450</span></a>        <span class="k">if</span> <span class="n">terms</span><span class="p">:</span>
</span><span id="WeakForm-451"><a href="#WeakForm-451"><span class="linenos">451</span></a>            <span class="n">eqn</span> <span class="o">=</span> <span class="n">terms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">constcoeffs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="WeakForm-452"><a href="#WeakForm-452"><span class="linenos">452</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">constcoeffs</span><span class="p">)):</span>
</span><span id="WeakForm-453"><a href="#WeakForm-453"><span class="linenos">453</span></a>                <span class="n">eqn</span> <span class="o">=</span> <span class="n">eqn</span><span class="o">.</span><span class="fm">__add__</span><span class="p">(</span><span class="n">terms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">constcoeffs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="WeakForm-454"><a href="#WeakForm-454"><span class="linenos">454</span></a>            <span class="n">eqn</span> <span class="o">=</span> <span class="n">Equation</span><span class="p">(</span><span class="s1">&#39;eqn_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">name</span><span class="p">,</span> <span class="n">eqn</span><span class="p">)</span>
</span><span id="WeakForm-455"><a href="#WeakForm-455"><span class="linenos">455</span></a>            <span class="k">return</span> <span class="n">eqn</span>
</span><span id="WeakForm-456"><a href="#WeakForm-456"><span class="linenos">456</span></a>
</span><span id="WeakForm-457"><a href="#WeakForm-457"><span class="linenos">457</span></a>    <span class="k">def</span> <span class="nf">split_equation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WeakForm-458"><a href="#WeakForm-458"><span class="linenos">458</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Split the equation into constant VS updatable equations.&quot;&quot;&quot;</span>
</span><span id="WeakForm-459"><a href="#WeakForm-459"><span class="linenos">459</span></a>        <span class="n">terms_cst</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="WeakForm-460"><a href="#WeakForm-460"><span class="linenos">460</span></a>        <span class="n">terms_mod</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="WeakForm-461"><a href="#WeakForm-461"><span class="linenos">461</span></a>        <span class="n">constcoeffs_cst</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="WeakForm-462"><a href="#WeakForm-462"><span class="linenos">462</span></a>        <span class="n">constcoeffs_mod</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="WeakForm-463"><a href="#WeakForm-463"><span class="linenos">463</span></a>        <span class="n">mats</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="WeakForm-464"><a href="#WeakForm-464"><span class="linenos">464</span></a>        <span class="n">terms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_terms</span>
</span><span id="WeakForm-465"><a href="#WeakForm-465"><span class="linenos">465</span></a>        <span class="n">mats_aux</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eqn</span><span class="o">.</span><span class="n">collect_materials</span><span class="p">()</span>
</span><span id="WeakForm-466"><a href="#WeakForm-466"><span class="linenos">466</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mats_aux</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">terms</span><span class="p">):</span>
</span><span id="WeakForm-467"><a href="#WeakForm-467"><span class="linenos">467</span></a>            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="WeakForm-468"><a href="#WeakForm-468"><span class="linenos">468</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">terms</span><span class="p">)):</span>
</span><span id="WeakForm-469"><a href="#WeakForm-469"><span class="linenos">469</span></a>                <span class="n">func</span> <span class="o">=</span> <span class="n">terms</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="WeakForm-470"><a href="#WeakForm-470"><span class="linenos">470</span></a>                <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="WeakForm-471"><a href="#WeakForm-471"><span class="linenos">471</span></a>                    <span class="n">mats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="WeakForm-472"><a href="#WeakForm-472"><span class="linenos">472</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="WeakForm-473"><a href="#WeakForm-473"><span class="linenos">473</span></a>                    <span class="n">mats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mats_aux</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="WeakForm-474"><a href="#WeakForm-474"><span class="linenos">474</span></a>                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="WeakForm-475"><a href="#WeakForm-475"><span class="linenos">475</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="WeakForm-476"><a href="#WeakForm-476"><span class="linenos">476</span></a>            <span class="n">mats</span> <span class="o">=</span> <span class="n">mats_aux</span>
</span><span id="WeakForm-477"><a href="#WeakForm-477"><span class="linenos">477</span></a>
</span><span id="WeakForm-478"><a href="#WeakForm-478"><span class="linenos">478</span></a>        <span class="k">for</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">mat</span><span class="p">,</span> <span class="n">term</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">constcoeffs</span><span class="p">,</span> <span class="n">mats</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">terms</span><span class="p">):</span>
</span><span id="WeakForm-479"><a href="#WeakForm-479"><span class="linenos">479</span></a>            <span class="n">isconstant</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="WeakForm-480"><a href="#WeakForm-480"><span class="linenos">480</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="s1">&#39;extra_args&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">mat</span><span class="o">.</span><span class="n">extra_args</span> <span class="o">!=</span> <span class="p">{}:</span>
</span><span id="WeakForm-481"><a href="#WeakForm-481"><span class="linenos">481</span></a>                <span class="n">extra_args</span> <span class="o">=</span> <span class="n">mat</span><span class="o">.</span><span class="n">extra_args</span> <span class="c1"># fetch material&#39;s extra-args dict</span>
</span><span id="WeakForm-482"><a href="#WeakForm-482"><span class="linenos">482</span></a>                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">extra_args</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="WeakForm-483"><a href="#WeakForm-483"><span class="linenos">483</span></a>                    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">WeakForm</span><span class="o">.</span><span class="n">forbidden_mod_arg</span><span class="p">:</span>
</span><span id="WeakForm-484"><a href="#WeakForm-484"><span class="linenos">484</span></a>                        <span class="n">isconstant</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="WeakForm-485"><a href="#WeakForm-485"><span class="linenos">485</span></a>                        <span class="k">break</span>
</span><span id="WeakForm-486"><a href="#WeakForm-486"><span class="linenos">486</span></a>            <span class="k">if</span> <span class="n">isconstant</span><span class="p">:</span>
</span><span id="WeakForm-487"><a href="#WeakForm-487"><span class="linenos">487</span></a>                <span class="n">terms_cst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">term</span><span class="p">)</span>
</span><span id="WeakForm-488"><a href="#WeakForm-488"><span class="linenos">488</span></a>                <span class="n">constcoeffs_cst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coeff</span><span class="p">)</span>
</span><span id="WeakForm-489"><a href="#WeakForm-489"><span class="linenos">489</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="WeakForm-490"><a href="#WeakForm-490"><span class="linenos">490</span></a>                <span class="n">terms_mod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">term</span><span class="p">)</span>
</span><span id="WeakForm-491"><a href="#WeakForm-491"><span class="linenos">491</span></a>                <span class="n">constcoeffs_mod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coeff</span><span class="p">)</span>
</span><span id="WeakForm-492"><a href="#WeakForm-492"><span class="linenos">492</span></a>        <span class="k">if</span> <span class="n">terms_cst</span><span class="p">:</span>
</span><span id="WeakForm-493"><a href="#WeakForm-493"><span class="linenos">493</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">eqn_cst</span> <span class="o">=</span> <span class="n">WeakForm</span><span class="o">.</span><span class="n">make_equation</span><span class="p">(</span><span class="n">terms_cst</span><span class="p">,</span> <span class="n">constcoeffs_cst</span><span class="p">,</span>
</span><span id="WeakForm-494"><a href="#WeakForm-494"><span class="linenos">494</span></a>                                                  <span class="s1">&#39;eqn_cst&#39;</span><span class="p">)</span>
</span><span id="WeakForm-495"><a href="#WeakForm-495"><span class="linenos">495</span></a>        <span class="k">if</span> <span class="n">terms_mod</span><span class="p">:</span>
</span><span id="WeakForm-496"><a href="#WeakForm-496"><span class="linenos">496</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">eqn_mod</span> <span class="o">=</span> <span class="n">WeakForm</span><span class="o">.</span><span class="n">make_equation</span><span class="p">(</span><span class="n">terms_mod</span><span class="p">,</span> <span class="n">constcoeffs_mod</span><span class="p">,</span>
</span><span id="WeakForm-497"><a href="#WeakForm-497"><span class="linenos">497</span></a>                                                  <span class="s1">&#39;eqn_mod&#39;</span><span class="p">)</span>
</span><span id="WeakForm-498"><a href="#WeakForm-498"><span class="linenos">498</span></a>
</span><span id="WeakForm-499"><a href="#WeakForm-499"><span class="linenos">499</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WeakForm-500"><a href="#WeakForm-500"><span class="linenos">500</span></a>        <span class="n">string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="WeakForm-501"><a href="#WeakForm-501"><span class="linenos">501</span></a><span class="s2">        Weak Form:</span>
</span><span id="WeakForm-502"><a href="#WeakForm-502"><span class="linenos">502</span></a><span class="s2">            name: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span>
</span><span id="WeakForm-503"><a href="#WeakForm-503"><span class="linenos">503</span></a><span class="s2">            &quot;&quot;&quot;</span>
</span><span id="WeakForm-504"><a href="#WeakForm-504"><span class="linenos">504</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;meshfile&#39;</span><span class="p">):</span>
</span><span id="WeakForm-505"><a href="#WeakForm-505"><span class="linenos">505</span></a>            <span class="n">string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="WeakForm-506"><a href="#WeakForm-506"><span class="linenos">506</span></a><span class="s2">            mesh location: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">meshfile</span><span class="si">}</span>
</span><span id="WeakForm-507"><a href="#WeakForm-507"><span class="linenos">507</span></a><span class="s2">            &quot;&quot;&quot;</span>
</span><span id="WeakForm-508"><a href="#WeakForm-508"><span class="linenos">508</span></a>            <span class="n">string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="WeakForm-509"><a href="#WeakForm-509"><span class="linenos">509</span></a><span class="s2">            Ndofs: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ndofs</span><span class="si">}</span>
</span><span id="WeakForm-510"><a href="#WeakForm-510"><span class="linenos">510</span></a><span class="s2">            Approximation order: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="si">}</span>
</span><span id="WeakForm-511"><a href="#WeakForm-511"><span class="linenos">511</span></a><span class="s2">            Space: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">space</span><span class="si">}</span>
</span><span id="WeakForm-512"><a href="#WeakForm-512"><span class="linenos">512</span></a><span class="s2">            Polynomial space base: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">poly_space_base</span><span class="si">}</span>
</span><span id="WeakForm-513"><a href="#WeakForm-513"><span class="linenos">513</span></a><span class="s2">            Unknown variable: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">unknown_name</span><span class="si">}</span>
</span><span id="WeakForm-514"><a href="#WeakForm-514"><span class="linenos">514</span></a><span class="s2">            Test variable: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">test_name</span><span class="si">}</span>
</span><span id="WeakForm-515"><a href="#WeakForm-515"><span class="linenos">515</span></a><span class="s2">            Integral, Order: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">integral</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">integral</span><span class="o">.</span><span class="n">order</span><span class="si">}</span>
</span><span id="WeakForm-516"><a href="#WeakForm-516"><span class="linenos">516</span></a><span class="s2">            Physical Groups: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">physical_group_ids</span><span class="si">}</span>
</span><span id="WeakForm-517"><a href="#WeakForm-517"><span class="linenos">517</span></a><span class="s2">            Dirichlet BC: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ebcs</span><span class="si">}</span>
</span><span id="WeakForm-518"><a href="#WeakForm-518"><span class="linenos">518</span></a><span class="s2">            Periodic BC: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">epbcs</span><span class="si">}</span>
</span><span id="WeakForm-519"><a href="#WeakForm-519"><span class="linenos">519</span></a><span class="s2">            Linear Combination BC: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lcbcs</span><span class="si">}</span>
</span><span id="WeakForm-520"><a href="#WeakForm-520"><span class="linenos">520</span></a><span class="s2">            Terms: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">terms</span><span class="si">}</span>
</span><span id="WeakForm-521"><a href="#WeakForm-521"><span class="linenos">521</span></a><span class="s2">            Constant coefficients: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">constcoeffs</span><span class="si">}</span>
</span><span id="WeakForm-522"><a href="#WeakForm-522"><span class="linenos">522</span></a><span class="s2">            Equation name: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">eqn</span><span class="o">.</span><span class="n">name</span><span class="si">}</span>
</span><span id="WeakForm-523"><a href="#WeakForm-523"><span class="linenos">523</span></a><span class="s2">            &quot;&quot;&quot;</span>
</span><span id="WeakForm-524"><a href="#WeakForm-524"><span class="linenos">524</span></a>        <span class="k">return</span> <span class="n">string</span>
</span><span id="WeakForm-525"><a href="#WeakForm-525"><span class="linenos">525</span></a>
</span><span id="WeakForm-526"><a href="#WeakForm-526"><span class="linenos">526</span></a>    <span class="nd">@staticmethod</span>
</span><span id="WeakForm-527"><a href="#WeakForm-527"><span class="linenos">527</span></a>    <span class="k">def</span> <span class="nf">get_term_table_kw</span><span class="p">(</span><span class="n">term_table</span><span class="p">,</span> <span class="n">term_str</span><span class="p">):</span>
</span><span id="WeakForm-528"><a href="#WeakForm-528"><span class="linenos">528</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Utility method for getting the syntax of a term given by its string</span>
</span><span id="WeakForm-529"><a href="#WeakForm-529"><span class="linenos">529</span></a><span class="sd">        identifier.  Might break with future Sfepy releases, see</span>
</span><span id="WeakForm-530"><a href="#WeakForm-530"><span class="linenos">530</span></a><span class="sd">        https://github.com/sfepy/sfepy/issues/773&quot;&quot;&quot;</span>
</span><span id="WeakForm-531"><a href="#WeakForm-531"><span class="linenos">531</span></a>        <span class="n">entry</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">numpyit</span><span class="p">(</span><span class="n">term_table</span><span class="p">[</span><span class="n">term_str</span><span class="p">]</span><span class="o">.</span><span class="n">arg_types</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="WeakForm-532"><a href="#WeakForm-532"><span class="linenos">532</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Class encapsulating all Sfepy objects for defining a weak form PDE.</p>

<h6 id="attributes">Attributes</h6>

<ul>
<li><strong>name</strong> (str):
Name of the weak form.</li>
<li><strong>meshfile</strong> (str):
Name of the meshfile e.g. 'my_mesh.vtk' located in the specified mesh
directory.</li>
<li><strong>terms</strong> (list):
List containing the terms of the weak form PDE. Each element of the
list is a list containing:
    - a material function or None.
    - a Sfepy string of the term, e.g. 'dw_laplace', or
    'dw_volume'. <a href="https://sfepy.org/doc-devel/terms_overview.html">https://sfepy.org/doc-devel/terms_overview.html</a>.
    - a region's name e.g. 'facet200', 'subomega301', or None.</li>
<li><strong>verbose</strong> (bool):
Display user's information. The default is False.</li>
<li><strong>mesh_dir</strong> (str):
Absolute path to the directory containing meshfile. The default is
None.</li>
<li><strong>ext</strong> (str):
Extension given to the mesh file. The default is '.vtk'.</li>
<li><strong>constcoeffs</strong> (list):
Coefficients weighting the terms such that the weak form equation
reads
    $$ \sum_{i=1}^{N_{\mathrm{terms}}} \texttt{constcoeffs[i]} \times
    \texttt{terms[i]} = 0 $$</li>
<li><strong>unknown</strong> (<code>sfepy.discrete.variables.FieldVariable</code>):
Sfepy unknown variable.</li>
<li><strong>unknown_name</strong> (str):
Name of the unknown variable. The default is 'u'.</li>
<li><strong>test</strong> (<code>sfepy.discrete.variables.FieldVariable</code>):
Sfepy test variable.</li>
<li><strong>test_name</strong> (str):
Name of the test variable. The default is 'v'.</li>
<li><strong>order</strong> (int):
The FE approximation order. The default is 2.</li>
<li><strong>space</strong> (str):
The function space name. The default is 'H1'.</li>
<li><strong>poly_space_base</strong> (str):
The name of polynomial space base. The default is 'lagrange'.</li>
<li><strong>integral</strong> (<code>sfepy.discrete.integrals.Integral</code>):
Sfepy Integral instance.</li>
<li><strong>integral_name</strong> (str):
The integral name. The default is 'i'.</li>
<li><strong>domain</strong> (<code>sfepy.discrete.fem.domain.FEDomain</code>):
Sfepy Domain instance.</li>
<li><strong>domain_name</strong> (str):
The domain name. The default is 'domain'.</li>
<li><strong>omega</strong> (Region):
The whole domain over which the variable are defined.</li>
<li><strong>dimension</strong> (int):
Spatial dimension of the problem (3 is the maximum).</li>
<li><strong>physical_group_ids</strong> (list of int):
All distinct physical groups identifiers.</li>
<li><strong>region_dic</strong> (dict):
Dictionary of all regions.</li>
<li><strong>subomegas</strong> (list):
List of sub regions of dimension D.</li>
<li><strong>facets</strong> (list):
List of sub regions of dimension D-1.</li>
<li><strong>edges</strong> (list):
List of sub regions of dimension 1.</li>
<li><strong>vertices</strong> (list):
List of sub regions of dimension 0.</li>
<li><strong>epbcs</strong> (list):
List of periodic boundary conditions.</li>
<li><strong>lcbcs</strong> (list):
List of linear combination boundary conditions.</li>
<li><strong>ebcs</strong> (list):
List of essential boundary conditions.</li>
<li><strong>ndofs</strong> (int):
Number of degrees of freedom.</li>
<li><strong>entity_functions</strong> (list of 2-tuple):
List of tuples (dim, function) for manual entity selection.
The default is [].</li>
</ul>
</div>


                            <div id="WeakForm.__init__" class="classattr">
                                        <input id="WeakForm.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">WeakForm</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">name</span>, </span><span class="param"><span class="n">meshfile</span>, </span><span class="param"><span class="n">terms</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span>)</span>

                <label class="view-source-button" for="WeakForm.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeakForm.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeakForm.__init__-115"><a href="#WeakForm.__init__-115"><span class="linenos">115</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">meshfile</span><span class="p">,</span> <span class="n">terms</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="WeakForm.__init__-116"><a href="#WeakForm.__init__-116"><span class="linenos">116</span></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm.__init__-117"><a href="#WeakForm.__init__-117"><span class="linenos">117</span></a><span class="sd">        Construct a WeakForm instance that is an object containing all the</span>
</span><span id="WeakForm.__init__-118"><a href="#WeakForm.__init__-118"><span class="linenos">118</span></a><span class="sd">        necessary information related to a given weak form PDE.</span>
</span><span id="WeakForm.__init__-119"><a href="#WeakForm.__init__-119"><span class="linenos">119</span></a>
</span><span id="WeakForm.__init__-120"><a href="#WeakForm.__init__-120"><span class="linenos">120</span></a><span class="sd">        Parameters</span>
</span><span id="WeakForm.__init__-121"><a href="#WeakForm.__init__-121"><span class="linenos">121</span></a><span class="sd">        ----------</span>
</span><span id="WeakForm.__init__-122"><a href="#WeakForm.__init__-122"><span class="linenos">122</span></a><span class="sd">        name : str</span>
</span><span id="WeakForm.__init__-123"><a href="#WeakForm.__init__-123"><span class="linenos">123</span></a><span class="sd">            Name of the weak form.</span>
</span><span id="WeakForm.__init__-124"><a href="#WeakForm.__init__-124"><span class="linenos">124</span></a><span class="sd">        meshfile : str</span>
</span><span id="WeakForm.__init__-125"><a href="#WeakForm.__init__-125"><span class="linenos">125</span></a><span class="sd">            Name of the meshfile e.g. &#39;my_mesh.vtk&#39; located in the specified</span>
</span><span id="WeakForm.__init__-126"><a href="#WeakForm.__init__-126"><span class="linenos">126</span></a><span class="sd">            mesh directory.</span>
</span><span id="WeakForm.__init__-127"><a href="#WeakForm.__init__-127"><span class="linenos">127</span></a><span class="sd">        terms : list</span>
</span><span id="WeakForm.__init__-128"><a href="#WeakForm.__init__-128"><span class="linenos">128</span></a><span class="sd">            List containing the terms of the weak form PDE. Each element of the</span>
</span><span id="WeakForm.__init__-129"><a href="#WeakForm.__init__-129"><span class="linenos">129</span></a><span class="sd">            list is a list containing:</span>
</span><span id="WeakForm.__init__-130"><a href="#WeakForm.__init__-130"><span class="linenos">130</span></a><span class="sd">                - a material function or None.</span>
</span><span id="WeakForm.__init__-131"><a href="#WeakForm.__init__-131"><span class="linenos">131</span></a><span class="sd">                - a Sfepy string of the term, e.g. &#39;dw_laplace&#39;, or</span>
</span><span id="WeakForm.__init__-132"><a href="#WeakForm.__init__-132"><span class="linenos">132</span></a><span class="sd">                &#39;dw_volume&#39;. https://sfepy.org/doc-devel/terms_overview.html.</span>
</span><span id="WeakForm.__init__-133"><a href="#WeakForm.__init__-133"><span class="linenos">133</span></a><span class="sd">                - a region&#39;s name e.g. &#39;facet200&#39;, &#39;subomega301&#39;, or None.</span>
</span><span id="WeakForm.__init__-134"><a href="#WeakForm.__init__-134"><span class="linenos">134</span></a>
</span><span id="WeakForm.__init__-135"><a href="#WeakForm.__init__-135"><span class="linenos">135</span></a><span class="sd">        Other Parameters</span>
</span><span id="WeakForm.__init__-136"><a href="#WeakForm.__init__-136"><span class="linenos">136</span></a><span class="sd">        ----------------</span>
</span><span id="WeakForm.__init__-137"><a href="#WeakForm.__init__-137"><span class="linenos">137</span></a><span class="sd">        mesh_dir : str</span>
</span><span id="WeakForm.__init__-138"><a href="#WeakForm.__init__-138"><span class="linenos">138</span></a><span class="sd">            Directory where the mesh files are located. The default is None.</span>
</span><span id="WeakForm.__init__-139"><a href="#WeakForm.__init__-139"><span class="linenos">139</span></a><span class="sd">        ext : str</span>
</span><span id="WeakForm.__init__-140"><a href="#WeakForm.__init__-140"><span class="linenos">140</span></a><span class="sd">            Extension of the mesh file. The default is &#39;.vtk&#39;.</span>
</span><span id="WeakForm.__init__-141"><a href="#WeakForm.__init__-141"><span class="linenos">141</span></a><span class="sd">        constcoeffs : list</span>
</span><span id="WeakForm.__init__-142"><a href="#WeakForm.__init__-142"><span class="linenos">142</span></a><span class="sd">            Coefficients weighting the terms such that the weak form equation</span>
</span><span id="WeakForm.__init__-143"><a href="#WeakForm.__init__-143"><span class="linenos">143</span></a><span class="sd">            reads</span>
</span><span id="WeakForm.__init__-144"><a href="#WeakForm.__init__-144"><span class="linenos">144</span></a><span class="sd">                $$ \sum_{i=1}^{N_{\mathrm{terms}}} \texttt{constcoeffs[i]}</span>
</span><span id="WeakForm.__init__-145"><a href="#WeakForm.__init__-145"><span class="linenos">145</span></a><span class="sd">                \times \texttt{terms[i]} = 0 $$</span>
</span><span id="WeakForm.__init__-146"><a href="#WeakForm.__init__-146"><span class="linenos">146</span></a><span class="sd">        dirichlet_bc_facet : list</span>
</span><span id="WeakForm.__init__-147"><a href="#WeakForm.__init__-147"><span class="linenos">147</span></a><span class="sd">            List of dirichlet boundary conditions applied to facets. This list</span>
</span><span id="WeakForm.__init__-148"><a href="#WeakForm.__init__-148"><span class="linenos">148</span></a><span class="sd">            must be the same length as the number of facets defined in the</span>
</span><span id="WeakForm.__init__-149"><a href="#WeakForm.__init__-149"><span class="linenos">149</span></a><span class="sd">            domain. Elements of the list are such that:</span>
</span><span id="WeakForm.__init__-150"><a href="#WeakForm.__init__-150"><span class="linenos">150</span></a><span class="sd">                - if `dirichlet_bc_facet`[k] is None, then facets[k] is free of</span>
</span><span id="WeakForm.__init__-151"><a href="#WeakForm.__init__-151"><span class="linenos">151</span></a><span class="sd">                any essential boundary condition.</span>
</span><span id="WeakForm.__init__-152"><a href="#WeakForm.__init__-152"><span class="linenos">152</span></a><span class="sd">                - if `dirichlet_bc_facet`[k] is a number, then facets[k] is</span>
</span><span id="WeakForm.__init__-153"><a href="#WeakForm.__init__-153"><span class="linenos">153</span></a><span class="sd">                constrained by a constant essential boundary condition.</span>
</span><span id="WeakForm.__init__-154"><a href="#WeakForm.__init__-154"><span class="linenos">154</span></a><span class="sd">                - if `dirichlet_bc_facet`[k] is a function, then facets[k] is</span>
</span><span id="WeakForm.__init__-155"><a href="#WeakForm.__init__-155"><span class="linenos">155</span></a><span class="sd">                constrained by a dirichlet boundary condition calculated by the</span>
</span><span id="WeakForm.__init__-156"><a href="#WeakForm.__init__-156"><span class="linenos">156</span></a><span class="sd">                function.</span>
</span><span id="WeakForm.__init__-157"><a href="#WeakForm.__init__-157"><span class="linenos">157</span></a><span class="sd">            The default is None.</span>
</span><span id="WeakForm.__init__-158"><a href="#WeakForm.__init__-158"><span class="linenos">158</span></a><span class="sd">        dirichlet_bc_edge : list</span>
</span><span id="WeakForm.__init__-159"><a href="#WeakForm.__init__-159"><span class="linenos">159</span></a><span class="sd">            List of dirichlet boundary conditions applied to edges. This list</span>
</span><span id="WeakForm.__init__-160"><a href="#WeakForm.__init__-160"><span class="linenos">160</span></a><span class="sd">            must be the same length as the number of edges defined in the</span>
</span><span id="WeakForm.__init__-161"><a href="#WeakForm.__init__-161"><span class="linenos">161</span></a><span class="sd">            domain. The default is None.</span>
</span><span id="WeakForm.__init__-162"><a href="#WeakForm.__init__-162"><span class="linenos">162</span></a><span class="sd">        dirichlet_bc_vertex : list</span>
</span><span id="WeakForm.__init__-163"><a href="#WeakForm.__init__-163"><span class="linenos">163</span></a><span class="sd">            List of dirichlet boundary conditions applied to vertices. This</span>
</span><span id="WeakForm.__init__-164"><a href="#WeakForm.__init__-164"><span class="linenos">164</span></a><span class="sd">            list must be the same length as the number of edges defined in the</span>
</span><span id="WeakForm.__init__-165"><a href="#WeakForm.__init__-165"><span class="linenos">165</span></a><span class="sd">            domain. The default is None.</span>
</span><span id="WeakForm.__init__-166"><a href="#WeakForm.__init__-166"><span class="linenos">166</span></a><span class="sd">        verbose : bool</span>
</span><span id="WeakForm.__init__-167"><a href="#WeakForm.__init__-167"><span class="linenos">167</span></a><span class="sd">            Display user&#39;s information. The default is False.</span>
</span><span id="WeakForm.__init__-168"><a href="#WeakForm.__init__-168"><span class="linenos">168</span></a><span class="sd">        domain_name : str</span>
</span><span id="WeakForm.__init__-169"><a href="#WeakForm.__init__-169"><span class="linenos">169</span></a><span class="sd">            The domain name. The default is &#39;domain&#39;.</span>
</span><span id="WeakForm.__init__-170"><a href="#WeakForm.__init__-170"><span class="linenos">170</span></a><span class="sd">        integral_name : str</span>
</span><span id="WeakForm.__init__-171"><a href="#WeakForm.__init__-171"><span class="linenos">171</span></a><span class="sd">            The integral name. The default is &#39;i&#39;.</span>
</span><span id="WeakForm.__init__-172"><a href="#WeakForm.__init__-172"><span class="linenos">172</span></a><span class="sd">        space : str</span>
</span><span id="WeakForm.__init__-173"><a href="#WeakForm.__init__-173"><span class="linenos">173</span></a><span class="sd">            The function space name. The default is &#39;H1&#39;.</span>
</span><span id="WeakForm.__init__-174"><a href="#WeakForm.__init__-174"><span class="linenos">174</span></a><span class="sd">        poly_space_base : str</span>
</span><span id="WeakForm.__init__-175"><a href="#WeakForm.__init__-175"><span class="linenos">175</span></a><span class="sd">            The name of polynomial space base. The default is &#39;lagrange&#39;.</span>
</span><span id="WeakForm.__init__-176"><a href="#WeakForm.__init__-176"><span class="linenos">176</span></a><span class="sd">        test_name : str</span>
</span><span id="WeakForm.__init__-177"><a href="#WeakForm.__init__-177"><span class="linenos">177</span></a><span class="sd">            Name of the test variable. The default is &#39;v&#39;.</span>
</span><span id="WeakForm.__init__-178"><a href="#WeakForm.__init__-178"><span class="linenos">178</span></a><span class="sd">        unknown_name : str</span>
</span><span id="WeakForm.__init__-179"><a href="#WeakForm.__init__-179"><span class="linenos">179</span></a><span class="sd">            Name of the unknown variable. The default is &#39;u&#39;.</span>
</span><span id="WeakForm.__init__-180"><a href="#WeakForm.__init__-180"><span class="linenos">180</span></a><span class="sd">        densities : list</span>
</span><span id="WeakForm.__init__-181"><a href="#WeakForm.__init__-181"><span class="linenos">181</span></a><span class="sd">            List of density functions or constants. The length of this list</span>
</span><span id="WeakForm.__init__-182"><a href="#WeakForm.__init__-182"><span class="linenos">182</span></a><span class="sd">            must match the number of sub*domains in the mesh.</span>
</span><span id="WeakForm.__init__-183"><a href="#WeakForm.__init__-183"><span class="linenos">183</span></a><span class="sd">            The default is None.</span>
</span><span id="WeakForm.__init__-184"><a href="#WeakForm.__init__-184"><span class="linenos">184</span></a><span class="sd">        entity_functions : list of 2-tuple</span>
</span><span id="WeakForm.__init__-185"><a href="#WeakForm.__init__-185"><span class="linenos">185</span></a><span class="sd">            List of tuples (dim, function) for manual entity selection.</span>
</span><span id="WeakForm.__init__-186"><a href="#WeakForm.__init__-186"><span class="linenos">186</span></a><span class="sd">            The default is [].</span>
</span><span id="WeakForm.__init__-187"><a href="#WeakForm.__init__-187"><span class="linenos">187</span></a>
</span><span id="WeakForm.__init__-188"><a href="#WeakForm.__init__-188"><span class="linenos">188</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WeakForm.__init__-189"><a href="#WeakForm.__init__-189"><span class="linenos">189</span></a>
</span><span id="WeakForm.__init__-190"><a href="#WeakForm.__init__-190"><span class="linenos">190</span></a>        <span class="c1"># keyword arguments handling</span>
</span><span id="WeakForm.__init__-191"><a href="#WeakForm.__init__-191"><span class="linenos">191</span></a>        <span class="n">mesh_dir</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mesh_dir&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="WeakForm.__init__-192"><a href="#WeakForm.__init__-192"><span class="linenos">192</span></a>        <span class="n">ext</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ext&#39;</span><span class="p">,</span> <span class="s1">&#39;.vtk&#39;</span><span class="p">)</span>
</span><span id="WeakForm.__init__-193"><a href="#WeakForm.__init__-193"><span class="linenos">193</span></a>        <span class="n">constcoeffs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;constcoeffs&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">terms</span><span class="p">))</span>
</span><span id="WeakForm.__init__-194"><a href="#WeakForm.__init__-194"><span class="linenos">194</span></a>        <span class="n">dirichlet_bc_vertex</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dirichlet_bc_vertex&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="WeakForm.__init__-195"><a href="#WeakForm.__init__-195"><span class="linenos">195</span></a>        <span class="n">dirichlet_bc_edge</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dirichlet_bc_edge&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="WeakForm.__init__-196"><a href="#WeakForm.__init__-196"><span class="linenos">196</span></a>        <span class="n">dirichlet_bc_facet</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dirichlet_bc_facet&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="WeakForm.__init__-197"><a href="#WeakForm.__init__-197"><span class="linenos">197</span></a>        <span class="n">dbc_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">dirichlet_bc_vertex</span><span class="p">,</span> <span class="n">dirichlet_bc_edge</span><span class="p">,</span> <span class="n">dirichlet_bc_facet</span><span class="p">]</span>
</span><span id="WeakForm.__init__-198"><a href="#WeakForm.__init__-198"><span class="linenos">198</span></a>
</span><span id="WeakForm.__init__-199"><a href="#WeakForm.__init__-199"><span class="linenos">199</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;verbose&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="WeakForm.__init__-200"><a href="#WeakForm.__init__-200"><span class="linenos">200</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="WeakForm.__init__-201"><a href="#WeakForm.__init__-201"><span class="linenos">201</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">constcoeffs</span> <span class="o">=</span> <span class="n">constcoeffs</span>
</span><span id="WeakForm.__init__-202"><a href="#WeakForm.__init__-202"><span class="linenos">202</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unknown_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;unknown_name&#39;</span><span class="p">,</span> <span class="s1">&#39;u&#39;</span><span class="p">)</span>
</span><span id="WeakForm.__init__-203"><a href="#WeakForm.__init__-203"><span class="linenos">203</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">test_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;test_name&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">)</span>
</span><span id="WeakForm.__init__-204"><a href="#WeakForm.__init__-204"><span class="linenos">204</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;order&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="WeakForm.__init__-205"><a href="#WeakForm.__init__-205"><span class="linenos">205</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">space</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;space&#39;</span><span class="p">,</span> <span class="s1">&#39;H1&#39;</span><span class="p">)</span>
</span><span id="WeakForm.__init__-206"><a href="#WeakForm.__init__-206"><span class="linenos">206</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">poly_space_base</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;poly_space_base&#39;</span><span class="p">,</span> <span class="s1">&#39;lagrange&#39;</span><span class="p">)</span>
</span><span id="WeakForm.__init__-207"><a href="#WeakForm.__init__-207"><span class="linenos">207</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">integral_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;integral_name&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">)</span>
</span><span id="WeakForm.__init__-208"><a href="#WeakForm.__init__-208"><span class="linenos">208</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">domain_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;domain_name&#39;</span><span class="p">,</span> <span class="s1">&#39;domain&#39;</span><span class="p">)</span>
</span><span id="WeakForm.__init__-209"><a href="#WeakForm.__init__-209"><span class="linenos">209</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nterms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">terms</span><span class="p">)</span>
</span><span id="WeakForm.__init__-210"><a href="#WeakForm.__init__-210"><span class="linenos">210</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">meshfile</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="WeakForm.__init__-211"><a href="#WeakForm.__init__-211"><span class="linenos">211</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">meshfile</span> <span class="o">=</span> <span class="n">get_meshsource</span><span class="p">(</span><span class="n">meshfile</span><span class="p">,</span> <span class="n">mesh_dir</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span>
</span><span id="WeakForm.__init__-212"><a href="#WeakForm.__init__-212"><span class="linenos">212</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meshfile</span><span class="p">)</span>
</span><span id="WeakForm.__init__-213"><a href="#WeakForm.__init__-213"><span class="linenos">213</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">physical_group_ids</span> <span class="o">=</span> <span class="n">get_physical_group_ids</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meshfile</span><span class="p">)</span>
</span><span id="WeakForm.__init__-214"><a href="#WeakForm.__init__-214"><span class="linenos">214</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="WeakForm.__init__-215"><a href="#WeakForm.__init__-215"><span class="linenos">215</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">meshfile</span>
</span><span id="WeakForm.__init__-216"><a href="#WeakForm.__init__-216"><span class="linenos">216</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">physical_group_ids</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="WeakForm.__init__-217"><a href="#WeakForm.__init__-217"><span class="linenos">217</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="n">FEDomain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">)</span>
</span><span id="WeakForm.__init__-218"><a href="#WeakForm.__init__-218"><span class="linenos">218</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">omega</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span><span class="s1">&#39;omega&#39;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">)</span>
</span><span id="WeakForm.__init__-219"><a href="#WeakForm.__init__-219"><span class="linenos">219</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">omega</span><span class="o">.</span><span class="n">dim</span>
</span><span id="WeakForm.__init__-220"><a href="#WeakForm.__init__-220"><span class="linenos">220</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">entity_functions</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;entity_functions&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="WeakForm.__init__-221"><a href="#WeakForm.__init__-221"><span class="linenos">221</span></a>
</span><span id="WeakForm.__init__-222"><a href="#WeakForm.__init__-222"><span class="linenos">222</span></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">terms</span><span class="p">)</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">constcoeffs</span><span class="p">)</span>
</span><span id="WeakForm.__init__-223"><a href="#WeakForm.__init__-223"><span class="linenos">223</span></a>
</span><span id="WeakForm.__init__-224"><a href="#WeakForm.__init__-224"><span class="linenos">224</span></a>        <span class="c1"># Regions (cells, facets, edges, vertices):</span>
</span><span id="WeakForm.__init__-225"><a href="#WeakForm.__init__-225"><span class="linenos">225</span></a>        <span class="c1"># - embedded in the mesh file</span>
</span><span id="WeakForm.__init__-226"><a href="#WeakForm.__init__-226"><span class="linenos">226</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">region_dic</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;omega&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">omega</span><span class="p">}</span>
</span><span id="WeakForm.__init__-227"><a href="#WeakForm.__init__-227"><span class="linenos">227</span></a>        <span class="n">subomegas</span><span class="p">,</span> <span class="n">facets</span><span class="p">,</span> <span class="n">edges</span><span class="p">,</span> <span class="n">vertices</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
</span><span id="WeakForm.__init__-228"><a href="#WeakForm.__init__-228"><span class="linenos">228</span></a>        <span class="c1"># subool = len([x for x in self.physical_group_ids if x &gt;= 300]) &gt;= 2</span>
</span><span id="WeakForm.__init__-229"><a href="#WeakForm.__init__-229"><span class="linenos">229</span></a>        <span class="k">for</span> <span class="n">group_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">physical_group_ids</span><span class="p">:</span>
</span><span id="WeakForm.__init__-230"><a href="#WeakForm.__init__-230"><span class="linenos">230</span></a>            <span class="k">if</span> <span class="n">group_id</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">group_id</span> <span class="o">&lt;=</span> <span class="mi">99</span><span class="p">:</span>
</span><span id="WeakForm.__init__-231"><a href="#WeakForm.__init__-231"><span class="linenos">231</span></a>                <span class="n">vertices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span>
</span><span id="WeakForm.__init__-232"><a href="#WeakForm.__init__-232"><span class="linenos">232</span></a>                    <span class="s1">&#39;node</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">group_id</span><span class="p">,</span>
</span><span id="WeakForm.__init__-233"><a href="#WeakForm.__init__-233"><span class="linenos">233</span></a>                    <span class="s1">&#39;vertices of group </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">group_id</span><span class="p">,</span> <span class="c1"># selection of vertices</span>
</span><span id="WeakForm.__init__-234"><a href="#WeakForm.__init__-234"><span class="linenos">234</span></a>                    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;vertex&#39;</span><span class="p">))</span>
</span><span id="WeakForm.__init__-235"><a href="#WeakForm.__init__-235"><span class="linenos">235</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">region_dic</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">group_id</span><span class="p">)]</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="WeakForm.__init__-236"><a href="#WeakForm.__init__-236"><span class="linenos">236</span></a>            <span class="k">elif</span> <span class="n">group_id</span> <span class="o">&gt;=</span> <span class="mi">100</span> <span class="ow">and</span> <span class="n">group_id</span> <span class="o">&lt;=</span> <span class="mi">199</span><span class="p">:</span>
</span><span id="WeakForm.__init__-237"><a href="#WeakForm.__init__-237"><span class="linenos">237</span></a>                <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span>
</span><span id="WeakForm.__init__-238"><a href="#WeakForm.__init__-238"><span class="linenos">238</span></a>                    <span class="s1">&#39;edge</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">group_id</span><span class="p">,</span>
</span><span id="WeakForm.__init__-239"><a href="#WeakForm.__init__-239"><span class="linenos">239</span></a>                    <span class="s1">&#39;vertices of group </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">group_id</span><span class="p">,</span> <span class="c1"># selection of vertices</span>
</span><span id="WeakForm.__init__-240"><a href="#WeakForm.__init__-240"><span class="linenos">240</span></a>                    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;edge&#39;</span><span class="p">))</span>
</span><span id="WeakForm.__init__-241"><a href="#WeakForm.__init__-241"><span class="linenos">241</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">region_dic</span><span class="p">[</span><span class="s1">&#39;edge&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">group_id</span><span class="p">)]</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="WeakForm.__init__-242"><a href="#WeakForm.__init__-242"><span class="linenos">242</span></a>            <span class="k">elif</span> <span class="n">group_id</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="ow">and</span> <span class="n">group_id</span> <span class="o">&lt;=</span> <span class="mi">299</span><span class="p">:</span>
</span><span id="WeakForm.__init__-243"><a href="#WeakForm.__init__-243"><span class="linenos">243</span></a>                <span class="n">facets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span>
</span><span id="WeakForm.__init__-244"><a href="#WeakForm.__init__-244"><span class="linenos">244</span></a>                    <span class="s1">&#39;facet</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">group_id</span><span class="p">,</span>
</span><span id="WeakForm.__init__-245"><a href="#WeakForm.__init__-245"><span class="linenos">245</span></a>                    <span class="s1">&#39;vertices of group </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">group_id</span><span class="p">,</span> <span class="c1"># selection of vertices</span>
</span><span id="WeakForm.__init__-246"><a href="#WeakForm.__init__-246"><span class="linenos">246</span></a>                    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;facet&#39;</span><span class="p">))</span>
</span><span id="WeakForm.__init__-247"><a href="#WeakForm.__init__-247"><span class="linenos">247</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">region_dic</span><span class="p">[</span><span class="s1">&#39;facet&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">group_id</span><span class="p">)]</span> <span class="o">=</span> <span class="n">facets</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="WeakForm.__init__-248"><a href="#WeakForm.__init__-248"><span class="linenos">248</span></a>            <span class="k">elif</span> <span class="n">group_id</span> <span class="o">&gt;=</span> <span class="mi">300</span><span class="p">:</span>
</span><span id="WeakForm.__init__-249"><a href="#WeakForm.__init__-249"><span class="linenos">249</span></a>                <span class="n">subomegas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span>
</span><span id="WeakForm.__init__-250"><a href="#WeakForm.__init__-250"><span class="linenos">250</span></a>                    <span class="s1">&#39;subomega</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">group_id</span><span class="p">,</span>
</span><span id="WeakForm.__init__-251"><a href="#WeakForm.__init__-251"><span class="linenos">251</span></a>                    <span class="s1">&#39;cells of group </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">group_id</span><span class="p">,</span> <span class="c1"># selection of cells</span>
</span><span id="WeakForm.__init__-252"><a href="#WeakForm.__init__-252"><span class="linenos">252</span></a>                    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cell&#39;</span><span class="p">))</span>
</span><span id="WeakForm.__init__-253"><a href="#WeakForm.__init__-253"><span class="linenos">253</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">region_dic</span><span class="p">[</span><span class="s1">&#39;subomega&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">group_id</span><span class="p">)]</span> <span class="o">=</span> <span class="n">subomegas</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="WeakForm.__init__-254"><a href="#WeakForm.__init__-254"><span class="linenos">254</span></a>
</span><span id="WeakForm.__init__-255"><a href="#WeakForm.__init__-255"><span class="linenos">255</span></a>        <span class="c1"># - specified manually through a function of coordinates</span>
</span><span id="WeakForm.__init__-256"><a href="#WeakForm.__init__-256"><span class="linenos">256</span></a>        <span class="k">for</span> <span class="n">dimFunc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entity_functions</span><span class="p">:</span>
</span><span id="WeakForm.__init__-257"><a href="#WeakForm.__init__-257"><span class="linenos">257</span></a>            <span class="n">dim</span><span class="p">,</span> <span class="n">func</span> <span class="o">=</span> <span class="n">dimFunc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dimFunc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="WeakForm.__init__-258"><a href="#WeakForm.__init__-258"><span class="linenos">258</span></a>            <span class="n">funcname</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="WeakForm.__init__-259"><a href="#WeakForm.__init__-259"><span class="linenos">259</span></a>            <span class="k">if</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="WeakForm.__init__-260"><a href="#WeakForm.__init__-260"><span class="linenos">260</span></a>                <span class="n">nb</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span>
</span><span id="WeakForm.__init__-261"><a href="#WeakForm.__init__-261"><span class="linenos">261</span></a>                <span class="n">vertices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span>
</span><span id="WeakForm.__init__-262"><a href="#WeakForm.__init__-262"><span class="linenos">262</span></a>                    <span class="s1">&#39;node</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">nb</span><span class="p">,</span>
</span><span id="WeakForm.__init__-263"><a href="#WeakForm.__init__-263"><span class="linenos">263</span></a>                    <span class="s1">&#39;vertices by </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">funcname</span><span class="p">,</span>
</span><span id="WeakForm.__init__-264"><a href="#WeakForm.__init__-264"><span class="linenos">264</span></a>                    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;vertex&#39;</span><span class="p">,</span>
</span><span id="WeakForm.__init__-265"><a href="#WeakForm.__init__-265"><span class="linenos">265</span></a>                    <span class="n">functions</span><span class="o">=</span><span class="p">{</span><span class="n">funcname</span> <span class="p">:</span> <span class="n">func</span><span class="p">}))</span>
</span><span id="WeakForm.__init__-266"><a href="#WeakForm.__init__-266"><span class="linenos">266</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">region_dic</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nb</span><span class="p">)]</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="WeakForm.__init__-267"><a href="#WeakForm.__init__-267"><span class="linenos">267</span></a>
</span><span id="WeakForm.__init__-268"><a href="#WeakForm.__init__-268"><span class="linenos">268</span></a>            <span class="k">elif</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="WeakForm.__init__-269"><a href="#WeakForm.__init__-269"><span class="linenos">269</span></a>                <span class="n">nb</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span>
</span><span id="WeakForm.__init__-270"><a href="#WeakForm.__init__-270"><span class="linenos">270</span></a>                <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span>
</span><span id="WeakForm.__init__-271"><a href="#WeakForm.__init__-271"><span class="linenos">271</span></a>                    <span class="s1">&#39;edge</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">nb</span><span class="p">,</span>
</span><span id="WeakForm.__init__-272"><a href="#WeakForm.__init__-272"><span class="linenos">272</span></a>                    <span class="s1">&#39;vertices by </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">funcname</span><span class="p">,</span>
</span><span id="WeakForm.__init__-273"><a href="#WeakForm.__init__-273"><span class="linenos">273</span></a>                    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;edge&#39;</span><span class="p">,</span>
</span><span id="WeakForm.__init__-274"><a href="#WeakForm.__init__-274"><span class="linenos">274</span></a>                    <span class="n">functions</span><span class="o">=</span><span class="p">{</span><span class="n">funcname</span> <span class="p">:</span> <span class="n">func</span><span class="p">}))</span>
</span><span id="WeakForm.__init__-275"><a href="#WeakForm.__init__-275"><span class="linenos">275</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">region_dic</span><span class="p">[</span><span class="s1">&#39;edge&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nb</span><span class="p">)]</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="WeakForm.__init__-276"><a href="#WeakForm.__init__-276"><span class="linenos">276</span></a>
</span><span id="WeakForm.__init__-277"><a href="#WeakForm.__init__-277"><span class="linenos">277</span></a>            <span class="k">elif</span> <span class="p">(</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
</span><span id="WeakForm.__init__-278"><a href="#WeakForm.__init__-278"><span class="linenos">278</span></a>                    <span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
</span><span id="WeakForm.__init__-279"><a href="#WeakForm.__init__-279"><span class="linenos">279</span></a>                <span class="n">nb</span> <span class="o">=</span> <span class="mi">200</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">facets</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span>
</span><span id="WeakForm.__init__-280"><a href="#WeakForm.__init__-280"><span class="linenos">280</span></a>                <span class="n">facets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span>
</span><span id="WeakForm.__init__-281"><a href="#WeakForm.__init__-281"><span class="linenos">281</span></a>                    <span class="s1">&#39;facet</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">nb</span><span class="p">,</span>
</span><span id="WeakForm.__init__-282"><a href="#WeakForm.__init__-282"><span class="linenos">282</span></a>                    <span class="s1">&#39;vertices by </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">funcname</span><span class="p">,</span>
</span><span id="WeakForm.__init__-283"><a href="#WeakForm.__init__-283"><span class="linenos">283</span></a>                    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;facet&#39;</span><span class="p">,</span>
</span><span id="WeakForm.__init__-284"><a href="#WeakForm.__init__-284"><span class="linenos">284</span></a>                    <span class="n">functions</span><span class="o">=</span><span class="p">{</span><span class="n">funcname</span> <span class="p">:</span> <span class="n">func</span><span class="p">}))</span>
</span><span id="WeakForm.__init__-285"><a href="#WeakForm.__init__-285"><span class="linenos">285</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">region_dic</span><span class="p">[</span><span class="s1">&#39;facet&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nb</span><span class="p">)]</span> <span class="o">=</span> <span class="n">facets</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="WeakForm.__init__-286"><a href="#WeakForm.__init__-286"><span class="linenos">286</span></a>
</span><span id="WeakForm.__init__-287"><a href="#WeakForm.__init__-287"><span class="linenos">287</span></a>            <span class="k">elif</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="WeakForm.__init__-288"><a href="#WeakForm.__init__-288"><span class="linenos">288</span></a>                <span class="n">nb</span> <span class="o">=</span> <span class="mi">300</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">subomegas</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span>
</span><span id="WeakForm.__init__-289"><a href="#WeakForm.__init__-289"><span class="linenos">289</span></a>                <span class="n">subomegas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span>
</span><span id="WeakForm.__init__-290"><a href="#WeakForm.__init__-290"><span class="linenos">290</span></a>                    <span class="s1">&#39;subomega</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">nb</span><span class="p">,</span>
</span><span id="WeakForm.__init__-291"><a href="#WeakForm.__init__-291"><span class="linenos">291</span></a>                    <span class="s1">&#39;cells by </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">funcname</span><span class="p">,</span>
</span><span id="WeakForm.__init__-292"><a href="#WeakForm.__init__-292"><span class="linenos">292</span></a>                    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cell&#39;</span><span class="p">,</span>
</span><span id="WeakForm.__init__-293"><a href="#WeakForm.__init__-293"><span class="linenos">293</span></a>                    <span class="n">functions</span><span class="o">=</span><span class="p">{</span><span class="n">funcname</span> <span class="p">:</span> <span class="n">func</span><span class="p">}))</span>
</span><span id="WeakForm.__init__-294"><a href="#WeakForm.__init__-294"><span class="linenos">294</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">region_dic</span><span class="p">[</span><span class="s1">&#39;subomega&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nb</span><span class="p">)]</span> <span class="o">=</span> <span class="n">subomegas</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="WeakForm.__init__-295"><a href="#WeakForm.__init__-295"><span class="linenos">295</span></a>
</span><span id="WeakForm.__init__-296"><a href="#WeakForm.__init__-296"><span class="linenos">296</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">subomegas</span> <span class="o">=</span> <span class="n">subomegas</span>
</span><span id="WeakForm.__init__-297"><a href="#WeakForm.__init__-297"><span class="linenos">297</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">facets</span> <span class="o">=</span> <span class="n">facets</span>
</span><span id="WeakForm.__init__-298"><a href="#WeakForm.__init__-298"><span class="linenos">298</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">edges</span> <span class="o">=</span> <span class="n">edges</span>
</span><span id="WeakForm.__init__-299"><a href="#WeakForm.__init__-299"><span class="linenos">299</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="n">vertices</span>
</span><span id="WeakForm.__init__-300"><a href="#WeakForm.__init__-300"><span class="linenos">300</span></a>
</span><span id="WeakForm.__init__-301"><a href="#WeakForm.__init__-301"><span class="linenos">301</span></a>        <span class="c1"># Density profiles</span>
</span><span id="WeakForm.__init__-302"><a href="#WeakForm.__init__-302"><span class="linenos">302</span></a>        <span class="n">densities</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;densities&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="WeakForm.__init__-303"><a href="#WeakForm.__init__-303"><span class="linenos">303</span></a>        <span class="k">if</span> <span class="n">densities</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="WeakForm.__init__-304"><a href="#WeakForm.__init__-304"><span class="linenos">304</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">densities</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">subomegas</span><span class="p">):</span>
</span><span id="WeakForm.__init__-305"><a href="#WeakForm.__init__-305"><span class="linenos">305</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;More density profiles than sub-domains&quot;</span><span class="p">)</span>
</span><span id="WeakForm.__init__-306"><a href="#WeakForm.__init__-306"><span class="linenos">306</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">densities</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="WeakForm.__init__-307"><a href="#WeakForm.__init__-307"><span class="linenos">307</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">densities</span><span class="p">)):</span>
</span><span id="WeakForm.__init__-308"><a href="#WeakForm.__init__-308"><span class="linenos">308</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="p">[</span><span class="n">subomegas</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">densities</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="WeakForm.__init__-309"><a href="#WeakForm.__init__-309"><span class="linenos">309</span></a>
</span><span id="WeakForm.__init__-310"><a href="#WeakForm.__init__-310"><span class="linenos">310</span></a>        <span class="c1"># Field setup</span>
</span><span id="WeakForm.__init__-311"><a href="#WeakForm.__init__-311"><span class="linenos">311</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">field</span> <span class="o">=</span> <span class="n">Field</span><span class="o">.</span><span class="n">from_args</span><span class="p">(</span><span class="s1">&#39;fu&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="s1">&#39;scalar&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">omega</span><span class="p">,</span>
</span><span id="WeakForm.__init__-312"><a href="#WeakForm.__init__-312"><span class="linenos">312</span></a>                                     <span class="n">approx_order</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">space</span><span class="p">,</span>
</span><span id="WeakForm.__init__-313"><a href="#WeakForm.__init__-313"><span class="linenos">313</span></a>                                     <span class="n">poly_space_base</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">poly_space_base</span><span class="p">)</span>
</span><span id="WeakForm.__init__-314"><a href="#WeakForm.__init__-314"><span class="linenos">314</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ndofs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">n_nod</span>
</span><span id="WeakForm.__init__-315"><a href="#WeakForm.__init__-315"><span class="linenos">315</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unknown</span> <span class="o">=</span> <span class="n">FieldVariable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unknown_name</span><span class="p">,</span> <span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="p">)</span>
</span><span id="WeakForm.__init__-316"><a href="#WeakForm.__init__-316"><span class="linenos">316</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">test</span> <span class="o">=</span> <span class="n">FieldVariable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_name</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="p">,</span>
</span><span id="WeakForm.__init__-317"><a href="#WeakForm.__init__-317"><span class="linenos">317</span></a>                                  <span class="n">primary_var_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unknown_name</span><span class="p">)</span>
</span><span id="WeakForm.__init__-318"><a href="#WeakForm.__init__-318"><span class="linenos">318</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">integral</span> <span class="o">=</span> <span class="n">Integral</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">integral_name</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span><span id="WeakForm.__init__-319"><a href="#WeakForm.__init__-319"><span class="linenos">319</span></a>
</span><span id="WeakForm.__init__-320"><a href="#WeakForm.__init__-320"><span class="linenos">320</span></a>        <span class="c1"># Dirichlet boundary conditions on entities of dimension &lt; D</span>
</span><span id="WeakForm.__init__-321"><a href="#WeakForm.__init__-321"><span class="linenos">321</span></a>        <span class="n">ent_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">facets</span><span class="p">]</span>
</span><span id="WeakForm.__init__-322"><a href="#WeakForm.__init__-322"><span class="linenos">322</span></a>        <span class="n">ebcs_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="WeakForm.__init__-323"><a href="#WeakForm.__init__-323"><span class="linenos">323</span></a>        <span class="k">for</span> <span class="n">k_dbcs</span><span class="p">,</span> <span class="n">dbcs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dbc_list</span><span class="p">):</span>
</span><span id="WeakForm.__init__-324"><a href="#WeakForm.__init__-324"><span class="linenos">324</span></a>            <span class="k">if</span> <span class="n">dbcs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="WeakForm.__init__-325"><a href="#WeakForm.__init__-325"><span class="linenos">325</span></a>                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">dbcs</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">ent_list</span><span class="p">[</span><span class="n">k_dbcs</span><span class="p">])</span>
</span><span id="WeakForm.__init__-326"><a href="#WeakForm.__init__-326"><span class="linenos">326</span></a>                <span class="k">for</span> <span class="n">k_dbc</span><span class="p">,</span> <span class="n">dbc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dbcs</span><span class="p">):</span>
</span><span id="WeakForm.__init__-327"><a href="#WeakForm.__init__-327"><span class="linenos">327</span></a>                    <span class="k">if</span> <span class="n">dbc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="WeakForm.__init__-328"><a href="#WeakForm.__init__-328"><span class="linenos">328</span></a>                        <span class="n">ebc_name</span> <span class="o">=</span> <span class="s1">&#39;ebc_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k_dbcs</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k_dbc</span><span class="p">)</span>
</span><span id="WeakForm.__init__-329"><a href="#WeakForm.__init__-329"><span class="linenos">329</span></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dbc</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
</span><span id="WeakForm.__init__-330"><a href="#WeakForm.__init__-330"><span class="linenos">330</span></a>                            <span class="n">ebc</span> <span class="o">=</span> <span class="n">EssentialBC</span><span class="p">(</span>
</span><span id="WeakForm.__init__-331"><a href="#WeakForm.__init__-331"><span class="linenos">331</span></a>                                <span class="n">ebc_name</span><span class="p">,</span>
</span><span id="WeakForm.__init__-332"><a href="#WeakForm.__init__-332"><span class="linenos">332</span></a>                                <span class="n">ent_list</span><span class="p">[</span><span class="n">k_dbcs</span><span class="p">][</span><span class="n">k_dbc</span><span class="p">],</span>
</span><span id="WeakForm.__init__-333"><a href="#WeakForm.__init__-333"><span class="linenos">333</span></a>                                <span class="p">{</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.all&#39;</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">unknown_name</span> <span class="p">:</span> <span class="n">dbc</span><span class="p">})</span>
</span><span id="WeakForm.__init__-334"><a href="#WeakForm.__init__-334"><span class="linenos">334</span></a>                        <span class="k">elif</span> <span class="n">callable</span><span class="p">(</span><span class="n">dbc</span><span class="p">):</span>
</span><span id="WeakForm.__init__-335"><a href="#WeakForm.__init__-335"><span class="linenos">335</span></a><span class="w">                            </span><span class="sd">&quot;&quot;&quot; Function signature should be </span>
</span><span id="WeakForm.__init__-336"><a href="#WeakForm.__init__-336"><span class="linenos">336</span></a><span class="sd">                            dbc(ts, coors, **kwargs) &quot;&quot;&quot;</span>
</span><span id="WeakForm.__init__-337"><a href="#WeakForm.__init__-337"><span class="linenos">337</span></a>                            <span class="n">ebc_func_name</span> <span class="o">=</span> <span class="s1">&#39;ebc_func_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k_dbcs</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k_dbc</span><span class="p">)</span>
</span><span id="WeakForm.__init__-338"><a href="#WeakForm.__init__-338"><span class="linenos">338</span></a>                            <span class="n">ebc_func</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="n">ebc_func_name</span><span class="p">,</span> <span class="n">dbc</span><span class="p">)</span>
</span><span id="WeakForm.__init__-339"><a href="#WeakForm.__init__-339"><span class="linenos">339</span></a>                            <span class="n">ebc</span> <span class="o">=</span> <span class="n">EssentialBC</span><span class="p">(</span>
</span><span id="WeakForm.__init__-340"><a href="#WeakForm.__init__-340"><span class="linenos">340</span></a>                                <span class="n">ebc_name</span><span class="p">,</span>
</span><span id="WeakForm.__init__-341"><a href="#WeakForm.__init__-341"><span class="linenos">341</span></a>                                <span class="n">ent_list</span><span class="p">[</span><span class="n">k_dbcs</span><span class="p">][</span><span class="n">k_dbc</span><span class="p">],</span>
</span><span id="WeakForm.__init__-342"><a href="#WeakForm.__init__-342"><span class="linenos">342</span></a>                                <span class="p">{</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.all&#39;</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">unknown_name</span> <span class="p">:</span> <span class="n">ebc_func</span><span class="p">})</span>
</span><span id="WeakForm.__init__-343"><a href="#WeakForm.__init__-343"><span class="linenos">343</span></a>                        <span class="n">ebcs_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ebc</span><span class="p">)</span>
</span><span id="WeakForm.__init__-344"><a href="#WeakForm.__init__-344"><span class="linenos">344</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ebcs</span> <span class="o">=</span> <span class="n">ebcs_list</span>
</span><span id="WeakForm.__init__-345"><a href="#WeakForm.__init__-345"><span class="linenos">345</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">epbcs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="WeakForm.__init__-346"><a href="#WeakForm.__init__-346"><span class="linenos">346</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lcbcs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="WeakForm.__init__-347"><a href="#WeakForm.__init__-347"><span class="linenos">347</span></a>
</span><span id="WeakForm.__init__-348"><a href="#WeakForm.__init__-348"><span class="linenos">348</span></a>        <span class="c1"># Terms definition</span>
</span><span id="WeakForm.__init__-349"><a href="#WeakForm.__init__-349"><span class="linenos">349</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_terms</span> <span class="o">=</span> <span class="n">terms</span>
</span><span id="WeakForm.__init__-350"><a href="#WeakForm.__init__-350"><span class="linenos">350</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">terms</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="WeakForm.__init__-351"><a href="#WeakForm.__init__-351"><span class="linenos">351</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eqn</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WeakForm.__init__-352"><a href="#WeakForm.__init__-352"><span class="linenos">352</span></a>        <span class="k">for</span> <span class="n">materm</span> <span class="ow">in</span> <span class="n">terms</span><span class="p">:</span>
</span><span id="WeakForm.__init__-353"><a href="#WeakForm.__init__-353"><span class="linenos">353</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">add_term</span><span class="p">(</span><span class="n">materm</span><span class="p">)</span>
</span><span id="WeakForm.__init__-354"><a href="#WeakForm.__init__-354"><span class="linenos">354</span></a>
</span><span id="WeakForm.__init__-355"><a href="#WeakForm.__init__-355"><span class="linenos">355</span></a>        <span class="c1"># Equation</span>
</span><span id="WeakForm.__init__-356"><a href="#WeakForm.__init__-356"><span class="linenos">356</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eqn</span> <span class="o">=</span> <span class="n">WeakForm</span><span class="o">.</span><span class="n">make_equation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">terms</span><span class="p">,</span>
</span><span id="WeakForm.__init__-357"><a href="#WeakForm.__init__-357"><span class="linenos">357</span></a>                                          <span class="bp">self</span><span class="o">.</span><span class="n">constcoeffs</span><span class="p">,</span>
</span><span id="WeakForm.__init__-358"><a href="#WeakForm.__init__-358"><span class="linenos">358</span></a>                                          <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="WeakForm.__init__-359"><a href="#WeakForm.__init__-359"><span class="linenos">359</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eqn_cst</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WeakForm.__init__-360"><a href="#WeakForm.__init__-360"><span class="linenos">360</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eqn_mod</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WeakForm.__init__-361"><a href="#WeakForm.__init__-361"><span class="linenos">361</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">split_equation</span><span class="p">()</span>
</span><span id="WeakForm.__init__-362"><a href="#WeakForm.__init__-362"><span class="linenos">362</span></a>
</span><span id="WeakForm.__init__-363"><a href="#WeakForm.__init__-363"><span class="linenos">363</span></a>        <span class="c1"># Display information for the user</span>
</span><span id="WeakForm.__init__-364"><a href="#WeakForm.__init__-364"><span class="linenos">364</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="WeakForm.__init__-365"><a href="#WeakForm.__init__-365"><span class="linenos">365</span></a>            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><p>Construct a WeakForm instance that is an object containing all the
necessary information related to a given weak form PDE.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>name</strong> (str):
Name of the weak form.</li>
<li><strong>meshfile</strong> (str):
Name of the meshfile e.g. 'my_mesh.vtk' located in the specified
mesh directory.</li>
<li><strong>terms</strong> (list):
List containing the terms of the weak form PDE. Each element of the
list is a list containing:
    - a material function or None.
    - a Sfepy string of the term, e.g. 'dw_laplace', or
    'dw_volume'. <a href="https://sfepy.org/doc-devel/terms_overview.html">https://sfepy.org/doc-devel/terms_overview.html</a>.
    - a region's name e.g. 'facet200', 'subomega301', or None.</li>
</ul>

<h6 id="other-parameters">Other Parameters</h6>

<ul>
<li><strong>mesh_dir</strong> (str):
Directory where the mesh files are located. The default is None.</li>
<li><strong>ext</strong> (str):
Extension of the mesh file. The default is '.vtk'.</li>
<li><strong>constcoeffs</strong> (list):
Coefficients weighting the terms such that the weak form equation
reads
    $$ \sum_{i=1}^{N_{\mathrm{terms}}} \texttt{constcoeffs[i]}
    \times \texttt{terms[i]} = 0 $$</li>
<li><strong>dirichlet_bc_facet</strong> (list):
List of dirichlet boundary conditions applied to facets. This list
must be the same length as the number of facets defined in the
domain. Elements of the list are such that:
    - if <code>dirichlet_bc_facet</code>[k] is None, then facets[k] is free of
    any essential boundary condition.
    - if <code>dirichlet_bc_facet</code>[k] is a number, then facets[k] is
    constrained by a constant essential boundary condition.
    - if <code>dirichlet_bc_facet</code>[k] is a function, then facets[k] is
    constrained by a dirichlet boundary condition calculated by the
    function.
The default is None.</li>
<li><strong>dirichlet_bc_edge</strong> (list):
List of dirichlet boundary conditions applied to edges. This list
must be the same length as the number of edges defined in the
domain. The default is None.</li>
<li><strong>dirichlet_bc_vertex</strong> (list):
List of dirichlet boundary conditions applied to vertices. This
list must be the same length as the number of edges defined in the
domain. The default is None.</li>
<li><strong>verbose</strong> (bool):
Display user's information. The default is False.</li>
<li><strong>domain_name</strong> (str):
The domain name. The default is 'domain'.</li>
<li><strong>integral_name</strong> (str):
The integral name. The default is 'i'.</li>
<li><strong>space</strong> (str):
The function space name. The default is 'H1'.</li>
<li><strong>poly_space_base</strong> (str):
The name of polynomial space base. The default is 'lagrange'.</li>
<li><strong>test_name</strong> (str):
Name of the test variable. The default is 'v'.</li>
<li><strong>unknown_name</strong> (str):
Name of the unknown variable. The default is 'u'.</li>
<li><strong>densities</strong> (list):
List of density functions or constants. The length of this list
must match the number of sub*domains in the mesh.
The default is None.</li>
<li><strong>entity_functions</strong> (list of 2-tuple):
List of tuples (dim, function) for manual entity selection.
The default is [].</li>
</ul>
</div>


                            </div>
                            <div id="WeakForm.forbidden_mod_arg" class="classattr">
                                <div class="attr variable">
            <span class="name">forbidden_mod_arg</span>        =
<span class="default_value">[&#39;update_nl&#39;, &#39;rho&#39;, &#39;rho_vac&#39;, &#39;Rcut&#39;]</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.forbidden_mod_arg"></a>
    
    

                            </div>
                            <div id="WeakForm.verbose" class="classattr">
                                <div class="attr variable">
            <span class="name">verbose</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.verbose"></a>
    
    

                            </div>
                            <div id="WeakForm.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.name"></a>
    
    

                            </div>
                            <div id="WeakForm.constcoeffs" class="classattr">
                                <div class="attr variable">
            <span class="name">constcoeffs</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.constcoeffs"></a>
    
    

                            </div>
                            <div id="WeakForm.unknown_name" class="classattr">
                                <div class="attr variable">
            <span class="name">unknown_name</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.unknown_name"></a>
    
    

                            </div>
                            <div id="WeakForm.test_name" class="classattr">
                                <div class="attr variable">
            <span class="name">test_name</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.test_name"></a>
    
    

                            </div>
                            <div id="WeakForm.order" class="classattr">
                                <div class="attr variable">
            <span class="name">order</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.order"></a>
    
    

                            </div>
                            <div id="WeakForm.space" class="classattr">
                                <div class="attr variable">
            <span class="name">space</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.space"></a>
    
    

                            </div>
                            <div id="WeakForm.poly_space_base" class="classattr">
                                <div class="attr variable">
            <span class="name">poly_space_base</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.poly_space_base"></a>
    
    

                            </div>
                            <div id="WeakForm.integral_name" class="classattr">
                                <div class="attr variable">
            <span class="name">integral_name</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.integral_name"></a>
    
    

                            </div>
                            <div id="WeakForm.domain_name" class="classattr">
                                <div class="attr variable">
            <span class="name">domain_name</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.domain_name"></a>
    
    

                            </div>
                            <div id="WeakForm.nterms" class="classattr">
                                <div class="attr variable">
            <span class="name">nterms</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.nterms"></a>
    
    

                            </div>
                            <div id="WeakForm.domain" class="classattr">
                                <div class="attr variable">
            <span class="name">domain</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.domain"></a>
    
    

                            </div>
                            <div id="WeakForm.omega" class="classattr">
                                <div class="attr variable">
            <span class="name">omega</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.omega"></a>
    
    

                            </div>
                            <div id="WeakForm.dimension" class="classattr">
                                <div class="attr variable">
            <span class="name">dimension</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.dimension"></a>
    
    

                            </div>
                            <div id="WeakForm.entity_functions" class="classattr">
                                <div class="attr variable">
            <span class="name">entity_functions</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.entity_functions"></a>
    
    

                            </div>
                            <div id="WeakForm.region_dic" class="classattr">
                                <div class="attr variable">
            <span class="name">region_dic</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.region_dic"></a>
    
    

                            </div>
                            <div id="WeakForm.subomegas" class="classattr">
                                <div class="attr variable">
            <span class="name">subomegas</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.subomegas"></a>
    
    

                            </div>
                            <div id="WeakForm.facets" class="classattr">
                                <div class="attr variable">
            <span class="name">facets</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.facets"></a>
    
    

                            </div>
                            <div id="WeakForm.edges" class="classattr">
                                <div class="attr variable">
            <span class="name">edges</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.edges"></a>
    
    

                            </div>
                            <div id="WeakForm.vertices" class="classattr">
                                <div class="attr variable">
            <span class="name">vertices</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.vertices"></a>
    
    

                            </div>
                            <div id="WeakForm.field" class="classattr">
                                <div class="attr variable">
            <span class="name">field</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.field"></a>
    
    

                            </div>
                            <div id="WeakForm.ndofs" class="classattr">
                                <div class="attr variable">
            <span class="name">ndofs</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.ndofs"></a>
    
    

                            </div>
                            <div id="WeakForm.unknown" class="classattr">
                                <div class="attr variable">
            <span class="name">unknown</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.unknown"></a>
    
    

                            </div>
                            <div id="WeakForm.test" class="classattr">
                                <div class="attr variable">
            <span class="name">test</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.test"></a>
    
    

                            </div>
                            <div id="WeakForm.integral" class="classattr">
                                <div class="attr variable">
            <span class="name">integral</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.integral"></a>
    
    

                            </div>
                            <div id="WeakForm.ebcs" class="classattr">
                                <div class="attr variable">
            <span class="name">ebcs</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.ebcs"></a>
    
    

                            </div>
                            <div id="WeakForm.epbcs" class="classattr">
                                <div class="attr variable">
            <span class="name">epbcs</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.epbcs"></a>
    
    

                            </div>
                            <div id="WeakForm.lcbcs" class="classattr">
                                <div class="attr variable">
            <span class="name">lcbcs</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.lcbcs"></a>
    
    

                            </div>
                            <div id="WeakForm.terms" class="classattr">
                                <div class="attr variable">
            <span class="name">terms</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.terms"></a>
    
    

                            </div>
                            <div id="WeakForm.eqn" class="classattr">
                                <div class="attr variable">
            <span class="name">eqn</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.eqn"></a>
    
    

                            </div>
                            <div id="WeakForm.eqn_cst" class="classattr">
                                <div class="attr variable">
            <span class="name">eqn_cst</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.eqn_cst"></a>
    
    

                            </div>
                            <div id="WeakForm.eqn_mod" class="classattr">
                                <div class="attr variable">
            <span class="name">eqn_mod</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.eqn_mod"></a>
    
    

                            </div>
                            <div id="WeakForm.add_term" class="classattr">
                                        <input id="WeakForm.add_term-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_term</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">materm</span>, </span><span class="param"><span class="n">update</span><span class="o">=</span><span class="kc">False</span>, </span><span class="param"><span class="n">newcoeff</span><span class="o">=</span><span class="mf">1.0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="WeakForm.add_term-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeakForm.add_term"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeakForm.add_term-367"><a href="#WeakForm.add_term-367"><span class="linenos">367</span></a>    <span class="k">def</span> <span class="nf">add_term</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">materm</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">newcoeff</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
</span><span id="WeakForm.add_term-368"><a href="#WeakForm.add_term-368"><span class="linenos">368</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm.add_term-369"><a href="#WeakForm.add_term-369"><span class="linenos">369</span></a><span class="sd">        Add a term to the existing WeakForm object.</span>
</span><span id="WeakForm.add_term-370"><a href="#WeakForm.add_term-370"><span class="linenos">370</span></a>
</span><span id="WeakForm.add_term-371"><a href="#WeakForm.add_term-371"><span class="linenos">371</span></a><span class="sd">        Parameters</span>
</span><span id="WeakForm.add_term-372"><a href="#WeakForm.add_term-372"><span class="linenos">372</span></a><span class="sd">        ----------</span>
</span><span id="WeakForm.add_term-373"><a href="#WeakForm.add_term-373"><span class="linenos">373</span></a><span class="sd">        materm : list of length 2 or 3 (one element of terms).</span>
</span><span id="WeakForm.add_term-374"><a href="#WeakForm.add_term-374"><span class="linenos">374</span></a><span class="sd">            A list containing:</span>
</span><span id="WeakForm.add_term-375"><a href="#WeakForm.add_term-375"><span class="linenos">375</span></a><span class="sd">                - a material function or None.</span>
</span><span id="WeakForm.add_term-376"><a href="#WeakForm.add_term-376"><span class="linenos">376</span></a><span class="sd">                - a Sfepy string of the term, e.g. &#39;dw_laplace&#39;, or</span>
</span><span id="WeakForm.add_term-377"><a href="#WeakForm.add_term-377"><span class="linenos">377</span></a><span class="sd">                &#39;dw_volume&#39;. https://sfepy.org/doc-devel/terms_overview.html</span>
</span><span id="WeakForm.add_term-378"><a href="#WeakForm.add_term-378"><span class="linenos">378</span></a><span class="sd">                - a region&#39;s name e.g. &#39;facet200&#39;, &#39;subomega301&#39;, or None.</span>
</span><span id="WeakForm.add_term-379"><a href="#WeakForm.add_term-379"><span class="linenos">379</span></a><span class="sd">        update : bool, optional</span>
</span><span id="WeakForm.add_term-380"><a href="#WeakForm.add_term-380"><span class="linenos">380</span></a><span class="sd">            Update self.equation with new term. The default is False.</span>
</span><span id="WeakForm.add_term-381"><a href="#WeakForm.add_term-381"><span class="linenos">381</span></a><span class="sd">        newcoeff : float, optional</span>
</span><span id="WeakForm.add_term-382"><a href="#WeakForm.add_term-382"><span class="linenos">382</span></a><span class="sd">            If update, the new term multiplicative constant.</span>
</span><span id="WeakForm.add_term-383"><a href="#WeakForm.add_term-383"><span class="linenos">383</span></a><span class="sd">            The default is 1.0.</span>
</span><span id="WeakForm.add_term-384"><a href="#WeakForm.add_term-384"><span class="linenos">384</span></a>
</span><span id="WeakForm.add_term-385"><a href="#WeakForm.add_term-385"><span class="linenos">385</span></a><span class="sd">        Returns</span>
</span><span id="WeakForm.add_term-386"><a href="#WeakForm.add_term-386"><span class="linenos">386</span></a><span class="sd">        -------</span>
</span><span id="WeakForm.add_term-387"><a href="#WeakForm.add_term-387"><span class="linenos">387</span></a><span class="sd">        None.</span>
</span><span id="WeakForm.add_term-388"><a href="#WeakForm.add_term-388"><span class="linenos">388</span></a>
</span><span id="WeakForm.add_term-389"><a href="#WeakForm.add_term-389"><span class="linenos">389</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WeakForm.add_term-390"><a href="#WeakForm.add_term-390"><span class="linenos">390</span></a>        <span class="n">material</span> <span class="o">=</span> <span class="n">materm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="WeakForm.add_term-391"><a href="#WeakForm.add_term-391"><span class="linenos">391</span></a>        <span class="n">term_str</span> <span class="o">=</span> <span class="n">materm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="WeakForm.add_term-392"><a href="#WeakForm.add_term-392"><span class="linenos">392</span></a>        <span class="n">ttkw</span> <span class="o">=</span> <span class="n">WeakForm</span><span class="o">.</span><span class="n">get_term_table_kw</span><span class="p">(</span><span class="n">term_table</span><span class="p">,</span> <span class="n">term_str</span><span class="p">)</span>
</span><span id="WeakForm.add_term-393"><a href="#WeakForm.add_term-393"><span class="linenos">393</span></a>        
</span><span id="WeakForm.add_term-394"><a href="#WeakForm.add_term-394"><span class="linenos">394</span></a>        <span class="c1"># Determine the region over which integral is defined</span>
</span><span id="WeakForm.add_term-395"><a href="#WeakForm.add_term-395"><span class="linenos">395</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">materm</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
</span><span id="WeakForm.add_term-396"><a href="#WeakForm.add_term-396"><span class="linenos">396</span></a>            <span class="k">if</span> <span class="n">materm</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="WeakForm.add_term-397"><a href="#WeakForm.add_term-397"><span class="linenos">397</span></a>                <span class="n">name</span> <span class="o">=</span> <span class="n">materm</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="c1"># the region&#39;s name was given by the user</span>
</span><span id="WeakForm.add_term-398"><a href="#WeakForm.add_term-398"><span class="linenos">398</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="WeakForm.add_term-399"><a href="#WeakForm.add_term-399"><span class="linenos">399</span></a>            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;omega&#39;</span> <span class="c1"># the region&#39;s name was not given, default is omega</span>
</span><span id="WeakForm.add_term-400"><a href="#WeakForm.add_term-400"><span class="linenos">400</span></a>            
</span><span id="WeakForm.add_term-401"><a href="#WeakForm.add_term-401"><span class="linenos">401</span></a>        <span class="c1"># assert term_str in term_table</span>
</span><span id="WeakForm.add_term-402"><a href="#WeakForm.add_term-402"><span class="linenos">402</span></a>        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">unknown_name</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">unknown</span><span class="p">,</span>
</span><span id="WeakForm.add_term-403"><a href="#WeakForm.add_term-403"><span class="linenos">403</span></a>                  <span class="bp">self</span><span class="o">.</span><span class="n">test_name</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">test</span><span class="p">}</span>
</span><span id="WeakForm.add_term-404"><a href="#WeakForm.add_term-404"><span class="linenos">404</span></a>
</span><span id="WeakForm.add_term-405"><a href="#WeakForm.add_term-405"><span class="linenos">405</span></a>        <span class="k">if</span> <span class="n">material</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="WeakForm.add_term-406"><a href="#WeakForm.add_term-406"><span class="linenos">406</span></a>            <span class="k">if</span> <span class="s1">&#39;state&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ttkw</span> <span class="ow">and</span> <span class="s1">&#39;virtual/grad_state&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ttkw</span><span class="p">:</span>
</span><span id="WeakForm.add_term-407"><a href="#WeakForm.add_term-407"><span class="linenos">407</span></a>                <span class="n">new_term</span> <span class="o">=</span> <span class="n">Term</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
</span><span id="WeakForm.add_term-408"><a href="#WeakForm.add_term-408"><span class="linenos">408</span></a>                    <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">term_str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_name</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">integral</span><span class="p">,</span>
</span><span id="WeakForm.add_term-409"><a href="#WeakForm.add_term-409"><span class="linenos">409</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">region_dic</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="WeakForm.add_term-410"><a href="#WeakForm.add_term-410"><span class="linenos">410</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="WeakForm.add_term-411"><a href="#WeakForm.add_term-411"><span class="linenos">411</span></a>                <span class="n">new_term</span> <span class="o">=</span> <span class="n">Term</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
</span><span id="WeakForm.add_term-412"><a href="#WeakForm.add_term-412"><span class="linenos">412</span></a>                    <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">term_str</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">test_name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">unknown_name</span><span class="p">),</span>
</span><span id="WeakForm.add_term-413"><a href="#WeakForm.add_term-413"><span class="linenos">413</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">integral</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_dic</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="WeakForm.add_term-414"><a href="#WeakForm.add_term-414"><span class="linenos">414</span></a>
</span><span id="WeakForm.add_term-415"><a href="#WeakForm.add_term-415"><span class="linenos">415</span></a>        <span class="k">elif</span> <span class="n">callable</span><span class="p">(</span><span class="n">material</span><span class="p">):</span>
</span><span id="WeakForm.add_term-416"><a href="#WeakForm.add_term-416"><span class="linenos">416</span></a>            <span class="n">mat_func</span>  <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="s1">&#39;mat_func&#39;</span><span class="p">,</span> <span class="n">material</span><span class="p">)</span>
</span><span id="WeakForm.add_term-417"><a href="#WeakForm.add_term-417"><span class="linenos">417</span></a>            <span class="n">extra_args</span> <span class="o">=</span> <span class="n">get_default_args</span><span class="p">(</span><span class="n">material</span><span class="p">)</span>
</span><span id="WeakForm.add_term-418"><a href="#WeakForm.add_term-418"><span class="linenos">418</span></a>            <span class="n">matname</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="WeakForm.add_term-419"><a href="#WeakForm.add_term-419"><span class="linenos">419</span></a>            <span class="c1"># density profile linked to subregion</span>
</span><span id="WeakForm.add_term-420"><a href="#WeakForm.add_term-420"><span class="linenos">420</span></a>            <span class="k">if</span> <span class="s1">&#39;rho&#39;</span> <span class="ow">in</span> <span class="n">extra_args</span> <span class="ow">and</span> <span class="n">extra_args</span><span class="p">[</span><span class="s1">&#39;rho&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="WeakForm.add_term-421"><a href="#WeakForm.add_term-421"><span class="linenos">421</span></a>                <span class="n">extra_args</span><span class="p">[</span><span class="s1">&#39;rho&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
</span><span id="WeakForm.add_term-422"><a href="#WeakForm.add_term-422"><span class="linenos">422</span></a>                <span class="n">matname</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">name</span>
</span><span id="WeakForm.add_term-423"><a href="#WeakForm.add_term-423"><span class="linenos">423</span></a>            <span class="n">mat</span> <span class="o">=</span> <span class="n">Material</span><span class="p">(</span><span class="n">matname</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;stationary&#39;</span><span class="p">,</span> <span class="n">function</span><span class="o">=</span><span class="n">mat_func</span><span class="p">)</span>
</span><span id="WeakForm.add_term-424"><a href="#WeakForm.add_term-424"><span class="linenos">424</span></a>            <span class="n">mat</span><span class="o">.</span><span class="n">set_extra_args</span><span class="p">(</span><span class="o">**</span><span class="n">extra_args</span><span class="p">)</span>
</span><span id="WeakForm.add_term-425"><a href="#WeakForm.add_term-425"><span class="linenos">425</span></a>            <span class="n">kwargs</span><span class="p">[</span><span class="n">matname</span><span class="p">]</span> <span class="o">=</span> <span class="n">mat</span>
</span><span id="WeakForm.add_term-426"><a href="#WeakForm.add_term-426"><span class="linenos">426</span></a>            <span class="k">if</span> <span class="s1">&#39;state&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ttkw</span> <span class="ow">and</span> <span class="s1">&#39;virtual/grad_state&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ttkw</span><span class="p">:</span>
</span><span id="WeakForm.add_term-427"><a href="#WeakForm.add_term-427"><span class="linenos">427</span></a>                <span class="n">new_term</span> <span class="o">=</span> <span class="n">Term</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
</span><span id="WeakForm.add_term-428"><a href="#WeakForm.add_term-428"><span class="linenos">428</span></a>                    <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%s</span><span class="s1">.val, </span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">term_str</span><span class="p">,</span> <span class="n">matname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_name</span><span class="p">),</span>
</span><span id="WeakForm.add_term-429"><a href="#WeakForm.add_term-429"><span class="linenos">429</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">integral</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_dic</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="WeakForm.add_term-430"><a href="#WeakForm.add_term-430"><span class="linenos">430</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="WeakForm.add_term-431"><a href="#WeakForm.add_term-431"><span class="linenos">431</span></a>                <span class="n">new_term</span> <span class="o">=</span> <span class="n">Term</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
</span><span id="WeakForm.add_term-432"><a href="#WeakForm.add_term-432"><span class="linenos">432</span></a>                    <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%s</span><span class="s1">.val, </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">term_str</span><span class="p">,</span> <span class="n">matname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_name</span><span class="p">,</span>
</span><span id="WeakForm.add_term-433"><a href="#WeakForm.add_term-433"><span class="linenos">433</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">unknown_name</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">integral</span><span class="p">,</span>
</span><span id="WeakForm.add_term-434"><a href="#WeakForm.add_term-434"><span class="linenos">434</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">region_dic</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="WeakForm.add_term-435"><a href="#WeakForm.add_term-435"><span class="linenos">435</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="WeakForm.add_term-436"><a href="#WeakForm.add_term-436"><span class="linenos">436</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Material should be a function or None&quot;</span><span class="p">)</span>
</span><span id="WeakForm.add_term-437"><a href="#WeakForm.add_term-437"><span class="linenos">437</span></a>
</span><span id="WeakForm.add_term-438"><a href="#WeakForm.add_term-438"><span class="linenos">438</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">terms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_term</span><span class="p">)</span>
</span><span id="WeakForm.add_term-439"><a href="#WeakForm.add_term-439"><span class="linenos">439</span></a>        <span class="k">if</span> <span class="n">update</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
</span><span id="WeakForm.add_term-440"><a href="#WeakForm.add_term-440"><span class="linenos">440</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_terms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">materm</span><span class="p">)</span>
</span><span id="WeakForm.add_term-441"><a href="#WeakForm.add_term-441"><span class="linenos">441</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">constcoeffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newcoeff</span><span class="p">)</span>
</span><span id="WeakForm.add_term-442"><a href="#WeakForm.add_term-442"><span class="linenos">442</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">eqn</span> <span class="o">=</span> <span class="n">WeakForm</span><span class="o">.</span><span class="n">make_equation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">terms</span><span class="p">,</span>
</span><span id="WeakForm.add_term-443"><a href="#WeakForm.add_term-443"><span class="linenos">443</span></a>                                              <span class="bp">self</span><span class="o">.</span><span class="n">constcoeffs</span><span class="p">,</span>
</span><span id="WeakForm.add_term-444"><a href="#WeakForm.add_term-444"><span class="linenos">444</span></a>                                              <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="WeakForm.add_term-445"><a href="#WeakForm.add_term-445"><span class="linenos">445</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">split_equation</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Add a term to the existing WeakForm object.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>materm</strong> (list of length 2 or 3 (one element of terms).):
A list containing:
    - a material function or None.
    - a Sfepy string of the term, e.g. 'dw_laplace', or
    'dw_volume'. <a href="https://sfepy.org/doc-devel/terms_overview.html">https://sfepy.org/doc-devel/terms_overview.html</a>
    - a region's name e.g. 'facet200', 'subomega301', or None.</li>
<li><strong>update</strong> (bool, optional):
Update self.equation with new term. The default is False.</li>
<li><strong>newcoeff</strong> (float, optional):
If update, the new term multiplicative constant.
The default is 1.0.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None.</strong></li>
</ul>
</div>


                            </div>
                            <div id="WeakForm.make_equation" class="classattr">
                                        <input id="WeakForm.make_equation-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">make_equation</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">terms</span>, </span><span class="param"><span class="n">constcoeffs</span>, </span><span class="param"><span class="n">name</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="WeakForm.make_equation-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeakForm.make_equation"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeakForm.make_equation-447"><a href="#WeakForm.make_equation-447"><span class="linenos">447</span></a>    <span class="nd">@staticmethod</span>
</span><span id="WeakForm.make_equation-448"><a href="#WeakForm.make_equation-448"><span class="linenos">448</span></a>    <span class="k">def</span> <span class="nf">make_equation</span><span class="p">(</span><span class="n">terms</span><span class="p">,</span> <span class="n">constcoeffs</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span><span id="WeakForm.make_equation-449"><a href="#WeakForm.make_equation-449"><span class="linenos">449</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the eqn attribute of the WeakForm object.&quot;&quot;&quot;</span>
</span><span id="WeakForm.make_equation-450"><a href="#WeakForm.make_equation-450"><span class="linenos">450</span></a>        <span class="k">if</span> <span class="n">terms</span><span class="p">:</span>
</span><span id="WeakForm.make_equation-451"><a href="#WeakForm.make_equation-451"><span class="linenos">451</span></a>            <span class="n">eqn</span> <span class="o">=</span> <span class="n">terms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">constcoeffs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="WeakForm.make_equation-452"><a href="#WeakForm.make_equation-452"><span class="linenos">452</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">constcoeffs</span><span class="p">)):</span>
</span><span id="WeakForm.make_equation-453"><a href="#WeakForm.make_equation-453"><span class="linenos">453</span></a>                <span class="n">eqn</span> <span class="o">=</span> <span class="n">eqn</span><span class="o">.</span><span class="fm">__add__</span><span class="p">(</span><span class="n">terms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">constcoeffs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="WeakForm.make_equation-454"><a href="#WeakForm.make_equation-454"><span class="linenos">454</span></a>            <span class="n">eqn</span> <span class="o">=</span> <span class="n">Equation</span><span class="p">(</span><span class="s1">&#39;eqn_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">name</span><span class="p">,</span> <span class="n">eqn</span><span class="p">)</span>
</span><span id="WeakForm.make_equation-455"><a href="#WeakForm.make_equation-455"><span class="linenos">455</span></a>            <span class="k">return</span> <span class="n">eqn</span>
</span></pre></div>


            <div class="docstring"><p>Set the eqn attribute of the WeakForm object.</p>
</div>


                            </div>
                            <div id="WeakForm.split_equation" class="classattr">
                                        <input id="WeakForm.split_equation-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">split_equation</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="WeakForm.split_equation-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeakForm.split_equation"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeakForm.split_equation-457"><a href="#WeakForm.split_equation-457"><span class="linenos">457</span></a>    <span class="k">def</span> <span class="nf">split_equation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WeakForm.split_equation-458"><a href="#WeakForm.split_equation-458"><span class="linenos">458</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Split the equation into constant VS updatable equations.&quot;&quot;&quot;</span>
</span><span id="WeakForm.split_equation-459"><a href="#WeakForm.split_equation-459"><span class="linenos">459</span></a>        <span class="n">terms_cst</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="WeakForm.split_equation-460"><a href="#WeakForm.split_equation-460"><span class="linenos">460</span></a>        <span class="n">terms_mod</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="WeakForm.split_equation-461"><a href="#WeakForm.split_equation-461"><span class="linenos">461</span></a>        <span class="n">constcoeffs_cst</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="WeakForm.split_equation-462"><a href="#WeakForm.split_equation-462"><span class="linenos">462</span></a>        <span class="n">constcoeffs_mod</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="WeakForm.split_equation-463"><a href="#WeakForm.split_equation-463"><span class="linenos">463</span></a>        <span class="n">mats</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="WeakForm.split_equation-464"><a href="#WeakForm.split_equation-464"><span class="linenos">464</span></a>        <span class="n">terms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_terms</span>
</span><span id="WeakForm.split_equation-465"><a href="#WeakForm.split_equation-465"><span class="linenos">465</span></a>        <span class="n">mats_aux</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eqn</span><span class="o">.</span><span class="n">collect_materials</span><span class="p">()</span>
</span><span id="WeakForm.split_equation-466"><a href="#WeakForm.split_equation-466"><span class="linenos">466</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mats_aux</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">terms</span><span class="p">):</span>
</span><span id="WeakForm.split_equation-467"><a href="#WeakForm.split_equation-467"><span class="linenos">467</span></a>            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="WeakForm.split_equation-468"><a href="#WeakForm.split_equation-468"><span class="linenos">468</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">terms</span><span class="p">)):</span>
</span><span id="WeakForm.split_equation-469"><a href="#WeakForm.split_equation-469"><span class="linenos">469</span></a>                <span class="n">func</span> <span class="o">=</span> <span class="n">terms</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="WeakForm.split_equation-470"><a href="#WeakForm.split_equation-470"><span class="linenos">470</span></a>                <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="WeakForm.split_equation-471"><a href="#WeakForm.split_equation-471"><span class="linenos">471</span></a>                    <span class="n">mats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="WeakForm.split_equation-472"><a href="#WeakForm.split_equation-472"><span class="linenos">472</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="WeakForm.split_equation-473"><a href="#WeakForm.split_equation-473"><span class="linenos">473</span></a>                    <span class="n">mats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mats_aux</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="WeakForm.split_equation-474"><a href="#WeakForm.split_equation-474"><span class="linenos">474</span></a>                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="WeakForm.split_equation-475"><a href="#WeakForm.split_equation-475"><span class="linenos">475</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="WeakForm.split_equation-476"><a href="#WeakForm.split_equation-476"><span class="linenos">476</span></a>            <span class="n">mats</span> <span class="o">=</span> <span class="n">mats_aux</span>
</span><span id="WeakForm.split_equation-477"><a href="#WeakForm.split_equation-477"><span class="linenos">477</span></a>
</span><span id="WeakForm.split_equation-478"><a href="#WeakForm.split_equation-478"><span class="linenos">478</span></a>        <span class="k">for</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">mat</span><span class="p">,</span> <span class="n">term</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">constcoeffs</span><span class="p">,</span> <span class="n">mats</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">terms</span><span class="p">):</span>
</span><span id="WeakForm.split_equation-479"><a href="#WeakForm.split_equation-479"><span class="linenos">479</span></a>            <span class="n">isconstant</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="WeakForm.split_equation-480"><a href="#WeakForm.split_equation-480"><span class="linenos">480</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="s1">&#39;extra_args&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">mat</span><span class="o">.</span><span class="n">extra_args</span> <span class="o">!=</span> <span class="p">{}:</span>
</span><span id="WeakForm.split_equation-481"><a href="#WeakForm.split_equation-481"><span class="linenos">481</span></a>                <span class="n">extra_args</span> <span class="o">=</span> <span class="n">mat</span><span class="o">.</span><span class="n">extra_args</span> <span class="c1"># fetch material&#39;s extra-args dict</span>
</span><span id="WeakForm.split_equation-482"><a href="#WeakForm.split_equation-482"><span class="linenos">482</span></a>                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">extra_args</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="WeakForm.split_equation-483"><a href="#WeakForm.split_equation-483"><span class="linenos">483</span></a>                    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">WeakForm</span><span class="o">.</span><span class="n">forbidden_mod_arg</span><span class="p">:</span>
</span><span id="WeakForm.split_equation-484"><a href="#WeakForm.split_equation-484"><span class="linenos">484</span></a>                        <span class="n">isconstant</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="WeakForm.split_equation-485"><a href="#WeakForm.split_equation-485"><span class="linenos">485</span></a>                        <span class="k">break</span>
</span><span id="WeakForm.split_equation-486"><a href="#WeakForm.split_equation-486"><span class="linenos">486</span></a>            <span class="k">if</span> <span class="n">isconstant</span><span class="p">:</span>
</span><span id="WeakForm.split_equation-487"><a href="#WeakForm.split_equation-487"><span class="linenos">487</span></a>                <span class="n">terms_cst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">term</span><span class="p">)</span>
</span><span id="WeakForm.split_equation-488"><a href="#WeakForm.split_equation-488"><span class="linenos">488</span></a>                <span class="n">constcoeffs_cst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coeff</span><span class="p">)</span>
</span><span id="WeakForm.split_equation-489"><a href="#WeakForm.split_equation-489"><span class="linenos">489</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="WeakForm.split_equation-490"><a href="#WeakForm.split_equation-490"><span class="linenos">490</span></a>                <span class="n">terms_mod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">term</span><span class="p">)</span>
</span><span id="WeakForm.split_equation-491"><a href="#WeakForm.split_equation-491"><span class="linenos">491</span></a>                <span class="n">constcoeffs_mod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coeff</span><span class="p">)</span>
</span><span id="WeakForm.split_equation-492"><a href="#WeakForm.split_equation-492"><span class="linenos">492</span></a>        <span class="k">if</span> <span class="n">terms_cst</span><span class="p">:</span>
</span><span id="WeakForm.split_equation-493"><a href="#WeakForm.split_equation-493"><span class="linenos">493</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">eqn_cst</span> <span class="o">=</span> <span class="n">WeakForm</span><span class="o">.</span><span class="n">make_equation</span><span class="p">(</span><span class="n">terms_cst</span><span class="p">,</span> <span class="n">constcoeffs_cst</span><span class="p">,</span>
</span><span id="WeakForm.split_equation-494"><a href="#WeakForm.split_equation-494"><span class="linenos">494</span></a>                                                  <span class="s1">&#39;eqn_cst&#39;</span><span class="p">)</span>
</span><span id="WeakForm.split_equation-495"><a href="#WeakForm.split_equation-495"><span class="linenos">495</span></a>        <span class="k">if</span> <span class="n">terms_mod</span><span class="p">:</span>
</span><span id="WeakForm.split_equation-496"><a href="#WeakForm.split_equation-496"><span class="linenos">496</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">eqn_mod</span> <span class="o">=</span> <span class="n">WeakForm</span><span class="o">.</span><span class="n">make_equation</span><span class="p">(</span><span class="n">terms_mod</span><span class="p">,</span> <span class="n">constcoeffs_mod</span><span class="p">,</span>
</span><span id="WeakForm.split_equation-497"><a href="#WeakForm.split_equation-497"><span class="linenos">497</span></a>                                                  <span class="s1">&#39;eqn_mod&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Split the equation into constant VS updatable equations.</p>
</div>


                            </div>
                            <div id="WeakForm.get_term_table_kw" class="classattr">
                                        <input id="WeakForm.get_term_table_kw-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">get_term_table_kw</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">term_table</span>, </span><span class="param"><span class="n">term_str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="WeakForm.get_term_table_kw-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeakForm.get_term_table_kw"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeakForm.get_term_table_kw-526"><a href="#WeakForm.get_term_table_kw-526"><span class="linenos">526</span></a>    <span class="nd">@staticmethod</span>
</span><span id="WeakForm.get_term_table_kw-527"><a href="#WeakForm.get_term_table_kw-527"><span class="linenos">527</span></a>    <span class="k">def</span> <span class="nf">get_term_table_kw</span><span class="p">(</span><span class="n">term_table</span><span class="p">,</span> <span class="n">term_str</span><span class="p">):</span>
</span><span id="WeakForm.get_term_table_kw-528"><a href="#WeakForm.get_term_table_kw-528"><span class="linenos">528</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Utility method for getting the syntax of a term given by its string</span>
</span><span id="WeakForm.get_term_table_kw-529"><a href="#WeakForm.get_term_table_kw-529"><span class="linenos">529</span></a><span class="sd">        identifier.  Might break with future Sfepy releases, see</span>
</span><span id="WeakForm.get_term_table_kw-530"><a href="#WeakForm.get_term_table_kw-530"><span class="linenos">530</span></a><span class="sd">        https://github.com/sfepy/sfepy/issues/773&quot;&quot;&quot;</span>
</span><span id="WeakForm.get_term_table_kw-531"><a href="#WeakForm.get_term_table_kw-531"><span class="linenos">531</span></a>        <span class="n">entry</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">numpyit</span><span class="p">(</span><span class="n">term_table</span><span class="p">[</span><span class="n">term_str</span><span class="p">]</span><span class="o">.</span><span class="n">arg_types</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="WeakForm.get_term_table_kw-532"><a href="#WeakForm.get_term_table_kw-532"><span class="linenos">532</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Utility method for getting the syntax of a term given by its string
identifier.  Might break with future Sfepy releases, see
<a href="https://github.com/sfepy/sfepy/issues/773">https://github.com/sfepy/sfepy/issues/773</a></p>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>