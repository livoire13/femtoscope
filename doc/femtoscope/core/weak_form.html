<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.5.1"/>
    <title>femtoscope.core.weak_form API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style><script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']]
        }
    };
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
    /* Re-invoke MathJax when DOM content changes, for example during search. */
    document.addEventListener("DOMContentLoaded", () => {
        new MutationObserver(() => MathJax.typeset()).observe(
            document.querySelector("main.pdoc").parentNode,
            {childList: true}
        );
    })
</script>
<style>
    mjx-container {
        overflow-x: auto;
        overflow-y: hidden;
    }
</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../core.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;femtoscope.core</a>

            <img src="file://D:/hlevy/Documents/microscope2/femtoscope/images/logo.png" class="logo" alt="project logo"/>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#WeakForm">WeakForm</a>
                            <ul class="memberlist">
                        <li>
                                <a class="class" href="#WeakForm.Decorators">WeakForm.Decorators</a>
                                        <ul class="memberlist">
                                    <li>
                                            <a class="function" href="#WeakForm.Decorators.check_lcbcs">check_lcbcs</a>
                                    </li>
                            </ul>

                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.name">name</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.dim">dim</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.region_dict">region_dict</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.ebc_dict">ebc_dict</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.pre_terms">pre_terms</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.fem_order">fem_order</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.pb_cst">pb_cst</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.pb_mod">pb_mod</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.mtx_vec">mtx_vec</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.active_bcs">active_bcs</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.field">field</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.integral">integral</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.ndofs">ndofs</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeakForm.vec_bc">vec_bc</a>
                        </li>
                        <li>
                                <a class="function" href="#WeakForm.from_attr_dict">from_attr_dict</a>
                        </li>
                        <li>
                                <a class="function" href="#WeakForm.from_scratch">from_scratch</a>
                        </li>
                        <li>
                                <a class="function" href="#WeakForm.from_two_weak_forms">from_two_weak_forms</a>
                        </li>
                        <li>
                                <a class="function" href="#WeakForm.set_problems">set_problems</a>
                        </li>
                        <li>
                                <a class="function" href="#WeakForm.apply_bcs">apply_bcs</a>
                        </li>
                        <li>
                                <a class="function" href="#WeakForm.remove_bcs">remove_bcs</a>
                        </li>
                        <li>
                                <a class="function" href="#WeakForm.update_materials">update_materials</a>
                        </li>
                        <li>
                                <a class="function" href="#WeakForm.make_full_vec">make_full_vec</a>
                        </li>
                        <li>
                                <a class="function" href="#WeakForm.make_reduced_vec">make_reduced_vec</a>
                        </li>
                        <li>
                                <a class="function" href="#WeakForm.set_mtx_vec_no_bc">set_mtx_vec_no_bc</a>
                        </li>
                        <li>
                                <a class="function" href="#WeakForm.set_mtx_vec_bc_reduced">set_mtx_vec_bc_reduced</a>
                        </li>
                        <li>
                                <a class="function" href="#WeakForm.set_mtx_vec_bc_full">set_mtx_vec_bc_full</a>
                        </li>
                        <li>
                                <a class="function" href="#WeakForm.get_field">get_field</a>
                        </li>
                        <li>
                                <a class="function" href="#WeakForm.get_unknown_name">get_unknown_name</a>
                        </li>
                        <li>
                                <a class="function" href="#WeakForm.get_test_name">get_test_name</a>
                        </li>
                        <li>
                                <a class="function" href="#WeakForm.create_sfepy_internal_mesh">create_sfepy_internal_mesh</a>
                        </li>
                        <li>
                                <a class="function" href="#WeakForm.fill_ebc_dict">fill_ebc_dict</a>
                        </li>
                        <li>
                                <a class="function" href="#WeakForm.fill_region_dict">fill_region_dict</a>
                        </li>
                        <li>
                                <a class="function" href="#WeakForm.get_qps_coors_in_region">get_qps_coors_in_region</a>
                        </li>
                        <li>
                                <a class="function" href="#WeakForm.get_pickable_args_dict">get_pickable_args_dict</a>
                        </li>
                </ul>

            </li>
    </ul>


            <footer>Hugo LÃ©vy PhD Thesis</footer>

        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../../femtoscope.html">femtoscope</a><wbr>.<a href="./../core.html">core</a><wbr>.weak_form    </h1>

                        <div class="docstring"><p>Created on Wed Feb  7 13:24:52 2024</p>

<p>Definition of a 'weak-formulation' class, mainly gathering Sfepy's objects.
The current implementation relies partially on the assumption that, even when
nonlinear, the PDE at stake has at least one linear term.</p>
</div>

                        <input id="mod-weak_form-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-weak_form-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="c1"># -*- coding: utf-8 -*-</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="sd">Created on Wed Feb  7 13:24:52 2024</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="sd">Definition of a &#39;weak-formulation&#39; class, mainly gathering Sfepy&#39;s objects.</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="sd">The current implementation relies partially on the assumption that, even when</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="sd">nonlinear, the PDE at stake has at least one linear term.</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="kn">import</span> <span class="nn">warnings</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="kn">from</span> <span class="nn">numbers</span> <span class="kn">import</span> <span class="n">Number</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Union</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="kn">from</span> <span class="nn">sfepy.base.base</span> <span class="kn">import</span> <span class="n">Container</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a><span class="kn">import</span> <span class="nn">sfepy.discrete.fem</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a><span class="kn">from</span> <span class="nn">sfepy.discrete</span> <span class="kn">import</span> <span class="p">(</span><span class="n">FieldVariable</span><span class="p">,</span> <span class="n">Function</span><span class="p">,</span> <span class="n">Integral</span><span class="p">,</span> <span class="n">Materials</span><span class="p">,</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a>                            <span class="n">Variables</span><span class="p">)</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a><span class="kn">from</span> <span class="nn">sfepy.discrete.conditions</span> <span class="kn">import</span> <span class="p">(</span><span class="n">Conditions</span><span class="p">,</span> <span class="n">EssentialBC</span><span class="p">,</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a>                                       <span class="n">LinearCombinationBC</span><span class="p">)</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a><span class="kn">from</span> <span class="nn">sfepy.discrete.equations</span> <span class="kn">import</span> <span class="n">Equation</span><span class="p">,</span> <span class="n">Equations</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a><span class="kn">from</span> <span class="nn">sfepy.discrete.fem</span> <span class="kn">import</span> <span class="n">FEDomain</span><span class="p">,</span> <span class="n">Field</span><span class="p">,</span> <span class="n">Mesh</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a><span class="kn">from</span> <span class="nn">sfepy.discrete.problem</span> <span class="kn">import</span> <span class="n">Problem</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a><span class="kn">from</span> <span class="nn">sfepy.terms.terms</span> <span class="kn">import</span> <span class="n">Terms</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a><span class="kn">import</span> <span class="nn">sfepy.discrete.fem.periodic</span> <span class="k">as</span> <span class="nn">per</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="kn">from</span> <span class="nn">sfepy.discrete.common.mappings</span> <span class="kn">import</span> <span class="n">get_physical_qps</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a><span class="kn">from</span> <span class="nn">femtoscope.core</span> <span class="kn">import</span> <span class="n">valid_topological_kinds_ebc</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a><span class="kn">from</span> <span class="nn">femtoscope.core.matrix_vector</span> <span class="kn">import</span> <span class="n">MatrixVector</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a><span class="kn">from</span> <span class="nn">femtoscope.core.pre_term</span> <span class="kn">import</span> <span class="n">PreTerm</span><span class="p">,</span> <span class="n">is_matrix_term</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a><span class="kn">from</span> <span class="nn">femtoscope.inout.meshfactory</span> <span class="kn">import</span> <span class="p">(</span><span class="n">make_absolute_mesh_name</span><span class="p">,</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a>                                          <span class="n">read_physical_groups_from_mesh_file</span><span class="p">)</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a><span class="k">class</span> <span class="nc">WeakForm</span><span class="p">:</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a><span class="sd">    Class gathering objects linked to the weak formulation of some PDE.</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a><span class="sd">    Attributes</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a><span class="sd">    ----------</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a><span class="sd">    name : str</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a><span class="sd">        Name of the weak form.</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a><span class="sd">    dim : int</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a><span class="sd">        Dimension of the problem: 1, 2 or 3.</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a><span class="sd">    region_dict : dict</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a><span class="sd">        Dictionary of regions with</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a><span class="sd">        keys: pairs topological kind - tag, e.g. (&#39;subomega&#39;, 301).</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a><span class="sd">        values: corresponding Sfepy `Region` instances.</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a><span class="sd">    ebc_dict : dict</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a><span class="sd">        Dictionary of essential boundary conditions with</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a><span class="sd">        keys: same as `region_dict`.</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a><span class="sd">        values: dictionary with keys (&#39;cst&#39;, &#39;mod&#39;) containing corresponding</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a><span class="sd">        Sfepy&#39;s `EssentialBC` instances.</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a><span class="sd">    pre_terms : list[PreTerm]</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a><span class="sd">        List of `PreTerm` instances. Each &#39;pre_term&#39; contains extra information</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a><span class="sd">        with respect to Sfepy&#39;s `Term` instance.</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a><span class="sd">    fem_order : int</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a><span class="sd">        Finite Element approximation order.</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a><span class="sd">    pb_cst : Problem</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a><span class="sd">        Sfepy&#39;s Problem instance associated with the linear part of the PDE.</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a><span class="sd">    pb_mod : Problem</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a><span class="sd">        Sfepy&#39;s Problem instance associated with the nonlinear part of the PDE.</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a><span class="sd">    mtx_vec : MatrixVector</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a><span class="sd">        Instance of class `MatrixVector` for storing assembled matrices and</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a><span class="sd">        vectors associated with the current weak form.</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a><span class="sd">    _active_bcs : dict</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a><span class="sd">        Private attribute indicating whether boundary conditions are set active</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a><span class="sd">        on `pb_cst` and `pb_mod`.</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a><span class="sd">    Properties</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a><span class="sd">    ----------</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a><span class="sd">    active_bcs : dict</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a><span class="sd">        Proxy for `_active_bcs` in read-only mode.</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a><span class="sd">    field : Field</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a><span class="sd">        Sfepy Field instance.</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a><span class="sd">    integral : Integral</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a><span class="sd">        Sfepy Integral instance.</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a><span class="sd">    ndofs : int</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a><span class="sd">        Total number of degrees of freedom.</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a><span class="sd">    vec_bc : np.ndarray</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a><span class="sd">        Full vector filled with zeros except at fixed DOFs where Dirichlet</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a><span class="sd">        BC values are used.</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a>    <span class="k">class</span> <span class="nc">Decorators</span><span class="p">:</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Inner class for defining decorators.&quot;&quot;&quot;</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a>        <span class="nd">@staticmethod</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a>        <span class="k">def</span> <span class="nf">check_lcbcs</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a>            <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a>                <span class="bp">self</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pb_cst</span><span class="o">.</span><span class="n">equations</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">has_lcbc</span><span class="p">:</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a>                            <span class="sa">f</span><span class="s2">&quot;Method &#39;</span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; cannot be called on weak&quot;</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a>                            <span class="sa">f</span><span class="s2">&quot; form &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; because it has lcbcs!&quot;</span><span class="p">)</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a>                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a>                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;weak form </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is not fully set up!&quot;</span><span class="p">)</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a>                <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a>            <span class="k">return</span> <span class="n">wrapper</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ebc_dict</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pre_terms</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fem_order</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pb_cst</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pb_mod</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mtx_vec</span> <span class="o">=</span> <span class="n">MatrixVector</span><span class="p">()</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_active_bcs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cst&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;mod&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_exterior</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a>    <span class="nd">@property</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a>    <span class="k">def</span> <span class="nf">active_bcs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_bcs</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a>    <span class="nd">@property</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a>    <span class="k">def</span> <span class="nf">field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_field</span><span class="p">()</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a>    <span class="nd">@property</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a>    <span class="k">def</span> <span class="nf">integral</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pb_cst</span><span class="o">.</span><span class="n">equations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">terms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">integral</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a>    <span class="nd">@property</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a>    <span class="k">def</span> <span class="nf">ndofs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">coors</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a>    <span class="nd">@property</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a>    <span class="k">def</span> <span class="nf">vec_bc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Full vector filled with zeros except at fixed DOFs where Dirichlet</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a><span class="sd">        BC values are used.&quot;&quot;&quot;</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">apply_bcs</span><span class="p">()</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pb_cst</span><span class="o">.</span><span class="n">get_variables</span><span class="p">()</span><span class="o">.</span><span class="n">get_state</span><span class="p">(</span><span class="n">reduced</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a>    <span class="k">def</span> <span class="nf">from_attr_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">attr_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WeakForm</span><span class="p">:</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an instance of `WeakForm`, set its attributes from the</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a><span class="sd">        `attr_dict` dictionary and return it.&quot;&quot;&quot;</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a>        <span class="n">wf_instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">attr_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Dictionary keys must be strings&quot;</span><span class="p">)</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a>            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="n">wf_instance</span><span class="p">):</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a>                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39; is not a WeakForm attribute name&quot;</span><span class="p">)</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="n">wf_instance</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">attr_dict</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nb">vars</span><span class="p">(</span><span class="n">wf_instance</span><span class="p">))</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Some attributes have not been set&quot;</span><span class="p">)</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a>        <span class="k">return</span> <span class="n">wf_instance</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a>    <span class="k">def</span> <span class="nf">from_scratch</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">args_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WeakForm</span><span class="p">:</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a><span class="sd">        Create an instance of `WeakForm` and set its attributes by creating the</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a><span class="sd">        relevant Sfepy&#39;s objects step by step. The dictionary `args_dict`</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a><span class="sd">        passed to the function contains the following items:</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a><span class="sd">        Parameters</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a><span class="sd">        ----------</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a><span class="sd">        dim : int</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a><span class="sd">            Dimension of the problem: 1, 2 or 3.</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a><span class="sd">        pre_mesh : str or `sfepy.discrete.fem.mesh.Mesh`</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a><span class="sd">            In 1D: already existing Sfepy&#39;s `Mesh` instance.</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a><span class="sd">            In 2D and 3D: name of the .vtk mesh file.</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a><span class="sd">        name : str, optional</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a><span class="sd">            Name of the weak form. The default is &#39;wf&#39;.</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a><span class="sd">        dim_func_entities : List[tuple]</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a><span class="sd">            List of triplets (entity dimension, function selection, tag).</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a><span class="sd">        pre_ebc_dict : dict</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a><span class="sd">            Dictionary that is used to assign some essential boundary conditions</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a><span class="sd">            to some topological entities. Its keys are a subset of `region_dict`</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a><span class="sd">            ones and its values are either numbers or functions.</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a><span class="sd">        fem_order : int, optional</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a><span class="sd">            Finite Element approximation order. The default is 2.</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a><span class="sd">        pre_terms : List[PreTerm]</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a><span class="sd">            List of `PreTerm` instances associated with the PDE to be solved.</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a><span class="sd">        is_exterior : Union[bool, None]</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a><span class="sd">            Wheter the weak form to be created shall be associated with the</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a><span class="sd">            exterior domain. The default is None.</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a><span class="sd">        Returns</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a><span class="sd">        -------</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a><span class="sd">        wf_instance : WeakForm</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a><span class="sd">            The created weak form.</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a>        <span class="c1"># Get arguments and default values</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a>        <span class="n">dim</span> <span class="o">=</span> <span class="n">args_dict</span><span class="p">[</span><span class="s1">&#39;dim&#39;</span><span class="p">]</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a>        <span class="n">pre_mesh</span> <span class="o">=</span> <span class="n">args_dict</span><span class="p">[</span><span class="s1">&#39;pre_mesh&#39;</span><span class="p">]</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a>        <span class="n">name</span> <span class="o">=</span> <span class="n">args_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;wf&#39;</span><span class="p">)</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>        <span class="n">dim_func_entities</span> <span class="o">=</span> <span class="n">args_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dim_func_entities&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a>        <span class="n">pre_ebc_dict</span> <span class="o">=</span> <span class="n">args_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pre_ebc_dict&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a>        <span class="n">fem_order</span> <span class="o">=</span> <span class="n">args_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fem_order&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a>        <span class="n">pre_terms</span> <span class="o">=</span> <span class="n">args_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pre_terms&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a>        <span class="n">is_exterior</span> <span class="o">=</span> <span class="n">args_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;is_exterior&#39;</span><span class="p">)</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a>        <span class="c1"># Create empty class instance</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a>        <span class="n">wf_instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a>        <span class="c1"># Name of the weak form, is_exterior?</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">_is_exterior</span> <span class="o">=</span> <span class="n">is_exterior</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a>        <span class="c1"># Dimension</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a>        <span class="c1"># Region dictionary</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a>        <span class="n">mesh</span> <span class="o">=</span> <span class="n">wf_instance</span><span class="o">.</span><span class="n">create_sfepy_internal_mesh</span><span class="p">(</span><span class="n">pre_mesh</span><span class="p">)</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a>        <span class="n">domain</span> <span class="o">=</span> <span class="n">FEDomain</span><span class="p">(</span><span class="s1">&#39;domain&#39;</span><span class="p">,</span> <span class="n">mesh</span><span class="p">)</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a>        <span class="k">if</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a>            <span class="n">physical_group_ids</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a>            <span class="n">physical_group_ids</span> <span class="o">=</span> <span class="n">read_physical_groups_from_mesh_file</span><span class="p">(</span><span class="n">pre_mesh</span><span class="p">)</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">region_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">fill_region_dict</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">physical_group_ids</span><span class="p">,</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a>                                     <span class="n">dim_func_entities</span><span class="p">)</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a>        <span class="c1"># Essential boundary conditions dictionary</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a>        <span class="bp">cls</span><span class="o">.</span><span class="n">_check_pre_ebc_dict_format</span><span class="p">(</span><span class="n">pre_ebc_dict</span><span class="p">)</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">ebc_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">fill_ebc_dict</span><span class="p">(</span><span class="n">pre_ebc_dict</span><span class="p">)</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a>        <span class="c1"># FEM order</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">fem_order</span> <span class="o">=</span> <span class="n">fem_order</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a>        <span class="c1"># Problem instances</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">pre_terms</span> <span class="o">=</span> <span class="n">pre_terms</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">_fix_pb_without_state_variable</span><span class="p">()</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">set_problems</span><span class="p">(</span><span class="n">pre_terms</span><span class="p">)</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">apply_bcs</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a>        <span class="k">return</span> <span class="n">wf_instance</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a>    <span class="k">def</span> <span class="nf">from_two_weak_forms</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">wf_int</span><span class="p">:</span> <span class="n">WeakForm</span><span class="p">,</span> <span class="n">wf_ext</span><span class="p">:</span> <span class="n">WeakForm</span><span class="p">,</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a>                            <span class="n">region_key_int</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">region_key_ext</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a>                            <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WeakForm</span><span class="p">:</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a><span class="sd">        Create an instance of `WeakForm` from two existing weak forms,</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a><span class="sd">        corresponding to the interior and exterior domains respectively.</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a><span class="sd">        This class method is to be used when solving problems on unbounded</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a><span class="sd">        domains with the inverted finite element method.</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a><span class="sd">        Parameters</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a><span class="sd">        ----------</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a><span class="sd">        wf_int : WeakForm</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a><span class="sd">            Interior weak form.</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a><span class="sd">        wf_ext : WeakForm</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a><span class="sd">            Exterior weak form.</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a><span class="sd">        region_key_int : tuple</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a><span class="sd">            Key of the connecting region in the interior domain.</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a><span class="sd">        region_key_ext : tuple</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a><span class="sd">            Key of the connecting region in the exterior domain.</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a><span class="sd">        verbose : bool, optional</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a><span class="sd">            The default is False.</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a><span class="sd">        Returns</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a><span class="sd">        -------</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a><span class="sd">        wf_instance : WeakForm</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a><span class="sd">            The created weak form.</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a><span class="sd">        Notes</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a><span class="sd">        -----</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a><span class="sd">        The following attributes of the new WeakForm instance will be disabled</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a><span class="sd">        (i.e. set to None):</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a><span class="sd">        - region_dict</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a><span class="sd">        - ebc_dict</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a><span class="sd">        - pre_terms</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a><span class="sd">        Moreover, the boundary conditions are necessarily set active, meaning</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a><span class="sd">        that several methods &amp; functionalities will not work with the newly</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a><span class="sd">        created weak form.</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a>        <span class="c1"># Safety checks</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a>        <span class="bp">cls</span><span class="o">.</span><span class="n">_check_args_before_merging</span><span class="p">(</span><span class="n">wf_int</span><span class="p">,</span> <span class="n">wf_ext</span><span class="p">,</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a>                                       <span class="n">region_key_int</span><span class="p">,</span> <span class="n">region_key_ext</span><span class="p">)</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>        <span class="c1"># Fill basic attributes</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a>        <span class="n">attr_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a>        <span class="n">attr_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;combine_</span><span class="si">{}</span><span class="s2">_&amp;_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wf_int</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">wf_ext</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>        <span class="n">attr_dict</span><span class="p">[</span><span class="s1">&#39;dim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wf_int</span><span class="o">.</span><span class="n">dim</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a>        <span class="n">attr_dict</span><span class="p">[</span><span class="s1">&#39;region_dict&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a>        <span class="n">attr_dict</span><span class="p">[</span><span class="s1">&#39;ebc_dict&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a>        <span class="n">attr_dict</span><span class="p">[</span><span class="s1">&#39;pre_terms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a>        <span class="n">attr_dict</span><span class="p">[</span><span class="s1">&#39;fem_order&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wf_int</span><span class="o">.</span><span class="n">fem_order</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a>        <span class="c1"># Preparation of LCBCs</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a>        <span class="n">match_coors</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="s1">&#39;match_coors&#39;</span><span class="p">,</span> <span class="n">per</span><span class="o">.</span><span class="n">match_coors</span><span class="p">)</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>        <span class="n">connecting_regions</span> <span class="o">=</span> <span class="p">[</span><span class="n">wf_int</span><span class="o">.</span><span class="n">region_dict</span><span class="p">[</span><span class="n">region_key_int</span><span class="p">],</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>                              <span class="n">wf_ext</span><span class="o">.</span><span class="n">region_dict</span><span class="p">[</span><span class="n">region_key_ext</span><span class="p">]]</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>        <span class="c1"># Construct new Problem instance(s)</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>        <span class="k">if</span> <span class="n">wf_int</span><span class="o">.</span><span class="n">pb_mod</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>            <span class="n">tag_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cst&#39;</span><span class="p">]</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a>            <span class="n">attr_dict</span><span class="p">[</span><span class="s1">&#39;pb_mod&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>            <span class="n">tag_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cst&#39;</span><span class="p">,</span> <span class="s1">&#39;mod&#39;</span><span class="p">]</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tag_list</span><span class="p">:</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>            <span class="c1"># Set up ebcs &amp; names</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>            <span class="n">pb_key</span> <span class="o">=</span> <span class="s1">&#39;pb_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>            <span class="n">ebcs_int</span> <span class="o">=</span> <span class="p">[</span><span class="n">dico</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="k">for</span> <span class="n">dico</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">wf_int</span><span class="o">.</span><span class="n">ebc_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())]</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a>            <span class="n">ebcs_ext</span> <span class="o">=</span> <span class="p">[</span><span class="n">dico</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="k">for</span> <span class="n">dico</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">wf_ext</span><span class="o">.</span><span class="n">ebc_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())]</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a>            <span class="n">ebcs_new</span> <span class="o">=</span> <span class="n">Conditions</span><span class="p">(</span><span class="n">ebcs_int</span> <span class="o">+</span> <span class="n">ebcs_ext</span><span class="p">)</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a>            <span class="n">u_int_name</span> <span class="o">=</span> <span class="n">wf_int</span><span class="o">.</span><span class="n">get_unknown_name</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a>            <span class="n">u_ext_name</span> <span class="o">=</span> <span class="n">wf_ext</span><span class="o">.</span><span class="n">get_unknown_name</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>            <span class="c1"># Linear Combination Boundary Conditions</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a>            <span class="n">lcbc</span> <span class="o">=</span> <span class="n">LinearCombinationBC</span><span class="p">(</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a>                <span class="s1">&#39;lc_cst&#39;</span><span class="p">,</span> <span class="n">connecting_regions</span><span class="p">,</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a>                <span class="p">{</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.all&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">u_int_name</span><span class="p">)</span> <span class="p">:</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.all&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">u_ext_name</span><span class="p">)},</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a>                <span class="n">match_coors</span><span class="p">,</span> <span class="s1">&#39;match_dofs&#39;</span><span class="p">)</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a>            <span class="n">lcbcs</span> <span class="o">=</span> <span class="n">Conditions</span><span class="p">([</span><span class="n">lcbc</span><span class="p">])</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>            <span class="c1"># Create new Problem instance</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>            <span class="n">eqs</span> <span class="o">=</span> <span class="n">_EquationsFix</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">wf_int</span><span class="p">,</span> <span class="n">pb_key</span><span class="p">)</span><span class="o">.</span><span class="n">equations</span><span class="o">.</span><span class="n">_objs</span> <span class="o">+</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a>                                <span class="nb">getattr</span><span class="p">(</span><span class="n">wf_ext</span><span class="p">,</span> <span class="n">pb_key</span><span class="p">)</span><span class="o">.</span><span class="n">equations</span><span class="o">.</span><span class="n">_objs</span><span class="p">)</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a>            <span class="n">pb_new</span> <span class="o">=</span> <span class="n">Problem</span><span class="p">(</span><span class="n">pb_key</span><span class="p">,</span> <span class="n">equations</span><span class="o">=</span><span class="n">eqs</span><span class="p">,</span> <span class="n">active_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>            <span class="n">pb_new</span><span class="o">.</span><span class="n">set_bcs</span><span class="p">(</span><span class="n">ebcs</span><span class="o">=</span><span class="n">ebcs_new</span><span class="p">,</span> <span class="n">lcbcs</span><span class="o">=</span><span class="n">lcbcs</span><span class="p">)</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a>            <span class="c1"># Apply ebc to variables</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a>            <span class="n">variables</span> <span class="o">=</span> <span class="n">pb_new</span><span class="o">.</span><span class="n">get_initial_state</span><span class="p">()</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a>            <span class="n">pb_new</span><span class="o">.</span><span class="n">time_update</span><span class="p">()</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a>            <span class="n">variables</span><span class="o">.</span><span class="n">apply_ebc</span><span class="p">()</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>            <span class="n">attr_dict</span><span class="p">[</span><span class="n">pb_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">pb_new</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>        <span class="c1"># Create WeakForm instance from &#39;attr_dict&#39; and mark bcs as active</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>        <span class="n">wf_instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_attr_dict</span><span class="p">(</span><span class="n">attr_dict</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">_active_bcs</span><span class="p">[</span><span class="s1">&#39;cst&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">_active_bcs</span><span class="p">[</span><span class="s1">&#39;mod&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>        <span class="k">return</span> <span class="n">wf_instance</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>    <span class="k">def</span> <span class="nf">set_problems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pre_terms</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PreTerm</span><span class="p">]):</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a><span class="sd">        Create Problem instance(s) and set corresponding attribute(s). As a</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a><span class="sd">        side effect, the `term` attribute of each `PreTerm` instance is set.</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a><span class="sd">        Parameters</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a><span class="sd">        ----------</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a><span class="sd">        pre_terms : list[PreTerm]</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a><span class="sd">            List of `PreTerm` instances</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a><span class="sd">        Notes</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a><span class="sd">        -----</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a><span class="sd">        If none of the `PreTerm` instances has tag &#39;mod&#39;, `pb_mod` attribute is</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a><span class="sd">        left to None.</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a><span class="sd">        Some parameters are hardcoded in this process, e.g.</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a><span class="sd">            test function space = &#39;H1&#39;</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a><span class="sd">            basis of the FE space = &#39;lagrange&#39;</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a><span class="sd">            order of the polynomials to integrate = 2*fem_order + 1</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>        <span class="n">has_nonlinear_term</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_nonlinear_term</span><span class="p">(</span><span class="n">pre_terms</span><span class="p">)</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>        <span class="c1"># Define field and variables</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>        <span class="n">field_name</span> <span class="o">=</span> <span class="s2">&quot;field_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>        <span class="n">field</span> <span class="o">=</span> <span class="n">Field</span><span class="o">.</span><span class="n">from_args</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="s1">&#39;scalar&#39;</span><span class="p">,</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span><span class="p">[(</span><span class="s1">&#39;omega&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)],</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>                                <span class="n">approx_order</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fem_order</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="s1">&#39;H1&#39;</span><span class="p">,</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>                                <span class="n">poly_space_base</span><span class="o">=</span><span class="s1">&#39;lagrange&#39;</span><span class="p">)</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a>        <span class="n">u_cst</span> <span class="o">=</span> <span class="n">FieldVariable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_unknown_name</span><span class="p">(</span><span class="s1">&#39;cst&#39;</span><span class="p">),</span> <span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a>        <span class="n">v_cst</span> <span class="o">=</span> <span class="n">FieldVariable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_test_name</span><span class="p">(</span><span class="s1">&#39;cst&#39;</span><span class="p">),</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a>                              <span class="n">primary_var_name</span><span class="o">=</span><span class="n">u_cst</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a>        <span class="n">u_mod</span> <span class="o">=</span> <span class="n">FieldVariable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_unknown_name</span><span class="p">(</span><span class="s1">&#39;mod&#39;</span><span class="p">),</span> <span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a>        <span class="n">v_mod</span> <span class="o">=</span> <span class="n">FieldVariable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_test_name</span><span class="p">(</span><span class="s1">&#39;mod&#39;</span><span class="p">),</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a>                              <span class="n">primary_var_name</span><span class="o">=</span><span class="n">u_mod</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a>        <span class="c1"># Define integral</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a>        <span class="n">integral</span> <span class="o">=</span> <span class="n">Integral</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fem_order</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>        <span class="c1"># Construct terms from the list of pre_term</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>        <span class="n">terms_cst</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>        <span class="n">terms_mod</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>        <span class="k">for</span> <span class="n">pre_term</span> <span class="ow">in</span> <span class="n">pre_terms</span><span class="p">:</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>            <span class="k">if</span> <span class="n">pre_term</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;cst&#39;</span><span class="p">:</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>                <span class="n">pre_term</span><span class="o">.</span><span class="n">set_term</span><span class="p">(</span><span class="n">integral</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">u_cst</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="n">v_cst</span><span class="p">)</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a>                <span class="n">terms_cst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pre_term</span><span class="o">.</span><span class="n">term</span><span class="p">)</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>                <span class="n">pre_term</span><span class="o">.</span><span class="n">set_term</span><span class="p">(</span><span class="n">integral</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">u_mod</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="n">v_mod</span><span class="p">)</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>                <span class="n">terms_mod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pre_term</span><span class="o">.</span><span class="n">term</span><span class="p">)</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>        <span class="n">terms_cst</span> <span class="o">=</span> <span class="n">Terms</span><span class="p">(</span><span class="n">terms_cst</span><span class="p">)</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a>        <span class="n">terms_mod</span> <span class="o">=</span> <span class="n">Terms</span><span class="p">(</span><span class="n">terms_mod</span><span class="p">)</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a>        <span class="c1"># Define equations</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a>        <span class="n">eq_cst_name</span> <span class="o">=</span> <span class="s2">&quot;eq_</span><span class="si">{}</span><span class="s2">_cst&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a>        <span class="n">eq_cst</span> <span class="o">=</span> <span class="n">Equation</span><span class="p">(</span><span class="n">eq_cst_name</span><span class="p">,</span> <span class="n">terms_cst</span><span class="p">)</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>        <span class="n">eq_mod_name</span> <span class="o">=</span> <span class="s2">&quot;eq_</span><span class="si">{}</span><span class="s2">_mod&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>        <span class="n">eq_mod</span> <span class="o">=</span> <span class="n">Equation</span><span class="p">(</span><span class="n">eq_mod_name</span><span class="p">,</span> <span class="n">terms_mod</span><span class="p">)</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>        <span class="c1"># Set problem(s)</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>        <span class="n">pb_cst_name</span> <span class="o">=</span> <span class="s2">&quot;pb_</span><span class="si">{}</span><span class="s2">_cst&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pb_cst</span> <span class="o">=</span> <span class="n">Problem</span><span class="p">(</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>            <span class="n">pb_cst_name</span><span class="p">,</span> <span class="n">equations</span><span class="o">=</span><span class="n">Equations</span><span class="p">([</span><span class="n">eq_cst</span><span class="p">]),</span> <span class="n">active_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>        <span class="k">if</span> <span class="n">has_nonlinear_term</span><span class="p">:</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a>            <span class="n">pb_mod_name</span> <span class="o">=</span> <span class="s2">&quot;pb_</span><span class="si">{}</span><span class="s2">_mod&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pb_mod</span> <span class="o">=</span> <span class="n">Problem</span><span class="p">(</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a>                <span class="n">pb_mod_name</span><span class="p">,</span> <span class="n">equations</span><span class="o">=</span><span class="n">Equations</span><span class="p">([</span><span class="n">eq_mod</span><span class="p">]),</span> <span class="n">active_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a>        <span class="c1"># Evaluate materials in physical quadrature points for the first time</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_materials</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s1">&#39;cst&#39;</span><span class="p">)</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a>    <span class="nd">@Decorators</span><span class="o">.</span><span class="n">check_lcbcs</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>    <span class="k">def</span> <span class="nf">apply_bcs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">):</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a><span class="sd">        Apply boundary conditions to the weak form `Problem` instance(s).</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a><span class="sd">        The &#39;tag&#39; argument is used to select either `pb_cst` or `pb_mod`. Use</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a><span class="sd">        &#39;tag&#39;=&#39;both&#39; to select both (default behavior).</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_pb_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>  <span class="c1"># Safety checks</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a>        <span class="n">tag_list</span><span class="p">,</span> <span class="n">pb_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_tag_pb_lists</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>        <span class="c1"># Setting up bcs following Sfepy&#39;s API</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a>        <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">pb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tag_list</span><span class="p">,</span> <span class="n">pb_list</span><span class="p">):</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a>            <span class="n">ebcs</span> <span class="o">=</span> <span class="n">Conditions</span><span class="p">(</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a>                <span class="p">[</span><span class="n">pair_ebc</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="k">for</span> <span class="n">pair_ebc</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ebc_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())])</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a>            <span class="n">pb</span><span class="o">.</span><span class="n">set_bcs</span><span class="p">(</span><span class="n">ebcs</span><span class="o">=</span><span class="n">ebcs</span><span class="p">)</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a>            <span class="n">variables</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">get_initial_state</span><span class="p">()</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>            <span class="n">pb</span><span class="o">.</span><span class="n">time_update</span><span class="p">()</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>            <span class="n">variables</span><span class="o">.</span><span class="n">apply_ebc</span><span class="p">()</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_active_bcs</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># update dictionary of active bcs</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a>    <span class="nd">@Decorators</span><span class="o">.</span><span class="n">check_lcbcs</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a>    <span class="k">def</span> <span class="nf">remove_bcs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">):</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a><span class="sd">        Remove boundary conditions to the weak form `Problem` instance(s).</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a><span class="sd">        The &#39;tag&#39; argument is used to select either `pb_cst` or `pb_mod`. Use</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a><span class="sd">        &#39;tag&#39;=&#39;both&#39; to select both (default behavior).</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_pb_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>  <span class="c1"># Safety checks</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a>        <span class="n">tag_list</span><span class="p">,</span> <span class="n">pb_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_tag_pb_lists</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>        <span class="c1"># Removing bcs following Sfepy&#39;s API</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>        <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">pb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;cst&#39;</span><span class="p">,</span> <span class="s1">&#39;mod&#39;</span><span class="p">],</span> <span class="n">pb_list</span><span class="p">):</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>            <span class="n">pb</span><span class="o">.</span><span class="n">remove_bcs</span><span class="p">()</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>            <span class="n">pb</span><span class="o">.</span><span class="n">get_initial_state</span><span class="p">()</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_active_bcs</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># update dictionary of active bcs</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>    <span class="k">def</span> <span class="nf">update_materials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a><span class="sd">        Wrapper for `update_materials` from Sfepy `Problem` class.</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a><span class="sd">        Parameters</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a><span class="sd">        ----------</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a><span class="sd">        tag : str</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a><span class="sd">            &#39;cst&#39;, &#39;mod&#39; or &#39;both&#39;</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a><span class="sd">        force : bool</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a><span class="sd">            If True, set materials data to None before calling</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a><span class="sd">            `pb.update_materials`, which has the same effect as setting</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a><span class="sd">            &#39;mode=force&#39; in `Material.time_update` method.</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_pb_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>        <span class="n">tag_list</span><span class="p">,</span> <span class="n">pb_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_tag_pb_lists</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>        <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">pb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tag_list</span><span class="p">,</span> <span class="n">pb_list</span><span class="p">):</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>            <span class="k">if</span> <span class="n">force</span><span class="p">:</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_deplete_mat_datas</span><span class="p">(</span><span class="n">pb</span><span class="p">)</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>            <span class="n">pb</span><span class="o">.</span><span class="n">update_materials</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>    <span class="k">def</span> <span class="nf">make_full_vec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reduced_vec</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a><span class="sd">        Reconstruct a full DOF vector satisfying E(P)BCs from a reduced DOF</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a><span class="sd">        vector.</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_bcs</span><span class="p">[</span><span class="s1">&#39;cst&#39;</span><span class="p">]:</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">apply_bcs</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s1">&#39;cst&#39;</span><span class="p">)</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>        <span class="n">variables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pb_cst</span><span class="o">.</span><span class="n">get_variables</span><span class="p">()</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>        <span class="n">full_vec</span> <span class="o">=</span> <span class="n">variables</span><span class="o">.</span><span class="n">make_full_vec</span><span class="p">(</span><span class="n">reduced_vec</span><span class="p">)</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>        <span class="k">return</span> <span class="n">full_vec</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>    <span class="k">def</span> <span class="nf">make_reduced_vec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">full_vec</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a><span class="sd">        Get the reduced DOF vector (with EBC DOFs removed) from a full vector.</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_bcs</span><span class="p">[</span><span class="s1">&#39;cst&#39;</span><span class="p">]:</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">apply_bcs</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s1">&#39;cst&#39;</span><span class="p">)</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>        <span class="n">variables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pb_cst</span><span class="o">.</span><span class="n">get_variables</span><span class="p">()</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>        <span class="n">reduced_vec</span> <span class="o">=</span> <span class="n">variables</span><span class="o">.</span><span class="n">reduce_vec</span><span class="p">(</span><span class="n">full_vec</span><span class="p">)</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>        <span class="k">return</span> <span class="n">reduced_vec</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>    <span class="nd">@Decorators</span><span class="o">.</span><span class="n">check_lcbcs</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>    <span class="k">def</span> <span class="nf">set_mtx_vec_no_bc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">):</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a><span class="sd">        Set the &#39;no_bc&#39; attributes of &#39;mtx_vec&#39; (which is an instance of the</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a><span class="sd">        `MatrixVector` class). &#39;tag&#39; must be either &#39;cst&#39;, &#39;mod&#39; or &#39;both&#39;.</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a><span class="sd">        todo: handle the case &#39;mod&#39; terms are only vectors.</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_pb_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>        <span class="n">tag_list</span><span class="p">,</span> <span class="n">pb_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_tag_pb_lists</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>        <span class="n">mtx_vec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtx_vec</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>        <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">pb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tag_list</span><span class="p">,</span> <span class="n">pb_list</span><span class="p">):</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a>            <span class="n">key_mtx</span> <span class="o">=</span> <span class="s1">&#39;mtx_no_bc_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>            <span class="n">key_vec</span> <span class="o">=</span> <span class="s1">&#39;vec_no_bc_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mtx_vec</span><span class="p">,</span> <span class="n">key_mtx</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mtx_vec</span><span class="p">,</span> <span class="n">key_vec</span><span class="p">):</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a>                    <span class="sa">f</span><span class="s2">&quot;&#39;mtx_vec&#39; does not have attr. (</span><span class="si">{</span><span class="n">key_mtx</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">key_vec</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_bcs</span><span class="p">[</span><span class="n">tag</span><span class="p">]:</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">remove_bcs</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>            <span class="n">ev</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">get_evaluator</span><span class="p">()</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>            <span class="n">vec_r</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">get_variables</span><span class="p">()</span><span class="o">.</span><span class="n">get_state</span><span class="p">(</span><span class="n">reduced</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>            <span class="n">mtx</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="n">eval_tangent_matrix</span><span class="p">(</span><span class="n">vec_r</span><span class="p">,</span> <span class="n">mtx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_full</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>            <span class="n">rhs</span> <span class="o">=</span> <span class="o">-</span><span class="n">ev</span><span class="o">.</span><span class="n">eval_residual</span><span class="p">(</span><span class="n">vec_r</span><span class="p">,</span> <span class="n">is_full</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="n">mtx_vec</span><span class="p">,</span> <span class="n">key_mtx</span><span class="p">,</span> <span class="n">mtx</span><span class="p">)</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="n">mtx_vec</span><span class="p">,</span> <span class="n">key_vec</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>    <span class="k">def</span> <span class="nf">set_mtx_vec_bc_reduced</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">):</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a><span class="sd">        Set the &#39;bc_reduced&#39; attributes of &#39;mtx_vec&#39; (which is an instance of</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a><span class="sd">        the `MatrixVector` class). &#39;tag&#39; must be either &#39;cst&#39;, &#39;mod&#39; or &#39;both&#39;.</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a><span class="sd">        todo: handle the case &#39;mod&#39; terms are only vectors.</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>        <span class="n">tag_list</span><span class="p">,</span> <span class="n">pb_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_tag_pb_lists</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>        <span class="n">mtx_vec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtx_vec</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>        <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">pb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tag_list</span><span class="p">,</span> <span class="n">pb_list</span><span class="p">):</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>            <span class="n">key_mtx</span> <span class="o">=</span> <span class="s1">&#39;mtx_bc_reduced_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a>            <span class="n">key_vec</span> <span class="o">=</span> <span class="s1">&#39;vec_bc_reduced_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mtx_vec</span><span class="p">,</span> <span class="n">key_mtx</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mtx_vec</span><span class="p">,</span> <span class="n">key_vec</span><span class="p">):</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>                    <span class="sa">f</span><span class="s2">&quot;&#39;mtx_vec&#39; does not have attr. (</span><span class="si">{</span><span class="n">key_mtx</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">key_vec</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_bcs</span><span class="p">[</span><span class="n">tag</span><span class="p">]:</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">apply_bcs</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>            <span class="n">ev</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">get_evaluator</span><span class="p">()</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a>            <span class="n">vec_r</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">get_variables</span><span class="p">()</span><span class="o">.</span><span class="n">get_state</span><span class="p">(</span><span class="n">reduced</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a>            <span class="n">mtx</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="n">eval_tangent_matrix</span><span class="p">(</span><span class="n">vec_r</span><span class="p">,</span> <span class="n">mtx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_full</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a>            <span class="n">rhs</span> <span class="o">=</span> <span class="o">-</span><span class="n">ev</span><span class="o">.</span><span class="n">eval_residual</span><span class="p">(</span><span class="n">vec_r</span><span class="p">,</span> <span class="n">is_full</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="n">mtx_vec</span><span class="p">,</span> <span class="n">key_mtx</span><span class="p">,</span> <span class="n">mtx</span><span class="p">)</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="n">mtx_vec</span><span class="p">,</span> <span class="n">key_vec</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a>    <span class="nd">@Decorators</span><span class="o">.</span><span class="n">check_lcbcs</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a>    <span class="k">def</span> <span class="nf">set_mtx_vec_bc_full</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">):</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a><span class="sd">        Set the &#39;bc_full&#39; attributes of &#39;mtx_vec&#39; (which is an instance of the</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a><span class="sd">        `MatrixVector` class). &#39;tag&#39; must be either &#39;cst&#39;, &#39;mod&#39; or &#39;both&#39;.</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a><span class="sd">        todo: handle the case &#39;mod&#39; terms are only vectors.</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a>        <span class="n">tag_list</span><span class="p">,</span> <span class="n">pb_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_tag_pb_lists</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a>        <span class="n">mtx_vec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtx_vec</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a>        <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">pb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tag_list</span><span class="p">,</span> <span class="n">pb_list</span><span class="p">):</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a>            <span class="n">key_mtx</span> <span class="o">=</span> <span class="s1">&#39;mtx_bc_full_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a>            <span class="n">key_vec</span> <span class="o">=</span> <span class="s1">&#39;vec_bc_full_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mtx_vec</span><span class="p">,</span> <span class="n">key_mtx</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mtx_vec</span><span class="p">,</span> <span class="n">key_vec</span><span class="p">):</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a>                    <span class="sa">f</span><span class="s2">&quot;&#39;mtx_vec&#39; does not have attr. (</span><span class="si">{</span><span class="n">key_mtx</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">key_vec</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a>            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mtx_vec</span><span class="p">,</span> <span class="s1">&#39;mtx_no_bc_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_mtx_vec_no_bc</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>            <span class="n">mtx_no_bc</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mtx_vec</span><span class="p">,</span> <span class="s1">&#39;mtx_no_bc_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a>            <span class="n">vec_no_bc</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mtx_vec</span><span class="p">,</span> <span class="s1">&#39;vec_no_bc_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_bcs</span><span class="p">[</span><span class="n">tag</span><span class="p">]:</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">apply_bcs</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>            <span class="n">mtx</span> <span class="o">=</span> <span class="n">mtx_vec</span><span class="o">.</span><span class="n">_make_mtx_bc_full_from_mtx_no_bc</span><span class="p">(</span><span class="n">mtx_no_bc</span><span class="p">,</span> <span class="n">pb</span><span class="p">)</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>            <span class="n">vec</span> <span class="o">=</span> <span class="n">mtx_vec</span><span class="o">.</span><span class="n">_make_vec_bc_full_from_mtx_vec_no_bc</span><span class="p">(</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>                <span class="n">mtx_no_bc</span><span class="p">,</span> <span class="n">vec_no_bc</span><span class="p">,</span> <span class="n">pb</span><span class="p">)</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="n">mtx_vec</span><span class="p">,</span> <span class="n">key_mtx</span><span class="p">,</span> <span class="n">mtx</span><span class="p">)</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="n">mtx_vec</span><span class="p">,</span> <span class="n">key_vec</span><span class="p">,</span> <span class="n">vec</span><span class="p">)</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>    <span class="k">def</span> <span class="nf">get_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pb_cst</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sfepy &#39;Field&#39; has not yet been instantiated.&quot;</span><span class="p">)</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>        <span class="n">field_name</span> <span class="o">=</span> <span class="s2">&quot;field_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pb_cst</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>    <span class="k">def</span> <span class="nf">get_unknown_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>        <span class="k">if</span> <span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cst&#39;</span><span class="p">,</span> <span class="s1">&#39;mod&#39;</span><span class="p">]:</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">&#39; is not a valid tag, must be either &quot;</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a>                             <span class="sa">f</span><span class="s2">&quot;&#39;cst&#39; or &#39;mod&#39;.&quot;</span><span class="p">)</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a>        <span class="k">return</span> <span class="s1">&#39;u_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a>    <span class="k">def</span> <span class="nf">get_test_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>        <span class="k">if</span> <span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cst&#39;</span><span class="p">,</span> <span class="s1">&#39;mod&#39;</span><span class="p">]:</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">&#39; is not a valid tag, must be either &quot;</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a>                             <span class="sa">f</span><span class="s2">&quot;&#39;cst&#39; or &#39;mod&#39;.&quot;</span><span class="p">)</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a>        <span class="k">return</span> <span class="s1">&#39;v_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>    <span class="k">def</span> <span class="nf">create_sfepy_internal_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pre_mesh</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Mesh</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Mesh</span><span class="p">:</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a><span class="sd">        Create a Sfepy `Mesh` instance and return it. The input `pre_mesh` must</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a><span class="sd">        already be an instance of `sfepy.discrete.fem.mesh.Mesh` in 1D. For the</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a><span class="sd">        2D or 3D case, it is the name of an already existing .vtk mesh file.</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pre_mesh</span><span class="p">,</span> <span class="n">Mesh</span><span class="p">):</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;In the one-dimensional case, &#39;mesh&#39; should &quot;</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a>                                <span class="sa">f</span><span class="s2">&quot;be an instance of </span><span class="si">{</span><span class="n">Mesh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a>            <span class="n">sfepy_mesh</span> <span class="o">=</span> <span class="n">pre_mesh</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pre_mesh</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;In the two- and three-dimensional case, &quot;</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a>                                <span class="s2">&quot;&#39;mesh&#39; should be a string&quot;</span><span class="p">)</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>            <span class="n">mesh_path_name</span> <span class="o">=</span> <span class="n">make_absolute_mesh_name</span><span class="p">(</span><span class="n">pre_mesh</span><span class="p">)</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>            <span class="n">sfepy_mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">mesh_path_name</span><span class="p">)</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>        <span class="k">return</span> <span class="n">sfepy_mesh</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>    <span class="k">def</span> <span class="nf">fill_ebc_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pre_ebc_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a><span class="sd">        Fill the &#39;ebc_dict&#39; from user specified Dirichlet boundary conditions.</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a><span class="sd">        Parameters</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a><span class="sd">        ----------</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a><span class="sd">        pre_ebc_dict : dict</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a><span class="sd">            Dictionary that is used to assign some essential boundary conditions</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a><span class="sd">            to some topological entities. Its keys are a subset of</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a><span class="sd">            `region_dict`&#39;s ones and its values are either numbers or functions.</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a><span class="sd">        Notes</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a><span class="sd">        -----</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a><span class="sd">        In order to match Sfepy&#39;s syntax, function signatures should be</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a><span class="sd">            def func(ts, coors, **kwargs)</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a><span class="sd">        In view of Sfepy&#39;s handling of essential boundary conditions, it is</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a><span class="sd">        necessary to define pairs of ebcs (for &#39;u_cst&#39; and &#39;u_mod&#39;).</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>        <span class="k">if</span> <span class="n">pre_ebc_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>            <span class="n">pre_ebc_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">pre_ebc_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>            <span class="n">ebc_pair</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cst&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;mod&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>            <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cst&#39;</span><span class="p">,</span> <span class="s1">&#39;mod&#39;</span><span class="p">]:</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>                <span class="n">ebc_name</span> <span class="o">=</span> <span class="s1">&#39;ebc_</span><span class="si">{}{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tag</span><span class="p">)</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a>                <span class="n">unknown_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_unknown_name</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>  <span class="c1"># val is a single number</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>                    <span class="n">ebc</span> <span class="o">=</span> <span class="n">EssentialBC</span><span class="p">(</span><span class="n">ebc_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a>                                      <span class="p">{</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.all&#39;</span> <span class="o">%</span> <span class="n">unknown_name</span><span class="p">:</span> <span class="n">val</span><span class="p">})</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a>                <span class="k">else</span><span class="p">:</span>  <span class="c1"># val is a function</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a>                    <span class="n">ebc_func_name</span> <span class="o">=</span> <span class="s1">&#39;ebc_func_</span><span class="si">{}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a>                    <span class="n">ebc_func</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="n">ebc_func_name</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a>                    <span class="n">ebc</span> <span class="o">=</span> <span class="n">EssentialBC</span><span class="p">(</span><span class="n">ebc_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a>                                      <span class="p">{</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.all&#39;</span> <span class="o">%</span> <span class="n">unknown_name</span><span class="p">:</span> <span class="n">ebc_func</span><span class="p">})</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a>                <span class="n">ebc_pair</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">ebc</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ebc_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ebc_pair</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>    <span class="k">def</span> <span class="nf">fill_region_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">FEDomain</span><span class="p">,</span> <span class="n">physical_group_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>                         <span class="n">dim_func_entities</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">tuple</span><span class="p">]):</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a><span class="sd">        Fill the &#39;region_dict&#39; based on:</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a><span class="sd">        1) the physical groups present in the mesh;</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a><span class="sd">        2) the topological entities selected via a function of the coordinates.</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a><span class="sd">        Each entry of &#39;region_dict&#39; is then an instance of the class</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a><span class="sd">        `sfepy.discrete.common.region.Region`.</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a><span class="sd">        Parameters</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a><span class="sd">        ----------</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a><span class="sd">        domain : FEDomain</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a><span class="sd">            Sfepy Domain instance.</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a><span class="sd">        physical_group_ids : list</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a><span class="sd">            List of all the physical groups (int) readable from the mesh.</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a><span class="sd">        dim_func_entities : list</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a><span class="sd">            List of triplets (entity dimension, function selection, tag).</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a>        <span class="c1"># Omega and Gamma regions</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span><span class="p">[(</span><span class="s1">&#39;omega&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span><span class="s1">&#39;omega&#39;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">)</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span><span class="p">[(</span><span class="s1">&#39;gamma&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a>            <span class="s1">&#39;gamma&#39;</span><span class="p">,</span> <span class="s1">&#39;vertices of surface&#39;</span><span class="p">,</span> <span class="s1">&#39;facet&#39;</span><span class="p">)</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a>        <span class="n">topological_entities_counter</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;vertices&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>                                        <span class="s1">&#39;edges&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>                                        <span class="s1">&#39;facets&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a>                                        <span class="s1">&#39;subomegas&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a>        <span class="k">for</span> <span class="n">group_id</span> <span class="ow">in</span> <span class="n">physical_group_ids</span><span class="p">:</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_fill_region_dict_from_group_id</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">group_id</span><span class="p">,</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>                                                 <span class="n">topological_entities_counter</span><span class="p">)</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>        <span class="k">for</span> <span class="n">entity_dimension</span><span class="p">,</span> <span class="n">function_selection</span><span class="p">,</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">dim_func_entities</span><span class="p">:</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_fill_region_dict_from_dim_func</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">entity_dimension</span><span class="p">,</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>                                                 <span class="n">function_selection</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>                                                 <span class="n">topological_entities_counter</span><span class="p">)</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a>    <span class="k">def</span> <span class="nf">get_qps_coors_in_region</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">region_key</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;omega&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)):</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a><span class="sd">        Fetch quadrature points coordinates in given region.</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a><span class="sd">        Parameters</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a><span class="sd">        ----------</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a><span class="sd">        region_key : tuple, optional</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a><span class="sd">            Region where to fetch the quadrature points. The default is</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a><span class="sd">            (&#39;omega&#39;, -1), which corresponds to the whole domain.</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a><span class="sd">        Returns</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a><span class="sd">        -------</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a><span class="sd">        qps_coors : np.ndarray</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a><span class="sd">            Numpy array containing the coordinates of the qps in the specified</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a><span class="sd">            region.</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a>        <span class="n">region</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span><span class="p">[</span><span class="n">region_key</span><span class="p">]</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>        <span class="n">qps</span> <span class="o">=</span> <span class="n">get_physical_qps</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">integral</span><span class="p">)</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a>        <span class="n">qps_coors</span> <span class="o">=</span> <span class="n">qps</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a>        <span class="k">return</span> <span class="n">qps_coors</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a>    <span class="k">def</span> <span class="nf">get_pickable_args_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a><span class="sd">        Construct a dictionary that</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a><span class="sd">        (i) can be used to create a new weak form with `from_scratch` method;</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a><span class="sd">        (ii) can be serialized and thus save using pickle.</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a><span class="sd">        The second requirement implies that user defined functions are not</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a><span class="sd">        registered in the process. We get rid of all &#39;pre_term&#39;s and replace</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a><span class="sd">        them by a dummy &#39;dw_laplace&#39; term.</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a><span class="sd">        Returns</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a><span class="sd">        -------</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a><span class="sd">        args_dict : dict</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a><span class="sd">        Notes</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a><span class="sd">        -----</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a><span class="sd">        This function is a wrapper for `_reconstruct_args_dict` and</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a><span class="sd">        `_remove_functions_from_args_dict`.</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a>        <span class="n">args_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reconstruct_args_dict</span><span class="p">()</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a>        <span class="n">_remove_functions_from_args_dict</span><span class="p">(</span><span class="n">args_dict</span><span class="p">)</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a>        <span class="n">args_dict</span><span class="p">[</span><span class="s1">&#39;pre_terms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">PreTerm</span><span class="p">(</span><span class="s1">&#39;dw_laplace&#39;</span><span class="p">)]</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a>        <span class="k">return</span> <span class="n">args_dict</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>    <span class="k">def</span> <span class="nf">_reconstruct_args_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a><span class="sd">        Mirror of `from_scratch` method, i.e. recreate the `args_dict`</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a><span class="sd">        parameter from the instantiated weak form. This method does not apply to</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a><span class="sd">        one-dimensional weak forms.</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a><span class="sd">        Returns</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a><span class="sd">        -------</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a><span class="sd">        args_dict : dict</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a><span class="sd">            Dictionary that was used to create to present instance of WeakForm.</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a><span class="sd">        See Also</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a><span class="sd">        --------</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a><span class="sd">        from_scratch : create weak form instance from an `args_dict`.</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a><span class="sd">        Notes</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a><span class="sd">        -----</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a><span class="sd">        Some items cannot be recovered (e.g. &#39;dim_func_entities&#39;) or can only be</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a><span class="sd">        partially reconstructed (e.g. &#39;pre_ebc_dict&#39; when the dirichlet boundary</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a><span class="sd">        condition is given by a function).</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a>        <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>        <span class="k">if</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>                <span class="s2">&quot;Cannot call &#39;reconstruct_args_dict&#39; on 1D weak forms!&quot;</span><span class="p">)</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a>        <span class="n">pre_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">name</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>        <span class="n">dim_func_entities</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Cannot be recovered</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>        <span class="n">pre_ebc_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>        <span class="k">for</span> <span class="n">region_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ebc_dict</span><span class="p">:</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>            <span class="n">ebc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ebc_dict</span><span class="p">[</span><span class="n">region_key</span><span class="p">][</span><span class="s1">&#39;cst&#39;</span><span class="p">]</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>            <span class="n">val</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ebc</span><span class="o">.</span><span class="n">dofs</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>            <span class="n">pre_ebc_dict</span><span class="p">[</span><span class="n">region_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a>        <span class="n">fem_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fem_order</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>        <span class="n">pre_terms</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>        <span class="k">for</span> <span class="n">pre_term</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_terms</span><span class="p">:</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>            <span class="n">pre_terms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy</span><span class="p">(</span><span class="n">pre_term</span><span class="p">))</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>            <span class="n">pre_terms</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">term</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>        <span class="n">is_exterior</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_exterior</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>        <span class="n">args_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>            <span class="s1">&#39;dim&#39;</span><span class="p">:</span> <span class="n">dim</span><span class="p">,</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>            <span class="s1">&#39;pre_mesh&#39;</span><span class="p">:</span> <span class="n">pre_mesh</span><span class="p">,</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>            <span class="s1">&#39;dim_func_entities&#39;</span><span class="p">:</span> <span class="n">dim_func_entities</span><span class="p">,</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>            <span class="s1">&#39;pre_ebc_dict&#39;</span><span class="p">:</span> <span class="n">pre_ebc_dict</span><span class="p">,</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>            <span class="s1">&#39;fem_order&#39;</span><span class="p">:</span> <span class="n">fem_order</span><span class="p">,</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>            <span class="s1">&#39;pre_terms&#39;</span><span class="p">:</span> <span class="n">pre_terms</span><span class="p">,</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>            <span class="s1">&#39;is_exterior&#39;</span><span class="p">:</span> <span class="n">is_exterior</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>        <span class="p">}</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>        <span class="k">return</span> <span class="n">args_dict</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>    <span class="k">def</span> <span class="nf">_fill_region_dict_from_group_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">FEDomain</span><span class="p">,</span> <span class="n">group_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>                                        <span class="n">topological_entities_counter</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a><span class="sd">        Fill the `region_dict` dictionary with a single additional item based</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a><span class="sd">        on the provided physical group id.</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a><span class="sd">        Parameters</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a><span class="sd">        ----------</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a><span class="sd">        domain : `sfepy.discrete.fem.domain.FEDomain`</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a><span class="sd">            Sfepy Domain instance.</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a><span class="sd">        group_id : int</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a><span class="sd">            Physical group id.</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a><span class="sd">        topological_entities_counter : dict</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a><span class="sd">            Dictionary containing the current number of regions with a certain</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a><span class="sd">            topology created.</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">group_id</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>  <span class="c1"># vertex</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a>            <span class="n">vertex</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span><span class="s1">&#39;vertex</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">group_id</span><span class="p">,</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>                                          <span class="s1">&#39;vertices of group </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">group_id</span><span class="p">,</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>                                          <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;vertex&#39;</span><span class="p">)</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span><span class="p">[(</span><span class="s1">&#39;vertex&#39;</span><span class="p">,</span> <span class="n">group_id</span><span class="p">)]</span> <span class="o">=</span> <span class="n">vertex</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>            <span class="n">topological_entities_counter</span><span class="p">[</span><span class="s1">&#39;vertices&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a>        <span class="k">elif</span> <span class="mi">100</span> <span class="o">&lt;=</span> <span class="n">group_id</span> <span class="o">&lt;</span> <span class="mi">200</span><span class="p">:</span>  <span class="c1"># edge</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a>            <span class="n">edge</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span><span class="s1">&#39;edge</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">group_id</span><span class="p">,</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a>                                        <span class="s1">&#39;vertices of group </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">group_id</span><span class="p">,</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a>                                        <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;edge&#39;</span><span class="p">)</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span><span class="p">[(</span><span class="s1">&#39;edge&#39;</span><span class="p">,</span> <span class="n">group_id</span><span class="p">)]</span> <span class="o">=</span> <span class="n">edge</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>            <span class="n">topological_entities_counter</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a>        <span class="k">elif</span> <span class="mi">200</span> <span class="o">&lt;=</span> <span class="n">group_id</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="p">:</span>  <span class="c1"># facet</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>            <span class="n">facet</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span><span class="s1">&#39;facet</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">group_id</span><span class="p">,</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>                                         <span class="s1">&#39;vertices of group </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">group_id</span><span class="p">,</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>                                         <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;facet&#39;</span><span class="p">)</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span><span class="p">[(</span><span class="s1">&#39;facet&#39;</span><span class="p">,</span> <span class="n">group_id</span><span class="p">)]</span> <span class="o">=</span> <span class="n">facet</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>            <span class="n">topological_entities_counter</span><span class="p">[</span><span class="s1">&#39;facets&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>        <span class="k">elif</span> <span class="n">group_id</span> <span class="o">&gt;=</span> <span class="mi">300</span><span class="p">:</span>  <span class="c1"># subomega</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>            <span class="n">subomega</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span><span class="s1">&#39;subomega</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">group_id</span><span class="p">,</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>                                            <span class="s1">&#39;cells of group </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">group_id</span><span class="p">,</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>                                            <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cell&#39;</span><span class="p">)</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span><span class="p">[(</span><span class="s1">&#39;subomega&#39;</span><span class="p">,</span> <span class="n">group_id</span><span class="p">)]</span> <span class="o">=</span> <span class="n">subomega</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>            <span class="n">topological_entities_counter</span><span class="p">[</span><span class="s1">&#39;subomegas&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;group_id&#39; must be a positive integer.&quot;</span><span class="p">)</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a>    <span class="k">def</span> <span class="nf">_fill_region_dict_from_dim_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">FEDomain</span><span class="p">,</span> <span class="n">ent_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a>                                        <span class="n">func</span><span class="p">:</span> <span class="n">callable</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a>                                        <span class="n">topological_entities_counter</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a><span class="sd">        Fill the `region_dict` dictionary with a single additional item based</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a><span class="sd">        on the provided (entity dimension, function selection) pair. This</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a><span class="sd">        method is to be called after `_fill_region_dict_from_group_id`, because</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a><span class="sd">        it checks whether keys are already listed in the &#39;region_dict&#39;.</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a><span class="sd">        Parameters</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a><span class="sd">        ----------</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a><span class="sd">        domain : `sfepy.discrete.fem.domain.FEDomain`</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a><span class="sd">            Sfepy Domain instance.</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a><span class="sd">        ent_dim : int</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a><span class="sd">            Dimension of the selected topological entity.</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a><span class="sd">        func : function</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a><span class="sd">            Function specifying the geometry to be selected, e.g.</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a><span class="sd">            def func(coors, domain=None):</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a><span class="sd">                return np.where(np.linalg.norm(coors, axis=1) &lt; 1)[0]</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a><span class="sd">        tag : int</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a><span class="sd">            Tag assigned to the topological entity.</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a><span class="sd">        topological_entities_counter : dict</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a><span class="sd">            Dictionary containing the current number of regions with a certain</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a><span class="sd">            kind created.</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>        <span class="n">func_name</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>            <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;tag </span><span class="si">{}</span><span class="s2"> is already assigned to some &quot;</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>                                 <span class="s2">&quot;topological entity&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>        <span class="k">if</span> <span class="n">ent_dim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># vertex</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>            <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">tag</span> <span class="o">&lt;</span> <span class="mi">100</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;vertex&#39;</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>            <span class="n">topological_entities_counter</span><span class="p">[</span><span class="s1">&#39;vertices&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>            <span class="n">region</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span><span class="s1">&#39;vertex</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">tag</span><span class="p">,</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>                                          <span class="s1">&#39;vertices by </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">func_name</span><span class="p">,</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>                                          <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;vertex&#39;</span><span class="p">,</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>                                          <span class="n">functions</span><span class="o">=</span><span class="p">{</span><span class="n">func_name</span><span class="p">:</span> <span class="n">func</span><span class="p">})</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>        <span class="k">elif</span> <span class="n">ent_dim</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># edge</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a>            <span class="k">assert</span> <span class="mi">100</span> <span class="o">&lt;=</span> <span class="n">tag</span> <span class="o">&lt;</span> <span class="mi">200</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;edge&#39;</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a>            <span class="n">topological_entities_counter</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>            <span class="n">region</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span><span class="s1">&#39;edge</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">tag</span><span class="p">,</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>                                          <span class="s1">&#39;vertices by </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">func_name</span><span class="p">,</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>                                          <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;edge&#39;</span><span class="p">,</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>                                          <span class="n">functions</span><span class="o">=</span><span class="p">{</span><span class="n">func_name</span><span class="p">:</span> <span class="n">func</span><span class="p">})</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">-</span> <span class="n">ent_dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># facet</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>            <span class="k">assert</span> <span class="mi">200</span> <span class="o">&lt;=</span> <span class="n">tag</span> <span class="o">&lt;</span> <span class="mi">300</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;facet&#39;</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>            <span class="n">topological_entities_counter</span><span class="p">[</span><span class="s1">&#39;facets&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>            <span class="n">region</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span><span class="s1">&#39;facet</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">tag</span><span class="p">,</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>                                          <span class="s1">&#39;vertices by </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">func_name</span><span class="p">,</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>                                          <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;facet&#39;</span><span class="p">,</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>                                          <span class="n">functions</span><span class="o">=</span><span class="p">{</span><span class="n">func_name</span><span class="p">:</span> <span class="n">func</span><span class="p">})</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="n">ent_dim</span><span class="p">:</span>  <span class="c1"># subomega</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>            <span class="k">assert</span> <span class="n">tag</span> <span class="o">&gt;=</span> <span class="mi">300</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;subomega&#39;</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>            <span class="n">topological_entities_counter</span><span class="p">[</span><span class="s1">&#39;subomegas&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a>            <span class="n">region</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span><span class="s1">&#39;subomega</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">tag</span><span class="p">,</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>                                          <span class="s1">&#39;cells by </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">func_name</span><span class="p">,</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>                                          <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cell&#39;</span><span class="p">,</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a>                                          <span class="n">functions</span><span class="o">=</span><span class="p">{</span><span class="n">func_name</span><span class="p">:</span> <span class="n">func</span><span class="p">})</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>                <span class="s2">&quot;Invalid dimension specified in &#39;dim_func_entities&#39;.&quot;</span><span class="p">)</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a>        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span><span class="p">:</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Overwritten key of &#39;region_dict&#39;!&quot;</span><span class="p">)</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">region</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>    <span class="k">def</span> <span class="nf">_get_tag_pb_lists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a><span class="sd">        Create a list of tags and a corresponding list of `Problem`</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a><span class="sd">        instances for convenience.</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a>        <span class="n">pb_cst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pb_cst</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a>        <span class="n">pb_mod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pb_mod</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>        <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;cst&#39;</span><span class="p">:</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>            <span class="n">pb_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">pb_cst</span><span class="p">]</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>            <span class="n">tag_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">tag</span><span class="p">]</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>        <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;mod&#39;</span><span class="p">:</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>            <span class="n">pb_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">pb_mod</span><span class="p">]</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a>            <span class="n">tag_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">tag</span><span class="p">]</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a>        <span class="k">else</span><span class="p">:</span>  <span class="c1"># &#39;tag&#39; is then expected to be set to &#39;both&#39;</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a>            <span class="n">pb_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">pb_cst</span><span class="p">,</span> <span class="n">pb_mod</span><span class="p">]</span> <span class="k">if</span> <span class="n">pb_mod</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[</span><span class="n">pb_cst</span><span class="p">]</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a>            <span class="n">tag_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cst&#39;</span><span class="p">,</span> <span class="s1">&#39;mod&#39;</span><span class="p">]</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>        <span class="k">return</span> <span class="n">tag_list</span><span class="p">,</span> <span class="n">pb_list</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a>    <span class="k">def</span> <span class="nf">_check_pre_ebc_dict_format</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">pre_ebc_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check that `ebc_dict` has the right format.&quot;&quot;&quot;</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>        <span class="k">if</span> <span class="n">pre_ebc_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>            <span class="n">pre_ebc_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">pre_ebc_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Keys of &#39;pre_ebc_dict&#39; must be pairs &quot;</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>                                 <span class="s2">&quot;specifying the topological entity kind and &quot;</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>                                 <span class="s2">&quot;tag&quot;</span><span class="p">)</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>            <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_topological_kinds_ebc</span><span class="p">:</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; is not a valid kind for ebc&quot;</span><span class="p">)</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">Number</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Values of &#39;pre_ebc_dict&#39; must either be a &quot;</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>                                 <span class="s2">&quot;single number or a function&quot;</span><span class="p">)</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>    <span class="k">def</span> <span class="nf">_deplete_mat_datas</span><span class="p">(</span><span class="n">pb</span><span class="p">):</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a>        <span class="k">for</span> <span class="n">mat</span> <span class="ow">in</span> <span class="n">pb</span><span class="o">.</span><span class="n">get_materials</span><span class="p">():</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a>            <span class="n">mat</span><span class="o">.</span><span class="n">datas</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>    <span class="k">def</span> <span class="nf">_has_nonlinear_term</span><span class="p">(</span><span class="n">pre_terms</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PreTerm</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if `pre_terms` list contains at least one pre_term with</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a><span class="sd">        tag &#39;mod&#39;.&quot;&quot;&quot;</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>        <span class="k">for</span> <span class="n">pre_term</span> <span class="ow">in</span> <span class="n">pre_terms</span><span class="p">:</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>            <span class="k">if</span> <span class="n">pre_term</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;mod&#39;</span><span class="p">:</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>    <span class="k">def</span> <span class="nf">_check_pb_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check that &#39;tag&#39; and current `Problem` attributes comply.&quot;&quot;&quot;</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pb_cst</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Problem instances  have not been created yet. &quot;</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>                             <span class="s2">&quot;Consider calling &#39;set_problems&#39; beforehand.&quot;</span><span class="p">)</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>        <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;mod&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pb_mod</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;pb_mod&#39; is not set&quot;</span><span class="p">)</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a>    <span class="k">def</span> <span class="nf">_check_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check that &#39;tag&#39; is either &#39;cst&#39;, &#39;mod&#39; or &#39;both&#39;.&quot;&quot;&quot;</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>        <span class="n">valid_tags</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cst&#39;</span><span class="p">,</span> <span class="s1">&#39;mod&#39;</span><span class="p">,</span> <span class="s1">&#39;both&#39;</span><span class="p">]</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a>        <span class="k">if</span> <span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_tags</span><span class="p">:</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid &#39;tag&#39; (valid tags are </span><span class="si">{</span><span class="n">valid_tags</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>    <span class="k">def</span> <span class="nf">_check_args_before_merging</span><span class="p">(</span><span class="n">wf_int</span><span class="p">:</span> <span class="n">WeakForm</span><span class="p">,</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>                                   <span class="n">wf_ext</span><span class="p">:</span> <span class="n">WeakForm</span><span class="p">,</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>                                   <span class="n">region_key_int</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>                                   <span class="n">region_key_ext</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check that arguments of `from_two_weak_forms` are compliant for</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a><span class="sd">        proceeding to the merging of the two weak forms.&quot;&quot;&quot;</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>        <span class="c1"># Check dim</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>        <span class="k">if</span> <span class="n">wf_int</span><span class="o">.</span><span class="n">dim</span> <span class="o">!=</span> <span class="n">wf_ext</span><span class="o">.</span><span class="n">dim</span><span class="p">:</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The two weak forms have different dimensions!&quot;</span><span class="p">)</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>        <span class="c1"># Check fem_order</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>        <span class="k">if</span> <span class="n">wf_int</span><span class="o">.</span><span class="n">fem_order</span> <span class="o">!=</span> <span class="n">wf_ext</span><span class="o">.</span><span class="n">fem_order</span><span class="p">:</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>                <span class="s2">&quot;The two weak forms have different &#39;fem_order&#39; attributes!&quot;</span><span class="p">)</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>        <span class="c1"># Check if specified regions exist</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>        <span class="k">if</span> <span class="n">region_key_int</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">wf_int</span><span class="o">.</span><span class="n">region_dict</span><span class="p">:</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Region with key &#39;</span><span class="si">{</span><span class="n">region_key_int</span><span class="si">}</span><span class="s2">&#39; is not included&quot;</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>                           <span class="sa">f</span><span class="s2">&quot;in the interior weak form &#39;region_dict&#39; with keys &quot;</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>                           <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">wf_int</span><span class="o">.</span><span class="n">region_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a>        <span class="k">if</span> <span class="n">region_key_ext</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">wf_ext</span><span class="o">.</span><span class="n">region_dict</span><span class="p">:</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Region with key &#39;</span><span class="si">{</span><span class="n">region_key_ext</span><span class="si">}</span><span class="s2">&#39; is not included&quot;</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>                           <span class="sa">f</span><span class="s2">&quot; in the exterior weak form &#39;region_dict&#39; with keys&quot;</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>                           <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">wf_ext</span><span class="o">.</span><span class="n">region_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>        <span class="c1"># Check that both regions have the same number of DOFs</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a>        <span class="n">n_dofs_int</span> <span class="o">=</span> <span class="n">wf_int</span><span class="o">.</span><span class="n">region_dict</span><span class="p">[</span><span class="n">region_key_int</span><span class="p">]</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>        <span class="n">n_dofs_ext</span> <span class="o">=</span> <span class="n">wf_ext</span><span class="o">.</span><span class="n">region_dict</span><span class="p">[</span><span class="n">region_key_ext</span><span class="p">]</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>        <span class="k">if</span> <span class="n">n_dofs_int</span> <span class="o">!=</span> <span class="n">n_dofs_ext</span><span class="p">:</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>                <span class="s2">&quot;Connecting regions do not have the same number of DOFs!&quot;</span><span class="p">)</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>        <span class="c1"># Check that both weak forms have the same (non)linearity settings</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">wf_int</span><span class="o">.</span><span class="n">pb_mod</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="p">(</span><span class="n">wf_ext</span><span class="o">.</span><span class="n">pb_mod</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>                <span class="s2">&quot;One weak form is nonlinear while the other one is linear!&quot;</span><span class="p">)</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a>        <span class="c1"># Check that the weak forms have different names</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>        <span class="k">if</span> <span class="n">wf_int</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">wf_ext</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a>            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The two provided weak forms have the same name &quot;</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a>                            <span class="sa">f</span><span class="s2">&quot;(&#39;</span><span class="si">{</span><span class="n">wf_int</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;): abort combination.&quot;</span><span class="p">)</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a>    <span class="k">def</span> <span class="nf">_fix_pb_without_state_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a><span class="sd">        For tag = (&#39;cst&#39;, &#39;mod&#39;), add a zero dummy `PreTerm` instance to the</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a><span class="sd">        list `self.pre_terms` if it does not feature any &#39;matrix term&#39;.</span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a><span class="sd">        Notes</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a><span class="sd">        -----</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a><span class="sd">        This is a (dirty) fix to the issue encountered when trying to assemble</span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a><span class="sd">        rhs vector from `Problem` instances with no matrix terms. Adding a</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a><span class="sd">        zero matrix term solves the issue. So far, there is no other fix</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a><span class="sd">        available.</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a>        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cst&#39;</span><span class="p">,</span> <span class="s1">&#39;mod&#39;</span><span class="p">]:</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a>            <span class="n">has_matrix_term</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a>            <span class="n">has_tag</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a>            <span class="k">for</span> <span class="n">pre_term</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_terms</span><span class="p">:</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>                <span class="k">if</span> <span class="n">pre_term</span><span class="o">.</span><span class="n">tag</span> <span class="o">!=</span> <span class="n">tag</span><span class="p">:</span>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a>                    <span class="k">continue</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a>                <span class="n">has_tag</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>                <span class="k">if</span> <span class="n">is_matrix_term</span><span class="p">(</span><span class="n">pre_term</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a>                    <span class="n">has_matrix_term</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>                    <span class="k">break</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">has_matrix_term</span> <span class="ow">and</span> <span class="n">has_tag</span><span class="p">:</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a>                <span class="k">def</span> <span class="nf">mat_zero</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">coors</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vec_qp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>                    <span class="k">if</span> <span class="n">mode</span> <span class="o">!=</span> <span class="s1">&#39;qp&#39;</span><span class="p">:</span> <span class="k">return</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>                    <span class="n">val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">coors</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a>                    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span> <span class="n">val</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)}</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>                <span class="n">dummy_term</span> <span class="o">=</span> <span class="n">PreTerm</span><span class="p">(</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a>                    <span class="s1">&#39;dw_laplace&#39;</span><span class="p">,</span> <span class="n">mat</span><span class="o">=</span><span class="n">mat_zero</span><span class="p">,</span> <span class="n">prefactor</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pre_terms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dummy_term</span><span class="p">)</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a><span class="k">def</span> <span class="nf">_remove_functions_from_args_dict</span><span class="p">(</span><span class="n">args_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a><span class="sd">    Remove functions references in dictionary `args_dict` in order to make it</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a><span class="sd">    &#39;pickable&#39;. This operation is done in-place.</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a><span class="sd">    Parameters</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a><span class="sd">    ----------</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a><span class="sd">    args_dict : dict</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a><span class="sd">            Dictionary that was used to create to present instance of WeakForm.</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a>    <span class="c1"># Replace Dirichlet BC functions by np.nan</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a>    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">args_dict</span><span class="p">[</span><span class="s1">&#39;pre_ebc_dict&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a>        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a>            <span class="n">args_dict</span><span class="p">[</span><span class="s1">&#39;pre_ebc_dict&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a>    <span class="c1"># Replace material functions by None</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a>    <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">args_dict</span><span class="p">[</span><span class="s1">&#39;pre_terms&#39;</span><span class="p">]:</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a>        <span class="n">term</span><span class="o">.</span><span class="n">mat</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a>        <span class="n">term</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="s1">&#39;cst&#39;</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a>        <span class="n">term</span><span class="o">.</span><span class="n">term</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a><span class="k">class</span> <span class="nc">_EquationsFix</span><span class="p">(</span><span class="n">Equations</span><span class="p">):</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a><span class="sd">    Class inheriting from Sfepy `Equations`, where the __init__ method is</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a><span class="sd">    overriden in order to sort the variables (&#39;int&#39; goes first, &#39;ext&#39; goes</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a><span class="sd">    second). Without this fix, the order chosen by Sfepy is random. This caused</span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a><span class="sd">    spurious bugs when &#39;cst&#39; and &#39;mod&#39; variables end up in different orders.</span>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">equations</span><span class="p">):</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a>        <span class="n">Container</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">equations</span><span class="p">)</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span> <span class="o">=</span> <span class="n">Variables</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collect_variables</span><span class="p">())</span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a>        <span class="c1"># Fix ordered_state &amp; ordered_virtual</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a>        <span class="k">if</span> <span class="s1">&#39;ext&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">ordered_state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">):</span>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">ordered_state</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">ordered_virtual</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">materials</span> <span class="o">=</span> <span class="n">Materials</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collect_materials</span><span class="p">())</span>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_domain</span><span class="p">()</span>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">active_bcs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">collect_conn_info</span><span class="p">()</span>
</span></pre></div>


            </section>
                <section id="WeakForm">
                            <input id="WeakForm-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">WeakForm</span>:

                <label class="view-source-button" for="WeakForm-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeakForm"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeakForm-40"><a href="#WeakForm-40"><span class="linenos">  40</span></a><span class="k">class</span> <span class="nc">WeakForm</span><span class="p">:</span>
</span><span id="WeakForm-41"><a href="#WeakForm-41"><span class="linenos">  41</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm-42"><a href="#WeakForm-42"><span class="linenos">  42</span></a><span class="sd">    Class gathering objects linked to the weak formulation of some PDE.</span>
</span><span id="WeakForm-43"><a href="#WeakForm-43"><span class="linenos">  43</span></a>
</span><span id="WeakForm-44"><a href="#WeakForm-44"><span class="linenos">  44</span></a><span class="sd">    Attributes</span>
</span><span id="WeakForm-45"><a href="#WeakForm-45"><span class="linenos">  45</span></a><span class="sd">    ----------</span>
</span><span id="WeakForm-46"><a href="#WeakForm-46"><span class="linenos">  46</span></a><span class="sd">    name : str</span>
</span><span id="WeakForm-47"><a href="#WeakForm-47"><span class="linenos">  47</span></a><span class="sd">        Name of the weak form.</span>
</span><span id="WeakForm-48"><a href="#WeakForm-48"><span class="linenos">  48</span></a><span class="sd">    dim : int</span>
</span><span id="WeakForm-49"><a href="#WeakForm-49"><span class="linenos">  49</span></a><span class="sd">        Dimension of the problem: 1, 2 or 3.</span>
</span><span id="WeakForm-50"><a href="#WeakForm-50"><span class="linenos">  50</span></a><span class="sd">    region_dict : dict</span>
</span><span id="WeakForm-51"><a href="#WeakForm-51"><span class="linenos">  51</span></a><span class="sd">        Dictionary of regions with</span>
</span><span id="WeakForm-52"><a href="#WeakForm-52"><span class="linenos">  52</span></a><span class="sd">        keys: pairs topological kind - tag, e.g. (&#39;subomega&#39;, 301).</span>
</span><span id="WeakForm-53"><a href="#WeakForm-53"><span class="linenos">  53</span></a><span class="sd">        values: corresponding Sfepy `Region` instances.</span>
</span><span id="WeakForm-54"><a href="#WeakForm-54"><span class="linenos">  54</span></a><span class="sd">    ebc_dict : dict</span>
</span><span id="WeakForm-55"><a href="#WeakForm-55"><span class="linenos">  55</span></a><span class="sd">        Dictionary of essential boundary conditions with</span>
</span><span id="WeakForm-56"><a href="#WeakForm-56"><span class="linenos">  56</span></a><span class="sd">        keys: same as `region_dict`.</span>
</span><span id="WeakForm-57"><a href="#WeakForm-57"><span class="linenos">  57</span></a><span class="sd">        values: dictionary with keys (&#39;cst&#39;, &#39;mod&#39;) containing corresponding</span>
</span><span id="WeakForm-58"><a href="#WeakForm-58"><span class="linenos">  58</span></a><span class="sd">        Sfepy&#39;s `EssentialBC` instances.</span>
</span><span id="WeakForm-59"><a href="#WeakForm-59"><span class="linenos">  59</span></a><span class="sd">    pre_terms : list[PreTerm]</span>
</span><span id="WeakForm-60"><a href="#WeakForm-60"><span class="linenos">  60</span></a><span class="sd">        List of `PreTerm` instances. Each &#39;pre_term&#39; contains extra information</span>
</span><span id="WeakForm-61"><a href="#WeakForm-61"><span class="linenos">  61</span></a><span class="sd">        with respect to Sfepy&#39;s `Term` instance.</span>
</span><span id="WeakForm-62"><a href="#WeakForm-62"><span class="linenos">  62</span></a><span class="sd">    fem_order : int</span>
</span><span id="WeakForm-63"><a href="#WeakForm-63"><span class="linenos">  63</span></a><span class="sd">        Finite Element approximation order.</span>
</span><span id="WeakForm-64"><a href="#WeakForm-64"><span class="linenos">  64</span></a><span class="sd">    pb_cst : Problem</span>
</span><span id="WeakForm-65"><a href="#WeakForm-65"><span class="linenos">  65</span></a><span class="sd">        Sfepy&#39;s Problem instance associated with the linear part of the PDE.</span>
</span><span id="WeakForm-66"><a href="#WeakForm-66"><span class="linenos">  66</span></a><span class="sd">    pb_mod : Problem</span>
</span><span id="WeakForm-67"><a href="#WeakForm-67"><span class="linenos">  67</span></a><span class="sd">        Sfepy&#39;s Problem instance associated with the nonlinear part of the PDE.</span>
</span><span id="WeakForm-68"><a href="#WeakForm-68"><span class="linenos">  68</span></a><span class="sd">    mtx_vec : MatrixVector</span>
</span><span id="WeakForm-69"><a href="#WeakForm-69"><span class="linenos">  69</span></a><span class="sd">        Instance of class `MatrixVector` for storing assembled matrices and</span>
</span><span id="WeakForm-70"><a href="#WeakForm-70"><span class="linenos">  70</span></a><span class="sd">        vectors associated with the current weak form.</span>
</span><span id="WeakForm-71"><a href="#WeakForm-71"><span class="linenos">  71</span></a><span class="sd">    _active_bcs : dict</span>
</span><span id="WeakForm-72"><a href="#WeakForm-72"><span class="linenos">  72</span></a><span class="sd">        Private attribute indicating whether boundary conditions are set active</span>
</span><span id="WeakForm-73"><a href="#WeakForm-73"><span class="linenos">  73</span></a><span class="sd">        on `pb_cst` and `pb_mod`.</span>
</span><span id="WeakForm-74"><a href="#WeakForm-74"><span class="linenos">  74</span></a>
</span><span id="WeakForm-75"><a href="#WeakForm-75"><span class="linenos">  75</span></a><span class="sd">    Properties</span>
</span><span id="WeakForm-76"><a href="#WeakForm-76"><span class="linenos">  76</span></a><span class="sd">    ----------</span>
</span><span id="WeakForm-77"><a href="#WeakForm-77"><span class="linenos">  77</span></a><span class="sd">    active_bcs : dict</span>
</span><span id="WeakForm-78"><a href="#WeakForm-78"><span class="linenos">  78</span></a><span class="sd">        Proxy for `_active_bcs` in read-only mode.</span>
</span><span id="WeakForm-79"><a href="#WeakForm-79"><span class="linenos">  79</span></a><span class="sd">    field : Field</span>
</span><span id="WeakForm-80"><a href="#WeakForm-80"><span class="linenos">  80</span></a><span class="sd">        Sfepy Field instance.</span>
</span><span id="WeakForm-81"><a href="#WeakForm-81"><span class="linenos">  81</span></a><span class="sd">    integral : Integral</span>
</span><span id="WeakForm-82"><a href="#WeakForm-82"><span class="linenos">  82</span></a><span class="sd">        Sfepy Integral instance.</span>
</span><span id="WeakForm-83"><a href="#WeakForm-83"><span class="linenos">  83</span></a><span class="sd">    ndofs : int</span>
</span><span id="WeakForm-84"><a href="#WeakForm-84"><span class="linenos">  84</span></a><span class="sd">        Total number of degrees of freedom.</span>
</span><span id="WeakForm-85"><a href="#WeakForm-85"><span class="linenos">  85</span></a><span class="sd">    vec_bc : np.ndarray</span>
</span><span id="WeakForm-86"><a href="#WeakForm-86"><span class="linenos">  86</span></a><span class="sd">        Full vector filled with zeros except at fixed DOFs where Dirichlet</span>
</span><span id="WeakForm-87"><a href="#WeakForm-87"><span class="linenos">  87</span></a><span class="sd">        BC values are used.</span>
</span><span id="WeakForm-88"><a href="#WeakForm-88"><span class="linenos">  88</span></a>
</span><span id="WeakForm-89"><a href="#WeakForm-89"><span class="linenos">  89</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="WeakForm-90"><a href="#WeakForm-90"><span class="linenos">  90</span></a>
</span><span id="WeakForm-91"><a href="#WeakForm-91"><span class="linenos">  91</span></a>    <span class="k">class</span> <span class="nc">Decorators</span><span class="p">:</span>
</span><span id="WeakForm-92"><a href="#WeakForm-92"><span class="linenos">  92</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Inner class for defining decorators.&quot;&quot;&quot;</span>
</span><span id="WeakForm-93"><a href="#WeakForm-93"><span class="linenos">  93</span></a>
</span><span id="WeakForm-94"><a href="#WeakForm-94"><span class="linenos">  94</span></a>        <span class="nd">@staticmethod</span>
</span><span id="WeakForm-95"><a href="#WeakForm-95"><span class="linenos">  95</span></a>        <span class="k">def</span> <span class="nf">check_lcbcs</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
</span><span id="WeakForm-96"><a href="#WeakForm-96"><span class="linenos">  96</span></a>            <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="WeakForm-97"><a href="#WeakForm-97"><span class="linenos">  97</span></a>                <span class="bp">self</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="WeakForm-98"><a href="#WeakForm-98"><span class="linenos">  98</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="WeakForm-99"><a href="#WeakForm-99"><span class="linenos">  99</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pb_cst</span><span class="o">.</span><span class="n">equations</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">has_lcbc</span><span class="p">:</span>
</span><span id="WeakForm-100"><a href="#WeakForm-100"><span class="linenos"> 100</span></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="WeakForm-101"><a href="#WeakForm-101"><span class="linenos"> 101</span></a>                            <span class="sa">f</span><span class="s2">&quot;Method &#39;</span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; cannot be called on weak&quot;</span>
</span><span id="WeakForm-102"><a href="#WeakForm-102"><span class="linenos"> 102</span></a>                            <span class="sa">f</span><span class="s2">&quot; form &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; because it has lcbcs!&quot;</span><span class="p">)</span>
</span><span id="WeakForm-103"><a href="#WeakForm-103"><span class="linenos"> 103</span></a>                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span id="WeakForm-104"><a href="#WeakForm-104"><span class="linenos"> 104</span></a>                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;weak form </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is not fully set up!&quot;</span><span class="p">)</span>
</span><span id="WeakForm-105"><a href="#WeakForm-105"><span class="linenos"> 105</span></a>                <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="WeakForm-106"><a href="#WeakForm-106"><span class="linenos"> 106</span></a>            <span class="k">return</span> <span class="n">wrapper</span>
</span><span id="WeakForm-107"><a href="#WeakForm-107"><span class="linenos"> 107</span></a>
</span><span id="WeakForm-108"><a href="#WeakForm-108"><span class="linenos"> 108</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WeakForm-109"><a href="#WeakForm-109"><span class="linenos"> 109</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WeakForm-110"><a href="#WeakForm-110"><span class="linenos"> 110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WeakForm-111"><a href="#WeakForm-111"><span class="linenos"> 111</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WeakForm-112"><a href="#WeakForm-112"><span class="linenos"> 112</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ebc_dict</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WeakForm-113"><a href="#WeakForm-113"><span class="linenos"> 113</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pre_terms</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WeakForm-114"><a href="#WeakForm-114"><span class="linenos"> 114</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fem_order</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WeakForm-115"><a href="#WeakForm-115"><span class="linenos"> 115</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pb_cst</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WeakForm-116"><a href="#WeakForm-116"><span class="linenos"> 116</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pb_mod</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WeakForm-117"><a href="#WeakForm-117"><span class="linenos"> 117</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mtx_vec</span> <span class="o">=</span> <span class="n">MatrixVector</span><span class="p">()</span>
</span><span id="WeakForm-118"><a href="#WeakForm-118"><span class="linenos"> 118</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_active_bcs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cst&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;mod&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
</span><span id="WeakForm-119"><a href="#WeakForm-119"><span class="linenos"> 119</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_exterior</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WeakForm-120"><a href="#WeakForm-120"><span class="linenos"> 120</span></a>
</span><span id="WeakForm-121"><a href="#WeakForm-121"><span class="linenos"> 121</span></a>    <span class="nd">@property</span>
</span><span id="WeakForm-122"><a href="#WeakForm-122"><span class="linenos"> 122</span></a>    <span class="k">def</span> <span class="nf">active_bcs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WeakForm-123"><a href="#WeakForm-123"><span class="linenos"> 123</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_bcs</span>
</span><span id="WeakForm-124"><a href="#WeakForm-124"><span class="linenos"> 124</span></a>
</span><span id="WeakForm-125"><a href="#WeakForm-125"><span class="linenos"> 125</span></a>    <span class="nd">@property</span>
</span><span id="WeakForm-126"><a href="#WeakForm-126"><span class="linenos"> 126</span></a>    <span class="k">def</span> <span class="nf">field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WeakForm-127"><a href="#WeakForm-127"><span class="linenos"> 127</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_field</span><span class="p">()</span>
</span><span id="WeakForm-128"><a href="#WeakForm-128"><span class="linenos"> 128</span></a>
</span><span id="WeakForm-129"><a href="#WeakForm-129"><span class="linenos"> 129</span></a>    <span class="nd">@property</span>
</span><span id="WeakForm-130"><a href="#WeakForm-130"><span class="linenos"> 130</span></a>    <span class="k">def</span> <span class="nf">integral</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WeakForm-131"><a href="#WeakForm-131"><span class="linenos"> 131</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pb_cst</span><span class="o">.</span><span class="n">equations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">terms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">integral</span>
</span><span id="WeakForm-132"><a href="#WeakForm-132"><span class="linenos"> 132</span></a>
</span><span id="WeakForm-133"><a href="#WeakForm-133"><span class="linenos"> 133</span></a>    <span class="nd">@property</span>
</span><span id="WeakForm-134"><a href="#WeakForm-134"><span class="linenos"> 134</span></a>    <span class="k">def</span> <span class="nf">ndofs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WeakForm-135"><a href="#WeakForm-135"><span class="linenos"> 135</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">coors</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="WeakForm-136"><a href="#WeakForm-136"><span class="linenos"> 136</span></a>
</span><span id="WeakForm-137"><a href="#WeakForm-137"><span class="linenos"> 137</span></a>    <span class="nd">@property</span>
</span><span id="WeakForm-138"><a href="#WeakForm-138"><span class="linenos"> 138</span></a>    <span class="k">def</span> <span class="nf">vec_bc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WeakForm-139"><a href="#WeakForm-139"><span class="linenos"> 139</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Full vector filled with zeros except at fixed DOFs where Dirichlet</span>
</span><span id="WeakForm-140"><a href="#WeakForm-140"><span class="linenos"> 140</span></a><span class="sd">        BC values are used.&quot;&quot;&quot;</span>
</span><span id="WeakForm-141"><a href="#WeakForm-141"><span class="linenos"> 141</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">apply_bcs</span><span class="p">()</span>
</span><span id="WeakForm-142"><a href="#WeakForm-142"><span class="linenos"> 142</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pb_cst</span><span class="o">.</span><span class="n">get_variables</span><span class="p">()</span><span class="o">.</span><span class="n">get_state</span><span class="p">(</span><span class="n">reduced</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="WeakForm-143"><a href="#WeakForm-143"><span class="linenos"> 143</span></a>
</span><span id="WeakForm-144"><a href="#WeakForm-144"><span class="linenos"> 144</span></a>    <span class="nd">@classmethod</span>
</span><span id="WeakForm-145"><a href="#WeakForm-145"><span class="linenos"> 145</span></a>    <span class="k">def</span> <span class="nf">from_attr_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">attr_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WeakForm</span><span class="p">:</span>
</span><span id="WeakForm-146"><a href="#WeakForm-146"><span class="linenos"> 146</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an instance of `WeakForm`, set its attributes from the</span>
</span><span id="WeakForm-147"><a href="#WeakForm-147"><span class="linenos"> 147</span></a><span class="sd">        `attr_dict` dictionary and return it.&quot;&quot;&quot;</span>
</span><span id="WeakForm-148"><a href="#WeakForm-148"><span class="linenos"> 148</span></a>        <span class="n">wf_instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
</span><span id="WeakForm-149"><a href="#WeakForm-149"><span class="linenos"> 149</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">attr_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="WeakForm-150"><a href="#WeakForm-150"><span class="linenos"> 150</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="WeakForm-151"><a href="#WeakForm-151"><span class="linenos"> 151</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Dictionary keys must be strings&quot;</span><span class="p">)</span>
</span><span id="WeakForm-152"><a href="#WeakForm-152"><span class="linenos"> 152</span></a>            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="n">wf_instance</span><span class="p">):</span>
</span><span id="WeakForm-153"><a href="#WeakForm-153"><span class="linenos"> 153</span></a>                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39; is not a WeakForm attribute name&quot;</span><span class="p">)</span>
</span><span id="WeakForm-154"><a href="#WeakForm-154"><span class="linenos"> 154</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="n">wf_instance</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
</span><span id="WeakForm-155"><a href="#WeakForm-155"><span class="linenos"> 155</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">attr_dict</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nb">vars</span><span class="p">(</span><span class="n">wf_instance</span><span class="p">))</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="WeakForm-156"><a href="#WeakForm-156"><span class="linenos"> 156</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Some attributes have not been set&quot;</span><span class="p">)</span>
</span><span id="WeakForm-157"><a href="#WeakForm-157"><span class="linenos"> 157</span></a>        <span class="k">return</span> <span class="n">wf_instance</span>
</span><span id="WeakForm-158"><a href="#WeakForm-158"><span class="linenos"> 158</span></a>
</span><span id="WeakForm-159"><a href="#WeakForm-159"><span class="linenos"> 159</span></a>    <span class="nd">@classmethod</span>
</span><span id="WeakForm-160"><a href="#WeakForm-160"><span class="linenos"> 160</span></a>    <span class="k">def</span> <span class="nf">from_scratch</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">args_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WeakForm</span><span class="p">:</span>
</span><span id="WeakForm-161"><a href="#WeakForm-161"><span class="linenos"> 161</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm-162"><a href="#WeakForm-162"><span class="linenos"> 162</span></a><span class="sd">        Create an instance of `WeakForm` and set its attributes by creating the</span>
</span><span id="WeakForm-163"><a href="#WeakForm-163"><span class="linenos"> 163</span></a><span class="sd">        relevant Sfepy&#39;s objects step by step. The dictionary `args_dict`</span>
</span><span id="WeakForm-164"><a href="#WeakForm-164"><span class="linenos"> 164</span></a><span class="sd">        passed to the function contains the following items:</span>
</span><span id="WeakForm-165"><a href="#WeakForm-165"><span class="linenos"> 165</span></a>
</span><span id="WeakForm-166"><a href="#WeakForm-166"><span class="linenos"> 166</span></a><span class="sd">        Parameters</span>
</span><span id="WeakForm-167"><a href="#WeakForm-167"><span class="linenos"> 167</span></a><span class="sd">        ----------</span>
</span><span id="WeakForm-168"><a href="#WeakForm-168"><span class="linenos"> 168</span></a><span class="sd">        dim : int</span>
</span><span id="WeakForm-169"><a href="#WeakForm-169"><span class="linenos"> 169</span></a><span class="sd">            Dimension of the problem: 1, 2 or 3.</span>
</span><span id="WeakForm-170"><a href="#WeakForm-170"><span class="linenos"> 170</span></a><span class="sd">        pre_mesh : str or `sfepy.discrete.fem.mesh.Mesh`</span>
</span><span id="WeakForm-171"><a href="#WeakForm-171"><span class="linenos"> 171</span></a><span class="sd">            In 1D: already existing Sfepy&#39;s `Mesh` instance.</span>
</span><span id="WeakForm-172"><a href="#WeakForm-172"><span class="linenos"> 172</span></a><span class="sd">            In 2D and 3D: name of the .vtk mesh file.</span>
</span><span id="WeakForm-173"><a href="#WeakForm-173"><span class="linenos"> 173</span></a><span class="sd">        name : str, optional</span>
</span><span id="WeakForm-174"><a href="#WeakForm-174"><span class="linenos"> 174</span></a><span class="sd">            Name of the weak form. The default is &#39;wf&#39;.</span>
</span><span id="WeakForm-175"><a href="#WeakForm-175"><span class="linenos"> 175</span></a><span class="sd">        dim_func_entities : List[tuple]</span>
</span><span id="WeakForm-176"><a href="#WeakForm-176"><span class="linenos"> 176</span></a><span class="sd">            List of triplets (entity dimension, function selection, tag).</span>
</span><span id="WeakForm-177"><a href="#WeakForm-177"><span class="linenos"> 177</span></a><span class="sd">        pre_ebc_dict : dict</span>
</span><span id="WeakForm-178"><a href="#WeakForm-178"><span class="linenos"> 178</span></a><span class="sd">            Dictionary that is used to assign some essential boundary conditions</span>
</span><span id="WeakForm-179"><a href="#WeakForm-179"><span class="linenos"> 179</span></a><span class="sd">            to some topological entities. Its keys are a subset of `region_dict`</span>
</span><span id="WeakForm-180"><a href="#WeakForm-180"><span class="linenos"> 180</span></a><span class="sd">            ones and its values are either numbers or functions.</span>
</span><span id="WeakForm-181"><a href="#WeakForm-181"><span class="linenos"> 181</span></a><span class="sd">        fem_order : int, optional</span>
</span><span id="WeakForm-182"><a href="#WeakForm-182"><span class="linenos"> 182</span></a><span class="sd">            Finite Element approximation order. The default is 2.</span>
</span><span id="WeakForm-183"><a href="#WeakForm-183"><span class="linenos"> 183</span></a><span class="sd">        pre_terms : List[PreTerm]</span>
</span><span id="WeakForm-184"><a href="#WeakForm-184"><span class="linenos"> 184</span></a><span class="sd">            List of `PreTerm` instances associated with the PDE to be solved.</span>
</span><span id="WeakForm-185"><a href="#WeakForm-185"><span class="linenos"> 185</span></a><span class="sd">        is_exterior : Union[bool, None]</span>
</span><span id="WeakForm-186"><a href="#WeakForm-186"><span class="linenos"> 186</span></a><span class="sd">            Wheter the weak form to be created shall be associated with the</span>
</span><span id="WeakForm-187"><a href="#WeakForm-187"><span class="linenos"> 187</span></a><span class="sd">            exterior domain. The default is None.</span>
</span><span id="WeakForm-188"><a href="#WeakForm-188"><span class="linenos"> 188</span></a>
</span><span id="WeakForm-189"><a href="#WeakForm-189"><span class="linenos"> 189</span></a><span class="sd">        Returns</span>
</span><span id="WeakForm-190"><a href="#WeakForm-190"><span class="linenos"> 190</span></a><span class="sd">        -------</span>
</span><span id="WeakForm-191"><a href="#WeakForm-191"><span class="linenos"> 191</span></a><span class="sd">        wf_instance : WeakForm</span>
</span><span id="WeakForm-192"><a href="#WeakForm-192"><span class="linenos"> 192</span></a><span class="sd">            The created weak form.</span>
</span><span id="WeakForm-193"><a href="#WeakForm-193"><span class="linenos"> 193</span></a>
</span><span id="WeakForm-194"><a href="#WeakForm-194"><span class="linenos"> 194</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WeakForm-195"><a href="#WeakForm-195"><span class="linenos"> 195</span></a>
</span><span id="WeakForm-196"><a href="#WeakForm-196"><span class="linenos"> 196</span></a>        <span class="c1"># Get arguments and default values</span>
</span><span id="WeakForm-197"><a href="#WeakForm-197"><span class="linenos"> 197</span></a>        <span class="n">dim</span> <span class="o">=</span> <span class="n">args_dict</span><span class="p">[</span><span class="s1">&#39;dim&#39;</span><span class="p">]</span>
</span><span id="WeakForm-198"><a href="#WeakForm-198"><span class="linenos"> 198</span></a>        <span class="n">pre_mesh</span> <span class="o">=</span> <span class="n">args_dict</span><span class="p">[</span><span class="s1">&#39;pre_mesh&#39;</span><span class="p">]</span>
</span><span id="WeakForm-199"><a href="#WeakForm-199"><span class="linenos"> 199</span></a>        <span class="n">name</span> <span class="o">=</span> <span class="n">args_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;wf&#39;</span><span class="p">)</span>
</span><span id="WeakForm-200"><a href="#WeakForm-200"><span class="linenos"> 200</span></a>        <span class="n">dim_func_entities</span> <span class="o">=</span> <span class="n">args_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dim_func_entities&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="WeakForm-201"><a href="#WeakForm-201"><span class="linenos"> 201</span></a>        <span class="n">pre_ebc_dict</span> <span class="o">=</span> <span class="n">args_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pre_ebc_dict&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="WeakForm-202"><a href="#WeakForm-202"><span class="linenos"> 202</span></a>        <span class="n">fem_order</span> <span class="o">=</span> <span class="n">args_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fem_order&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="WeakForm-203"><a href="#WeakForm-203"><span class="linenos"> 203</span></a>        <span class="n">pre_terms</span> <span class="o">=</span> <span class="n">args_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pre_terms&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="WeakForm-204"><a href="#WeakForm-204"><span class="linenos"> 204</span></a>        <span class="n">is_exterior</span> <span class="o">=</span> <span class="n">args_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;is_exterior&#39;</span><span class="p">)</span>
</span><span id="WeakForm-205"><a href="#WeakForm-205"><span class="linenos"> 205</span></a>
</span><span id="WeakForm-206"><a href="#WeakForm-206"><span class="linenos"> 206</span></a>        <span class="c1"># Create empty class instance</span>
</span><span id="WeakForm-207"><a href="#WeakForm-207"><span class="linenos"> 207</span></a>        <span class="n">wf_instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
</span><span id="WeakForm-208"><a href="#WeakForm-208"><span class="linenos"> 208</span></a>
</span><span id="WeakForm-209"><a href="#WeakForm-209"><span class="linenos"> 209</span></a>        <span class="c1"># Name of the weak form, is_exterior?</span>
</span><span id="WeakForm-210"><a href="#WeakForm-210"><span class="linenos"> 210</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="WeakForm-211"><a href="#WeakForm-211"><span class="linenos"> 211</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">_is_exterior</span> <span class="o">=</span> <span class="n">is_exterior</span>
</span><span id="WeakForm-212"><a href="#WeakForm-212"><span class="linenos"> 212</span></a>
</span><span id="WeakForm-213"><a href="#WeakForm-213"><span class="linenos"> 213</span></a>        <span class="c1"># Dimension</span>
</span><span id="WeakForm-214"><a href="#WeakForm-214"><span class="linenos"> 214</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span>
</span><span id="WeakForm-215"><a href="#WeakForm-215"><span class="linenos"> 215</span></a>
</span><span id="WeakForm-216"><a href="#WeakForm-216"><span class="linenos"> 216</span></a>        <span class="c1"># Region dictionary</span>
</span><span id="WeakForm-217"><a href="#WeakForm-217"><span class="linenos"> 217</span></a>        <span class="n">mesh</span> <span class="o">=</span> <span class="n">wf_instance</span><span class="o">.</span><span class="n">create_sfepy_internal_mesh</span><span class="p">(</span><span class="n">pre_mesh</span><span class="p">)</span>
</span><span id="WeakForm-218"><a href="#WeakForm-218"><span class="linenos"> 218</span></a>        <span class="n">domain</span> <span class="o">=</span> <span class="n">FEDomain</span><span class="p">(</span><span class="s1">&#39;domain&#39;</span><span class="p">,</span> <span class="n">mesh</span><span class="p">)</span>
</span><span id="WeakForm-219"><a href="#WeakForm-219"><span class="linenos"> 219</span></a>        <span class="k">if</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="WeakForm-220"><a href="#WeakForm-220"><span class="linenos"> 220</span></a>            <span class="n">physical_group_ids</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="WeakForm-221"><a href="#WeakForm-221"><span class="linenos"> 221</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="WeakForm-222"><a href="#WeakForm-222"><span class="linenos"> 222</span></a>            <span class="n">physical_group_ids</span> <span class="o">=</span> <span class="n">read_physical_groups_from_mesh_file</span><span class="p">(</span><span class="n">pre_mesh</span><span class="p">)</span>
</span><span id="WeakForm-223"><a href="#WeakForm-223"><span class="linenos"> 223</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">region_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="WeakForm-224"><a href="#WeakForm-224"><span class="linenos"> 224</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">fill_region_dict</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">physical_group_ids</span><span class="p">,</span>
</span><span id="WeakForm-225"><a href="#WeakForm-225"><span class="linenos"> 225</span></a>                                     <span class="n">dim_func_entities</span><span class="p">)</span>
</span><span id="WeakForm-226"><a href="#WeakForm-226"><span class="linenos"> 226</span></a>
</span><span id="WeakForm-227"><a href="#WeakForm-227"><span class="linenos"> 227</span></a>        <span class="c1"># Essential boundary conditions dictionary</span>
</span><span id="WeakForm-228"><a href="#WeakForm-228"><span class="linenos"> 228</span></a>        <span class="bp">cls</span><span class="o">.</span><span class="n">_check_pre_ebc_dict_format</span><span class="p">(</span><span class="n">pre_ebc_dict</span><span class="p">)</span>
</span><span id="WeakForm-229"><a href="#WeakForm-229"><span class="linenos"> 229</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">ebc_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="WeakForm-230"><a href="#WeakForm-230"><span class="linenos"> 230</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">fill_ebc_dict</span><span class="p">(</span><span class="n">pre_ebc_dict</span><span class="p">)</span>
</span><span id="WeakForm-231"><a href="#WeakForm-231"><span class="linenos"> 231</span></a>
</span><span id="WeakForm-232"><a href="#WeakForm-232"><span class="linenos"> 232</span></a>        <span class="c1"># FEM order</span>
</span><span id="WeakForm-233"><a href="#WeakForm-233"><span class="linenos"> 233</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">fem_order</span> <span class="o">=</span> <span class="n">fem_order</span>
</span><span id="WeakForm-234"><a href="#WeakForm-234"><span class="linenos"> 234</span></a>
</span><span id="WeakForm-235"><a href="#WeakForm-235"><span class="linenos"> 235</span></a>        <span class="c1"># Problem instances</span>
</span><span id="WeakForm-236"><a href="#WeakForm-236"><span class="linenos"> 236</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">pre_terms</span> <span class="o">=</span> <span class="n">pre_terms</span>
</span><span id="WeakForm-237"><a href="#WeakForm-237"><span class="linenos"> 237</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">_fix_pb_without_state_variable</span><span class="p">()</span>
</span><span id="WeakForm-238"><a href="#WeakForm-238"><span class="linenos"> 238</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">set_problems</span><span class="p">(</span><span class="n">pre_terms</span><span class="p">)</span>
</span><span id="WeakForm-239"><a href="#WeakForm-239"><span class="linenos"> 239</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">apply_bcs</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span>
</span><span id="WeakForm-240"><a href="#WeakForm-240"><span class="linenos"> 240</span></a>
</span><span id="WeakForm-241"><a href="#WeakForm-241"><span class="linenos"> 241</span></a>        <span class="k">return</span> <span class="n">wf_instance</span>
</span><span id="WeakForm-242"><a href="#WeakForm-242"><span class="linenos"> 242</span></a>
</span><span id="WeakForm-243"><a href="#WeakForm-243"><span class="linenos"> 243</span></a>    <span class="nd">@classmethod</span>
</span><span id="WeakForm-244"><a href="#WeakForm-244"><span class="linenos"> 244</span></a>    <span class="k">def</span> <span class="nf">from_two_weak_forms</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">wf_int</span><span class="p">:</span> <span class="n">WeakForm</span><span class="p">,</span> <span class="n">wf_ext</span><span class="p">:</span> <span class="n">WeakForm</span><span class="p">,</span>
</span><span id="WeakForm-245"><a href="#WeakForm-245"><span class="linenos"> 245</span></a>                            <span class="n">region_key_int</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">region_key_ext</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span>
</span><span id="WeakForm-246"><a href="#WeakForm-246"><span class="linenos"> 246</span></a>                            <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WeakForm</span><span class="p">:</span>
</span><span id="WeakForm-247"><a href="#WeakForm-247"><span class="linenos"> 247</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm-248"><a href="#WeakForm-248"><span class="linenos"> 248</span></a><span class="sd">        Create an instance of `WeakForm` from two existing weak forms,</span>
</span><span id="WeakForm-249"><a href="#WeakForm-249"><span class="linenos"> 249</span></a><span class="sd">        corresponding to the interior and exterior domains respectively.</span>
</span><span id="WeakForm-250"><a href="#WeakForm-250"><span class="linenos"> 250</span></a><span class="sd">        This class method is to be used when solving problems on unbounded</span>
</span><span id="WeakForm-251"><a href="#WeakForm-251"><span class="linenos"> 251</span></a><span class="sd">        domains with the inverted finite element method.</span>
</span><span id="WeakForm-252"><a href="#WeakForm-252"><span class="linenos"> 252</span></a>
</span><span id="WeakForm-253"><a href="#WeakForm-253"><span class="linenos"> 253</span></a><span class="sd">        Parameters</span>
</span><span id="WeakForm-254"><a href="#WeakForm-254"><span class="linenos"> 254</span></a><span class="sd">        ----------</span>
</span><span id="WeakForm-255"><a href="#WeakForm-255"><span class="linenos"> 255</span></a><span class="sd">        wf_int : WeakForm</span>
</span><span id="WeakForm-256"><a href="#WeakForm-256"><span class="linenos"> 256</span></a><span class="sd">            Interior weak form.</span>
</span><span id="WeakForm-257"><a href="#WeakForm-257"><span class="linenos"> 257</span></a><span class="sd">        wf_ext : WeakForm</span>
</span><span id="WeakForm-258"><a href="#WeakForm-258"><span class="linenos"> 258</span></a><span class="sd">            Exterior weak form.</span>
</span><span id="WeakForm-259"><a href="#WeakForm-259"><span class="linenos"> 259</span></a><span class="sd">        region_key_int : tuple</span>
</span><span id="WeakForm-260"><a href="#WeakForm-260"><span class="linenos"> 260</span></a><span class="sd">            Key of the connecting region in the interior domain.</span>
</span><span id="WeakForm-261"><a href="#WeakForm-261"><span class="linenos"> 261</span></a><span class="sd">        region_key_ext : tuple</span>
</span><span id="WeakForm-262"><a href="#WeakForm-262"><span class="linenos"> 262</span></a><span class="sd">            Key of the connecting region in the exterior domain.</span>
</span><span id="WeakForm-263"><a href="#WeakForm-263"><span class="linenos"> 263</span></a><span class="sd">        verbose : bool, optional</span>
</span><span id="WeakForm-264"><a href="#WeakForm-264"><span class="linenos"> 264</span></a><span class="sd">            The default is False.</span>
</span><span id="WeakForm-265"><a href="#WeakForm-265"><span class="linenos"> 265</span></a>
</span><span id="WeakForm-266"><a href="#WeakForm-266"><span class="linenos"> 266</span></a><span class="sd">        Returns</span>
</span><span id="WeakForm-267"><a href="#WeakForm-267"><span class="linenos"> 267</span></a><span class="sd">        -------</span>
</span><span id="WeakForm-268"><a href="#WeakForm-268"><span class="linenos"> 268</span></a><span class="sd">        wf_instance : WeakForm</span>
</span><span id="WeakForm-269"><a href="#WeakForm-269"><span class="linenos"> 269</span></a><span class="sd">            The created weak form.</span>
</span><span id="WeakForm-270"><a href="#WeakForm-270"><span class="linenos"> 270</span></a>
</span><span id="WeakForm-271"><a href="#WeakForm-271"><span class="linenos"> 271</span></a><span class="sd">        Notes</span>
</span><span id="WeakForm-272"><a href="#WeakForm-272"><span class="linenos"> 272</span></a><span class="sd">        -----</span>
</span><span id="WeakForm-273"><a href="#WeakForm-273"><span class="linenos"> 273</span></a><span class="sd">        The following attributes of the new WeakForm instance will be disabled</span>
</span><span id="WeakForm-274"><a href="#WeakForm-274"><span class="linenos"> 274</span></a><span class="sd">        (i.e. set to None):</span>
</span><span id="WeakForm-275"><a href="#WeakForm-275"><span class="linenos"> 275</span></a><span class="sd">        - region_dict</span>
</span><span id="WeakForm-276"><a href="#WeakForm-276"><span class="linenos"> 276</span></a><span class="sd">        - ebc_dict</span>
</span><span id="WeakForm-277"><a href="#WeakForm-277"><span class="linenos"> 277</span></a><span class="sd">        - pre_terms</span>
</span><span id="WeakForm-278"><a href="#WeakForm-278"><span class="linenos"> 278</span></a><span class="sd">        Moreover, the boundary conditions are necessarily set active, meaning</span>
</span><span id="WeakForm-279"><a href="#WeakForm-279"><span class="linenos"> 279</span></a><span class="sd">        that several methods &amp; functionalities will not work with the newly</span>
</span><span id="WeakForm-280"><a href="#WeakForm-280"><span class="linenos"> 280</span></a><span class="sd">        created weak form.</span>
</span><span id="WeakForm-281"><a href="#WeakForm-281"><span class="linenos"> 281</span></a>
</span><span id="WeakForm-282"><a href="#WeakForm-282"><span class="linenos"> 282</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WeakForm-283"><a href="#WeakForm-283"><span class="linenos"> 283</span></a>        <span class="c1"># Safety checks</span>
</span><span id="WeakForm-284"><a href="#WeakForm-284"><span class="linenos"> 284</span></a>        <span class="bp">cls</span><span class="o">.</span><span class="n">_check_args_before_merging</span><span class="p">(</span><span class="n">wf_int</span><span class="p">,</span> <span class="n">wf_ext</span><span class="p">,</span>
</span><span id="WeakForm-285"><a href="#WeakForm-285"><span class="linenos"> 285</span></a>                                       <span class="n">region_key_int</span><span class="p">,</span> <span class="n">region_key_ext</span><span class="p">)</span>
</span><span id="WeakForm-286"><a href="#WeakForm-286"><span class="linenos"> 286</span></a>        <span class="c1"># Fill basic attributes</span>
</span><span id="WeakForm-287"><a href="#WeakForm-287"><span class="linenos"> 287</span></a>        <span class="n">attr_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="WeakForm-288"><a href="#WeakForm-288"><span class="linenos"> 288</span></a>        <span class="n">attr_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;combine_</span><span class="si">{}</span><span class="s2">_&amp;_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wf_int</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">wf_ext</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="WeakForm-289"><a href="#WeakForm-289"><span class="linenos"> 289</span></a>        <span class="n">attr_dict</span><span class="p">[</span><span class="s1">&#39;dim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wf_int</span><span class="o">.</span><span class="n">dim</span>
</span><span id="WeakForm-290"><a href="#WeakForm-290"><span class="linenos"> 290</span></a>        <span class="n">attr_dict</span><span class="p">[</span><span class="s1">&#39;region_dict&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WeakForm-291"><a href="#WeakForm-291"><span class="linenos"> 291</span></a>        <span class="n">attr_dict</span><span class="p">[</span><span class="s1">&#39;ebc_dict&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WeakForm-292"><a href="#WeakForm-292"><span class="linenos"> 292</span></a>        <span class="n">attr_dict</span><span class="p">[</span><span class="s1">&#39;pre_terms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WeakForm-293"><a href="#WeakForm-293"><span class="linenos"> 293</span></a>        <span class="n">attr_dict</span><span class="p">[</span><span class="s1">&#39;fem_order&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wf_int</span><span class="o">.</span><span class="n">fem_order</span>
</span><span id="WeakForm-294"><a href="#WeakForm-294"><span class="linenos"> 294</span></a>
</span><span id="WeakForm-295"><a href="#WeakForm-295"><span class="linenos"> 295</span></a>        <span class="c1"># Preparation of LCBCs</span>
</span><span id="WeakForm-296"><a href="#WeakForm-296"><span class="linenos"> 296</span></a>        <span class="n">match_coors</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="s1">&#39;match_coors&#39;</span><span class="p">,</span> <span class="n">per</span><span class="o">.</span><span class="n">match_coors</span><span class="p">)</span>
</span><span id="WeakForm-297"><a href="#WeakForm-297"><span class="linenos"> 297</span></a>        <span class="n">connecting_regions</span> <span class="o">=</span> <span class="p">[</span><span class="n">wf_int</span><span class="o">.</span><span class="n">region_dict</span><span class="p">[</span><span class="n">region_key_int</span><span class="p">],</span>
</span><span id="WeakForm-298"><a href="#WeakForm-298"><span class="linenos"> 298</span></a>                              <span class="n">wf_ext</span><span class="o">.</span><span class="n">region_dict</span><span class="p">[</span><span class="n">region_key_ext</span><span class="p">]]</span>
</span><span id="WeakForm-299"><a href="#WeakForm-299"><span class="linenos"> 299</span></a>
</span><span id="WeakForm-300"><a href="#WeakForm-300"><span class="linenos"> 300</span></a>        <span class="c1"># Construct new Problem instance(s)</span>
</span><span id="WeakForm-301"><a href="#WeakForm-301"><span class="linenos"> 301</span></a>        <span class="k">if</span> <span class="n">wf_int</span><span class="o">.</span><span class="n">pb_mod</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="WeakForm-302"><a href="#WeakForm-302"><span class="linenos"> 302</span></a>            <span class="n">tag_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cst&#39;</span><span class="p">]</span>
</span><span id="WeakForm-303"><a href="#WeakForm-303"><span class="linenos"> 303</span></a>            <span class="n">attr_dict</span><span class="p">[</span><span class="s1">&#39;pb_mod&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WeakForm-304"><a href="#WeakForm-304"><span class="linenos"> 304</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="WeakForm-305"><a href="#WeakForm-305"><span class="linenos"> 305</span></a>            <span class="n">tag_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cst&#39;</span><span class="p">,</span> <span class="s1">&#39;mod&#39;</span><span class="p">]</span>
</span><span id="WeakForm-306"><a href="#WeakForm-306"><span class="linenos"> 306</span></a>
</span><span id="WeakForm-307"><a href="#WeakForm-307"><span class="linenos"> 307</span></a>        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tag_list</span><span class="p">:</span>
</span><span id="WeakForm-308"><a href="#WeakForm-308"><span class="linenos"> 308</span></a>            <span class="c1"># Set up ebcs &amp; names</span>
</span><span id="WeakForm-309"><a href="#WeakForm-309"><span class="linenos"> 309</span></a>            <span class="n">pb_key</span> <span class="o">=</span> <span class="s1">&#39;pb_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm-310"><a href="#WeakForm-310"><span class="linenos"> 310</span></a>            <span class="n">ebcs_int</span> <span class="o">=</span> <span class="p">[</span><span class="n">dico</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="k">for</span> <span class="n">dico</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">wf_int</span><span class="o">.</span><span class="n">ebc_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())]</span>
</span><span id="WeakForm-311"><a href="#WeakForm-311"><span class="linenos"> 311</span></a>            <span class="n">ebcs_ext</span> <span class="o">=</span> <span class="p">[</span><span class="n">dico</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="k">for</span> <span class="n">dico</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">wf_ext</span><span class="o">.</span><span class="n">ebc_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())]</span>
</span><span id="WeakForm-312"><a href="#WeakForm-312"><span class="linenos"> 312</span></a>            <span class="n">ebcs_new</span> <span class="o">=</span> <span class="n">Conditions</span><span class="p">(</span><span class="n">ebcs_int</span> <span class="o">+</span> <span class="n">ebcs_ext</span><span class="p">)</span>
</span><span id="WeakForm-313"><a href="#WeakForm-313"><span class="linenos"> 313</span></a>            <span class="n">u_int_name</span> <span class="o">=</span> <span class="n">wf_int</span><span class="o">.</span><span class="n">get_unknown_name</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm-314"><a href="#WeakForm-314"><span class="linenos"> 314</span></a>            <span class="n">u_ext_name</span> <span class="o">=</span> <span class="n">wf_ext</span><span class="o">.</span><span class="n">get_unknown_name</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm-315"><a href="#WeakForm-315"><span class="linenos"> 315</span></a>
</span><span id="WeakForm-316"><a href="#WeakForm-316"><span class="linenos"> 316</span></a>            <span class="c1"># Linear Combination Boundary Conditions</span>
</span><span id="WeakForm-317"><a href="#WeakForm-317"><span class="linenos"> 317</span></a>            <span class="n">lcbc</span> <span class="o">=</span> <span class="n">LinearCombinationBC</span><span class="p">(</span>
</span><span id="WeakForm-318"><a href="#WeakForm-318"><span class="linenos"> 318</span></a>                <span class="s1">&#39;lc_cst&#39;</span><span class="p">,</span> <span class="n">connecting_regions</span><span class="p">,</span>
</span><span id="WeakForm-319"><a href="#WeakForm-319"><span class="linenos"> 319</span></a>                <span class="p">{</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.all&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">u_int_name</span><span class="p">)</span> <span class="p">:</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.all&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">u_ext_name</span><span class="p">)},</span>
</span><span id="WeakForm-320"><a href="#WeakForm-320"><span class="linenos"> 320</span></a>                <span class="n">match_coors</span><span class="p">,</span> <span class="s1">&#39;match_dofs&#39;</span><span class="p">)</span>
</span><span id="WeakForm-321"><a href="#WeakForm-321"><span class="linenos"> 321</span></a>            <span class="n">lcbcs</span> <span class="o">=</span> <span class="n">Conditions</span><span class="p">([</span><span class="n">lcbc</span><span class="p">])</span>
</span><span id="WeakForm-322"><a href="#WeakForm-322"><span class="linenos"> 322</span></a>
</span><span id="WeakForm-323"><a href="#WeakForm-323"><span class="linenos"> 323</span></a>            <span class="c1"># Create new Problem instance</span>
</span><span id="WeakForm-324"><a href="#WeakForm-324"><span class="linenos"> 324</span></a>            <span class="n">eqs</span> <span class="o">=</span> <span class="n">_EquationsFix</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">wf_int</span><span class="p">,</span> <span class="n">pb_key</span><span class="p">)</span><span class="o">.</span><span class="n">equations</span><span class="o">.</span><span class="n">_objs</span> <span class="o">+</span>
</span><span id="WeakForm-325"><a href="#WeakForm-325"><span class="linenos"> 325</span></a>                                <span class="nb">getattr</span><span class="p">(</span><span class="n">wf_ext</span><span class="p">,</span> <span class="n">pb_key</span><span class="p">)</span><span class="o">.</span><span class="n">equations</span><span class="o">.</span><span class="n">_objs</span><span class="p">)</span>
</span><span id="WeakForm-326"><a href="#WeakForm-326"><span class="linenos"> 326</span></a>            <span class="n">pb_new</span> <span class="o">=</span> <span class="n">Problem</span><span class="p">(</span><span class="n">pb_key</span><span class="p">,</span> <span class="n">equations</span><span class="o">=</span><span class="n">eqs</span><span class="p">,</span> <span class="n">active_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="WeakForm-327"><a href="#WeakForm-327"><span class="linenos"> 327</span></a>            <span class="n">pb_new</span><span class="o">.</span><span class="n">set_bcs</span><span class="p">(</span><span class="n">ebcs</span><span class="o">=</span><span class="n">ebcs_new</span><span class="p">,</span> <span class="n">lcbcs</span><span class="o">=</span><span class="n">lcbcs</span><span class="p">)</span>
</span><span id="WeakForm-328"><a href="#WeakForm-328"><span class="linenos"> 328</span></a>
</span><span id="WeakForm-329"><a href="#WeakForm-329"><span class="linenos"> 329</span></a>            <span class="c1"># Apply ebc to variables</span>
</span><span id="WeakForm-330"><a href="#WeakForm-330"><span class="linenos"> 330</span></a>            <span class="n">variables</span> <span class="o">=</span> <span class="n">pb_new</span><span class="o">.</span><span class="n">get_initial_state</span><span class="p">()</span>
</span><span id="WeakForm-331"><a href="#WeakForm-331"><span class="linenos"> 331</span></a>            <span class="n">pb_new</span><span class="o">.</span><span class="n">time_update</span><span class="p">()</span>
</span><span id="WeakForm-332"><a href="#WeakForm-332"><span class="linenos"> 332</span></a>            <span class="n">variables</span><span class="o">.</span><span class="n">apply_ebc</span><span class="p">()</span>
</span><span id="WeakForm-333"><a href="#WeakForm-333"><span class="linenos"> 333</span></a>            <span class="n">attr_dict</span><span class="p">[</span><span class="n">pb_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">pb_new</span>
</span><span id="WeakForm-334"><a href="#WeakForm-334"><span class="linenos"> 334</span></a>
</span><span id="WeakForm-335"><a href="#WeakForm-335"><span class="linenos"> 335</span></a>        <span class="c1"># Create WeakForm instance from &#39;attr_dict&#39; and mark bcs as active</span>
</span><span id="WeakForm-336"><a href="#WeakForm-336"><span class="linenos"> 336</span></a>        <span class="n">wf_instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_attr_dict</span><span class="p">(</span><span class="n">attr_dict</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</span><span id="WeakForm-337"><a href="#WeakForm-337"><span class="linenos"> 337</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">_active_bcs</span><span class="p">[</span><span class="s1">&#39;cst&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="WeakForm-338"><a href="#WeakForm-338"><span class="linenos"> 338</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">_active_bcs</span><span class="p">[</span><span class="s1">&#39;mod&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="WeakForm-339"><a href="#WeakForm-339"><span class="linenos"> 339</span></a>
</span><span id="WeakForm-340"><a href="#WeakForm-340"><span class="linenos"> 340</span></a>        <span class="k">return</span> <span class="n">wf_instance</span>
</span><span id="WeakForm-341"><a href="#WeakForm-341"><span class="linenos"> 341</span></a>
</span><span id="WeakForm-342"><a href="#WeakForm-342"><span class="linenos"> 342</span></a>    <span class="k">def</span> <span class="nf">set_problems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pre_terms</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PreTerm</span><span class="p">]):</span>
</span><span id="WeakForm-343"><a href="#WeakForm-343"><span class="linenos"> 343</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm-344"><a href="#WeakForm-344"><span class="linenos"> 344</span></a><span class="sd">        Create Problem instance(s) and set corresponding attribute(s). As a</span>
</span><span id="WeakForm-345"><a href="#WeakForm-345"><span class="linenos"> 345</span></a><span class="sd">        side effect, the `term` attribute of each `PreTerm` instance is set.</span>
</span><span id="WeakForm-346"><a href="#WeakForm-346"><span class="linenos"> 346</span></a>
</span><span id="WeakForm-347"><a href="#WeakForm-347"><span class="linenos"> 347</span></a><span class="sd">        Parameters</span>
</span><span id="WeakForm-348"><a href="#WeakForm-348"><span class="linenos"> 348</span></a><span class="sd">        ----------</span>
</span><span id="WeakForm-349"><a href="#WeakForm-349"><span class="linenos"> 349</span></a><span class="sd">        pre_terms : list[PreTerm]</span>
</span><span id="WeakForm-350"><a href="#WeakForm-350"><span class="linenos"> 350</span></a><span class="sd">            List of `PreTerm` instances</span>
</span><span id="WeakForm-351"><a href="#WeakForm-351"><span class="linenos"> 351</span></a>
</span><span id="WeakForm-352"><a href="#WeakForm-352"><span class="linenos"> 352</span></a><span class="sd">        Notes</span>
</span><span id="WeakForm-353"><a href="#WeakForm-353"><span class="linenos"> 353</span></a><span class="sd">        -----</span>
</span><span id="WeakForm-354"><a href="#WeakForm-354"><span class="linenos"> 354</span></a><span class="sd">        If none of the `PreTerm` instances has tag &#39;mod&#39;, `pb_mod` attribute is</span>
</span><span id="WeakForm-355"><a href="#WeakForm-355"><span class="linenos"> 355</span></a><span class="sd">        left to None.</span>
</span><span id="WeakForm-356"><a href="#WeakForm-356"><span class="linenos"> 356</span></a><span class="sd">        Some parameters are hardcoded in this process, e.g.</span>
</span><span id="WeakForm-357"><a href="#WeakForm-357"><span class="linenos"> 357</span></a><span class="sd">            test function space = &#39;H1&#39;</span>
</span><span id="WeakForm-358"><a href="#WeakForm-358"><span class="linenos"> 358</span></a><span class="sd">            basis of the FE space = &#39;lagrange&#39;</span>
</span><span id="WeakForm-359"><a href="#WeakForm-359"><span class="linenos"> 359</span></a><span class="sd">            order of the polynomials to integrate = 2*fem_order + 1</span>
</span><span id="WeakForm-360"><a href="#WeakForm-360"><span class="linenos"> 360</span></a>
</span><span id="WeakForm-361"><a href="#WeakForm-361"><span class="linenos"> 361</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WeakForm-362"><a href="#WeakForm-362"><span class="linenos"> 362</span></a>
</span><span id="WeakForm-363"><a href="#WeakForm-363"><span class="linenos"> 363</span></a>        <span class="n">has_nonlinear_term</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_nonlinear_term</span><span class="p">(</span><span class="n">pre_terms</span><span class="p">)</span>
</span><span id="WeakForm-364"><a href="#WeakForm-364"><span class="linenos"> 364</span></a>
</span><span id="WeakForm-365"><a href="#WeakForm-365"><span class="linenos"> 365</span></a>        <span class="c1"># Define field and variables</span>
</span><span id="WeakForm-366"><a href="#WeakForm-366"><span class="linenos"> 366</span></a>        <span class="n">field_name</span> <span class="o">=</span> <span class="s2">&quot;field_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="WeakForm-367"><a href="#WeakForm-367"><span class="linenos"> 367</span></a>        <span class="n">field</span> <span class="o">=</span> <span class="n">Field</span><span class="o">.</span><span class="n">from_args</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="s1">&#39;scalar&#39;</span><span class="p">,</span>
</span><span id="WeakForm-368"><a href="#WeakForm-368"><span class="linenos"> 368</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span><span class="p">[(</span><span class="s1">&#39;omega&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)],</span>
</span><span id="WeakForm-369"><a href="#WeakForm-369"><span class="linenos"> 369</span></a>                                <span class="n">approx_order</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fem_order</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="s1">&#39;H1&#39;</span><span class="p">,</span>
</span><span id="WeakForm-370"><a href="#WeakForm-370"><span class="linenos"> 370</span></a>                                <span class="n">poly_space_base</span><span class="o">=</span><span class="s1">&#39;lagrange&#39;</span><span class="p">)</span>
</span><span id="WeakForm-371"><a href="#WeakForm-371"><span class="linenos"> 371</span></a>
</span><span id="WeakForm-372"><a href="#WeakForm-372"><span class="linenos"> 372</span></a>        <span class="n">u_cst</span> <span class="o">=</span> <span class="n">FieldVariable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_unknown_name</span><span class="p">(</span><span class="s1">&#39;cst&#39;</span><span class="p">),</span> <span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
</span><span id="WeakForm-373"><a href="#WeakForm-373"><span class="linenos"> 373</span></a>        <span class="n">v_cst</span> <span class="o">=</span> <span class="n">FieldVariable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_test_name</span><span class="p">(</span><span class="s1">&#39;cst&#39;</span><span class="p">),</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span>
</span><span id="WeakForm-374"><a href="#WeakForm-374"><span class="linenos"> 374</span></a>                              <span class="n">primary_var_name</span><span class="o">=</span><span class="n">u_cst</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="WeakForm-375"><a href="#WeakForm-375"><span class="linenos"> 375</span></a>        <span class="n">u_mod</span> <span class="o">=</span> <span class="n">FieldVariable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_unknown_name</span><span class="p">(</span><span class="s1">&#39;mod&#39;</span><span class="p">),</span> <span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
</span><span id="WeakForm-376"><a href="#WeakForm-376"><span class="linenos"> 376</span></a>        <span class="n">v_mod</span> <span class="o">=</span> <span class="n">FieldVariable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_test_name</span><span class="p">(</span><span class="s1">&#39;mod&#39;</span><span class="p">),</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span>
</span><span id="WeakForm-377"><a href="#WeakForm-377"><span class="linenos"> 377</span></a>                              <span class="n">primary_var_name</span><span class="o">=</span><span class="n">u_mod</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="WeakForm-378"><a href="#WeakForm-378"><span class="linenos"> 378</span></a>
</span><span id="WeakForm-379"><a href="#WeakForm-379"><span class="linenos"> 379</span></a>        <span class="c1"># Define integral</span>
</span><span id="WeakForm-380"><a href="#WeakForm-380"><span class="linenos"> 380</span></a>        <span class="n">integral</span> <span class="o">=</span> <span class="n">Integral</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fem_order</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="WeakForm-381"><a href="#WeakForm-381"><span class="linenos"> 381</span></a>
</span><span id="WeakForm-382"><a href="#WeakForm-382"><span class="linenos"> 382</span></a>        <span class="c1"># Construct terms from the list of pre_term</span>
</span><span id="WeakForm-383"><a href="#WeakForm-383"><span class="linenos"> 383</span></a>        <span class="n">terms_cst</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="WeakForm-384"><a href="#WeakForm-384"><span class="linenos"> 384</span></a>        <span class="n">terms_mod</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="WeakForm-385"><a href="#WeakForm-385"><span class="linenos"> 385</span></a>        <span class="k">for</span> <span class="n">pre_term</span> <span class="ow">in</span> <span class="n">pre_terms</span><span class="p">:</span>
</span><span id="WeakForm-386"><a href="#WeakForm-386"><span class="linenos"> 386</span></a>            <span class="k">if</span> <span class="n">pre_term</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;cst&#39;</span><span class="p">:</span>
</span><span id="WeakForm-387"><a href="#WeakForm-387"><span class="linenos"> 387</span></a>                <span class="n">pre_term</span><span class="o">.</span><span class="n">set_term</span><span class="p">(</span><span class="n">integral</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">u_cst</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="n">v_cst</span><span class="p">)</span>
</span><span id="WeakForm-388"><a href="#WeakForm-388"><span class="linenos"> 388</span></a>                <span class="n">terms_cst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pre_term</span><span class="o">.</span><span class="n">term</span><span class="p">)</span>
</span><span id="WeakForm-389"><a href="#WeakForm-389"><span class="linenos"> 389</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="WeakForm-390"><a href="#WeakForm-390"><span class="linenos"> 390</span></a>                <span class="n">pre_term</span><span class="o">.</span><span class="n">set_term</span><span class="p">(</span><span class="n">integral</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">u_mod</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="n">v_mod</span><span class="p">)</span>
</span><span id="WeakForm-391"><a href="#WeakForm-391"><span class="linenos"> 391</span></a>                <span class="n">terms_mod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pre_term</span><span class="o">.</span><span class="n">term</span><span class="p">)</span>
</span><span id="WeakForm-392"><a href="#WeakForm-392"><span class="linenos"> 392</span></a>        <span class="n">terms_cst</span> <span class="o">=</span> <span class="n">Terms</span><span class="p">(</span><span class="n">terms_cst</span><span class="p">)</span>
</span><span id="WeakForm-393"><a href="#WeakForm-393"><span class="linenos"> 393</span></a>        <span class="n">terms_mod</span> <span class="o">=</span> <span class="n">Terms</span><span class="p">(</span><span class="n">terms_mod</span><span class="p">)</span>
</span><span id="WeakForm-394"><a href="#WeakForm-394"><span class="linenos"> 394</span></a>
</span><span id="WeakForm-395"><a href="#WeakForm-395"><span class="linenos"> 395</span></a>        <span class="c1"># Define equations</span>
</span><span id="WeakForm-396"><a href="#WeakForm-396"><span class="linenos"> 396</span></a>        <span class="n">eq_cst_name</span> <span class="o">=</span> <span class="s2">&quot;eq_</span><span class="si">{}</span><span class="s2">_cst&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="WeakForm-397"><a href="#WeakForm-397"><span class="linenos"> 397</span></a>        <span class="n">eq_cst</span> <span class="o">=</span> <span class="n">Equation</span><span class="p">(</span><span class="n">eq_cst_name</span><span class="p">,</span> <span class="n">terms_cst</span><span class="p">)</span>
</span><span id="WeakForm-398"><a href="#WeakForm-398"><span class="linenos"> 398</span></a>        <span class="n">eq_mod_name</span> <span class="o">=</span> <span class="s2">&quot;eq_</span><span class="si">{}</span><span class="s2">_mod&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="WeakForm-399"><a href="#WeakForm-399"><span class="linenos"> 399</span></a>        <span class="n">eq_mod</span> <span class="o">=</span> <span class="n">Equation</span><span class="p">(</span><span class="n">eq_mod_name</span><span class="p">,</span> <span class="n">terms_mod</span><span class="p">)</span>
</span><span id="WeakForm-400"><a href="#WeakForm-400"><span class="linenos"> 400</span></a>
</span><span id="WeakForm-401"><a href="#WeakForm-401"><span class="linenos"> 401</span></a>        <span class="c1"># Set problem(s)</span>
</span><span id="WeakForm-402"><a href="#WeakForm-402"><span class="linenos"> 402</span></a>        <span class="n">pb_cst_name</span> <span class="o">=</span> <span class="s2">&quot;pb_</span><span class="si">{}</span><span class="s2">_cst&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="WeakForm-403"><a href="#WeakForm-403"><span class="linenos"> 403</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pb_cst</span> <span class="o">=</span> <span class="n">Problem</span><span class="p">(</span>
</span><span id="WeakForm-404"><a href="#WeakForm-404"><span class="linenos"> 404</span></a>            <span class="n">pb_cst_name</span><span class="p">,</span> <span class="n">equations</span><span class="o">=</span><span class="n">Equations</span><span class="p">([</span><span class="n">eq_cst</span><span class="p">]),</span> <span class="n">active_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="WeakForm-405"><a href="#WeakForm-405"><span class="linenos"> 405</span></a>        <span class="k">if</span> <span class="n">has_nonlinear_term</span><span class="p">:</span>
</span><span id="WeakForm-406"><a href="#WeakForm-406"><span class="linenos"> 406</span></a>            <span class="n">pb_mod_name</span> <span class="o">=</span> <span class="s2">&quot;pb_</span><span class="si">{}</span><span class="s2">_mod&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="WeakForm-407"><a href="#WeakForm-407"><span class="linenos"> 407</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pb_mod</span> <span class="o">=</span> <span class="n">Problem</span><span class="p">(</span>
</span><span id="WeakForm-408"><a href="#WeakForm-408"><span class="linenos"> 408</span></a>                <span class="n">pb_mod_name</span><span class="p">,</span> <span class="n">equations</span><span class="o">=</span><span class="n">Equations</span><span class="p">([</span><span class="n">eq_mod</span><span class="p">]),</span> <span class="n">active_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="WeakForm-409"><a href="#WeakForm-409"><span class="linenos"> 409</span></a>
</span><span id="WeakForm-410"><a href="#WeakForm-410"><span class="linenos"> 410</span></a>        <span class="c1"># Evaluate materials in physical quadrature points for the first time</span>
</span><span id="WeakForm-411"><a href="#WeakForm-411"><span class="linenos"> 411</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_materials</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s1">&#39;cst&#39;</span><span class="p">)</span>
</span><span id="WeakForm-412"><a href="#WeakForm-412"><span class="linenos"> 412</span></a>
</span><span id="WeakForm-413"><a href="#WeakForm-413"><span class="linenos"> 413</span></a>    <span class="nd">@Decorators</span><span class="o">.</span><span class="n">check_lcbcs</span>
</span><span id="WeakForm-414"><a href="#WeakForm-414"><span class="linenos"> 414</span></a>    <span class="k">def</span> <span class="nf">apply_bcs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">):</span>
</span><span id="WeakForm-415"><a href="#WeakForm-415"><span class="linenos"> 415</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm-416"><a href="#WeakForm-416"><span class="linenos"> 416</span></a><span class="sd">        Apply boundary conditions to the weak form `Problem` instance(s).</span>
</span><span id="WeakForm-417"><a href="#WeakForm-417"><span class="linenos"> 417</span></a><span class="sd">        The &#39;tag&#39; argument is used to select either `pb_cst` or `pb_mod`. Use</span>
</span><span id="WeakForm-418"><a href="#WeakForm-418"><span class="linenos"> 418</span></a><span class="sd">        &#39;tag&#39;=&#39;both&#39; to select both (default behavior).</span>
</span><span id="WeakForm-419"><a href="#WeakForm-419"><span class="linenos"> 419</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WeakForm-420"><a href="#WeakForm-420"><span class="linenos"> 420</span></a>
</span><span id="WeakForm-421"><a href="#WeakForm-421"><span class="linenos"> 421</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_pb_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>  <span class="c1"># Safety checks</span>
</span><span id="WeakForm-422"><a href="#WeakForm-422"><span class="linenos"> 422</span></a>        <span class="n">tag_list</span><span class="p">,</span> <span class="n">pb_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_tag_pb_lists</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm-423"><a href="#WeakForm-423"><span class="linenos"> 423</span></a>
</span><span id="WeakForm-424"><a href="#WeakForm-424"><span class="linenos"> 424</span></a>        <span class="c1"># Setting up bcs following Sfepy&#39;s API</span>
</span><span id="WeakForm-425"><a href="#WeakForm-425"><span class="linenos"> 425</span></a>        <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">pb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tag_list</span><span class="p">,</span> <span class="n">pb_list</span><span class="p">):</span>
</span><span id="WeakForm-426"><a href="#WeakForm-426"><span class="linenos"> 426</span></a>            <span class="n">ebcs</span> <span class="o">=</span> <span class="n">Conditions</span><span class="p">(</span>
</span><span id="WeakForm-427"><a href="#WeakForm-427"><span class="linenos"> 427</span></a>                <span class="p">[</span><span class="n">pair_ebc</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="k">for</span> <span class="n">pair_ebc</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ebc_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())])</span>
</span><span id="WeakForm-428"><a href="#WeakForm-428"><span class="linenos"> 428</span></a>            <span class="n">pb</span><span class="o">.</span><span class="n">set_bcs</span><span class="p">(</span><span class="n">ebcs</span><span class="o">=</span><span class="n">ebcs</span><span class="p">)</span>
</span><span id="WeakForm-429"><a href="#WeakForm-429"><span class="linenos"> 429</span></a>            <span class="n">variables</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">get_initial_state</span><span class="p">()</span>
</span><span id="WeakForm-430"><a href="#WeakForm-430"><span class="linenos"> 430</span></a>            <span class="n">pb</span><span class="o">.</span><span class="n">time_update</span><span class="p">()</span>
</span><span id="WeakForm-431"><a href="#WeakForm-431"><span class="linenos"> 431</span></a>            <span class="n">variables</span><span class="o">.</span><span class="n">apply_ebc</span><span class="p">()</span>
</span><span id="WeakForm-432"><a href="#WeakForm-432"><span class="linenos"> 432</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_active_bcs</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># update dictionary of active bcs</span>
</span><span id="WeakForm-433"><a href="#WeakForm-433"><span class="linenos"> 433</span></a>
</span><span id="WeakForm-434"><a href="#WeakForm-434"><span class="linenos"> 434</span></a>    <span class="nd">@Decorators</span><span class="o">.</span><span class="n">check_lcbcs</span>
</span><span id="WeakForm-435"><a href="#WeakForm-435"><span class="linenos"> 435</span></a>    <span class="k">def</span> <span class="nf">remove_bcs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">):</span>
</span><span id="WeakForm-436"><a href="#WeakForm-436"><span class="linenos"> 436</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm-437"><a href="#WeakForm-437"><span class="linenos"> 437</span></a><span class="sd">        Remove boundary conditions to the weak form `Problem` instance(s).</span>
</span><span id="WeakForm-438"><a href="#WeakForm-438"><span class="linenos"> 438</span></a><span class="sd">        The &#39;tag&#39; argument is used to select either `pb_cst` or `pb_mod`. Use</span>
</span><span id="WeakForm-439"><a href="#WeakForm-439"><span class="linenos"> 439</span></a><span class="sd">        &#39;tag&#39;=&#39;both&#39; to select both (default behavior).</span>
</span><span id="WeakForm-440"><a href="#WeakForm-440"><span class="linenos"> 440</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WeakForm-441"><a href="#WeakForm-441"><span class="linenos"> 441</span></a>
</span><span id="WeakForm-442"><a href="#WeakForm-442"><span class="linenos"> 442</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_pb_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>  <span class="c1"># Safety checks</span>
</span><span id="WeakForm-443"><a href="#WeakForm-443"><span class="linenos"> 443</span></a>        <span class="n">tag_list</span><span class="p">,</span> <span class="n">pb_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_tag_pb_lists</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm-444"><a href="#WeakForm-444"><span class="linenos"> 444</span></a>
</span><span id="WeakForm-445"><a href="#WeakForm-445"><span class="linenos"> 445</span></a>        <span class="c1"># Removing bcs following Sfepy&#39;s API</span>
</span><span id="WeakForm-446"><a href="#WeakForm-446"><span class="linenos"> 446</span></a>        <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">pb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;cst&#39;</span><span class="p">,</span> <span class="s1">&#39;mod&#39;</span><span class="p">],</span> <span class="n">pb_list</span><span class="p">):</span>
</span><span id="WeakForm-447"><a href="#WeakForm-447"><span class="linenos"> 447</span></a>            <span class="n">pb</span><span class="o">.</span><span class="n">remove_bcs</span><span class="p">()</span>
</span><span id="WeakForm-448"><a href="#WeakForm-448"><span class="linenos"> 448</span></a>            <span class="n">pb</span><span class="o">.</span><span class="n">get_initial_state</span><span class="p">()</span>
</span><span id="WeakForm-449"><a href="#WeakForm-449"><span class="linenos"> 449</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_active_bcs</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># update dictionary of active bcs</span>
</span><span id="WeakForm-450"><a href="#WeakForm-450"><span class="linenos"> 450</span></a>
</span><span id="WeakForm-451"><a href="#WeakForm-451"><span class="linenos"> 451</span></a>    <span class="k">def</span> <span class="nf">update_materials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="WeakForm-452"><a href="#WeakForm-452"><span class="linenos"> 452</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm-453"><a href="#WeakForm-453"><span class="linenos"> 453</span></a><span class="sd">        Wrapper for `update_materials` from Sfepy `Problem` class.</span>
</span><span id="WeakForm-454"><a href="#WeakForm-454"><span class="linenos"> 454</span></a>
</span><span id="WeakForm-455"><a href="#WeakForm-455"><span class="linenos"> 455</span></a><span class="sd">        Parameters</span>
</span><span id="WeakForm-456"><a href="#WeakForm-456"><span class="linenos"> 456</span></a><span class="sd">        ----------</span>
</span><span id="WeakForm-457"><a href="#WeakForm-457"><span class="linenos"> 457</span></a><span class="sd">        tag : str</span>
</span><span id="WeakForm-458"><a href="#WeakForm-458"><span class="linenos"> 458</span></a><span class="sd">            &#39;cst&#39;, &#39;mod&#39; or &#39;both&#39;</span>
</span><span id="WeakForm-459"><a href="#WeakForm-459"><span class="linenos"> 459</span></a><span class="sd">        force : bool</span>
</span><span id="WeakForm-460"><a href="#WeakForm-460"><span class="linenos"> 460</span></a><span class="sd">            If True, set materials data to None before calling</span>
</span><span id="WeakForm-461"><a href="#WeakForm-461"><span class="linenos"> 461</span></a><span class="sd">            `pb.update_materials`, which has the same effect as setting</span>
</span><span id="WeakForm-462"><a href="#WeakForm-462"><span class="linenos"> 462</span></a><span class="sd">            &#39;mode=force&#39; in `Material.time_update` method.</span>
</span><span id="WeakForm-463"><a href="#WeakForm-463"><span class="linenos"> 463</span></a>
</span><span id="WeakForm-464"><a href="#WeakForm-464"><span class="linenos"> 464</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WeakForm-465"><a href="#WeakForm-465"><span class="linenos"> 465</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_pb_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm-466"><a href="#WeakForm-466"><span class="linenos"> 466</span></a>        <span class="n">tag_list</span><span class="p">,</span> <span class="n">pb_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_tag_pb_lists</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm-467"><a href="#WeakForm-467"><span class="linenos"> 467</span></a>        <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">pb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tag_list</span><span class="p">,</span> <span class="n">pb_list</span><span class="p">):</span>
</span><span id="WeakForm-468"><a href="#WeakForm-468"><span class="linenos"> 468</span></a>            <span class="k">if</span> <span class="n">force</span><span class="p">:</span>
</span><span id="WeakForm-469"><a href="#WeakForm-469"><span class="linenos"> 469</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_deplete_mat_datas</span><span class="p">(</span><span class="n">pb</span><span class="p">)</span>
</span><span id="WeakForm-470"><a href="#WeakForm-470"><span class="linenos"> 470</span></a>            <span class="n">pb</span><span class="o">.</span><span class="n">update_materials</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="WeakForm-471"><a href="#WeakForm-471"><span class="linenos"> 471</span></a>
</span><span id="WeakForm-472"><a href="#WeakForm-472"><span class="linenos"> 472</span></a>    <span class="k">def</span> <span class="nf">make_full_vec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reduced_vec</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="WeakForm-473"><a href="#WeakForm-473"><span class="linenos"> 473</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm-474"><a href="#WeakForm-474"><span class="linenos"> 474</span></a><span class="sd">        Reconstruct a full DOF vector satisfying E(P)BCs from a reduced DOF</span>
</span><span id="WeakForm-475"><a href="#WeakForm-475"><span class="linenos"> 475</span></a><span class="sd">        vector.</span>
</span><span id="WeakForm-476"><a href="#WeakForm-476"><span class="linenos"> 476</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WeakForm-477"><a href="#WeakForm-477"><span class="linenos"> 477</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_bcs</span><span class="p">[</span><span class="s1">&#39;cst&#39;</span><span class="p">]:</span>
</span><span id="WeakForm-478"><a href="#WeakForm-478"><span class="linenos"> 478</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">apply_bcs</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s1">&#39;cst&#39;</span><span class="p">)</span>
</span><span id="WeakForm-479"><a href="#WeakForm-479"><span class="linenos"> 479</span></a>        <span class="n">variables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pb_cst</span><span class="o">.</span><span class="n">get_variables</span><span class="p">()</span>
</span><span id="WeakForm-480"><a href="#WeakForm-480"><span class="linenos"> 480</span></a>        <span class="n">full_vec</span> <span class="o">=</span> <span class="n">variables</span><span class="o">.</span><span class="n">make_full_vec</span><span class="p">(</span><span class="n">reduced_vec</span><span class="p">)</span>
</span><span id="WeakForm-481"><a href="#WeakForm-481"><span class="linenos"> 481</span></a>        <span class="k">return</span> <span class="n">full_vec</span>
</span><span id="WeakForm-482"><a href="#WeakForm-482"><span class="linenos"> 482</span></a>
</span><span id="WeakForm-483"><a href="#WeakForm-483"><span class="linenos"> 483</span></a>    <span class="k">def</span> <span class="nf">make_reduced_vec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">full_vec</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="WeakForm-484"><a href="#WeakForm-484"><span class="linenos"> 484</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm-485"><a href="#WeakForm-485"><span class="linenos"> 485</span></a><span class="sd">        Get the reduced DOF vector (with EBC DOFs removed) from a full vector.</span>
</span><span id="WeakForm-486"><a href="#WeakForm-486"><span class="linenos"> 486</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WeakForm-487"><a href="#WeakForm-487"><span class="linenos"> 487</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_bcs</span><span class="p">[</span><span class="s1">&#39;cst&#39;</span><span class="p">]:</span>
</span><span id="WeakForm-488"><a href="#WeakForm-488"><span class="linenos"> 488</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">apply_bcs</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s1">&#39;cst&#39;</span><span class="p">)</span>
</span><span id="WeakForm-489"><a href="#WeakForm-489"><span class="linenos"> 489</span></a>        <span class="n">variables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pb_cst</span><span class="o">.</span><span class="n">get_variables</span><span class="p">()</span>
</span><span id="WeakForm-490"><a href="#WeakForm-490"><span class="linenos"> 490</span></a>        <span class="n">reduced_vec</span> <span class="o">=</span> <span class="n">variables</span><span class="o">.</span><span class="n">reduce_vec</span><span class="p">(</span><span class="n">full_vec</span><span class="p">)</span>
</span><span id="WeakForm-491"><a href="#WeakForm-491"><span class="linenos"> 491</span></a>        <span class="k">return</span> <span class="n">reduced_vec</span>
</span><span id="WeakForm-492"><a href="#WeakForm-492"><span class="linenos"> 492</span></a>
</span><span id="WeakForm-493"><a href="#WeakForm-493"><span class="linenos"> 493</span></a>    <span class="nd">@Decorators</span><span class="o">.</span><span class="n">check_lcbcs</span>
</span><span id="WeakForm-494"><a href="#WeakForm-494"><span class="linenos"> 494</span></a>    <span class="k">def</span> <span class="nf">set_mtx_vec_no_bc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">):</span>
</span><span id="WeakForm-495"><a href="#WeakForm-495"><span class="linenos"> 495</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm-496"><a href="#WeakForm-496"><span class="linenos"> 496</span></a><span class="sd">        Set the &#39;no_bc&#39; attributes of &#39;mtx_vec&#39; (which is an instance of the</span>
</span><span id="WeakForm-497"><a href="#WeakForm-497"><span class="linenos"> 497</span></a><span class="sd">        `MatrixVector` class). &#39;tag&#39; must be either &#39;cst&#39;, &#39;mod&#39; or &#39;both&#39;.</span>
</span><span id="WeakForm-498"><a href="#WeakForm-498"><span class="linenos"> 498</span></a>
</span><span id="WeakForm-499"><a href="#WeakForm-499"><span class="linenos"> 499</span></a><span class="sd">        todo: handle the case &#39;mod&#39; terms are only vectors.</span>
</span><span id="WeakForm-500"><a href="#WeakForm-500"><span class="linenos"> 500</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WeakForm-501"><a href="#WeakForm-501"><span class="linenos"> 501</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_pb_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm-502"><a href="#WeakForm-502"><span class="linenos"> 502</span></a>        <span class="n">tag_list</span><span class="p">,</span> <span class="n">pb_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_tag_pb_lists</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm-503"><a href="#WeakForm-503"><span class="linenos"> 503</span></a>        <span class="n">mtx_vec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtx_vec</span>
</span><span id="WeakForm-504"><a href="#WeakForm-504"><span class="linenos"> 504</span></a>        <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">pb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tag_list</span><span class="p">,</span> <span class="n">pb_list</span><span class="p">):</span>
</span><span id="WeakForm-505"><a href="#WeakForm-505"><span class="linenos"> 505</span></a>            <span class="n">key_mtx</span> <span class="o">=</span> <span class="s1">&#39;mtx_no_bc_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm-506"><a href="#WeakForm-506"><span class="linenos"> 506</span></a>            <span class="n">key_vec</span> <span class="o">=</span> <span class="s1">&#39;vec_no_bc_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm-507"><a href="#WeakForm-507"><span class="linenos"> 507</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mtx_vec</span><span class="p">,</span> <span class="n">key_mtx</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mtx_vec</span><span class="p">,</span> <span class="n">key_vec</span><span class="p">):</span>
</span><span id="WeakForm-508"><a href="#WeakForm-508"><span class="linenos"> 508</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="WeakForm-509"><a href="#WeakForm-509"><span class="linenos"> 509</span></a>                    <span class="sa">f</span><span class="s2">&quot;&#39;mtx_vec&#39; does not have attr. (</span><span class="si">{</span><span class="n">key_mtx</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">key_vec</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="WeakForm-510"><a href="#WeakForm-510"><span class="linenos"> 510</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_bcs</span><span class="p">[</span><span class="n">tag</span><span class="p">]:</span>
</span><span id="WeakForm-511"><a href="#WeakForm-511"><span class="linenos"> 511</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">remove_bcs</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm-512"><a href="#WeakForm-512"><span class="linenos"> 512</span></a>            <span class="n">ev</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">get_evaluator</span><span class="p">()</span>
</span><span id="WeakForm-513"><a href="#WeakForm-513"><span class="linenos"> 513</span></a>            <span class="n">vec_r</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">get_variables</span><span class="p">()</span><span class="o">.</span><span class="n">get_state</span><span class="p">(</span><span class="n">reduced</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="WeakForm-514"><a href="#WeakForm-514"><span class="linenos"> 514</span></a>            <span class="n">mtx</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="n">eval_tangent_matrix</span><span class="p">(</span><span class="n">vec_r</span><span class="p">,</span> <span class="n">mtx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_full</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="WeakForm-515"><a href="#WeakForm-515"><span class="linenos"> 515</span></a>            <span class="n">rhs</span> <span class="o">=</span> <span class="o">-</span><span class="n">ev</span><span class="o">.</span><span class="n">eval_residual</span><span class="p">(</span><span class="n">vec_r</span><span class="p">,</span> <span class="n">is_full</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="WeakForm-516"><a href="#WeakForm-516"><span class="linenos"> 516</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="n">mtx_vec</span><span class="p">,</span> <span class="n">key_mtx</span><span class="p">,</span> <span class="n">mtx</span><span class="p">)</span>
</span><span id="WeakForm-517"><a href="#WeakForm-517"><span class="linenos"> 517</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="n">mtx_vec</span><span class="p">,</span> <span class="n">key_vec</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
</span><span id="WeakForm-518"><a href="#WeakForm-518"><span class="linenos"> 518</span></a>
</span><span id="WeakForm-519"><a href="#WeakForm-519"><span class="linenos"> 519</span></a>    <span class="k">def</span> <span class="nf">set_mtx_vec_bc_reduced</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">):</span>
</span><span id="WeakForm-520"><a href="#WeakForm-520"><span class="linenos"> 520</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm-521"><a href="#WeakForm-521"><span class="linenos"> 521</span></a><span class="sd">        Set the &#39;bc_reduced&#39; attributes of &#39;mtx_vec&#39; (which is an instance of</span>
</span><span id="WeakForm-522"><a href="#WeakForm-522"><span class="linenos"> 522</span></a><span class="sd">        the `MatrixVector` class). &#39;tag&#39; must be either &#39;cst&#39;, &#39;mod&#39; or &#39;both&#39;.</span>
</span><span id="WeakForm-523"><a href="#WeakForm-523"><span class="linenos"> 523</span></a>
</span><span id="WeakForm-524"><a href="#WeakForm-524"><span class="linenos"> 524</span></a><span class="sd">        todo: handle the case &#39;mod&#39; terms are only vectors.</span>
</span><span id="WeakForm-525"><a href="#WeakForm-525"><span class="linenos"> 525</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WeakForm-526"><a href="#WeakForm-526"><span class="linenos"> 526</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm-527"><a href="#WeakForm-527"><span class="linenos"> 527</span></a>        <span class="n">tag_list</span><span class="p">,</span> <span class="n">pb_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_tag_pb_lists</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm-528"><a href="#WeakForm-528"><span class="linenos"> 528</span></a>        <span class="n">mtx_vec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtx_vec</span>
</span><span id="WeakForm-529"><a href="#WeakForm-529"><span class="linenos"> 529</span></a>        <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">pb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tag_list</span><span class="p">,</span> <span class="n">pb_list</span><span class="p">):</span>
</span><span id="WeakForm-530"><a href="#WeakForm-530"><span class="linenos"> 530</span></a>            <span class="n">key_mtx</span> <span class="o">=</span> <span class="s1">&#39;mtx_bc_reduced_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm-531"><a href="#WeakForm-531"><span class="linenos"> 531</span></a>            <span class="n">key_vec</span> <span class="o">=</span> <span class="s1">&#39;vec_bc_reduced_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm-532"><a href="#WeakForm-532"><span class="linenos"> 532</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mtx_vec</span><span class="p">,</span> <span class="n">key_mtx</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mtx_vec</span><span class="p">,</span> <span class="n">key_vec</span><span class="p">):</span>
</span><span id="WeakForm-533"><a href="#WeakForm-533"><span class="linenos"> 533</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="WeakForm-534"><a href="#WeakForm-534"><span class="linenos"> 534</span></a>                    <span class="sa">f</span><span class="s2">&quot;&#39;mtx_vec&#39; does not have attr. (</span><span class="si">{</span><span class="n">key_mtx</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">key_vec</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="WeakForm-535"><a href="#WeakForm-535"><span class="linenos"> 535</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_bcs</span><span class="p">[</span><span class="n">tag</span><span class="p">]:</span>
</span><span id="WeakForm-536"><a href="#WeakForm-536"><span class="linenos"> 536</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">apply_bcs</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm-537"><a href="#WeakForm-537"><span class="linenos"> 537</span></a>            <span class="n">ev</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">get_evaluator</span><span class="p">()</span>
</span><span id="WeakForm-538"><a href="#WeakForm-538"><span class="linenos"> 538</span></a>            <span class="n">vec_r</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">get_variables</span><span class="p">()</span><span class="o">.</span><span class="n">get_state</span><span class="p">(</span><span class="n">reduced</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="WeakForm-539"><a href="#WeakForm-539"><span class="linenos"> 539</span></a>            <span class="n">mtx</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="n">eval_tangent_matrix</span><span class="p">(</span><span class="n">vec_r</span><span class="p">,</span> <span class="n">mtx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_full</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="WeakForm-540"><a href="#WeakForm-540"><span class="linenos"> 540</span></a>            <span class="n">rhs</span> <span class="o">=</span> <span class="o">-</span><span class="n">ev</span><span class="o">.</span><span class="n">eval_residual</span><span class="p">(</span><span class="n">vec_r</span><span class="p">,</span> <span class="n">is_full</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="WeakForm-541"><a href="#WeakForm-541"><span class="linenos"> 541</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="n">mtx_vec</span><span class="p">,</span> <span class="n">key_mtx</span><span class="p">,</span> <span class="n">mtx</span><span class="p">)</span>
</span><span id="WeakForm-542"><a href="#WeakForm-542"><span class="linenos"> 542</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="n">mtx_vec</span><span class="p">,</span> <span class="n">key_vec</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
</span><span id="WeakForm-543"><a href="#WeakForm-543"><span class="linenos"> 543</span></a>
</span><span id="WeakForm-544"><a href="#WeakForm-544"><span class="linenos"> 544</span></a>    <span class="nd">@Decorators</span><span class="o">.</span><span class="n">check_lcbcs</span>
</span><span id="WeakForm-545"><a href="#WeakForm-545"><span class="linenos"> 545</span></a>    <span class="k">def</span> <span class="nf">set_mtx_vec_bc_full</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">):</span>
</span><span id="WeakForm-546"><a href="#WeakForm-546"><span class="linenos"> 546</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm-547"><a href="#WeakForm-547"><span class="linenos"> 547</span></a><span class="sd">        Set the &#39;bc_full&#39; attributes of &#39;mtx_vec&#39; (which is an instance of the</span>
</span><span id="WeakForm-548"><a href="#WeakForm-548"><span class="linenos"> 548</span></a><span class="sd">        `MatrixVector` class). &#39;tag&#39; must be either &#39;cst&#39;, &#39;mod&#39; or &#39;both&#39;.</span>
</span><span id="WeakForm-549"><a href="#WeakForm-549"><span class="linenos"> 549</span></a>
</span><span id="WeakForm-550"><a href="#WeakForm-550"><span class="linenos"> 550</span></a><span class="sd">        todo: handle the case &#39;mod&#39; terms are only vectors.</span>
</span><span id="WeakForm-551"><a href="#WeakForm-551"><span class="linenos"> 551</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WeakForm-552"><a href="#WeakForm-552"><span class="linenos"> 552</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm-553"><a href="#WeakForm-553"><span class="linenos"> 553</span></a>        <span class="n">tag_list</span><span class="p">,</span> <span class="n">pb_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_tag_pb_lists</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm-554"><a href="#WeakForm-554"><span class="linenos"> 554</span></a>        <span class="n">mtx_vec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtx_vec</span>
</span><span id="WeakForm-555"><a href="#WeakForm-555"><span class="linenos"> 555</span></a>        <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">pb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tag_list</span><span class="p">,</span> <span class="n">pb_list</span><span class="p">):</span>
</span><span id="WeakForm-556"><a href="#WeakForm-556"><span class="linenos"> 556</span></a>            <span class="n">key_mtx</span> <span class="o">=</span> <span class="s1">&#39;mtx_bc_full_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm-557"><a href="#WeakForm-557"><span class="linenos"> 557</span></a>            <span class="n">key_vec</span> <span class="o">=</span> <span class="s1">&#39;vec_bc_full_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm-558"><a href="#WeakForm-558"><span class="linenos"> 558</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mtx_vec</span><span class="p">,</span> <span class="n">key_mtx</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mtx_vec</span><span class="p">,</span> <span class="n">key_vec</span><span class="p">):</span>
</span><span id="WeakForm-559"><a href="#WeakForm-559"><span class="linenos"> 559</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="WeakForm-560"><a href="#WeakForm-560"><span class="linenos"> 560</span></a>                    <span class="sa">f</span><span class="s2">&quot;&#39;mtx_vec&#39; does not have attr. (</span><span class="si">{</span><span class="n">key_mtx</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">key_vec</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="WeakForm-561"><a href="#WeakForm-561"><span class="linenos"> 561</span></a>            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mtx_vec</span><span class="p">,</span> <span class="s1">&#39;mtx_no_bc_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="WeakForm-562"><a href="#WeakForm-562"><span class="linenos"> 562</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_mtx_vec_no_bc</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm-563"><a href="#WeakForm-563"><span class="linenos"> 563</span></a>            <span class="n">mtx_no_bc</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mtx_vec</span><span class="p">,</span> <span class="s1">&#39;mtx_no_bc_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span>
</span><span id="WeakForm-564"><a href="#WeakForm-564"><span class="linenos"> 564</span></a>            <span class="n">vec_no_bc</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mtx_vec</span><span class="p">,</span> <span class="s1">&#39;vec_no_bc_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span>
</span><span id="WeakForm-565"><a href="#WeakForm-565"><span class="linenos"> 565</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_bcs</span><span class="p">[</span><span class="n">tag</span><span class="p">]:</span>
</span><span id="WeakForm-566"><a href="#WeakForm-566"><span class="linenos"> 566</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">apply_bcs</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm-567"><a href="#WeakForm-567"><span class="linenos"> 567</span></a>            <span class="n">mtx</span> <span class="o">=</span> <span class="n">mtx_vec</span><span class="o">.</span><span class="n">_make_mtx_bc_full_from_mtx_no_bc</span><span class="p">(</span><span class="n">mtx_no_bc</span><span class="p">,</span> <span class="n">pb</span><span class="p">)</span>
</span><span id="WeakForm-568"><a href="#WeakForm-568"><span class="linenos"> 568</span></a>            <span class="n">vec</span> <span class="o">=</span> <span class="n">mtx_vec</span><span class="o">.</span><span class="n">_make_vec_bc_full_from_mtx_vec_no_bc</span><span class="p">(</span>
</span><span id="WeakForm-569"><a href="#WeakForm-569"><span class="linenos"> 569</span></a>                <span class="n">mtx_no_bc</span><span class="p">,</span> <span class="n">vec_no_bc</span><span class="p">,</span> <span class="n">pb</span><span class="p">)</span>
</span><span id="WeakForm-570"><a href="#WeakForm-570"><span class="linenos"> 570</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="n">mtx_vec</span><span class="p">,</span> <span class="n">key_mtx</span><span class="p">,</span> <span class="n">mtx</span><span class="p">)</span>
</span><span id="WeakForm-571"><a href="#WeakForm-571"><span class="linenos"> 571</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="n">mtx_vec</span><span class="p">,</span> <span class="n">key_vec</span><span class="p">,</span> <span class="n">vec</span><span class="p">)</span>
</span><span id="WeakForm-572"><a href="#WeakForm-572"><span class="linenos"> 572</span></a>
</span><span id="WeakForm-573"><a href="#WeakForm-573"><span class="linenos"> 573</span></a>    <span class="k">def</span> <span class="nf">get_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WeakForm-574"><a href="#WeakForm-574"><span class="linenos"> 574</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pb_cst</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="WeakForm-575"><a href="#WeakForm-575"><span class="linenos"> 575</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sfepy &#39;Field&#39; has not yet been instantiated.&quot;</span><span class="p">)</span>
</span><span id="WeakForm-576"><a href="#WeakForm-576"><span class="linenos"> 576</span></a>        <span class="n">field_name</span> <span class="o">=</span> <span class="s2">&quot;field_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="WeakForm-577"><a href="#WeakForm-577"><span class="linenos"> 577</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pb_cst</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
</span><span id="WeakForm-578"><a href="#WeakForm-578"><span class="linenos"> 578</span></a>
</span><span id="WeakForm-579"><a href="#WeakForm-579"><span class="linenos"> 579</span></a>    <span class="k">def</span> <span class="nf">get_unknown_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="WeakForm-580"><a href="#WeakForm-580"><span class="linenos"> 580</span></a>        <span class="k">if</span> <span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cst&#39;</span><span class="p">,</span> <span class="s1">&#39;mod&#39;</span><span class="p">]:</span>
</span><span id="WeakForm-581"><a href="#WeakForm-581"><span class="linenos"> 581</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">&#39; is not a valid tag, must be either &quot;</span>
</span><span id="WeakForm-582"><a href="#WeakForm-582"><span class="linenos"> 582</span></a>                             <span class="sa">f</span><span class="s2">&quot;&#39;cst&#39; or &#39;mod&#39;.&quot;</span><span class="p">)</span>
</span><span id="WeakForm-583"><a href="#WeakForm-583"><span class="linenos"> 583</span></a>        <span class="k">return</span> <span class="s1">&#39;u_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm-584"><a href="#WeakForm-584"><span class="linenos"> 584</span></a>
</span><span id="WeakForm-585"><a href="#WeakForm-585"><span class="linenos"> 585</span></a>    <span class="k">def</span> <span class="nf">get_test_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="WeakForm-586"><a href="#WeakForm-586"><span class="linenos"> 586</span></a>        <span class="k">if</span> <span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cst&#39;</span><span class="p">,</span> <span class="s1">&#39;mod&#39;</span><span class="p">]:</span>
</span><span id="WeakForm-587"><a href="#WeakForm-587"><span class="linenos"> 587</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">&#39; is not a valid tag, must be either &quot;</span>
</span><span id="WeakForm-588"><a href="#WeakForm-588"><span class="linenos"> 588</span></a>                             <span class="sa">f</span><span class="s2">&quot;&#39;cst&#39; or &#39;mod&#39;.&quot;</span><span class="p">)</span>
</span><span id="WeakForm-589"><a href="#WeakForm-589"><span class="linenos"> 589</span></a>        <span class="k">return</span> <span class="s1">&#39;v_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm-590"><a href="#WeakForm-590"><span class="linenos"> 590</span></a>
</span><span id="WeakForm-591"><a href="#WeakForm-591"><span class="linenos"> 591</span></a>    <span class="k">def</span> <span class="nf">create_sfepy_internal_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pre_mesh</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Mesh</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Mesh</span><span class="p">:</span>
</span><span id="WeakForm-592"><a href="#WeakForm-592"><span class="linenos"> 592</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm-593"><a href="#WeakForm-593"><span class="linenos"> 593</span></a><span class="sd">        Create a Sfepy `Mesh` instance and return it. The input `pre_mesh` must</span>
</span><span id="WeakForm-594"><a href="#WeakForm-594"><span class="linenos"> 594</span></a><span class="sd">        already be an instance of `sfepy.discrete.fem.mesh.Mesh` in 1D. For the</span>
</span><span id="WeakForm-595"><a href="#WeakForm-595"><span class="linenos"> 595</span></a><span class="sd">        2D or 3D case, it is the name of an already existing .vtk mesh file.</span>
</span><span id="WeakForm-596"><a href="#WeakForm-596"><span class="linenos"> 596</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WeakForm-597"><a href="#WeakForm-597"><span class="linenos"> 597</span></a>
</span><span id="WeakForm-598"><a href="#WeakForm-598"><span class="linenos"> 598</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="WeakForm-599"><a href="#WeakForm-599"><span class="linenos"> 599</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pre_mesh</span><span class="p">,</span> <span class="n">Mesh</span><span class="p">):</span>
</span><span id="WeakForm-600"><a href="#WeakForm-600"><span class="linenos"> 600</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;In the one-dimensional case, &#39;mesh&#39; should &quot;</span>
</span><span id="WeakForm-601"><a href="#WeakForm-601"><span class="linenos"> 601</span></a>                                <span class="sa">f</span><span class="s2">&quot;be an instance of </span><span class="si">{</span><span class="n">Mesh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="WeakForm-602"><a href="#WeakForm-602"><span class="linenos"> 602</span></a>            <span class="n">sfepy_mesh</span> <span class="o">=</span> <span class="n">pre_mesh</span>
</span><span id="WeakForm-603"><a href="#WeakForm-603"><span class="linenos"> 603</span></a>
</span><span id="WeakForm-604"><a href="#WeakForm-604"><span class="linenos"> 604</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="WeakForm-605"><a href="#WeakForm-605"><span class="linenos"> 605</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pre_mesh</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="WeakForm-606"><a href="#WeakForm-606"><span class="linenos"> 606</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;In the two- and three-dimensional case, &quot;</span>
</span><span id="WeakForm-607"><a href="#WeakForm-607"><span class="linenos"> 607</span></a>                                <span class="s2">&quot;&#39;mesh&#39; should be a string&quot;</span><span class="p">)</span>
</span><span id="WeakForm-608"><a href="#WeakForm-608"><span class="linenos"> 608</span></a>            <span class="n">mesh_path_name</span> <span class="o">=</span> <span class="n">make_absolute_mesh_name</span><span class="p">(</span><span class="n">pre_mesh</span><span class="p">)</span>
</span><span id="WeakForm-609"><a href="#WeakForm-609"><span class="linenos"> 609</span></a>            <span class="n">sfepy_mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">mesh_path_name</span><span class="p">)</span>
</span><span id="WeakForm-610"><a href="#WeakForm-610"><span class="linenos"> 610</span></a>
</span><span id="WeakForm-611"><a href="#WeakForm-611"><span class="linenos"> 611</span></a>        <span class="k">return</span> <span class="n">sfepy_mesh</span>
</span><span id="WeakForm-612"><a href="#WeakForm-612"><span class="linenos"> 612</span></a>
</span><span id="WeakForm-613"><a href="#WeakForm-613"><span class="linenos"> 613</span></a>    <span class="k">def</span> <span class="nf">fill_ebc_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pre_ebc_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="WeakForm-614"><a href="#WeakForm-614"><span class="linenos"> 614</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm-615"><a href="#WeakForm-615"><span class="linenos"> 615</span></a><span class="sd">        Fill the &#39;ebc_dict&#39; from user specified Dirichlet boundary conditions.</span>
</span><span id="WeakForm-616"><a href="#WeakForm-616"><span class="linenos"> 616</span></a>
</span><span id="WeakForm-617"><a href="#WeakForm-617"><span class="linenos"> 617</span></a><span class="sd">        Parameters</span>
</span><span id="WeakForm-618"><a href="#WeakForm-618"><span class="linenos"> 618</span></a><span class="sd">        ----------</span>
</span><span id="WeakForm-619"><a href="#WeakForm-619"><span class="linenos"> 619</span></a><span class="sd">        pre_ebc_dict : dict</span>
</span><span id="WeakForm-620"><a href="#WeakForm-620"><span class="linenos"> 620</span></a><span class="sd">            Dictionary that is used to assign some essential boundary conditions</span>
</span><span id="WeakForm-621"><a href="#WeakForm-621"><span class="linenos"> 621</span></a><span class="sd">            to some topological entities. Its keys are a subset of</span>
</span><span id="WeakForm-622"><a href="#WeakForm-622"><span class="linenos"> 622</span></a><span class="sd">            `region_dict`&#39;s ones and its values are either numbers or functions.</span>
</span><span id="WeakForm-623"><a href="#WeakForm-623"><span class="linenos"> 623</span></a>
</span><span id="WeakForm-624"><a href="#WeakForm-624"><span class="linenos"> 624</span></a><span class="sd">        Notes</span>
</span><span id="WeakForm-625"><a href="#WeakForm-625"><span class="linenos"> 625</span></a><span class="sd">        -----</span>
</span><span id="WeakForm-626"><a href="#WeakForm-626"><span class="linenos"> 626</span></a><span class="sd">        In order to match Sfepy&#39;s syntax, function signatures should be</span>
</span><span id="WeakForm-627"><a href="#WeakForm-627"><span class="linenos"> 627</span></a><span class="sd">            def func(ts, coors, **kwargs)</span>
</span><span id="WeakForm-628"><a href="#WeakForm-628"><span class="linenos"> 628</span></a>
</span><span id="WeakForm-629"><a href="#WeakForm-629"><span class="linenos"> 629</span></a><span class="sd">        In view of Sfepy&#39;s handling of essential boundary conditions, it is</span>
</span><span id="WeakForm-630"><a href="#WeakForm-630"><span class="linenos"> 630</span></a><span class="sd">        necessary to define pairs of ebcs (for &#39;u_cst&#39; and &#39;u_mod&#39;).</span>
</span><span id="WeakForm-631"><a href="#WeakForm-631"><span class="linenos"> 631</span></a>
</span><span id="WeakForm-632"><a href="#WeakForm-632"><span class="linenos"> 632</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WeakForm-633"><a href="#WeakForm-633"><span class="linenos"> 633</span></a>
</span><span id="WeakForm-634"><a href="#WeakForm-634"><span class="linenos"> 634</span></a>        <span class="k">if</span> <span class="n">pre_ebc_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="WeakForm-635"><a href="#WeakForm-635"><span class="linenos"> 635</span></a>            <span class="n">pre_ebc_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="WeakForm-636"><a href="#WeakForm-636"><span class="linenos"> 636</span></a>
</span><span id="WeakForm-637"><a href="#WeakForm-637"><span class="linenos"> 637</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">pre_ebc_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="WeakForm-638"><a href="#WeakForm-638"><span class="linenos"> 638</span></a>            <span class="n">ebc_pair</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cst&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;mod&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
</span><span id="WeakForm-639"><a href="#WeakForm-639"><span class="linenos"> 639</span></a>            <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cst&#39;</span><span class="p">,</span> <span class="s1">&#39;mod&#39;</span><span class="p">]:</span>
</span><span id="WeakForm-640"><a href="#WeakForm-640"><span class="linenos"> 640</span></a>                <span class="n">ebc_name</span> <span class="o">=</span> <span class="s1">&#39;ebc_</span><span class="si">{}{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm-641"><a href="#WeakForm-641"><span class="linenos"> 641</span></a>                <span class="n">unknown_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_unknown_name</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm-642"><a href="#WeakForm-642"><span class="linenos"> 642</span></a>
</span><span id="WeakForm-643"><a href="#WeakForm-643"><span class="linenos"> 643</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>  <span class="c1"># val is a single number</span>
</span><span id="WeakForm-644"><a href="#WeakForm-644"><span class="linenos"> 644</span></a>                    <span class="n">ebc</span> <span class="o">=</span> <span class="n">EssentialBC</span><span class="p">(</span><span class="n">ebc_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
</span><span id="WeakForm-645"><a href="#WeakForm-645"><span class="linenos"> 645</span></a>                                      <span class="p">{</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.all&#39;</span> <span class="o">%</span> <span class="n">unknown_name</span><span class="p">:</span> <span class="n">val</span><span class="p">})</span>
</span><span id="WeakForm-646"><a href="#WeakForm-646"><span class="linenos"> 646</span></a>
</span><span id="WeakForm-647"><a href="#WeakForm-647"><span class="linenos"> 647</span></a>                <span class="k">else</span><span class="p">:</span>  <span class="c1"># val is a function</span>
</span><span id="WeakForm-648"><a href="#WeakForm-648"><span class="linenos"> 648</span></a>                    <span class="n">ebc_func_name</span> <span class="o">=</span> <span class="s1">&#39;ebc_func_</span><span class="si">{}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="WeakForm-649"><a href="#WeakForm-649"><span class="linenos"> 649</span></a>                    <span class="n">ebc_func</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="n">ebc_func_name</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
</span><span id="WeakForm-650"><a href="#WeakForm-650"><span class="linenos"> 650</span></a>                    <span class="n">ebc</span> <span class="o">=</span> <span class="n">EssentialBC</span><span class="p">(</span><span class="n">ebc_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
</span><span id="WeakForm-651"><a href="#WeakForm-651"><span class="linenos"> 651</span></a>                                      <span class="p">{</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.all&#39;</span> <span class="o">%</span> <span class="n">unknown_name</span><span class="p">:</span> <span class="n">ebc_func</span><span class="p">})</span>
</span><span id="WeakForm-652"><a href="#WeakForm-652"><span class="linenos"> 652</span></a>
</span><span id="WeakForm-653"><a href="#WeakForm-653"><span class="linenos"> 653</span></a>                <span class="n">ebc_pair</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">ebc</span>
</span><span id="WeakForm-654"><a href="#WeakForm-654"><span class="linenos"> 654</span></a>
</span><span id="WeakForm-655"><a href="#WeakForm-655"><span class="linenos"> 655</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ebc_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ebc_pair</span>
</span><span id="WeakForm-656"><a href="#WeakForm-656"><span class="linenos"> 656</span></a>
</span><span id="WeakForm-657"><a href="#WeakForm-657"><span class="linenos"> 657</span></a>    <span class="k">def</span> <span class="nf">fill_region_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">FEDomain</span><span class="p">,</span> <span class="n">physical_group_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
</span><span id="WeakForm-658"><a href="#WeakForm-658"><span class="linenos"> 658</span></a>                         <span class="n">dim_func_entities</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">tuple</span><span class="p">]):</span>
</span><span id="WeakForm-659"><a href="#WeakForm-659"><span class="linenos"> 659</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm-660"><a href="#WeakForm-660"><span class="linenos"> 660</span></a><span class="sd">        Fill the &#39;region_dict&#39; based on:</span>
</span><span id="WeakForm-661"><a href="#WeakForm-661"><span class="linenos"> 661</span></a><span class="sd">        1) the physical groups present in the mesh;</span>
</span><span id="WeakForm-662"><a href="#WeakForm-662"><span class="linenos"> 662</span></a><span class="sd">        2) the topological entities selected via a function of the coordinates.</span>
</span><span id="WeakForm-663"><a href="#WeakForm-663"><span class="linenos"> 663</span></a><span class="sd">        Each entry of &#39;region_dict&#39; is then an instance of the class</span>
</span><span id="WeakForm-664"><a href="#WeakForm-664"><span class="linenos"> 664</span></a><span class="sd">        `sfepy.discrete.common.region.Region`.</span>
</span><span id="WeakForm-665"><a href="#WeakForm-665"><span class="linenos"> 665</span></a>
</span><span id="WeakForm-666"><a href="#WeakForm-666"><span class="linenos"> 666</span></a><span class="sd">        Parameters</span>
</span><span id="WeakForm-667"><a href="#WeakForm-667"><span class="linenos"> 667</span></a><span class="sd">        ----------</span>
</span><span id="WeakForm-668"><a href="#WeakForm-668"><span class="linenos"> 668</span></a><span class="sd">        domain : FEDomain</span>
</span><span id="WeakForm-669"><a href="#WeakForm-669"><span class="linenos"> 669</span></a><span class="sd">            Sfepy Domain instance.</span>
</span><span id="WeakForm-670"><a href="#WeakForm-670"><span class="linenos"> 670</span></a><span class="sd">        physical_group_ids : list</span>
</span><span id="WeakForm-671"><a href="#WeakForm-671"><span class="linenos"> 671</span></a><span class="sd">            List of all the physical groups (int) readable from the mesh.</span>
</span><span id="WeakForm-672"><a href="#WeakForm-672"><span class="linenos"> 672</span></a><span class="sd">        dim_func_entities : list</span>
</span><span id="WeakForm-673"><a href="#WeakForm-673"><span class="linenos"> 673</span></a><span class="sd">            List of triplets (entity dimension, function selection, tag).</span>
</span><span id="WeakForm-674"><a href="#WeakForm-674"><span class="linenos"> 674</span></a>
</span><span id="WeakForm-675"><a href="#WeakForm-675"><span class="linenos"> 675</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WeakForm-676"><a href="#WeakForm-676"><span class="linenos"> 676</span></a>
</span><span id="WeakForm-677"><a href="#WeakForm-677"><span class="linenos"> 677</span></a>        <span class="c1"># Omega and Gamma regions</span>
</span><span id="WeakForm-678"><a href="#WeakForm-678"><span class="linenos"> 678</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span><span class="p">[(</span><span class="s1">&#39;omega&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span><span class="s1">&#39;omega&#39;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">)</span>
</span><span id="WeakForm-679"><a href="#WeakForm-679"><span class="linenos"> 679</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span><span class="p">[(</span><span class="s1">&#39;gamma&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span>
</span><span id="WeakForm-680"><a href="#WeakForm-680"><span class="linenos"> 680</span></a>            <span class="s1">&#39;gamma&#39;</span><span class="p">,</span> <span class="s1">&#39;vertices of surface&#39;</span><span class="p">,</span> <span class="s1">&#39;facet&#39;</span><span class="p">)</span>
</span><span id="WeakForm-681"><a href="#WeakForm-681"><span class="linenos"> 681</span></a>
</span><span id="WeakForm-682"><a href="#WeakForm-682"><span class="linenos"> 682</span></a>        <span class="n">topological_entities_counter</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;vertices&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="WeakForm-683"><a href="#WeakForm-683"><span class="linenos"> 683</span></a>                                        <span class="s1">&#39;edges&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="WeakForm-684"><a href="#WeakForm-684"><span class="linenos"> 684</span></a>                                        <span class="s1">&#39;facets&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="WeakForm-685"><a href="#WeakForm-685"><span class="linenos"> 685</span></a>                                        <span class="s1">&#39;subomegas&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="WeakForm-686"><a href="#WeakForm-686"><span class="linenos"> 686</span></a>
</span><span id="WeakForm-687"><a href="#WeakForm-687"><span class="linenos"> 687</span></a>        <span class="k">for</span> <span class="n">group_id</span> <span class="ow">in</span> <span class="n">physical_group_ids</span><span class="p">:</span>
</span><span id="WeakForm-688"><a href="#WeakForm-688"><span class="linenos"> 688</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_fill_region_dict_from_group_id</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">group_id</span><span class="p">,</span>
</span><span id="WeakForm-689"><a href="#WeakForm-689"><span class="linenos"> 689</span></a>                                                 <span class="n">topological_entities_counter</span><span class="p">)</span>
</span><span id="WeakForm-690"><a href="#WeakForm-690"><span class="linenos"> 690</span></a>
</span><span id="WeakForm-691"><a href="#WeakForm-691"><span class="linenos"> 691</span></a>        <span class="k">for</span> <span class="n">entity_dimension</span><span class="p">,</span> <span class="n">function_selection</span><span class="p">,</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">dim_func_entities</span><span class="p">:</span>
</span><span id="WeakForm-692"><a href="#WeakForm-692"><span class="linenos"> 692</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_fill_region_dict_from_dim_func</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">entity_dimension</span><span class="p">,</span>
</span><span id="WeakForm-693"><a href="#WeakForm-693"><span class="linenos"> 693</span></a>                                                 <span class="n">function_selection</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span>
</span><span id="WeakForm-694"><a href="#WeakForm-694"><span class="linenos"> 694</span></a>                                                 <span class="n">topological_entities_counter</span><span class="p">)</span>
</span><span id="WeakForm-695"><a href="#WeakForm-695"><span class="linenos"> 695</span></a>
</span><span id="WeakForm-696"><a href="#WeakForm-696"><span class="linenos"> 696</span></a>    <span class="k">def</span> <span class="nf">get_qps_coors_in_region</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">region_key</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;omega&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)):</span>
</span><span id="WeakForm-697"><a href="#WeakForm-697"><span class="linenos"> 697</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm-698"><a href="#WeakForm-698"><span class="linenos"> 698</span></a><span class="sd">        Fetch quadrature points coordinates in given region.</span>
</span><span id="WeakForm-699"><a href="#WeakForm-699"><span class="linenos"> 699</span></a>
</span><span id="WeakForm-700"><a href="#WeakForm-700"><span class="linenos"> 700</span></a><span class="sd">        Parameters</span>
</span><span id="WeakForm-701"><a href="#WeakForm-701"><span class="linenos"> 701</span></a><span class="sd">        ----------</span>
</span><span id="WeakForm-702"><a href="#WeakForm-702"><span class="linenos"> 702</span></a><span class="sd">        region_key : tuple, optional</span>
</span><span id="WeakForm-703"><a href="#WeakForm-703"><span class="linenos"> 703</span></a><span class="sd">            Region where to fetch the quadrature points. The default is</span>
</span><span id="WeakForm-704"><a href="#WeakForm-704"><span class="linenos"> 704</span></a><span class="sd">            (&#39;omega&#39;, -1), which corresponds to the whole domain.</span>
</span><span id="WeakForm-705"><a href="#WeakForm-705"><span class="linenos"> 705</span></a>
</span><span id="WeakForm-706"><a href="#WeakForm-706"><span class="linenos"> 706</span></a><span class="sd">        Returns</span>
</span><span id="WeakForm-707"><a href="#WeakForm-707"><span class="linenos"> 707</span></a><span class="sd">        -------</span>
</span><span id="WeakForm-708"><a href="#WeakForm-708"><span class="linenos"> 708</span></a><span class="sd">        qps_coors : np.ndarray</span>
</span><span id="WeakForm-709"><a href="#WeakForm-709"><span class="linenos"> 709</span></a><span class="sd">            Numpy array containing the coordinates of the qps in the specified</span>
</span><span id="WeakForm-710"><a href="#WeakForm-710"><span class="linenos"> 710</span></a><span class="sd">            region.</span>
</span><span id="WeakForm-711"><a href="#WeakForm-711"><span class="linenos"> 711</span></a>
</span><span id="WeakForm-712"><a href="#WeakForm-712"><span class="linenos"> 712</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WeakForm-713"><a href="#WeakForm-713"><span class="linenos"> 713</span></a>        <span class="n">region</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span><span class="p">[</span><span class="n">region_key</span><span class="p">]</span>
</span><span id="WeakForm-714"><a href="#WeakForm-714"><span class="linenos"> 714</span></a>        <span class="n">qps</span> <span class="o">=</span> <span class="n">get_physical_qps</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">integral</span><span class="p">)</span>
</span><span id="WeakForm-715"><a href="#WeakForm-715"><span class="linenos"> 715</span></a>        <span class="n">qps_coors</span> <span class="o">=</span> <span class="n">qps</span><span class="o">.</span><span class="n">values</span>
</span><span id="WeakForm-716"><a href="#WeakForm-716"><span class="linenos"> 716</span></a>        <span class="k">return</span> <span class="n">qps_coors</span>
</span><span id="WeakForm-717"><a href="#WeakForm-717"><span class="linenos"> 717</span></a>
</span><span id="WeakForm-718"><a href="#WeakForm-718"><span class="linenos"> 718</span></a>    <span class="k">def</span> <span class="nf">get_pickable_args_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WeakForm-719"><a href="#WeakForm-719"><span class="linenos"> 719</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm-720"><a href="#WeakForm-720"><span class="linenos"> 720</span></a><span class="sd">        Construct a dictionary that</span>
</span><span id="WeakForm-721"><a href="#WeakForm-721"><span class="linenos"> 721</span></a><span class="sd">        (i) can be used to create a new weak form with `from_scratch` method;</span>
</span><span id="WeakForm-722"><a href="#WeakForm-722"><span class="linenos"> 722</span></a><span class="sd">        (ii) can be serialized and thus save using pickle.</span>
</span><span id="WeakForm-723"><a href="#WeakForm-723"><span class="linenos"> 723</span></a><span class="sd">        The second requirement implies that user defined functions are not</span>
</span><span id="WeakForm-724"><a href="#WeakForm-724"><span class="linenos"> 724</span></a><span class="sd">        registered in the process. We get rid of all &#39;pre_term&#39;s and replace</span>
</span><span id="WeakForm-725"><a href="#WeakForm-725"><span class="linenos"> 725</span></a><span class="sd">        them by a dummy &#39;dw_laplace&#39; term.</span>
</span><span id="WeakForm-726"><a href="#WeakForm-726"><span class="linenos"> 726</span></a>
</span><span id="WeakForm-727"><a href="#WeakForm-727"><span class="linenos"> 727</span></a><span class="sd">        Returns</span>
</span><span id="WeakForm-728"><a href="#WeakForm-728"><span class="linenos"> 728</span></a><span class="sd">        -------</span>
</span><span id="WeakForm-729"><a href="#WeakForm-729"><span class="linenos"> 729</span></a><span class="sd">        args_dict : dict</span>
</span><span id="WeakForm-730"><a href="#WeakForm-730"><span class="linenos"> 730</span></a>
</span><span id="WeakForm-731"><a href="#WeakForm-731"><span class="linenos"> 731</span></a><span class="sd">        Notes</span>
</span><span id="WeakForm-732"><a href="#WeakForm-732"><span class="linenos"> 732</span></a><span class="sd">        -----</span>
</span><span id="WeakForm-733"><a href="#WeakForm-733"><span class="linenos"> 733</span></a><span class="sd">        This function is a wrapper for `_reconstruct_args_dict` and</span>
</span><span id="WeakForm-734"><a href="#WeakForm-734"><span class="linenos"> 734</span></a><span class="sd">        `_remove_functions_from_args_dict`.</span>
</span><span id="WeakForm-735"><a href="#WeakForm-735"><span class="linenos"> 735</span></a>
</span><span id="WeakForm-736"><a href="#WeakForm-736"><span class="linenos"> 736</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WeakForm-737"><a href="#WeakForm-737"><span class="linenos"> 737</span></a>        <span class="n">args_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reconstruct_args_dict</span><span class="p">()</span>
</span><span id="WeakForm-738"><a href="#WeakForm-738"><span class="linenos"> 738</span></a>        <span class="n">_remove_functions_from_args_dict</span><span class="p">(</span><span class="n">args_dict</span><span class="p">)</span>
</span><span id="WeakForm-739"><a href="#WeakForm-739"><span class="linenos"> 739</span></a>        <span class="n">args_dict</span><span class="p">[</span><span class="s1">&#39;pre_terms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">PreTerm</span><span class="p">(</span><span class="s1">&#39;dw_laplace&#39;</span><span class="p">)]</span>
</span><span id="WeakForm-740"><a href="#WeakForm-740"><span class="linenos"> 740</span></a>        <span class="k">return</span> <span class="n">args_dict</span>
</span><span id="WeakForm-741"><a href="#WeakForm-741"><span class="linenos"> 741</span></a>
</span><span id="WeakForm-742"><a href="#WeakForm-742"><span class="linenos"> 742</span></a>    <span class="k">def</span> <span class="nf">_reconstruct_args_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WeakForm-743"><a href="#WeakForm-743"><span class="linenos"> 743</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm-744"><a href="#WeakForm-744"><span class="linenos"> 744</span></a><span class="sd">        Mirror of `from_scratch` method, i.e. recreate the `args_dict`</span>
</span><span id="WeakForm-745"><a href="#WeakForm-745"><span class="linenos"> 745</span></a><span class="sd">        parameter from the instantiated weak form. This method does not apply to</span>
</span><span id="WeakForm-746"><a href="#WeakForm-746"><span class="linenos"> 746</span></a><span class="sd">        one-dimensional weak forms.</span>
</span><span id="WeakForm-747"><a href="#WeakForm-747"><span class="linenos"> 747</span></a>
</span><span id="WeakForm-748"><a href="#WeakForm-748"><span class="linenos"> 748</span></a><span class="sd">        Returns</span>
</span><span id="WeakForm-749"><a href="#WeakForm-749"><span class="linenos"> 749</span></a><span class="sd">        -------</span>
</span><span id="WeakForm-750"><a href="#WeakForm-750"><span class="linenos"> 750</span></a><span class="sd">        args_dict : dict</span>
</span><span id="WeakForm-751"><a href="#WeakForm-751"><span class="linenos"> 751</span></a><span class="sd">            Dictionary that was used to create to present instance of WeakForm.</span>
</span><span id="WeakForm-752"><a href="#WeakForm-752"><span class="linenos"> 752</span></a>
</span><span id="WeakForm-753"><a href="#WeakForm-753"><span class="linenos"> 753</span></a><span class="sd">        See Also</span>
</span><span id="WeakForm-754"><a href="#WeakForm-754"><span class="linenos"> 754</span></a><span class="sd">        --------</span>
</span><span id="WeakForm-755"><a href="#WeakForm-755"><span class="linenos"> 755</span></a><span class="sd">        from_scratch : create weak form instance from an `args_dict`.</span>
</span><span id="WeakForm-756"><a href="#WeakForm-756"><span class="linenos"> 756</span></a>
</span><span id="WeakForm-757"><a href="#WeakForm-757"><span class="linenos"> 757</span></a><span class="sd">        Notes</span>
</span><span id="WeakForm-758"><a href="#WeakForm-758"><span class="linenos"> 758</span></a><span class="sd">        -----</span>
</span><span id="WeakForm-759"><a href="#WeakForm-759"><span class="linenos"> 759</span></a><span class="sd">        Some items cannot be recovered (e.g. &#39;dim_func_entities&#39;) or can only be</span>
</span><span id="WeakForm-760"><a href="#WeakForm-760"><span class="linenos"> 760</span></a><span class="sd">        partially reconstructed (e.g. &#39;pre_ebc_dict&#39; when the dirichlet boundary</span>
</span><span id="WeakForm-761"><a href="#WeakForm-761"><span class="linenos"> 761</span></a><span class="sd">        condition is given by a function).</span>
</span><span id="WeakForm-762"><a href="#WeakForm-762"><span class="linenos"> 762</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WeakForm-763"><a href="#WeakForm-763"><span class="linenos"> 763</span></a>
</span><span id="WeakForm-764"><a href="#WeakForm-764"><span class="linenos"> 764</span></a>        <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span>
</span><span id="WeakForm-765"><a href="#WeakForm-765"><span class="linenos"> 765</span></a>        <span class="k">if</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="WeakForm-766"><a href="#WeakForm-766"><span class="linenos"> 766</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="WeakForm-767"><a href="#WeakForm-767"><span class="linenos"> 767</span></a>                <span class="s2">&quot;Cannot call &#39;reconstruct_args_dict&#39; on 1D weak forms!&quot;</span><span class="p">)</span>
</span><span id="WeakForm-768"><a href="#WeakForm-768"><span class="linenos"> 768</span></a>        <span class="n">pre_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">name</span>
</span><span id="WeakForm-769"><a href="#WeakForm-769"><span class="linenos"> 769</span></a>        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</span><span id="WeakForm-770"><a href="#WeakForm-770"><span class="linenos"> 770</span></a>        <span class="n">dim_func_entities</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Cannot be recovered</span>
</span><span id="WeakForm-771"><a href="#WeakForm-771"><span class="linenos"> 771</span></a>        <span class="n">pre_ebc_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="WeakForm-772"><a href="#WeakForm-772"><span class="linenos"> 772</span></a>        <span class="k">for</span> <span class="n">region_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ebc_dict</span><span class="p">:</span>
</span><span id="WeakForm-773"><a href="#WeakForm-773"><span class="linenos"> 773</span></a>            <span class="n">ebc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ebc_dict</span><span class="p">[</span><span class="n">region_key</span><span class="p">][</span><span class="s1">&#39;cst&#39;</span><span class="p">]</span>
</span><span id="WeakForm-774"><a href="#WeakForm-774"><span class="linenos"> 774</span></a>            <span class="n">val</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ebc</span><span class="o">.</span><span class="n">dofs</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="WeakForm-775"><a href="#WeakForm-775"><span class="linenos"> 775</span></a>            <span class="n">pre_ebc_dict</span><span class="p">[</span><span class="n">region_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
</span><span id="WeakForm-776"><a href="#WeakForm-776"><span class="linenos"> 776</span></a>        <span class="n">fem_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fem_order</span>
</span><span id="WeakForm-777"><a href="#WeakForm-777"><span class="linenos"> 777</span></a>        <span class="n">pre_terms</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="WeakForm-778"><a href="#WeakForm-778"><span class="linenos"> 778</span></a>        <span class="k">for</span> <span class="n">pre_term</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_terms</span><span class="p">:</span>
</span><span id="WeakForm-779"><a href="#WeakForm-779"><span class="linenos"> 779</span></a>            <span class="n">pre_terms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy</span><span class="p">(</span><span class="n">pre_term</span><span class="p">))</span>
</span><span id="WeakForm-780"><a href="#WeakForm-780"><span class="linenos"> 780</span></a>            <span class="n">pre_terms</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">term</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WeakForm-781"><a href="#WeakForm-781"><span class="linenos"> 781</span></a>        <span class="n">is_exterior</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_exterior</span>
</span><span id="WeakForm-782"><a href="#WeakForm-782"><span class="linenos"> 782</span></a>
</span><span id="WeakForm-783"><a href="#WeakForm-783"><span class="linenos"> 783</span></a>        <span class="n">args_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="WeakForm-784"><a href="#WeakForm-784"><span class="linenos"> 784</span></a>            <span class="s1">&#39;dim&#39;</span><span class="p">:</span> <span class="n">dim</span><span class="p">,</span>
</span><span id="WeakForm-785"><a href="#WeakForm-785"><span class="linenos"> 785</span></a>            <span class="s1">&#39;pre_mesh&#39;</span><span class="p">:</span> <span class="n">pre_mesh</span><span class="p">,</span>
</span><span id="WeakForm-786"><a href="#WeakForm-786"><span class="linenos"> 786</span></a>            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
</span><span id="WeakForm-787"><a href="#WeakForm-787"><span class="linenos"> 787</span></a>            <span class="s1">&#39;dim_func_entities&#39;</span><span class="p">:</span> <span class="n">dim_func_entities</span><span class="p">,</span>
</span><span id="WeakForm-788"><a href="#WeakForm-788"><span class="linenos"> 788</span></a>            <span class="s1">&#39;pre_ebc_dict&#39;</span><span class="p">:</span> <span class="n">pre_ebc_dict</span><span class="p">,</span>
</span><span id="WeakForm-789"><a href="#WeakForm-789"><span class="linenos"> 789</span></a>            <span class="s1">&#39;fem_order&#39;</span><span class="p">:</span> <span class="n">fem_order</span><span class="p">,</span>
</span><span id="WeakForm-790"><a href="#WeakForm-790"><span class="linenos"> 790</span></a>            <span class="s1">&#39;pre_terms&#39;</span><span class="p">:</span> <span class="n">pre_terms</span><span class="p">,</span>
</span><span id="WeakForm-791"><a href="#WeakForm-791"><span class="linenos"> 791</span></a>            <span class="s1">&#39;is_exterior&#39;</span><span class="p">:</span> <span class="n">is_exterior</span>
</span><span id="WeakForm-792"><a href="#WeakForm-792"><span class="linenos"> 792</span></a>        <span class="p">}</span>
</span><span id="WeakForm-793"><a href="#WeakForm-793"><span class="linenos"> 793</span></a>
</span><span id="WeakForm-794"><a href="#WeakForm-794"><span class="linenos"> 794</span></a>        <span class="k">return</span> <span class="n">args_dict</span>
</span><span id="WeakForm-795"><a href="#WeakForm-795"><span class="linenos"> 795</span></a>
</span><span id="WeakForm-796"><a href="#WeakForm-796"><span class="linenos"> 796</span></a>    <span class="k">def</span> <span class="nf">_fill_region_dict_from_group_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">FEDomain</span><span class="p">,</span> <span class="n">group_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="WeakForm-797"><a href="#WeakForm-797"><span class="linenos"> 797</span></a>                                        <span class="n">topological_entities_counter</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="WeakForm-798"><a href="#WeakForm-798"><span class="linenos"> 798</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm-799"><a href="#WeakForm-799"><span class="linenos"> 799</span></a><span class="sd">        Fill the `region_dict` dictionary with a single additional item based</span>
</span><span id="WeakForm-800"><a href="#WeakForm-800"><span class="linenos"> 800</span></a><span class="sd">        on the provided physical group id.</span>
</span><span id="WeakForm-801"><a href="#WeakForm-801"><span class="linenos"> 801</span></a>
</span><span id="WeakForm-802"><a href="#WeakForm-802"><span class="linenos"> 802</span></a><span class="sd">        Parameters</span>
</span><span id="WeakForm-803"><a href="#WeakForm-803"><span class="linenos"> 803</span></a><span class="sd">        ----------</span>
</span><span id="WeakForm-804"><a href="#WeakForm-804"><span class="linenos"> 804</span></a><span class="sd">        domain : `sfepy.discrete.fem.domain.FEDomain`</span>
</span><span id="WeakForm-805"><a href="#WeakForm-805"><span class="linenos"> 805</span></a><span class="sd">            Sfepy Domain instance.</span>
</span><span id="WeakForm-806"><a href="#WeakForm-806"><span class="linenos"> 806</span></a><span class="sd">        group_id : int</span>
</span><span id="WeakForm-807"><a href="#WeakForm-807"><span class="linenos"> 807</span></a><span class="sd">            Physical group id.</span>
</span><span id="WeakForm-808"><a href="#WeakForm-808"><span class="linenos"> 808</span></a><span class="sd">        topological_entities_counter : dict</span>
</span><span id="WeakForm-809"><a href="#WeakForm-809"><span class="linenos"> 809</span></a><span class="sd">            Dictionary containing the current number of regions with a certain</span>
</span><span id="WeakForm-810"><a href="#WeakForm-810"><span class="linenos"> 810</span></a><span class="sd">            topology created.</span>
</span><span id="WeakForm-811"><a href="#WeakForm-811"><span class="linenos"> 811</span></a>
</span><span id="WeakForm-812"><a href="#WeakForm-812"><span class="linenos"> 812</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WeakForm-813"><a href="#WeakForm-813"><span class="linenos"> 813</span></a>
</span><span id="WeakForm-814"><a href="#WeakForm-814"><span class="linenos"> 814</span></a>        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">group_id</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>  <span class="c1"># vertex</span>
</span><span id="WeakForm-815"><a href="#WeakForm-815"><span class="linenos"> 815</span></a>            <span class="n">vertex</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span><span class="s1">&#39;vertex</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">group_id</span><span class="p">,</span>
</span><span id="WeakForm-816"><a href="#WeakForm-816"><span class="linenos"> 816</span></a>                                          <span class="s1">&#39;vertices of group </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">group_id</span><span class="p">,</span>
</span><span id="WeakForm-817"><a href="#WeakForm-817"><span class="linenos"> 817</span></a>                                          <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;vertex&#39;</span><span class="p">)</span>
</span><span id="WeakForm-818"><a href="#WeakForm-818"><span class="linenos"> 818</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span><span class="p">[(</span><span class="s1">&#39;vertex&#39;</span><span class="p">,</span> <span class="n">group_id</span><span class="p">)]</span> <span class="o">=</span> <span class="n">vertex</span>
</span><span id="WeakForm-819"><a href="#WeakForm-819"><span class="linenos"> 819</span></a>            <span class="n">topological_entities_counter</span><span class="p">[</span><span class="s1">&#39;vertices&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="WeakForm-820"><a href="#WeakForm-820"><span class="linenos"> 820</span></a>
</span><span id="WeakForm-821"><a href="#WeakForm-821"><span class="linenos"> 821</span></a>        <span class="k">elif</span> <span class="mi">100</span> <span class="o">&lt;=</span> <span class="n">group_id</span> <span class="o">&lt;</span> <span class="mi">200</span><span class="p">:</span>  <span class="c1"># edge</span>
</span><span id="WeakForm-822"><a href="#WeakForm-822"><span class="linenos"> 822</span></a>            <span class="n">edge</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span><span class="s1">&#39;edge</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">group_id</span><span class="p">,</span>
</span><span id="WeakForm-823"><a href="#WeakForm-823"><span class="linenos"> 823</span></a>                                        <span class="s1">&#39;vertices of group </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">group_id</span><span class="p">,</span>
</span><span id="WeakForm-824"><a href="#WeakForm-824"><span class="linenos"> 824</span></a>                                        <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;edge&#39;</span><span class="p">)</span>
</span><span id="WeakForm-825"><a href="#WeakForm-825"><span class="linenos"> 825</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span><span class="p">[(</span><span class="s1">&#39;edge&#39;</span><span class="p">,</span> <span class="n">group_id</span><span class="p">)]</span> <span class="o">=</span> <span class="n">edge</span>
</span><span id="WeakForm-826"><a href="#WeakForm-826"><span class="linenos"> 826</span></a>            <span class="n">topological_entities_counter</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="WeakForm-827"><a href="#WeakForm-827"><span class="linenos"> 827</span></a>
</span><span id="WeakForm-828"><a href="#WeakForm-828"><span class="linenos"> 828</span></a>        <span class="k">elif</span> <span class="mi">200</span> <span class="o">&lt;=</span> <span class="n">group_id</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="p">:</span>  <span class="c1"># facet</span>
</span><span id="WeakForm-829"><a href="#WeakForm-829"><span class="linenos"> 829</span></a>            <span class="n">facet</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span><span class="s1">&#39;facet</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">group_id</span><span class="p">,</span>
</span><span id="WeakForm-830"><a href="#WeakForm-830"><span class="linenos"> 830</span></a>                                         <span class="s1">&#39;vertices of group </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">group_id</span><span class="p">,</span>
</span><span id="WeakForm-831"><a href="#WeakForm-831"><span class="linenos"> 831</span></a>                                         <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;facet&#39;</span><span class="p">)</span>
</span><span id="WeakForm-832"><a href="#WeakForm-832"><span class="linenos"> 832</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span><span class="p">[(</span><span class="s1">&#39;facet&#39;</span><span class="p">,</span> <span class="n">group_id</span><span class="p">)]</span> <span class="o">=</span> <span class="n">facet</span>
</span><span id="WeakForm-833"><a href="#WeakForm-833"><span class="linenos"> 833</span></a>            <span class="n">topological_entities_counter</span><span class="p">[</span><span class="s1">&#39;facets&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="WeakForm-834"><a href="#WeakForm-834"><span class="linenos"> 834</span></a>
</span><span id="WeakForm-835"><a href="#WeakForm-835"><span class="linenos"> 835</span></a>        <span class="k">elif</span> <span class="n">group_id</span> <span class="o">&gt;=</span> <span class="mi">300</span><span class="p">:</span>  <span class="c1"># subomega</span>
</span><span id="WeakForm-836"><a href="#WeakForm-836"><span class="linenos"> 836</span></a>            <span class="n">subomega</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span><span class="s1">&#39;subomega</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">group_id</span><span class="p">,</span>
</span><span id="WeakForm-837"><a href="#WeakForm-837"><span class="linenos"> 837</span></a>                                            <span class="s1">&#39;cells of group </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">group_id</span><span class="p">,</span>
</span><span id="WeakForm-838"><a href="#WeakForm-838"><span class="linenos"> 838</span></a>                                            <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cell&#39;</span><span class="p">)</span>
</span><span id="WeakForm-839"><a href="#WeakForm-839"><span class="linenos"> 839</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span><span class="p">[(</span><span class="s1">&#39;subomega&#39;</span><span class="p">,</span> <span class="n">group_id</span><span class="p">)]</span> <span class="o">=</span> <span class="n">subomega</span>
</span><span id="WeakForm-840"><a href="#WeakForm-840"><span class="linenos"> 840</span></a>            <span class="n">topological_entities_counter</span><span class="p">[</span><span class="s1">&#39;subomegas&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="WeakForm-841"><a href="#WeakForm-841"><span class="linenos"> 841</span></a>
</span><span id="WeakForm-842"><a href="#WeakForm-842"><span class="linenos"> 842</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="WeakForm-843"><a href="#WeakForm-843"><span class="linenos"> 843</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;group_id&#39; must be a positive integer.&quot;</span><span class="p">)</span>
</span><span id="WeakForm-844"><a href="#WeakForm-844"><span class="linenos"> 844</span></a>
</span><span id="WeakForm-845"><a href="#WeakForm-845"><span class="linenos"> 845</span></a>    <span class="k">def</span> <span class="nf">_fill_region_dict_from_dim_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">FEDomain</span><span class="p">,</span> <span class="n">ent_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="WeakForm-846"><a href="#WeakForm-846"><span class="linenos"> 846</span></a>                                        <span class="n">func</span><span class="p">:</span> <span class="n">callable</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="WeakForm-847"><a href="#WeakForm-847"><span class="linenos"> 847</span></a>                                        <span class="n">topological_entities_counter</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="WeakForm-848"><a href="#WeakForm-848"><span class="linenos"> 848</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm-849"><a href="#WeakForm-849"><span class="linenos"> 849</span></a><span class="sd">        Fill the `region_dict` dictionary with a single additional item based</span>
</span><span id="WeakForm-850"><a href="#WeakForm-850"><span class="linenos"> 850</span></a><span class="sd">        on the provided (entity dimension, function selection) pair. This</span>
</span><span id="WeakForm-851"><a href="#WeakForm-851"><span class="linenos"> 851</span></a><span class="sd">        method is to be called after `_fill_region_dict_from_group_id`, because</span>
</span><span id="WeakForm-852"><a href="#WeakForm-852"><span class="linenos"> 852</span></a><span class="sd">        it checks whether keys are already listed in the &#39;region_dict&#39;.</span>
</span><span id="WeakForm-853"><a href="#WeakForm-853"><span class="linenos"> 853</span></a>
</span><span id="WeakForm-854"><a href="#WeakForm-854"><span class="linenos"> 854</span></a><span class="sd">        Parameters</span>
</span><span id="WeakForm-855"><a href="#WeakForm-855"><span class="linenos"> 855</span></a><span class="sd">        ----------</span>
</span><span id="WeakForm-856"><a href="#WeakForm-856"><span class="linenos"> 856</span></a><span class="sd">        domain : `sfepy.discrete.fem.domain.FEDomain`</span>
</span><span id="WeakForm-857"><a href="#WeakForm-857"><span class="linenos"> 857</span></a><span class="sd">            Sfepy Domain instance.</span>
</span><span id="WeakForm-858"><a href="#WeakForm-858"><span class="linenos"> 858</span></a><span class="sd">        ent_dim : int</span>
</span><span id="WeakForm-859"><a href="#WeakForm-859"><span class="linenos"> 859</span></a><span class="sd">            Dimension of the selected topological entity.</span>
</span><span id="WeakForm-860"><a href="#WeakForm-860"><span class="linenos"> 860</span></a><span class="sd">        func : function</span>
</span><span id="WeakForm-861"><a href="#WeakForm-861"><span class="linenos"> 861</span></a><span class="sd">            Function specifying the geometry to be selected, e.g.</span>
</span><span id="WeakForm-862"><a href="#WeakForm-862"><span class="linenos"> 862</span></a><span class="sd">            def func(coors, domain=None):</span>
</span><span id="WeakForm-863"><a href="#WeakForm-863"><span class="linenos"> 863</span></a><span class="sd">                return np.where(np.linalg.norm(coors, axis=1) &lt; 1)[0]</span>
</span><span id="WeakForm-864"><a href="#WeakForm-864"><span class="linenos"> 864</span></a><span class="sd">        tag : int</span>
</span><span id="WeakForm-865"><a href="#WeakForm-865"><span class="linenos"> 865</span></a><span class="sd">            Tag assigned to the topological entity.</span>
</span><span id="WeakForm-866"><a href="#WeakForm-866"><span class="linenos"> 866</span></a><span class="sd">        topological_entities_counter : dict</span>
</span><span id="WeakForm-867"><a href="#WeakForm-867"><span class="linenos"> 867</span></a><span class="sd">            Dictionary containing the current number of regions with a certain</span>
</span><span id="WeakForm-868"><a href="#WeakForm-868"><span class="linenos"> 868</span></a><span class="sd">            kind created.</span>
</span><span id="WeakForm-869"><a href="#WeakForm-869"><span class="linenos"> 869</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WeakForm-870"><a href="#WeakForm-870"><span class="linenos"> 870</span></a>
</span><span id="WeakForm-871"><a href="#WeakForm-871"><span class="linenos"> 871</span></a>        <span class="n">func_name</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="WeakForm-872"><a href="#WeakForm-872"><span class="linenos"> 872</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="WeakForm-873"><a href="#WeakForm-873"><span class="linenos"> 873</span></a>            <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="WeakForm-874"><a href="#WeakForm-874"><span class="linenos"> 874</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;tag </span><span class="si">{}</span><span class="s2"> is already assigned to some &quot;</span>
</span><span id="WeakForm-875"><a href="#WeakForm-875"><span class="linenos"> 875</span></a>                                 <span class="s2">&quot;topological entity&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span>
</span><span id="WeakForm-876"><a href="#WeakForm-876"><span class="linenos"> 876</span></a>
</span><span id="WeakForm-877"><a href="#WeakForm-877"><span class="linenos"> 877</span></a>        <span class="k">if</span> <span class="n">ent_dim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># vertex</span>
</span><span id="WeakForm-878"><a href="#WeakForm-878"><span class="linenos"> 878</span></a>            <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">tag</span> <span class="o">&lt;</span> <span class="mi">100</span>
</span><span id="WeakForm-879"><a href="#WeakForm-879"><span class="linenos"> 879</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;vertex&#39;</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm-880"><a href="#WeakForm-880"><span class="linenos"> 880</span></a>            <span class="n">topological_entities_counter</span><span class="p">[</span><span class="s1">&#39;vertices&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="WeakForm-881"><a href="#WeakForm-881"><span class="linenos"> 881</span></a>            <span class="n">region</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span><span class="s1">&#39;vertex</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">tag</span><span class="p">,</span>
</span><span id="WeakForm-882"><a href="#WeakForm-882"><span class="linenos"> 882</span></a>                                          <span class="s1">&#39;vertices by </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">func_name</span><span class="p">,</span>
</span><span id="WeakForm-883"><a href="#WeakForm-883"><span class="linenos"> 883</span></a>                                          <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;vertex&#39;</span><span class="p">,</span>
</span><span id="WeakForm-884"><a href="#WeakForm-884"><span class="linenos"> 884</span></a>                                          <span class="n">functions</span><span class="o">=</span><span class="p">{</span><span class="n">func_name</span><span class="p">:</span> <span class="n">func</span><span class="p">})</span>
</span><span id="WeakForm-885"><a href="#WeakForm-885"><span class="linenos"> 885</span></a>        <span class="k">elif</span> <span class="n">ent_dim</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># edge</span>
</span><span id="WeakForm-886"><a href="#WeakForm-886"><span class="linenos"> 886</span></a>            <span class="k">assert</span> <span class="mi">100</span> <span class="o">&lt;=</span> <span class="n">tag</span> <span class="o">&lt;</span> <span class="mi">200</span>
</span><span id="WeakForm-887"><a href="#WeakForm-887"><span class="linenos"> 887</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;edge&#39;</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm-888"><a href="#WeakForm-888"><span class="linenos"> 888</span></a>            <span class="n">topological_entities_counter</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="WeakForm-889"><a href="#WeakForm-889"><span class="linenos"> 889</span></a>            <span class="n">region</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span><span class="s1">&#39;edge</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">tag</span><span class="p">,</span>
</span><span id="WeakForm-890"><a href="#WeakForm-890"><span class="linenos"> 890</span></a>                                          <span class="s1">&#39;vertices by </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">func_name</span><span class="p">,</span>
</span><span id="WeakForm-891"><a href="#WeakForm-891"><span class="linenos"> 891</span></a>                                          <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;edge&#39;</span><span class="p">,</span>
</span><span id="WeakForm-892"><a href="#WeakForm-892"><span class="linenos"> 892</span></a>                                          <span class="n">functions</span><span class="o">=</span><span class="p">{</span><span class="n">func_name</span><span class="p">:</span> <span class="n">func</span><span class="p">})</span>
</span><span id="WeakForm-893"><a href="#WeakForm-893"><span class="linenos"> 893</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">-</span> <span class="n">ent_dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># facet</span>
</span><span id="WeakForm-894"><a href="#WeakForm-894"><span class="linenos"> 894</span></a>            <span class="k">assert</span> <span class="mi">200</span> <span class="o">&lt;=</span> <span class="n">tag</span> <span class="o">&lt;</span> <span class="mi">300</span>
</span><span id="WeakForm-895"><a href="#WeakForm-895"><span class="linenos"> 895</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;facet&#39;</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm-896"><a href="#WeakForm-896"><span class="linenos"> 896</span></a>            <span class="n">topological_entities_counter</span><span class="p">[</span><span class="s1">&#39;facets&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="WeakForm-897"><a href="#WeakForm-897"><span class="linenos"> 897</span></a>            <span class="n">region</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span><span class="s1">&#39;facet</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">tag</span><span class="p">,</span>
</span><span id="WeakForm-898"><a href="#WeakForm-898"><span class="linenos"> 898</span></a>                                          <span class="s1">&#39;vertices by </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">func_name</span><span class="p">,</span>
</span><span id="WeakForm-899"><a href="#WeakForm-899"><span class="linenos"> 899</span></a>                                          <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;facet&#39;</span><span class="p">,</span>
</span><span id="WeakForm-900"><a href="#WeakForm-900"><span class="linenos"> 900</span></a>                                          <span class="n">functions</span><span class="o">=</span><span class="p">{</span><span class="n">func_name</span><span class="p">:</span> <span class="n">func</span><span class="p">})</span>
</span><span id="WeakForm-901"><a href="#WeakForm-901"><span class="linenos"> 901</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="n">ent_dim</span><span class="p">:</span>  <span class="c1"># subomega</span>
</span><span id="WeakForm-902"><a href="#WeakForm-902"><span class="linenos"> 902</span></a>            <span class="k">assert</span> <span class="n">tag</span> <span class="o">&gt;=</span> <span class="mi">300</span>
</span><span id="WeakForm-903"><a href="#WeakForm-903"><span class="linenos"> 903</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;subomega&#39;</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm-904"><a href="#WeakForm-904"><span class="linenos"> 904</span></a>            <span class="n">topological_entities_counter</span><span class="p">[</span><span class="s1">&#39;subomegas&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="WeakForm-905"><a href="#WeakForm-905"><span class="linenos"> 905</span></a>            <span class="n">region</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span><span class="s1">&#39;subomega</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">tag</span><span class="p">,</span>
</span><span id="WeakForm-906"><a href="#WeakForm-906"><span class="linenos"> 906</span></a>                                          <span class="s1">&#39;cells by </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">func_name</span><span class="p">,</span>
</span><span id="WeakForm-907"><a href="#WeakForm-907"><span class="linenos"> 907</span></a>                                          <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cell&#39;</span><span class="p">,</span>
</span><span id="WeakForm-908"><a href="#WeakForm-908"><span class="linenos"> 908</span></a>                                          <span class="n">functions</span><span class="o">=</span><span class="p">{</span><span class="n">func_name</span><span class="p">:</span> <span class="n">func</span><span class="p">})</span>
</span><span id="WeakForm-909"><a href="#WeakForm-909"><span class="linenos"> 909</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="WeakForm-910"><a href="#WeakForm-910"><span class="linenos"> 910</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="WeakForm-911"><a href="#WeakForm-911"><span class="linenos"> 911</span></a>                <span class="s2">&quot;Invalid dimension specified in &#39;dim_func_entities&#39;.&quot;</span><span class="p">)</span>
</span><span id="WeakForm-912"><a href="#WeakForm-912"><span class="linenos"> 912</span></a>
</span><span id="WeakForm-913"><a href="#WeakForm-913"><span class="linenos"> 913</span></a>        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span><span class="p">:</span>
</span><span id="WeakForm-914"><a href="#WeakForm-914"><span class="linenos"> 914</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Overwritten key of &#39;region_dict&#39;!&quot;</span><span class="p">)</span>
</span><span id="WeakForm-915"><a href="#WeakForm-915"><span class="linenos"> 915</span></a>
</span><span id="WeakForm-916"><a href="#WeakForm-916"><span class="linenos"> 916</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">region</span>
</span><span id="WeakForm-917"><a href="#WeakForm-917"><span class="linenos"> 917</span></a>
</span><span id="WeakForm-918"><a href="#WeakForm-918"><span class="linenos"> 918</span></a>    <span class="k">def</span> <span class="nf">_get_tag_pb_lists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="WeakForm-919"><a href="#WeakForm-919"><span class="linenos"> 919</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm-920"><a href="#WeakForm-920"><span class="linenos"> 920</span></a><span class="sd">        Create a list of tags and a corresponding list of `Problem`</span>
</span><span id="WeakForm-921"><a href="#WeakForm-921"><span class="linenos"> 921</span></a><span class="sd">        instances for convenience.</span>
</span><span id="WeakForm-922"><a href="#WeakForm-922"><span class="linenos"> 922</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WeakForm-923"><a href="#WeakForm-923"><span class="linenos"> 923</span></a>        <span class="n">pb_cst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pb_cst</span>
</span><span id="WeakForm-924"><a href="#WeakForm-924"><span class="linenos"> 924</span></a>        <span class="n">pb_mod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pb_mod</span>
</span><span id="WeakForm-925"><a href="#WeakForm-925"><span class="linenos"> 925</span></a>        <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;cst&#39;</span><span class="p">:</span>
</span><span id="WeakForm-926"><a href="#WeakForm-926"><span class="linenos"> 926</span></a>            <span class="n">pb_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">pb_cst</span><span class="p">]</span>
</span><span id="WeakForm-927"><a href="#WeakForm-927"><span class="linenos"> 927</span></a>            <span class="n">tag_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">tag</span><span class="p">]</span>
</span><span id="WeakForm-928"><a href="#WeakForm-928"><span class="linenos"> 928</span></a>        <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;mod&#39;</span><span class="p">:</span>
</span><span id="WeakForm-929"><a href="#WeakForm-929"><span class="linenos"> 929</span></a>            <span class="n">pb_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">pb_mod</span><span class="p">]</span>
</span><span id="WeakForm-930"><a href="#WeakForm-930"><span class="linenos"> 930</span></a>            <span class="n">tag_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">tag</span><span class="p">]</span>
</span><span id="WeakForm-931"><a href="#WeakForm-931"><span class="linenos"> 931</span></a>        <span class="k">else</span><span class="p">:</span>  <span class="c1"># &#39;tag&#39; is then expected to be set to &#39;both&#39;</span>
</span><span id="WeakForm-932"><a href="#WeakForm-932"><span class="linenos"> 932</span></a>            <span class="n">pb_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">pb_cst</span><span class="p">,</span> <span class="n">pb_mod</span><span class="p">]</span> <span class="k">if</span> <span class="n">pb_mod</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[</span><span class="n">pb_cst</span><span class="p">]</span>
</span><span id="WeakForm-933"><a href="#WeakForm-933"><span class="linenos"> 933</span></a>            <span class="n">tag_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cst&#39;</span><span class="p">,</span> <span class="s1">&#39;mod&#39;</span><span class="p">]</span>
</span><span id="WeakForm-934"><a href="#WeakForm-934"><span class="linenos"> 934</span></a>        <span class="k">return</span> <span class="n">tag_list</span><span class="p">,</span> <span class="n">pb_list</span>
</span><span id="WeakForm-935"><a href="#WeakForm-935"><span class="linenos"> 935</span></a>
</span><span id="WeakForm-936"><a href="#WeakForm-936"><span class="linenos"> 936</span></a>    <span class="nd">@classmethod</span>
</span><span id="WeakForm-937"><a href="#WeakForm-937"><span class="linenos"> 937</span></a>    <span class="k">def</span> <span class="nf">_check_pre_ebc_dict_format</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">pre_ebc_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="WeakForm-938"><a href="#WeakForm-938"><span class="linenos"> 938</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check that `ebc_dict` has the right format.&quot;&quot;&quot;</span>
</span><span id="WeakForm-939"><a href="#WeakForm-939"><span class="linenos"> 939</span></a>        <span class="k">if</span> <span class="n">pre_ebc_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="WeakForm-940"><a href="#WeakForm-940"><span class="linenos"> 940</span></a>            <span class="n">pre_ebc_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="WeakForm-941"><a href="#WeakForm-941"><span class="linenos"> 941</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">pre_ebc_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="WeakForm-942"><a href="#WeakForm-942"><span class="linenos"> 942</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="WeakForm-943"><a href="#WeakForm-943"><span class="linenos"> 943</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Keys of &#39;pre_ebc_dict&#39; must be pairs &quot;</span>
</span><span id="WeakForm-944"><a href="#WeakForm-944"><span class="linenos"> 944</span></a>                                 <span class="s2">&quot;specifying the topological entity kind and &quot;</span>
</span><span id="WeakForm-945"><a href="#WeakForm-945"><span class="linenos"> 945</span></a>                                 <span class="s2">&quot;tag&quot;</span><span class="p">)</span>
</span><span id="WeakForm-946"><a href="#WeakForm-946"><span class="linenos"> 946</span></a>            <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_topological_kinds_ebc</span><span class="p">:</span>
</span><span id="WeakForm-947"><a href="#WeakForm-947"><span class="linenos"> 947</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; is not a valid kind for ebc&quot;</span><span class="p">)</span>
</span><span id="WeakForm-948"><a href="#WeakForm-948"><span class="linenos"> 948</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">Number</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
</span><span id="WeakForm-949"><a href="#WeakForm-949"><span class="linenos"> 949</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Values of &#39;pre_ebc_dict&#39; must either be a &quot;</span>
</span><span id="WeakForm-950"><a href="#WeakForm-950"><span class="linenos"> 950</span></a>                                 <span class="s2">&quot;single number or a function&quot;</span><span class="p">)</span>
</span><span id="WeakForm-951"><a href="#WeakForm-951"><span class="linenos"> 951</span></a>
</span><span id="WeakForm-952"><a href="#WeakForm-952"><span class="linenos"> 952</span></a>    <span class="nd">@staticmethod</span>
</span><span id="WeakForm-953"><a href="#WeakForm-953"><span class="linenos"> 953</span></a>    <span class="k">def</span> <span class="nf">_deplete_mat_datas</span><span class="p">(</span><span class="n">pb</span><span class="p">):</span>
</span><span id="WeakForm-954"><a href="#WeakForm-954"><span class="linenos"> 954</span></a>        <span class="k">for</span> <span class="n">mat</span> <span class="ow">in</span> <span class="n">pb</span><span class="o">.</span><span class="n">get_materials</span><span class="p">():</span>
</span><span id="WeakForm-955"><a href="#WeakForm-955"><span class="linenos"> 955</span></a>            <span class="n">mat</span><span class="o">.</span><span class="n">datas</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="WeakForm-956"><a href="#WeakForm-956"><span class="linenos"> 956</span></a>
</span><span id="WeakForm-957"><a href="#WeakForm-957"><span class="linenos"> 957</span></a>    <span class="nd">@staticmethod</span>
</span><span id="WeakForm-958"><a href="#WeakForm-958"><span class="linenos"> 958</span></a>    <span class="k">def</span> <span class="nf">_has_nonlinear_term</span><span class="p">(</span><span class="n">pre_terms</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PreTerm</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="WeakForm-959"><a href="#WeakForm-959"><span class="linenos"> 959</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if `pre_terms` list contains at least one pre_term with</span>
</span><span id="WeakForm-960"><a href="#WeakForm-960"><span class="linenos"> 960</span></a><span class="sd">        tag &#39;mod&#39;.&quot;&quot;&quot;</span>
</span><span id="WeakForm-961"><a href="#WeakForm-961"><span class="linenos"> 961</span></a>        <span class="k">for</span> <span class="n">pre_term</span> <span class="ow">in</span> <span class="n">pre_terms</span><span class="p">:</span>
</span><span id="WeakForm-962"><a href="#WeakForm-962"><span class="linenos"> 962</span></a>            <span class="k">if</span> <span class="n">pre_term</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;mod&#39;</span><span class="p">:</span>
</span><span id="WeakForm-963"><a href="#WeakForm-963"><span class="linenos"> 963</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="WeakForm-964"><a href="#WeakForm-964"><span class="linenos"> 964</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="WeakForm-965"><a href="#WeakForm-965"><span class="linenos"> 965</span></a>
</span><span id="WeakForm-966"><a href="#WeakForm-966"><span class="linenos"> 966</span></a>    <span class="k">def</span> <span class="nf">_check_pb_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="WeakForm-967"><a href="#WeakForm-967"><span class="linenos"> 967</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check that &#39;tag&#39; and current `Problem` attributes comply.&quot;&quot;&quot;</span>
</span><span id="WeakForm-968"><a href="#WeakForm-968"><span class="linenos"> 968</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm-969"><a href="#WeakForm-969"><span class="linenos"> 969</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pb_cst</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="WeakForm-970"><a href="#WeakForm-970"><span class="linenos"> 970</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Problem instances  have not been created yet. &quot;</span>
</span><span id="WeakForm-971"><a href="#WeakForm-971"><span class="linenos"> 971</span></a>                             <span class="s2">&quot;Consider calling &#39;set_problems&#39; beforehand.&quot;</span><span class="p">)</span>
</span><span id="WeakForm-972"><a href="#WeakForm-972"><span class="linenos"> 972</span></a>        <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;mod&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pb_mod</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="WeakForm-973"><a href="#WeakForm-973"><span class="linenos"> 973</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;pb_mod&#39; is not set&quot;</span><span class="p">)</span>
</span><span id="WeakForm-974"><a href="#WeakForm-974"><span class="linenos"> 974</span></a>
</span><span id="WeakForm-975"><a href="#WeakForm-975"><span class="linenos"> 975</span></a>    <span class="nd">@staticmethod</span>
</span><span id="WeakForm-976"><a href="#WeakForm-976"><span class="linenos"> 976</span></a>    <span class="k">def</span> <span class="nf">_check_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="WeakForm-977"><a href="#WeakForm-977"><span class="linenos"> 977</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check that &#39;tag&#39; is either &#39;cst&#39;, &#39;mod&#39; or &#39;both&#39;.&quot;&quot;&quot;</span>
</span><span id="WeakForm-978"><a href="#WeakForm-978"><span class="linenos"> 978</span></a>        <span class="n">valid_tags</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cst&#39;</span><span class="p">,</span> <span class="s1">&#39;mod&#39;</span><span class="p">,</span> <span class="s1">&#39;both&#39;</span><span class="p">]</span>
</span><span id="WeakForm-979"><a href="#WeakForm-979"><span class="linenos"> 979</span></a>        <span class="k">if</span> <span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_tags</span><span class="p">:</span>
</span><span id="WeakForm-980"><a href="#WeakForm-980"><span class="linenos"> 980</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid &#39;tag&#39; (valid tags are </span><span class="si">{</span><span class="n">valid_tags</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="WeakForm-981"><a href="#WeakForm-981"><span class="linenos"> 981</span></a>
</span><span id="WeakForm-982"><a href="#WeakForm-982"><span class="linenos"> 982</span></a>    <span class="nd">@staticmethod</span>
</span><span id="WeakForm-983"><a href="#WeakForm-983"><span class="linenos"> 983</span></a>    <span class="k">def</span> <span class="nf">_check_args_before_merging</span><span class="p">(</span><span class="n">wf_int</span><span class="p">:</span> <span class="n">WeakForm</span><span class="p">,</span>
</span><span id="WeakForm-984"><a href="#WeakForm-984"><span class="linenos"> 984</span></a>                                   <span class="n">wf_ext</span><span class="p">:</span> <span class="n">WeakForm</span><span class="p">,</span>
</span><span id="WeakForm-985"><a href="#WeakForm-985"><span class="linenos"> 985</span></a>                                   <span class="n">region_key_int</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span>
</span><span id="WeakForm-986"><a href="#WeakForm-986"><span class="linenos"> 986</span></a>                                   <span class="n">region_key_ext</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="WeakForm-987"><a href="#WeakForm-987"><span class="linenos"> 987</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check that arguments of `from_two_weak_forms` are compliant for</span>
</span><span id="WeakForm-988"><a href="#WeakForm-988"><span class="linenos"> 988</span></a><span class="sd">        proceeding to the merging of the two weak forms.&quot;&quot;&quot;</span>
</span><span id="WeakForm-989"><a href="#WeakForm-989"><span class="linenos"> 989</span></a>
</span><span id="WeakForm-990"><a href="#WeakForm-990"><span class="linenos"> 990</span></a>        <span class="c1"># Check dim</span>
</span><span id="WeakForm-991"><a href="#WeakForm-991"><span class="linenos"> 991</span></a>        <span class="k">if</span> <span class="n">wf_int</span><span class="o">.</span><span class="n">dim</span> <span class="o">!=</span> <span class="n">wf_ext</span><span class="o">.</span><span class="n">dim</span><span class="p">:</span>
</span><span id="WeakForm-992"><a href="#WeakForm-992"><span class="linenos"> 992</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The two weak forms have different dimensions!&quot;</span><span class="p">)</span>
</span><span id="WeakForm-993"><a href="#WeakForm-993"><span class="linenos"> 993</span></a>
</span><span id="WeakForm-994"><a href="#WeakForm-994"><span class="linenos"> 994</span></a>        <span class="c1"># Check fem_order</span>
</span><span id="WeakForm-995"><a href="#WeakForm-995"><span class="linenos"> 995</span></a>        <span class="k">if</span> <span class="n">wf_int</span><span class="o">.</span><span class="n">fem_order</span> <span class="o">!=</span> <span class="n">wf_ext</span><span class="o">.</span><span class="n">fem_order</span><span class="p">:</span>
</span><span id="WeakForm-996"><a href="#WeakForm-996"><span class="linenos"> 996</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="WeakForm-997"><a href="#WeakForm-997"><span class="linenos"> 997</span></a>                <span class="s2">&quot;The two weak forms have different &#39;fem_order&#39; attributes!&quot;</span><span class="p">)</span>
</span><span id="WeakForm-998"><a href="#WeakForm-998"><span class="linenos"> 998</span></a>
</span><span id="WeakForm-999"><a href="#WeakForm-999"><span class="linenos"> 999</span></a>        <span class="c1"># Check if specified regions exist</span>
</span><span id="WeakForm-1000"><a href="#WeakForm-1000"><span class="linenos">1000</span></a>        <span class="k">if</span> <span class="n">region_key_int</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">wf_int</span><span class="o">.</span><span class="n">region_dict</span><span class="p">:</span>
</span><span id="WeakForm-1001"><a href="#WeakForm-1001"><span class="linenos">1001</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Region with key &#39;</span><span class="si">{</span><span class="n">region_key_int</span><span class="si">}</span><span class="s2">&#39; is not included&quot;</span>
</span><span id="WeakForm-1002"><a href="#WeakForm-1002"><span class="linenos">1002</span></a>                           <span class="sa">f</span><span class="s2">&quot;in the interior weak form &#39;region_dict&#39; with keys &quot;</span>
</span><span id="WeakForm-1003"><a href="#WeakForm-1003"><span class="linenos">1003</span></a>                           <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">wf_int</span><span class="o">.</span><span class="n">region_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="WeakForm-1004"><a href="#WeakForm-1004"><span class="linenos">1004</span></a>        <span class="k">if</span> <span class="n">region_key_ext</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">wf_ext</span><span class="o">.</span><span class="n">region_dict</span><span class="p">:</span>
</span><span id="WeakForm-1005"><a href="#WeakForm-1005"><span class="linenos">1005</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Region with key &#39;</span><span class="si">{</span><span class="n">region_key_ext</span><span class="si">}</span><span class="s2">&#39; is not included&quot;</span>
</span><span id="WeakForm-1006"><a href="#WeakForm-1006"><span class="linenos">1006</span></a>                           <span class="sa">f</span><span class="s2">&quot; in the exterior weak form &#39;region_dict&#39; with keys&quot;</span>
</span><span id="WeakForm-1007"><a href="#WeakForm-1007"><span class="linenos">1007</span></a>                           <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">wf_ext</span><span class="o">.</span><span class="n">region_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="WeakForm-1008"><a href="#WeakForm-1008"><span class="linenos">1008</span></a>
</span><span id="WeakForm-1009"><a href="#WeakForm-1009"><span class="linenos">1009</span></a>        <span class="c1"># Check that both regions have the same number of DOFs</span>
</span><span id="WeakForm-1010"><a href="#WeakForm-1010"><span class="linenos">1010</span></a>        <span class="n">n_dofs_int</span> <span class="o">=</span> <span class="n">wf_int</span><span class="o">.</span><span class="n">region_dict</span><span class="p">[</span><span class="n">region_key_int</span><span class="p">]</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="WeakForm-1011"><a href="#WeakForm-1011"><span class="linenos">1011</span></a>        <span class="n">n_dofs_ext</span> <span class="o">=</span> <span class="n">wf_ext</span><span class="o">.</span><span class="n">region_dict</span><span class="p">[</span><span class="n">region_key_ext</span><span class="p">]</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="WeakForm-1012"><a href="#WeakForm-1012"><span class="linenos">1012</span></a>        <span class="k">if</span> <span class="n">n_dofs_int</span> <span class="o">!=</span> <span class="n">n_dofs_ext</span><span class="p">:</span>
</span><span id="WeakForm-1013"><a href="#WeakForm-1013"><span class="linenos">1013</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="WeakForm-1014"><a href="#WeakForm-1014"><span class="linenos">1014</span></a>                <span class="s2">&quot;Connecting regions do not have the same number of DOFs!&quot;</span><span class="p">)</span>
</span><span id="WeakForm-1015"><a href="#WeakForm-1015"><span class="linenos">1015</span></a>
</span><span id="WeakForm-1016"><a href="#WeakForm-1016"><span class="linenos">1016</span></a>        <span class="c1"># Check that both weak forms have the same (non)linearity settings</span>
</span><span id="WeakForm-1017"><a href="#WeakForm-1017"><span class="linenos">1017</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">wf_int</span><span class="o">.</span><span class="n">pb_mod</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="p">(</span><span class="n">wf_ext</span><span class="o">.</span><span class="n">pb_mod</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="WeakForm-1018"><a href="#WeakForm-1018"><span class="linenos">1018</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="WeakForm-1019"><a href="#WeakForm-1019"><span class="linenos">1019</span></a>                <span class="s2">&quot;One weak form is nonlinear while the other one is linear!&quot;</span><span class="p">)</span>
</span><span id="WeakForm-1020"><a href="#WeakForm-1020"><span class="linenos">1020</span></a>
</span><span id="WeakForm-1021"><a href="#WeakForm-1021"><span class="linenos">1021</span></a>        <span class="c1"># Check that the weak forms have different names</span>
</span><span id="WeakForm-1022"><a href="#WeakForm-1022"><span class="linenos">1022</span></a>        <span class="k">if</span> <span class="n">wf_int</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">wf_ext</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span id="WeakForm-1023"><a href="#WeakForm-1023"><span class="linenos">1023</span></a>            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The two provided weak forms have the same name &quot;</span>
</span><span id="WeakForm-1024"><a href="#WeakForm-1024"><span class="linenos">1024</span></a>                            <span class="sa">f</span><span class="s2">&quot;(&#39;</span><span class="si">{</span><span class="n">wf_int</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;): abort combination.&quot;</span><span class="p">)</span>
</span><span id="WeakForm-1025"><a href="#WeakForm-1025"><span class="linenos">1025</span></a>
</span><span id="WeakForm-1026"><a href="#WeakForm-1026"><span class="linenos">1026</span></a>    <span class="k">def</span> <span class="nf">_fix_pb_without_state_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WeakForm-1027"><a href="#WeakForm-1027"><span class="linenos">1027</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm-1028"><a href="#WeakForm-1028"><span class="linenos">1028</span></a><span class="sd">        For tag = (&#39;cst&#39;, &#39;mod&#39;), add a zero dummy `PreTerm` instance to the</span>
</span><span id="WeakForm-1029"><a href="#WeakForm-1029"><span class="linenos">1029</span></a><span class="sd">        list `self.pre_terms` if it does not feature any &#39;matrix term&#39;.</span>
</span><span id="WeakForm-1030"><a href="#WeakForm-1030"><span class="linenos">1030</span></a>
</span><span id="WeakForm-1031"><a href="#WeakForm-1031"><span class="linenos">1031</span></a><span class="sd">        Notes</span>
</span><span id="WeakForm-1032"><a href="#WeakForm-1032"><span class="linenos">1032</span></a><span class="sd">        -----</span>
</span><span id="WeakForm-1033"><a href="#WeakForm-1033"><span class="linenos">1033</span></a><span class="sd">        This is a (dirty) fix to the issue encountered when trying to assemble</span>
</span><span id="WeakForm-1034"><a href="#WeakForm-1034"><span class="linenos">1034</span></a><span class="sd">        rhs vector from `Problem` instances with no matrix terms. Adding a</span>
</span><span id="WeakForm-1035"><a href="#WeakForm-1035"><span class="linenos">1035</span></a><span class="sd">        zero matrix term solves the issue. So far, there is no other fix</span>
</span><span id="WeakForm-1036"><a href="#WeakForm-1036"><span class="linenos">1036</span></a><span class="sd">        available.</span>
</span><span id="WeakForm-1037"><a href="#WeakForm-1037"><span class="linenos">1037</span></a>
</span><span id="WeakForm-1038"><a href="#WeakForm-1038"><span class="linenos">1038</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WeakForm-1039"><a href="#WeakForm-1039"><span class="linenos">1039</span></a>
</span><span id="WeakForm-1040"><a href="#WeakForm-1040"><span class="linenos">1040</span></a>        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cst&#39;</span><span class="p">,</span> <span class="s1">&#39;mod&#39;</span><span class="p">]:</span>
</span><span id="WeakForm-1041"><a href="#WeakForm-1041"><span class="linenos">1041</span></a>            <span class="n">has_matrix_term</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="WeakForm-1042"><a href="#WeakForm-1042"><span class="linenos">1042</span></a>            <span class="n">has_tag</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="WeakForm-1043"><a href="#WeakForm-1043"><span class="linenos">1043</span></a>            <span class="k">for</span> <span class="n">pre_term</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_terms</span><span class="p">:</span>
</span><span id="WeakForm-1044"><a href="#WeakForm-1044"><span class="linenos">1044</span></a>                <span class="k">if</span> <span class="n">pre_term</span><span class="o">.</span><span class="n">tag</span> <span class="o">!=</span> <span class="n">tag</span><span class="p">:</span>
</span><span id="WeakForm-1045"><a href="#WeakForm-1045"><span class="linenos">1045</span></a>                    <span class="k">continue</span>
</span><span id="WeakForm-1046"><a href="#WeakForm-1046"><span class="linenos">1046</span></a>                <span class="n">has_tag</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="WeakForm-1047"><a href="#WeakForm-1047"><span class="linenos">1047</span></a>                <span class="k">if</span> <span class="n">is_matrix_term</span><span class="p">(</span><span class="n">pre_term</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
</span><span id="WeakForm-1048"><a href="#WeakForm-1048"><span class="linenos">1048</span></a>                    <span class="n">has_matrix_term</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="WeakForm-1049"><a href="#WeakForm-1049"><span class="linenos">1049</span></a>                    <span class="k">break</span>
</span><span id="WeakForm-1050"><a href="#WeakForm-1050"><span class="linenos">1050</span></a>
</span><span id="WeakForm-1051"><a href="#WeakForm-1051"><span class="linenos">1051</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">has_matrix_term</span> <span class="ow">and</span> <span class="n">has_tag</span><span class="p">:</span>
</span><span id="WeakForm-1052"><a href="#WeakForm-1052"><span class="linenos">1052</span></a>                <span class="k">def</span> <span class="nf">mat_zero</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">coors</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vec_qp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="WeakForm-1053"><a href="#WeakForm-1053"><span class="linenos">1053</span></a>                    <span class="k">if</span> <span class="n">mode</span> <span class="o">!=</span> <span class="s1">&#39;qp&#39;</span><span class="p">:</span> <span class="k">return</span>
</span><span id="WeakForm-1054"><a href="#WeakForm-1054"><span class="linenos">1054</span></a>                    <span class="n">val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">coors</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="WeakForm-1055"><a href="#WeakForm-1055"><span class="linenos">1055</span></a>                    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span> <span class="n">val</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)}</span>
</span><span id="WeakForm-1056"><a href="#WeakForm-1056"><span class="linenos">1056</span></a>                <span class="n">dummy_term</span> <span class="o">=</span> <span class="n">PreTerm</span><span class="p">(</span>
</span><span id="WeakForm-1057"><a href="#WeakForm-1057"><span class="linenos">1057</span></a>                    <span class="s1">&#39;dw_laplace&#39;</span><span class="p">,</span> <span class="n">mat</span><span class="o">=</span><span class="n">mat_zero</span><span class="p">,</span> <span class="n">prefactor</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm-1058"><a href="#WeakForm-1058"><span class="linenos">1058</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pre_terms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dummy_term</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Class gathering objects linked to the weak formulation of some PDE.</p>

<h6 id="attributes">Attributes</h6>

<ul>
<li><strong>name</strong> (str):
Name of the weak form.</li>
<li><strong>dim</strong> (int):
Dimension of the problem: 1, 2 or 3.</li>
<li><strong>region_dict</strong> (dict):
Dictionary of regions with
keys: pairs topological kind - tag, e.g. ('subomega', 301).
values: corresponding Sfepy <code>Region</code> instances.</li>
<li><strong>ebc_dict</strong> (dict):
Dictionary of essential boundary conditions with
keys: same as <code><a href="#WeakForm.region_dict">region_dict</a></code>.
values: dictionary with keys ('cst', 'mod') containing corresponding
Sfepy's <code>EssentialBC</code> instances.</li>
<li><strong>pre_terms</strong> (list[PreTerm]):
List of <code>PreTerm</code> instances. Each 'pre_term' contains extra information
with respect to Sfepy's <code>Term</code> instance.</li>
<li><strong>fem_order</strong> (int):
Finite Element approximation order.</li>
<li><strong>pb_cst</strong> (Problem):
Sfepy's Problem instance associated with the linear part of the PDE.</li>
<li><strong>pb_mod</strong> (Problem):
Sfepy's Problem instance associated with the nonlinear part of the PDE.</li>
<li><strong>mtx_vec</strong> (MatrixVector):
Instance of class <code>MatrixVector</code> for storing assembled matrices and
vectors associated with the current weak form.</li>
<li><strong>_active_bcs</strong> (dict):
Private attribute indicating whether boundary conditions are set active
on <code><a href="#WeakForm.pb_cst">pb_cst</a></code> and <code><a href="#WeakForm.pb_mod">pb_mod</a></code>.</li>
</ul>

<h6 id="properties">Properties</h6>

<p>active_bcs : dict
    Proxy for <code>_active_bcs</code> in read-only mode.
field : Field
    Sfepy Field instance.
integral : Integral
    Sfepy Integral instance.
ndofs : int
    Total number of degrees of freedom.
vec_bc : np.ndarray
    Full vector filled with zeros except at fixed DOFs where Dirichlet
    BC values are used.</p>
</div>


                            <div id="WeakForm.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.name"></a>
    
    

                            </div>
                            <div id="WeakForm.dim" class="classattr">
                                <div class="attr variable">
            <span class="name">dim</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.dim"></a>
    
    

                            </div>
                            <div id="WeakForm.region_dict" class="classattr">
                                <div class="attr variable">
            <span class="name">region_dict</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.region_dict"></a>
    
    

                            </div>
                            <div id="WeakForm.ebc_dict" class="classattr">
                                <div class="attr variable">
            <span class="name">ebc_dict</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.ebc_dict"></a>
    
    

                            </div>
                            <div id="WeakForm.pre_terms" class="classattr">
                                <div class="attr variable">
            <span class="name">pre_terms</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.pre_terms"></a>
    
    

                            </div>
                            <div id="WeakForm.fem_order" class="classattr">
                                <div class="attr variable">
            <span class="name">fem_order</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.fem_order"></a>
    
    

                            </div>
                            <div id="WeakForm.pb_cst" class="classattr">
                                <div class="attr variable">
            <span class="name">pb_cst</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.pb_cst"></a>
    
    

                            </div>
                            <div id="WeakForm.pb_mod" class="classattr">
                                <div class="attr variable">
            <span class="name">pb_mod</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.pb_mod"></a>
    
    

                            </div>
                            <div id="WeakForm.mtx_vec" class="classattr">
                                <div class="attr variable">
            <span class="name">mtx_vec</span>

        
    </div>
    <a class="headerlink" href="#WeakForm.mtx_vec"></a>
    
    

                            </div>
                            <div id="WeakForm.active_bcs" class="classattr">
                                        <input id="WeakForm.active_bcs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">active_bcs</span>

                <label class="view-source-button" for="WeakForm.active_bcs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeakForm.active_bcs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeakForm.active_bcs-121"><a href="#WeakForm.active_bcs-121"><span class="linenos">121</span></a>    <span class="nd">@property</span>
</span><span id="WeakForm.active_bcs-122"><a href="#WeakForm.active_bcs-122"><span class="linenos">122</span></a>    <span class="k">def</span> <span class="nf">active_bcs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WeakForm.active_bcs-123"><a href="#WeakForm.active_bcs-123"><span class="linenos">123</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_bcs</span>
</span></pre></div>


    

                            </div>
                            <div id="WeakForm.field" class="classattr">
                                        <input id="WeakForm.field-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">field</span>

                <label class="view-source-button" for="WeakForm.field-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeakForm.field"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeakForm.field-125"><a href="#WeakForm.field-125"><span class="linenos">125</span></a>    <span class="nd">@property</span>
</span><span id="WeakForm.field-126"><a href="#WeakForm.field-126"><span class="linenos">126</span></a>    <span class="k">def</span> <span class="nf">field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WeakForm.field-127"><a href="#WeakForm.field-127"><span class="linenos">127</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_field</span><span class="p">()</span>
</span></pre></div>


    

                            </div>
                            <div id="WeakForm.integral" class="classattr">
                                        <input id="WeakForm.integral-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">integral</span>

                <label class="view-source-button" for="WeakForm.integral-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeakForm.integral"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeakForm.integral-129"><a href="#WeakForm.integral-129"><span class="linenos">129</span></a>    <span class="nd">@property</span>
</span><span id="WeakForm.integral-130"><a href="#WeakForm.integral-130"><span class="linenos">130</span></a>    <span class="k">def</span> <span class="nf">integral</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WeakForm.integral-131"><a href="#WeakForm.integral-131"><span class="linenos">131</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pb_cst</span><span class="o">.</span><span class="n">equations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">terms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">integral</span>
</span></pre></div>


    

                            </div>
                            <div id="WeakForm.ndofs" class="classattr">
                                        <input id="WeakForm.ndofs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">ndofs</span>

                <label class="view-source-button" for="WeakForm.ndofs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeakForm.ndofs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeakForm.ndofs-133"><a href="#WeakForm.ndofs-133"><span class="linenos">133</span></a>    <span class="nd">@property</span>
</span><span id="WeakForm.ndofs-134"><a href="#WeakForm.ndofs-134"><span class="linenos">134</span></a>    <span class="k">def</span> <span class="nf">ndofs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WeakForm.ndofs-135"><a href="#WeakForm.ndofs-135"><span class="linenos">135</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">coors</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></pre></div>


    

                            </div>
                            <div id="WeakForm.vec_bc" class="classattr">
                                        <input id="WeakForm.vec_bc-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">vec_bc</span>

                <label class="view-source-button" for="WeakForm.vec_bc-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeakForm.vec_bc"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeakForm.vec_bc-137"><a href="#WeakForm.vec_bc-137"><span class="linenos">137</span></a>    <span class="nd">@property</span>
</span><span id="WeakForm.vec_bc-138"><a href="#WeakForm.vec_bc-138"><span class="linenos">138</span></a>    <span class="k">def</span> <span class="nf">vec_bc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WeakForm.vec_bc-139"><a href="#WeakForm.vec_bc-139"><span class="linenos">139</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Full vector filled with zeros except at fixed DOFs where Dirichlet</span>
</span><span id="WeakForm.vec_bc-140"><a href="#WeakForm.vec_bc-140"><span class="linenos">140</span></a><span class="sd">        BC values are used.&quot;&quot;&quot;</span>
</span><span id="WeakForm.vec_bc-141"><a href="#WeakForm.vec_bc-141"><span class="linenos">141</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">apply_bcs</span><span class="p">()</span>
</span><span id="WeakForm.vec_bc-142"><a href="#WeakForm.vec_bc-142"><span class="linenos">142</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pb_cst</span><span class="o">.</span><span class="n">get_variables</span><span class="p">()</span><span class="o">.</span><span class="n">get_state</span><span class="p">(</span><span class="n">reduced</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Full vector filled with zeros except at fixed DOFs where Dirichlet
BC values are used.</p>
</div>


                            </div>
                            <div id="WeakForm.from_attr_dict" class="classattr">
                                        <input id="WeakForm.from_attr_dict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">from_attr_dict</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">cls</span>,</span><span class="param">	<span class="n">attr_dict</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">verbose</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">) -> <span class="n"><a href="#WeakForm">WeakForm</a></span>:</span></span>

                <label class="view-source-button" for="WeakForm.from_attr_dict-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeakForm.from_attr_dict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeakForm.from_attr_dict-144"><a href="#WeakForm.from_attr_dict-144"><span class="linenos">144</span></a>    <span class="nd">@classmethod</span>
</span><span id="WeakForm.from_attr_dict-145"><a href="#WeakForm.from_attr_dict-145"><span class="linenos">145</span></a>    <span class="k">def</span> <span class="nf">from_attr_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">attr_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WeakForm</span><span class="p">:</span>
</span><span id="WeakForm.from_attr_dict-146"><a href="#WeakForm.from_attr_dict-146"><span class="linenos">146</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an instance of `WeakForm`, set its attributes from the</span>
</span><span id="WeakForm.from_attr_dict-147"><a href="#WeakForm.from_attr_dict-147"><span class="linenos">147</span></a><span class="sd">        `attr_dict` dictionary and return it.&quot;&quot;&quot;</span>
</span><span id="WeakForm.from_attr_dict-148"><a href="#WeakForm.from_attr_dict-148"><span class="linenos">148</span></a>        <span class="n">wf_instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
</span><span id="WeakForm.from_attr_dict-149"><a href="#WeakForm.from_attr_dict-149"><span class="linenos">149</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">attr_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="WeakForm.from_attr_dict-150"><a href="#WeakForm.from_attr_dict-150"><span class="linenos">150</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="WeakForm.from_attr_dict-151"><a href="#WeakForm.from_attr_dict-151"><span class="linenos">151</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Dictionary keys must be strings&quot;</span><span class="p">)</span>
</span><span id="WeakForm.from_attr_dict-152"><a href="#WeakForm.from_attr_dict-152"><span class="linenos">152</span></a>            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="n">wf_instance</span><span class="p">):</span>
</span><span id="WeakForm.from_attr_dict-153"><a href="#WeakForm.from_attr_dict-153"><span class="linenos">153</span></a>                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39; is not a WeakForm attribute name&quot;</span><span class="p">)</span>
</span><span id="WeakForm.from_attr_dict-154"><a href="#WeakForm.from_attr_dict-154"><span class="linenos">154</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="n">wf_instance</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
</span><span id="WeakForm.from_attr_dict-155"><a href="#WeakForm.from_attr_dict-155"><span class="linenos">155</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">attr_dict</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nb">vars</span><span class="p">(</span><span class="n">wf_instance</span><span class="p">))</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="WeakForm.from_attr_dict-156"><a href="#WeakForm.from_attr_dict-156"><span class="linenos">156</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Some attributes have not been set&quot;</span><span class="p">)</span>
</span><span id="WeakForm.from_attr_dict-157"><a href="#WeakForm.from_attr_dict-157"><span class="linenos">157</span></a>        <span class="k">return</span> <span class="n">wf_instance</span>
</span></pre></div>


            <div class="docstring"><p>Create an instance of <code><a href="#WeakForm">WeakForm</a></code>, set its attributes from the
<code>attr_dict</code> dictionary and return it.</p>
</div>


                            </div>
                            <div id="WeakForm.from_scratch" class="classattr">
                                        <input id="WeakForm.from_scratch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">from_scratch</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">args_dict</span><span class="p">:</span> <span class="nb">dict</span></span><span class="return-annotation">) -> <span class="n"><a href="#WeakForm">WeakForm</a></span>:</span></span>

                <label class="view-source-button" for="WeakForm.from_scratch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeakForm.from_scratch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeakForm.from_scratch-159"><a href="#WeakForm.from_scratch-159"><span class="linenos">159</span></a>    <span class="nd">@classmethod</span>
</span><span id="WeakForm.from_scratch-160"><a href="#WeakForm.from_scratch-160"><span class="linenos">160</span></a>    <span class="k">def</span> <span class="nf">from_scratch</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">args_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WeakForm</span><span class="p">:</span>
</span><span id="WeakForm.from_scratch-161"><a href="#WeakForm.from_scratch-161"><span class="linenos">161</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm.from_scratch-162"><a href="#WeakForm.from_scratch-162"><span class="linenos">162</span></a><span class="sd">        Create an instance of `WeakForm` and set its attributes by creating the</span>
</span><span id="WeakForm.from_scratch-163"><a href="#WeakForm.from_scratch-163"><span class="linenos">163</span></a><span class="sd">        relevant Sfepy&#39;s objects step by step. The dictionary `args_dict`</span>
</span><span id="WeakForm.from_scratch-164"><a href="#WeakForm.from_scratch-164"><span class="linenos">164</span></a><span class="sd">        passed to the function contains the following items:</span>
</span><span id="WeakForm.from_scratch-165"><a href="#WeakForm.from_scratch-165"><span class="linenos">165</span></a>
</span><span id="WeakForm.from_scratch-166"><a href="#WeakForm.from_scratch-166"><span class="linenos">166</span></a><span class="sd">        Parameters</span>
</span><span id="WeakForm.from_scratch-167"><a href="#WeakForm.from_scratch-167"><span class="linenos">167</span></a><span class="sd">        ----------</span>
</span><span id="WeakForm.from_scratch-168"><a href="#WeakForm.from_scratch-168"><span class="linenos">168</span></a><span class="sd">        dim : int</span>
</span><span id="WeakForm.from_scratch-169"><a href="#WeakForm.from_scratch-169"><span class="linenos">169</span></a><span class="sd">            Dimension of the problem: 1, 2 or 3.</span>
</span><span id="WeakForm.from_scratch-170"><a href="#WeakForm.from_scratch-170"><span class="linenos">170</span></a><span class="sd">        pre_mesh : str or `sfepy.discrete.fem.mesh.Mesh`</span>
</span><span id="WeakForm.from_scratch-171"><a href="#WeakForm.from_scratch-171"><span class="linenos">171</span></a><span class="sd">            In 1D: already existing Sfepy&#39;s `Mesh` instance.</span>
</span><span id="WeakForm.from_scratch-172"><a href="#WeakForm.from_scratch-172"><span class="linenos">172</span></a><span class="sd">            In 2D and 3D: name of the .vtk mesh file.</span>
</span><span id="WeakForm.from_scratch-173"><a href="#WeakForm.from_scratch-173"><span class="linenos">173</span></a><span class="sd">        name : str, optional</span>
</span><span id="WeakForm.from_scratch-174"><a href="#WeakForm.from_scratch-174"><span class="linenos">174</span></a><span class="sd">            Name of the weak form. The default is &#39;wf&#39;.</span>
</span><span id="WeakForm.from_scratch-175"><a href="#WeakForm.from_scratch-175"><span class="linenos">175</span></a><span class="sd">        dim_func_entities : List[tuple]</span>
</span><span id="WeakForm.from_scratch-176"><a href="#WeakForm.from_scratch-176"><span class="linenos">176</span></a><span class="sd">            List of triplets (entity dimension, function selection, tag).</span>
</span><span id="WeakForm.from_scratch-177"><a href="#WeakForm.from_scratch-177"><span class="linenos">177</span></a><span class="sd">        pre_ebc_dict : dict</span>
</span><span id="WeakForm.from_scratch-178"><a href="#WeakForm.from_scratch-178"><span class="linenos">178</span></a><span class="sd">            Dictionary that is used to assign some essential boundary conditions</span>
</span><span id="WeakForm.from_scratch-179"><a href="#WeakForm.from_scratch-179"><span class="linenos">179</span></a><span class="sd">            to some topological entities. Its keys are a subset of `region_dict`</span>
</span><span id="WeakForm.from_scratch-180"><a href="#WeakForm.from_scratch-180"><span class="linenos">180</span></a><span class="sd">            ones and its values are either numbers or functions.</span>
</span><span id="WeakForm.from_scratch-181"><a href="#WeakForm.from_scratch-181"><span class="linenos">181</span></a><span class="sd">        fem_order : int, optional</span>
</span><span id="WeakForm.from_scratch-182"><a href="#WeakForm.from_scratch-182"><span class="linenos">182</span></a><span class="sd">            Finite Element approximation order. The default is 2.</span>
</span><span id="WeakForm.from_scratch-183"><a href="#WeakForm.from_scratch-183"><span class="linenos">183</span></a><span class="sd">        pre_terms : List[PreTerm]</span>
</span><span id="WeakForm.from_scratch-184"><a href="#WeakForm.from_scratch-184"><span class="linenos">184</span></a><span class="sd">            List of `PreTerm` instances associated with the PDE to be solved.</span>
</span><span id="WeakForm.from_scratch-185"><a href="#WeakForm.from_scratch-185"><span class="linenos">185</span></a><span class="sd">        is_exterior : Union[bool, None]</span>
</span><span id="WeakForm.from_scratch-186"><a href="#WeakForm.from_scratch-186"><span class="linenos">186</span></a><span class="sd">            Wheter the weak form to be created shall be associated with the</span>
</span><span id="WeakForm.from_scratch-187"><a href="#WeakForm.from_scratch-187"><span class="linenos">187</span></a><span class="sd">            exterior domain. The default is None.</span>
</span><span id="WeakForm.from_scratch-188"><a href="#WeakForm.from_scratch-188"><span class="linenos">188</span></a>
</span><span id="WeakForm.from_scratch-189"><a href="#WeakForm.from_scratch-189"><span class="linenos">189</span></a><span class="sd">        Returns</span>
</span><span id="WeakForm.from_scratch-190"><a href="#WeakForm.from_scratch-190"><span class="linenos">190</span></a><span class="sd">        -------</span>
</span><span id="WeakForm.from_scratch-191"><a href="#WeakForm.from_scratch-191"><span class="linenos">191</span></a><span class="sd">        wf_instance : WeakForm</span>
</span><span id="WeakForm.from_scratch-192"><a href="#WeakForm.from_scratch-192"><span class="linenos">192</span></a><span class="sd">            The created weak form.</span>
</span><span id="WeakForm.from_scratch-193"><a href="#WeakForm.from_scratch-193"><span class="linenos">193</span></a>
</span><span id="WeakForm.from_scratch-194"><a href="#WeakForm.from_scratch-194"><span class="linenos">194</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WeakForm.from_scratch-195"><a href="#WeakForm.from_scratch-195"><span class="linenos">195</span></a>
</span><span id="WeakForm.from_scratch-196"><a href="#WeakForm.from_scratch-196"><span class="linenos">196</span></a>        <span class="c1"># Get arguments and default values</span>
</span><span id="WeakForm.from_scratch-197"><a href="#WeakForm.from_scratch-197"><span class="linenos">197</span></a>        <span class="n">dim</span> <span class="o">=</span> <span class="n">args_dict</span><span class="p">[</span><span class="s1">&#39;dim&#39;</span><span class="p">]</span>
</span><span id="WeakForm.from_scratch-198"><a href="#WeakForm.from_scratch-198"><span class="linenos">198</span></a>        <span class="n">pre_mesh</span> <span class="o">=</span> <span class="n">args_dict</span><span class="p">[</span><span class="s1">&#39;pre_mesh&#39;</span><span class="p">]</span>
</span><span id="WeakForm.from_scratch-199"><a href="#WeakForm.from_scratch-199"><span class="linenos">199</span></a>        <span class="n">name</span> <span class="o">=</span> <span class="n">args_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;wf&#39;</span><span class="p">)</span>
</span><span id="WeakForm.from_scratch-200"><a href="#WeakForm.from_scratch-200"><span class="linenos">200</span></a>        <span class="n">dim_func_entities</span> <span class="o">=</span> <span class="n">args_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dim_func_entities&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="WeakForm.from_scratch-201"><a href="#WeakForm.from_scratch-201"><span class="linenos">201</span></a>        <span class="n">pre_ebc_dict</span> <span class="o">=</span> <span class="n">args_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pre_ebc_dict&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="WeakForm.from_scratch-202"><a href="#WeakForm.from_scratch-202"><span class="linenos">202</span></a>        <span class="n">fem_order</span> <span class="o">=</span> <span class="n">args_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fem_order&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="WeakForm.from_scratch-203"><a href="#WeakForm.from_scratch-203"><span class="linenos">203</span></a>        <span class="n">pre_terms</span> <span class="o">=</span> <span class="n">args_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pre_terms&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="WeakForm.from_scratch-204"><a href="#WeakForm.from_scratch-204"><span class="linenos">204</span></a>        <span class="n">is_exterior</span> <span class="o">=</span> <span class="n">args_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;is_exterior&#39;</span><span class="p">)</span>
</span><span id="WeakForm.from_scratch-205"><a href="#WeakForm.from_scratch-205"><span class="linenos">205</span></a>
</span><span id="WeakForm.from_scratch-206"><a href="#WeakForm.from_scratch-206"><span class="linenos">206</span></a>        <span class="c1"># Create empty class instance</span>
</span><span id="WeakForm.from_scratch-207"><a href="#WeakForm.from_scratch-207"><span class="linenos">207</span></a>        <span class="n">wf_instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
</span><span id="WeakForm.from_scratch-208"><a href="#WeakForm.from_scratch-208"><span class="linenos">208</span></a>
</span><span id="WeakForm.from_scratch-209"><a href="#WeakForm.from_scratch-209"><span class="linenos">209</span></a>        <span class="c1"># Name of the weak form, is_exterior?</span>
</span><span id="WeakForm.from_scratch-210"><a href="#WeakForm.from_scratch-210"><span class="linenos">210</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="WeakForm.from_scratch-211"><a href="#WeakForm.from_scratch-211"><span class="linenos">211</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">_is_exterior</span> <span class="o">=</span> <span class="n">is_exterior</span>
</span><span id="WeakForm.from_scratch-212"><a href="#WeakForm.from_scratch-212"><span class="linenos">212</span></a>
</span><span id="WeakForm.from_scratch-213"><a href="#WeakForm.from_scratch-213"><span class="linenos">213</span></a>        <span class="c1"># Dimension</span>
</span><span id="WeakForm.from_scratch-214"><a href="#WeakForm.from_scratch-214"><span class="linenos">214</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span>
</span><span id="WeakForm.from_scratch-215"><a href="#WeakForm.from_scratch-215"><span class="linenos">215</span></a>
</span><span id="WeakForm.from_scratch-216"><a href="#WeakForm.from_scratch-216"><span class="linenos">216</span></a>        <span class="c1"># Region dictionary</span>
</span><span id="WeakForm.from_scratch-217"><a href="#WeakForm.from_scratch-217"><span class="linenos">217</span></a>        <span class="n">mesh</span> <span class="o">=</span> <span class="n">wf_instance</span><span class="o">.</span><span class="n">create_sfepy_internal_mesh</span><span class="p">(</span><span class="n">pre_mesh</span><span class="p">)</span>
</span><span id="WeakForm.from_scratch-218"><a href="#WeakForm.from_scratch-218"><span class="linenos">218</span></a>        <span class="n">domain</span> <span class="o">=</span> <span class="n">FEDomain</span><span class="p">(</span><span class="s1">&#39;domain&#39;</span><span class="p">,</span> <span class="n">mesh</span><span class="p">)</span>
</span><span id="WeakForm.from_scratch-219"><a href="#WeakForm.from_scratch-219"><span class="linenos">219</span></a>        <span class="k">if</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="WeakForm.from_scratch-220"><a href="#WeakForm.from_scratch-220"><span class="linenos">220</span></a>            <span class="n">physical_group_ids</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="WeakForm.from_scratch-221"><a href="#WeakForm.from_scratch-221"><span class="linenos">221</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="WeakForm.from_scratch-222"><a href="#WeakForm.from_scratch-222"><span class="linenos">222</span></a>            <span class="n">physical_group_ids</span> <span class="o">=</span> <span class="n">read_physical_groups_from_mesh_file</span><span class="p">(</span><span class="n">pre_mesh</span><span class="p">)</span>
</span><span id="WeakForm.from_scratch-223"><a href="#WeakForm.from_scratch-223"><span class="linenos">223</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">region_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="WeakForm.from_scratch-224"><a href="#WeakForm.from_scratch-224"><span class="linenos">224</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">fill_region_dict</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">physical_group_ids</span><span class="p">,</span>
</span><span id="WeakForm.from_scratch-225"><a href="#WeakForm.from_scratch-225"><span class="linenos">225</span></a>                                     <span class="n">dim_func_entities</span><span class="p">)</span>
</span><span id="WeakForm.from_scratch-226"><a href="#WeakForm.from_scratch-226"><span class="linenos">226</span></a>
</span><span id="WeakForm.from_scratch-227"><a href="#WeakForm.from_scratch-227"><span class="linenos">227</span></a>        <span class="c1"># Essential boundary conditions dictionary</span>
</span><span id="WeakForm.from_scratch-228"><a href="#WeakForm.from_scratch-228"><span class="linenos">228</span></a>        <span class="bp">cls</span><span class="o">.</span><span class="n">_check_pre_ebc_dict_format</span><span class="p">(</span><span class="n">pre_ebc_dict</span><span class="p">)</span>
</span><span id="WeakForm.from_scratch-229"><a href="#WeakForm.from_scratch-229"><span class="linenos">229</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">ebc_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="WeakForm.from_scratch-230"><a href="#WeakForm.from_scratch-230"><span class="linenos">230</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">fill_ebc_dict</span><span class="p">(</span><span class="n">pre_ebc_dict</span><span class="p">)</span>
</span><span id="WeakForm.from_scratch-231"><a href="#WeakForm.from_scratch-231"><span class="linenos">231</span></a>
</span><span id="WeakForm.from_scratch-232"><a href="#WeakForm.from_scratch-232"><span class="linenos">232</span></a>        <span class="c1"># FEM order</span>
</span><span id="WeakForm.from_scratch-233"><a href="#WeakForm.from_scratch-233"><span class="linenos">233</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">fem_order</span> <span class="o">=</span> <span class="n">fem_order</span>
</span><span id="WeakForm.from_scratch-234"><a href="#WeakForm.from_scratch-234"><span class="linenos">234</span></a>
</span><span id="WeakForm.from_scratch-235"><a href="#WeakForm.from_scratch-235"><span class="linenos">235</span></a>        <span class="c1"># Problem instances</span>
</span><span id="WeakForm.from_scratch-236"><a href="#WeakForm.from_scratch-236"><span class="linenos">236</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">pre_terms</span> <span class="o">=</span> <span class="n">pre_terms</span>
</span><span id="WeakForm.from_scratch-237"><a href="#WeakForm.from_scratch-237"><span class="linenos">237</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">_fix_pb_without_state_variable</span><span class="p">()</span>
</span><span id="WeakForm.from_scratch-238"><a href="#WeakForm.from_scratch-238"><span class="linenos">238</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">set_problems</span><span class="p">(</span><span class="n">pre_terms</span><span class="p">)</span>
</span><span id="WeakForm.from_scratch-239"><a href="#WeakForm.from_scratch-239"><span class="linenos">239</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">apply_bcs</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span>
</span><span id="WeakForm.from_scratch-240"><a href="#WeakForm.from_scratch-240"><span class="linenos">240</span></a>
</span><span id="WeakForm.from_scratch-241"><a href="#WeakForm.from_scratch-241"><span class="linenos">241</span></a>        <span class="k">return</span> <span class="n">wf_instance</span>
</span></pre></div>


            <div class="docstring"><p>Create an instance of <code><a href="#WeakForm">WeakForm</a></code> and set its attributes by creating the
relevant Sfepy's objects step by step. The dictionary <code>args_dict</code>
passed to the function contains the following items:</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>dim</strong> (int):
Dimension of the problem: 1, 2 or 3.</li>
<li><strong>pre_mesh</strong> (str or <code>sfepy.discrete.fem.mesh.Mesh</code>):
In 1D: already existing Sfepy's <code>Mesh</code> instance.
In 2D and 3D: name of the .vtk mesh file.</li>
<li><strong>name</strong> (str, optional):
Name of the weak form. The default is 'wf'.</li>
<li><strong>dim_func_entities</strong> (List[tuple]):
List of triplets (entity dimension, function selection, tag).</li>
<li><strong>pre_ebc_dict</strong> (dict):
Dictionary that is used to assign some essential boundary conditions
to some topological entities. Its keys are a subset of <code><a href="#WeakForm.region_dict">region_dict</a></code>
ones and its values are either numbers or functions.</li>
<li><strong>fem_order</strong> (int, optional):
Finite Element approximation order. The default is 2.</li>
<li><strong>pre_terms</strong> (List[PreTerm]):
List of <code>PreTerm</code> instances associated with the PDE to be solved.</li>
<li><strong>is_exterior</strong> (Union[bool, None]):
Wheter the weak form to be created shall be associated with the
exterior domain. The default is None.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>wf_instance</strong> (WeakForm):
The created weak form.</li>
</ul>
</div>


                            </div>
                            <div id="WeakForm.from_two_weak_forms" class="classattr">
                                        <input id="WeakForm.from_two_weak_forms-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">from_two_weak_forms</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">cls</span>,</span><span class="param">	<span class="n">wf_int</span><span class="p">:</span> <span class="n"><a href="#WeakForm">WeakForm</a></span>,</span><span class="param">	<span class="n">wf_ext</span><span class="p">:</span> <span class="n"><a href="#WeakForm">WeakForm</a></span>,</span><span class="param">	<span class="n">region_key_int</span><span class="p">:</span> <span class="nb">tuple</span>,</span><span class="param">	<span class="n">region_key_ext</span><span class="p">:</span> <span class="nb">tuple</span>,</span><span class="param">	<span class="n">verbose</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">) -> <span class="n"><a href="#WeakForm">WeakForm</a></span>:</span></span>

                <label class="view-source-button" for="WeakForm.from_two_weak_forms-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeakForm.from_two_weak_forms"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeakForm.from_two_weak_forms-243"><a href="#WeakForm.from_two_weak_forms-243"><span class="linenos">243</span></a>    <span class="nd">@classmethod</span>
</span><span id="WeakForm.from_two_weak_forms-244"><a href="#WeakForm.from_two_weak_forms-244"><span class="linenos">244</span></a>    <span class="k">def</span> <span class="nf">from_two_weak_forms</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">wf_int</span><span class="p">:</span> <span class="n">WeakForm</span><span class="p">,</span> <span class="n">wf_ext</span><span class="p">:</span> <span class="n">WeakForm</span><span class="p">,</span>
</span><span id="WeakForm.from_two_weak_forms-245"><a href="#WeakForm.from_two_weak_forms-245"><span class="linenos">245</span></a>                            <span class="n">region_key_int</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">region_key_ext</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span>
</span><span id="WeakForm.from_two_weak_forms-246"><a href="#WeakForm.from_two_weak_forms-246"><span class="linenos">246</span></a>                            <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WeakForm</span><span class="p">:</span>
</span><span id="WeakForm.from_two_weak_forms-247"><a href="#WeakForm.from_two_weak_forms-247"><span class="linenos">247</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm.from_two_weak_forms-248"><a href="#WeakForm.from_two_weak_forms-248"><span class="linenos">248</span></a><span class="sd">        Create an instance of `WeakForm` from two existing weak forms,</span>
</span><span id="WeakForm.from_two_weak_forms-249"><a href="#WeakForm.from_two_weak_forms-249"><span class="linenos">249</span></a><span class="sd">        corresponding to the interior and exterior domains respectively.</span>
</span><span id="WeakForm.from_two_weak_forms-250"><a href="#WeakForm.from_two_weak_forms-250"><span class="linenos">250</span></a><span class="sd">        This class method is to be used when solving problems on unbounded</span>
</span><span id="WeakForm.from_two_weak_forms-251"><a href="#WeakForm.from_two_weak_forms-251"><span class="linenos">251</span></a><span class="sd">        domains with the inverted finite element method.</span>
</span><span id="WeakForm.from_two_weak_forms-252"><a href="#WeakForm.from_two_weak_forms-252"><span class="linenos">252</span></a>
</span><span id="WeakForm.from_two_weak_forms-253"><a href="#WeakForm.from_two_weak_forms-253"><span class="linenos">253</span></a><span class="sd">        Parameters</span>
</span><span id="WeakForm.from_two_weak_forms-254"><a href="#WeakForm.from_two_weak_forms-254"><span class="linenos">254</span></a><span class="sd">        ----------</span>
</span><span id="WeakForm.from_two_weak_forms-255"><a href="#WeakForm.from_two_weak_forms-255"><span class="linenos">255</span></a><span class="sd">        wf_int : WeakForm</span>
</span><span id="WeakForm.from_two_weak_forms-256"><a href="#WeakForm.from_two_weak_forms-256"><span class="linenos">256</span></a><span class="sd">            Interior weak form.</span>
</span><span id="WeakForm.from_two_weak_forms-257"><a href="#WeakForm.from_two_weak_forms-257"><span class="linenos">257</span></a><span class="sd">        wf_ext : WeakForm</span>
</span><span id="WeakForm.from_two_weak_forms-258"><a href="#WeakForm.from_two_weak_forms-258"><span class="linenos">258</span></a><span class="sd">            Exterior weak form.</span>
</span><span id="WeakForm.from_two_weak_forms-259"><a href="#WeakForm.from_two_weak_forms-259"><span class="linenos">259</span></a><span class="sd">        region_key_int : tuple</span>
</span><span id="WeakForm.from_two_weak_forms-260"><a href="#WeakForm.from_two_weak_forms-260"><span class="linenos">260</span></a><span class="sd">            Key of the connecting region in the interior domain.</span>
</span><span id="WeakForm.from_two_weak_forms-261"><a href="#WeakForm.from_two_weak_forms-261"><span class="linenos">261</span></a><span class="sd">        region_key_ext : tuple</span>
</span><span id="WeakForm.from_two_weak_forms-262"><a href="#WeakForm.from_two_weak_forms-262"><span class="linenos">262</span></a><span class="sd">            Key of the connecting region in the exterior domain.</span>
</span><span id="WeakForm.from_two_weak_forms-263"><a href="#WeakForm.from_two_weak_forms-263"><span class="linenos">263</span></a><span class="sd">        verbose : bool, optional</span>
</span><span id="WeakForm.from_two_weak_forms-264"><a href="#WeakForm.from_two_weak_forms-264"><span class="linenos">264</span></a><span class="sd">            The default is False.</span>
</span><span id="WeakForm.from_two_weak_forms-265"><a href="#WeakForm.from_two_weak_forms-265"><span class="linenos">265</span></a>
</span><span id="WeakForm.from_two_weak_forms-266"><a href="#WeakForm.from_two_weak_forms-266"><span class="linenos">266</span></a><span class="sd">        Returns</span>
</span><span id="WeakForm.from_two_weak_forms-267"><a href="#WeakForm.from_two_weak_forms-267"><span class="linenos">267</span></a><span class="sd">        -------</span>
</span><span id="WeakForm.from_two_weak_forms-268"><a href="#WeakForm.from_two_weak_forms-268"><span class="linenos">268</span></a><span class="sd">        wf_instance : WeakForm</span>
</span><span id="WeakForm.from_two_weak_forms-269"><a href="#WeakForm.from_two_weak_forms-269"><span class="linenos">269</span></a><span class="sd">            The created weak form.</span>
</span><span id="WeakForm.from_two_weak_forms-270"><a href="#WeakForm.from_two_weak_forms-270"><span class="linenos">270</span></a>
</span><span id="WeakForm.from_two_weak_forms-271"><a href="#WeakForm.from_two_weak_forms-271"><span class="linenos">271</span></a><span class="sd">        Notes</span>
</span><span id="WeakForm.from_two_weak_forms-272"><a href="#WeakForm.from_two_weak_forms-272"><span class="linenos">272</span></a><span class="sd">        -----</span>
</span><span id="WeakForm.from_two_weak_forms-273"><a href="#WeakForm.from_two_weak_forms-273"><span class="linenos">273</span></a><span class="sd">        The following attributes of the new WeakForm instance will be disabled</span>
</span><span id="WeakForm.from_two_weak_forms-274"><a href="#WeakForm.from_two_weak_forms-274"><span class="linenos">274</span></a><span class="sd">        (i.e. set to None):</span>
</span><span id="WeakForm.from_two_weak_forms-275"><a href="#WeakForm.from_two_weak_forms-275"><span class="linenos">275</span></a><span class="sd">        - region_dict</span>
</span><span id="WeakForm.from_two_weak_forms-276"><a href="#WeakForm.from_two_weak_forms-276"><span class="linenos">276</span></a><span class="sd">        - ebc_dict</span>
</span><span id="WeakForm.from_two_weak_forms-277"><a href="#WeakForm.from_two_weak_forms-277"><span class="linenos">277</span></a><span class="sd">        - pre_terms</span>
</span><span id="WeakForm.from_two_weak_forms-278"><a href="#WeakForm.from_two_weak_forms-278"><span class="linenos">278</span></a><span class="sd">        Moreover, the boundary conditions are necessarily set active, meaning</span>
</span><span id="WeakForm.from_two_weak_forms-279"><a href="#WeakForm.from_two_weak_forms-279"><span class="linenos">279</span></a><span class="sd">        that several methods &amp; functionalities will not work with the newly</span>
</span><span id="WeakForm.from_two_weak_forms-280"><a href="#WeakForm.from_two_weak_forms-280"><span class="linenos">280</span></a><span class="sd">        created weak form.</span>
</span><span id="WeakForm.from_two_weak_forms-281"><a href="#WeakForm.from_two_weak_forms-281"><span class="linenos">281</span></a>
</span><span id="WeakForm.from_two_weak_forms-282"><a href="#WeakForm.from_two_weak_forms-282"><span class="linenos">282</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WeakForm.from_two_weak_forms-283"><a href="#WeakForm.from_two_weak_forms-283"><span class="linenos">283</span></a>        <span class="c1"># Safety checks</span>
</span><span id="WeakForm.from_two_weak_forms-284"><a href="#WeakForm.from_two_weak_forms-284"><span class="linenos">284</span></a>        <span class="bp">cls</span><span class="o">.</span><span class="n">_check_args_before_merging</span><span class="p">(</span><span class="n">wf_int</span><span class="p">,</span> <span class="n">wf_ext</span><span class="p">,</span>
</span><span id="WeakForm.from_two_weak_forms-285"><a href="#WeakForm.from_two_weak_forms-285"><span class="linenos">285</span></a>                                       <span class="n">region_key_int</span><span class="p">,</span> <span class="n">region_key_ext</span><span class="p">)</span>
</span><span id="WeakForm.from_two_weak_forms-286"><a href="#WeakForm.from_two_weak_forms-286"><span class="linenos">286</span></a>        <span class="c1"># Fill basic attributes</span>
</span><span id="WeakForm.from_two_weak_forms-287"><a href="#WeakForm.from_two_weak_forms-287"><span class="linenos">287</span></a>        <span class="n">attr_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="WeakForm.from_two_weak_forms-288"><a href="#WeakForm.from_two_weak_forms-288"><span class="linenos">288</span></a>        <span class="n">attr_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;combine_</span><span class="si">{}</span><span class="s2">_&amp;_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wf_int</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">wf_ext</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="WeakForm.from_two_weak_forms-289"><a href="#WeakForm.from_two_weak_forms-289"><span class="linenos">289</span></a>        <span class="n">attr_dict</span><span class="p">[</span><span class="s1">&#39;dim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wf_int</span><span class="o">.</span><span class="n">dim</span>
</span><span id="WeakForm.from_two_weak_forms-290"><a href="#WeakForm.from_two_weak_forms-290"><span class="linenos">290</span></a>        <span class="n">attr_dict</span><span class="p">[</span><span class="s1">&#39;region_dict&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WeakForm.from_two_weak_forms-291"><a href="#WeakForm.from_two_weak_forms-291"><span class="linenos">291</span></a>        <span class="n">attr_dict</span><span class="p">[</span><span class="s1">&#39;ebc_dict&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WeakForm.from_two_weak_forms-292"><a href="#WeakForm.from_two_weak_forms-292"><span class="linenos">292</span></a>        <span class="n">attr_dict</span><span class="p">[</span><span class="s1">&#39;pre_terms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WeakForm.from_two_weak_forms-293"><a href="#WeakForm.from_two_weak_forms-293"><span class="linenos">293</span></a>        <span class="n">attr_dict</span><span class="p">[</span><span class="s1">&#39;fem_order&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wf_int</span><span class="o">.</span><span class="n">fem_order</span>
</span><span id="WeakForm.from_two_weak_forms-294"><a href="#WeakForm.from_two_weak_forms-294"><span class="linenos">294</span></a>
</span><span id="WeakForm.from_two_weak_forms-295"><a href="#WeakForm.from_two_weak_forms-295"><span class="linenos">295</span></a>        <span class="c1"># Preparation of LCBCs</span>
</span><span id="WeakForm.from_two_weak_forms-296"><a href="#WeakForm.from_two_weak_forms-296"><span class="linenos">296</span></a>        <span class="n">match_coors</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="s1">&#39;match_coors&#39;</span><span class="p">,</span> <span class="n">per</span><span class="o">.</span><span class="n">match_coors</span><span class="p">)</span>
</span><span id="WeakForm.from_two_weak_forms-297"><a href="#WeakForm.from_two_weak_forms-297"><span class="linenos">297</span></a>        <span class="n">connecting_regions</span> <span class="o">=</span> <span class="p">[</span><span class="n">wf_int</span><span class="o">.</span><span class="n">region_dict</span><span class="p">[</span><span class="n">region_key_int</span><span class="p">],</span>
</span><span id="WeakForm.from_two_weak_forms-298"><a href="#WeakForm.from_two_weak_forms-298"><span class="linenos">298</span></a>                              <span class="n">wf_ext</span><span class="o">.</span><span class="n">region_dict</span><span class="p">[</span><span class="n">region_key_ext</span><span class="p">]]</span>
</span><span id="WeakForm.from_two_weak_forms-299"><a href="#WeakForm.from_two_weak_forms-299"><span class="linenos">299</span></a>
</span><span id="WeakForm.from_two_weak_forms-300"><a href="#WeakForm.from_two_weak_forms-300"><span class="linenos">300</span></a>        <span class="c1"># Construct new Problem instance(s)</span>
</span><span id="WeakForm.from_two_weak_forms-301"><a href="#WeakForm.from_two_weak_forms-301"><span class="linenos">301</span></a>        <span class="k">if</span> <span class="n">wf_int</span><span class="o">.</span><span class="n">pb_mod</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="WeakForm.from_two_weak_forms-302"><a href="#WeakForm.from_two_weak_forms-302"><span class="linenos">302</span></a>            <span class="n">tag_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cst&#39;</span><span class="p">]</span>
</span><span id="WeakForm.from_two_weak_forms-303"><a href="#WeakForm.from_two_weak_forms-303"><span class="linenos">303</span></a>            <span class="n">attr_dict</span><span class="p">[</span><span class="s1">&#39;pb_mod&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="WeakForm.from_two_weak_forms-304"><a href="#WeakForm.from_two_weak_forms-304"><span class="linenos">304</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="WeakForm.from_two_weak_forms-305"><a href="#WeakForm.from_two_weak_forms-305"><span class="linenos">305</span></a>            <span class="n">tag_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cst&#39;</span><span class="p">,</span> <span class="s1">&#39;mod&#39;</span><span class="p">]</span>
</span><span id="WeakForm.from_two_weak_forms-306"><a href="#WeakForm.from_two_weak_forms-306"><span class="linenos">306</span></a>
</span><span id="WeakForm.from_two_weak_forms-307"><a href="#WeakForm.from_two_weak_forms-307"><span class="linenos">307</span></a>        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tag_list</span><span class="p">:</span>
</span><span id="WeakForm.from_two_weak_forms-308"><a href="#WeakForm.from_two_weak_forms-308"><span class="linenos">308</span></a>            <span class="c1"># Set up ebcs &amp; names</span>
</span><span id="WeakForm.from_two_weak_forms-309"><a href="#WeakForm.from_two_weak_forms-309"><span class="linenos">309</span></a>            <span class="n">pb_key</span> <span class="o">=</span> <span class="s1">&#39;pb_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm.from_two_weak_forms-310"><a href="#WeakForm.from_two_weak_forms-310"><span class="linenos">310</span></a>            <span class="n">ebcs_int</span> <span class="o">=</span> <span class="p">[</span><span class="n">dico</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="k">for</span> <span class="n">dico</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">wf_int</span><span class="o">.</span><span class="n">ebc_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())]</span>
</span><span id="WeakForm.from_two_weak_forms-311"><a href="#WeakForm.from_two_weak_forms-311"><span class="linenos">311</span></a>            <span class="n">ebcs_ext</span> <span class="o">=</span> <span class="p">[</span><span class="n">dico</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="k">for</span> <span class="n">dico</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">wf_ext</span><span class="o">.</span><span class="n">ebc_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())]</span>
</span><span id="WeakForm.from_two_weak_forms-312"><a href="#WeakForm.from_two_weak_forms-312"><span class="linenos">312</span></a>            <span class="n">ebcs_new</span> <span class="o">=</span> <span class="n">Conditions</span><span class="p">(</span><span class="n">ebcs_int</span> <span class="o">+</span> <span class="n">ebcs_ext</span><span class="p">)</span>
</span><span id="WeakForm.from_two_weak_forms-313"><a href="#WeakForm.from_two_weak_forms-313"><span class="linenos">313</span></a>            <span class="n">u_int_name</span> <span class="o">=</span> <span class="n">wf_int</span><span class="o">.</span><span class="n">get_unknown_name</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm.from_two_weak_forms-314"><a href="#WeakForm.from_two_weak_forms-314"><span class="linenos">314</span></a>            <span class="n">u_ext_name</span> <span class="o">=</span> <span class="n">wf_ext</span><span class="o">.</span><span class="n">get_unknown_name</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm.from_two_weak_forms-315"><a href="#WeakForm.from_two_weak_forms-315"><span class="linenos">315</span></a>
</span><span id="WeakForm.from_two_weak_forms-316"><a href="#WeakForm.from_two_weak_forms-316"><span class="linenos">316</span></a>            <span class="c1"># Linear Combination Boundary Conditions</span>
</span><span id="WeakForm.from_two_weak_forms-317"><a href="#WeakForm.from_two_weak_forms-317"><span class="linenos">317</span></a>            <span class="n">lcbc</span> <span class="o">=</span> <span class="n">LinearCombinationBC</span><span class="p">(</span>
</span><span id="WeakForm.from_two_weak_forms-318"><a href="#WeakForm.from_two_weak_forms-318"><span class="linenos">318</span></a>                <span class="s1">&#39;lc_cst&#39;</span><span class="p">,</span> <span class="n">connecting_regions</span><span class="p">,</span>
</span><span id="WeakForm.from_two_weak_forms-319"><a href="#WeakForm.from_two_weak_forms-319"><span class="linenos">319</span></a>                <span class="p">{</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.all&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">u_int_name</span><span class="p">)</span> <span class="p">:</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.all&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">u_ext_name</span><span class="p">)},</span>
</span><span id="WeakForm.from_two_weak_forms-320"><a href="#WeakForm.from_two_weak_forms-320"><span class="linenos">320</span></a>                <span class="n">match_coors</span><span class="p">,</span> <span class="s1">&#39;match_dofs&#39;</span><span class="p">)</span>
</span><span id="WeakForm.from_two_weak_forms-321"><a href="#WeakForm.from_two_weak_forms-321"><span class="linenos">321</span></a>            <span class="n">lcbcs</span> <span class="o">=</span> <span class="n">Conditions</span><span class="p">([</span><span class="n">lcbc</span><span class="p">])</span>
</span><span id="WeakForm.from_two_weak_forms-322"><a href="#WeakForm.from_two_weak_forms-322"><span class="linenos">322</span></a>
</span><span id="WeakForm.from_two_weak_forms-323"><a href="#WeakForm.from_two_weak_forms-323"><span class="linenos">323</span></a>            <span class="c1"># Create new Problem instance</span>
</span><span id="WeakForm.from_two_weak_forms-324"><a href="#WeakForm.from_two_weak_forms-324"><span class="linenos">324</span></a>            <span class="n">eqs</span> <span class="o">=</span> <span class="n">_EquationsFix</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">wf_int</span><span class="p">,</span> <span class="n">pb_key</span><span class="p">)</span><span class="o">.</span><span class="n">equations</span><span class="o">.</span><span class="n">_objs</span> <span class="o">+</span>
</span><span id="WeakForm.from_two_weak_forms-325"><a href="#WeakForm.from_two_weak_forms-325"><span class="linenos">325</span></a>                                <span class="nb">getattr</span><span class="p">(</span><span class="n">wf_ext</span><span class="p">,</span> <span class="n">pb_key</span><span class="p">)</span><span class="o">.</span><span class="n">equations</span><span class="o">.</span><span class="n">_objs</span><span class="p">)</span>
</span><span id="WeakForm.from_two_weak_forms-326"><a href="#WeakForm.from_two_weak_forms-326"><span class="linenos">326</span></a>            <span class="n">pb_new</span> <span class="o">=</span> <span class="n">Problem</span><span class="p">(</span><span class="n">pb_key</span><span class="p">,</span> <span class="n">equations</span><span class="o">=</span><span class="n">eqs</span><span class="p">,</span> <span class="n">active_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="WeakForm.from_two_weak_forms-327"><a href="#WeakForm.from_two_weak_forms-327"><span class="linenos">327</span></a>            <span class="n">pb_new</span><span class="o">.</span><span class="n">set_bcs</span><span class="p">(</span><span class="n">ebcs</span><span class="o">=</span><span class="n">ebcs_new</span><span class="p">,</span> <span class="n">lcbcs</span><span class="o">=</span><span class="n">lcbcs</span><span class="p">)</span>
</span><span id="WeakForm.from_two_weak_forms-328"><a href="#WeakForm.from_two_weak_forms-328"><span class="linenos">328</span></a>
</span><span id="WeakForm.from_two_weak_forms-329"><a href="#WeakForm.from_two_weak_forms-329"><span class="linenos">329</span></a>            <span class="c1"># Apply ebc to variables</span>
</span><span id="WeakForm.from_two_weak_forms-330"><a href="#WeakForm.from_two_weak_forms-330"><span class="linenos">330</span></a>            <span class="n">variables</span> <span class="o">=</span> <span class="n">pb_new</span><span class="o">.</span><span class="n">get_initial_state</span><span class="p">()</span>
</span><span id="WeakForm.from_two_weak_forms-331"><a href="#WeakForm.from_two_weak_forms-331"><span class="linenos">331</span></a>            <span class="n">pb_new</span><span class="o">.</span><span class="n">time_update</span><span class="p">()</span>
</span><span id="WeakForm.from_two_weak_forms-332"><a href="#WeakForm.from_two_weak_forms-332"><span class="linenos">332</span></a>            <span class="n">variables</span><span class="o">.</span><span class="n">apply_ebc</span><span class="p">()</span>
</span><span id="WeakForm.from_two_weak_forms-333"><a href="#WeakForm.from_two_weak_forms-333"><span class="linenos">333</span></a>            <span class="n">attr_dict</span><span class="p">[</span><span class="n">pb_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">pb_new</span>
</span><span id="WeakForm.from_two_weak_forms-334"><a href="#WeakForm.from_two_weak_forms-334"><span class="linenos">334</span></a>
</span><span id="WeakForm.from_two_weak_forms-335"><a href="#WeakForm.from_two_weak_forms-335"><span class="linenos">335</span></a>        <span class="c1"># Create WeakForm instance from &#39;attr_dict&#39; and mark bcs as active</span>
</span><span id="WeakForm.from_two_weak_forms-336"><a href="#WeakForm.from_two_weak_forms-336"><span class="linenos">336</span></a>        <span class="n">wf_instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_attr_dict</span><span class="p">(</span><span class="n">attr_dict</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</span><span id="WeakForm.from_two_weak_forms-337"><a href="#WeakForm.from_two_weak_forms-337"><span class="linenos">337</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">_active_bcs</span><span class="p">[</span><span class="s1">&#39;cst&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="WeakForm.from_two_weak_forms-338"><a href="#WeakForm.from_two_weak_forms-338"><span class="linenos">338</span></a>        <span class="n">wf_instance</span><span class="o">.</span><span class="n">_active_bcs</span><span class="p">[</span><span class="s1">&#39;mod&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="WeakForm.from_two_weak_forms-339"><a href="#WeakForm.from_two_weak_forms-339"><span class="linenos">339</span></a>
</span><span id="WeakForm.from_two_weak_forms-340"><a href="#WeakForm.from_two_weak_forms-340"><span class="linenos">340</span></a>        <span class="k">return</span> <span class="n">wf_instance</span>
</span></pre></div>


            <div class="docstring"><p>Create an instance of <code><a href="#WeakForm">WeakForm</a></code> from two existing weak forms,
corresponding to the interior and exterior domains respectively.
This class method is to be used when solving problems on unbounded
domains with the inverted finite element method.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>wf_int</strong> (WeakForm):
Interior weak form.</li>
<li><strong>wf_ext</strong> (WeakForm):
Exterior weak form.</li>
<li><strong>region_key_int</strong> (tuple):
Key of the connecting region in the interior domain.</li>
<li><strong>region_key_ext</strong> (tuple):
Key of the connecting region in the exterior domain.</li>
<li><strong>verbose</strong> (bool, optional):
The default is False.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>wf_instance</strong> (WeakForm):
The created weak form.</li>
</ul>

<h6 id="notes">Notes</h6>

<p>The following attributes of the new WeakForm instance will be disabled
(i.e. set to None):</p>

<ul>
<li>region_dict</li>
<li>ebc_dict</li>
<li>pre_terms
Moreover, the boundary conditions are necessarily set active, meaning
that several methods &amp; functionalities will not work with the newly
created weak form.</li>
</ul>
</div>


                            </div>
                            <div id="WeakForm.set_problems" class="classattr">
                                        <input id="WeakForm.set_problems-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_problems</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">pre_terms</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n"><a href="pre_term.html#PreTerm">femtoscope.core.pre_term.PreTerm</a></span><span class="p">]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="WeakForm.set_problems-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeakForm.set_problems"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeakForm.set_problems-342"><a href="#WeakForm.set_problems-342"><span class="linenos">342</span></a>    <span class="k">def</span> <span class="nf">set_problems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pre_terms</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PreTerm</span><span class="p">]):</span>
</span><span id="WeakForm.set_problems-343"><a href="#WeakForm.set_problems-343"><span class="linenos">343</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm.set_problems-344"><a href="#WeakForm.set_problems-344"><span class="linenos">344</span></a><span class="sd">        Create Problem instance(s) and set corresponding attribute(s). As a</span>
</span><span id="WeakForm.set_problems-345"><a href="#WeakForm.set_problems-345"><span class="linenos">345</span></a><span class="sd">        side effect, the `term` attribute of each `PreTerm` instance is set.</span>
</span><span id="WeakForm.set_problems-346"><a href="#WeakForm.set_problems-346"><span class="linenos">346</span></a>
</span><span id="WeakForm.set_problems-347"><a href="#WeakForm.set_problems-347"><span class="linenos">347</span></a><span class="sd">        Parameters</span>
</span><span id="WeakForm.set_problems-348"><a href="#WeakForm.set_problems-348"><span class="linenos">348</span></a><span class="sd">        ----------</span>
</span><span id="WeakForm.set_problems-349"><a href="#WeakForm.set_problems-349"><span class="linenos">349</span></a><span class="sd">        pre_terms : list[PreTerm]</span>
</span><span id="WeakForm.set_problems-350"><a href="#WeakForm.set_problems-350"><span class="linenos">350</span></a><span class="sd">            List of `PreTerm` instances</span>
</span><span id="WeakForm.set_problems-351"><a href="#WeakForm.set_problems-351"><span class="linenos">351</span></a>
</span><span id="WeakForm.set_problems-352"><a href="#WeakForm.set_problems-352"><span class="linenos">352</span></a><span class="sd">        Notes</span>
</span><span id="WeakForm.set_problems-353"><a href="#WeakForm.set_problems-353"><span class="linenos">353</span></a><span class="sd">        -----</span>
</span><span id="WeakForm.set_problems-354"><a href="#WeakForm.set_problems-354"><span class="linenos">354</span></a><span class="sd">        If none of the `PreTerm` instances has tag &#39;mod&#39;, `pb_mod` attribute is</span>
</span><span id="WeakForm.set_problems-355"><a href="#WeakForm.set_problems-355"><span class="linenos">355</span></a><span class="sd">        left to None.</span>
</span><span id="WeakForm.set_problems-356"><a href="#WeakForm.set_problems-356"><span class="linenos">356</span></a><span class="sd">        Some parameters are hardcoded in this process, e.g.</span>
</span><span id="WeakForm.set_problems-357"><a href="#WeakForm.set_problems-357"><span class="linenos">357</span></a><span class="sd">            test function space = &#39;H1&#39;</span>
</span><span id="WeakForm.set_problems-358"><a href="#WeakForm.set_problems-358"><span class="linenos">358</span></a><span class="sd">            basis of the FE space = &#39;lagrange&#39;</span>
</span><span id="WeakForm.set_problems-359"><a href="#WeakForm.set_problems-359"><span class="linenos">359</span></a><span class="sd">            order of the polynomials to integrate = 2*fem_order + 1</span>
</span><span id="WeakForm.set_problems-360"><a href="#WeakForm.set_problems-360"><span class="linenos">360</span></a>
</span><span id="WeakForm.set_problems-361"><a href="#WeakForm.set_problems-361"><span class="linenos">361</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WeakForm.set_problems-362"><a href="#WeakForm.set_problems-362"><span class="linenos">362</span></a>
</span><span id="WeakForm.set_problems-363"><a href="#WeakForm.set_problems-363"><span class="linenos">363</span></a>        <span class="n">has_nonlinear_term</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_nonlinear_term</span><span class="p">(</span><span class="n">pre_terms</span><span class="p">)</span>
</span><span id="WeakForm.set_problems-364"><a href="#WeakForm.set_problems-364"><span class="linenos">364</span></a>
</span><span id="WeakForm.set_problems-365"><a href="#WeakForm.set_problems-365"><span class="linenos">365</span></a>        <span class="c1"># Define field and variables</span>
</span><span id="WeakForm.set_problems-366"><a href="#WeakForm.set_problems-366"><span class="linenos">366</span></a>        <span class="n">field_name</span> <span class="o">=</span> <span class="s2">&quot;field_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="WeakForm.set_problems-367"><a href="#WeakForm.set_problems-367"><span class="linenos">367</span></a>        <span class="n">field</span> <span class="o">=</span> <span class="n">Field</span><span class="o">.</span><span class="n">from_args</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="s1">&#39;scalar&#39;</span><span class="p">,</span>
</span><span id="WeakForm.set_problems-368"><a href="#WeakForm.set_problems-368"><span class="linenos">368</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span><span class="p">[(</span><span class="s1">&#39;omega&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)],</span>
</span><span id="WeakForm.set_problems-369"><a href="#WeakForm.set_problems-369"><span class="linenos">369</span></a>                                <span class="n">approx_order</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fem_order</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="s1">&#39;H1&#39;</span><span class="p">,</span>
</span><span id="WeakForm.set_problems-370"><a href="#WeakForm.set_problems-370"><span class="linenos">370</span></a>                                <span class="n">poly_space_base</span><span class="o">=</span><span class="s1">&#39;lagrange&#39;</span><span class="p">)</span>
</span><span id="WeakForm.set_problems-371"><a href="#WeakForm.set_problems-371"><span class="linenos">371</span></a>
</span><span id="WeakForm.set_problems-372"><a href="#WeakForm.set_problems-372"><span class="linenos">372</span></a>        <span class="n">u_cst</span> <span class="o">=</span> <span class="n">FieldVariable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_unknown_name</span><span class="p">(</span><span class="s1">&#39;cst&#39;</span><span class="p">),</span> <span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
</span><span id="WeakForm.set_problems-373"><a href="#WeakForm.set_problems-373"><span class="linenos">373</span></a>        <span class="n">v_cst</span> <span class="o">=</span> <span class="n">FieldVariable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_test_name</span><span class="p">(</span><span class="s1">&#39;cst&#39;</span><span class="p">),</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span>
</span><span id="WeakForm.set_problems-374"><a href="#WeakForm.set_problems-374"><span class="linenos">374</span></a>                              <span class="n">primary_var_name</span><span class="o">=</span><span class="n">u_cst</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="WeakForm.set_problems-375"><a href="#WeakForm.set_problems-375"><span class="linenos">375</span></a>        <span class="n">u_mod</span> <span class="o">=</span> <span class="n">FieldVariable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_unknown_name</span><span class="p">(</span><span class="s1">&#39;mod&#39;</span><span class="p">),</span> <span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
</span><span id="WeakForm.set_problems-376"><a href="#WeakForm.set_problems-376"><span class="linenos">376</span></a>        <span class="n">v_mod</span> <span class="o">=</span> <span class="n">FieldVariable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_test_name</span><span class="p">(</span><span class="s1">&#39;mod&#39;</span><span class="p">),</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span>
</span><span id="WeakForm.set_problems-377"><a href="#WeakForm.set_problems-377"><span class="linenos">377</span></a>                              <span class="n">primary_var_name</span><span class="o">=</span><span class="n">u_mod</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="WeakForm.set_problems-378"><a href="#WeakForm.set_problems-378"><span class="linenos">378</span></a>
</span><span id="WeakForm.set_problems-379"><a href="#WeakForm.set_problems-379"><span class="linenos">379</span></a>        <span class="c1"># Define integral</span>
</span><span id="WeakForm.set_problems-380"><a href="#WeakForm.set_problems-380"><span class="linenos">380</span></a>        <span class="n">integral</span> <span class="o">=</span> <span class="n">Integral</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fem_order</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="WeakForm.set_problems-381"><a href="#WeakForm.set_problems-381"><span class="linenos">381</span></a>
</span><span id="WeakForm.set_problems-382"><a href="#WeakForm.set_problems-382"><span class="linenos">382</span></a>        <span class="c1"># Construct terms from the list of pre_term</span>
</span><span id="WeakForm.set_problems-383"><a href="#WeakForm.set_problems-383"><span class="linenos">383</span></a>        <span class="n">terms_cst</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="WeakForm.set_problems-384"><a href="#WeakForm.set_problems-384"><span class="linenos">384</span></a>        <span class="n">terms_mod</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="WeakForm.set_problems-385"><a href="#WeakForm.set_problems-385"><span class="linenos">385</span></a>        <span class="k">for</span> <span class="n">pre_term</span> <span class="ow">in</span> <span class="n">pre_terms</span><span class="p">:</span>
</span><span id="WeakForm.set_problems-386"><a href="#WeakForm.set_problems-386"><span class="linenos">386</span></a>            <span class="k">if</span> <span class="n">pre_term</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;cst&#39;</span><span class="p">:</span>
</span><span id="WeakForm.set_problems-387"><a href="#WeakForm.set_problems-387"><span class="linenos">387</span></a>                <span class="n">pre_term</span><span class="o">.</span><span class="n">set_term</span><span class="p">(</span><span class="n">integral</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">u_cst</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="n">v_cst</span><span class="p">)</span>
</span><span id="WeakForm.set_problems-388"><a href="#WeakForm.set_problems-388"><span class="linenos">388</span></a>                <span class="n">terms_cst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pre_term</span><span class="o">.</span><span class="n">term</span><span class="p">)</span>
</span><span id="WeakForm.set_problems-389"><a href="#WeakForm.set_problems-389"><span class="linenos">389</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="WeakForm.set_problems-390"><a href="#WeakForm.set_problems-390"><span class="linenos">390</span></a>                <span class="n">pre_term</span><span class="o">.</span><span class="n">set_term</span><span class="p">(</span><span class="n">integral</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">u_mod</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="n">v_mod</span><span class="p">)</span>
</span><span id="WeakForm.set_problems-391"><a href="#WeakForm.set_problems-391"><span class="linenos">391</span></a>                <span class="n">terms_mod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pre_term</span><span class="o">.</span><span class="n">term</span><span class="p">)</span>
</span><span id="WeakForm.set_problems-392"><a href="#WeakForm.set_problems-392"><span class="linenos">392</span></a>        <span class="n">terms_cst</span> <span class="o">=</span> <span class="n">Terms</span><span class="p">(</span><span class="n">terms_cst</span><span class="p">)</span>
</span><span id="WeakForm.set_problems-393"><a href="#WeakForm.set_problems-393"><span class="linenos">393</span></a>        <span class="n">terms_mod</span> <span class="o">=</span> <span class="n">Terms</span><span class="p">(</span><span class="n">terms_mod</span><span class="p">)</span>
</span><span id="WeakForm.set_problems-394"><a href="#WeakForm.set_problems-394"><span class="linenos">394</span></a>
</span><span id="WeakForm.set_problems-395"><a href="#WeakForm.set_problems-395"><span class="linenos">395</span></a>        <span class="c1"># Define equations</span>
</span><span id="WeakForm.set_problems-396"><a href="#WeakForm.set_problems-396"><span class="linenos">396</span></a>        <span class="n">eq_cst_name</span> <span class="o">=</span> <span class="s2">&quot;eq_</span><span class="si">{}</span><span class="s2">_cst&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="WeakForm.set_problems-397"><a href="#WeakForm.set_problems-397"><span class="linenos">397</span></a>        <span class="n">eq_cst</span> <span class="o">=</span> <span class="n">Equation</span><span class="p">(</span><span class="n">eq_cst_name</span><span class="p">,</span> <span class="n">terms_cst</span><span class="p">)</span>
</span><span id="WeakForm.set_problems-398"><a href="#WeakForm.set_problems-398"><span class="linenos">398</span></a>        <span class="n">eq_mod_name</span> <span class="o">=</span> <span class="s2">&quot;eq_</span><span class="si">{}</span><span class="s2">_mod&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="WeakForm.set_problems-399"><a href="#WeakForm.set_problems-399"><span class="linenos">399</span></a>        <span class="n">eq_mod</span> <span class="o">=</span> <span class="n">Equation</span><span class="p">(</span><span class="n">eq_mod_name</span><span class="p">,</span> <span class="n">terms_mod</span><span class="p">)</span>
</span><span id="WeakForm.set_problems-400"><a href="#WeakForm.set_problems-400"><span class="linenos">400</span></a>
</span><span id="WeakForm.set_problems-401"><a href="#WeakForm.set_problems-401"><span class="linenos">401</span></a>        <span class="c1"># Set problem(s)</span>
</span><span id="WeakForm.set_problems-402"><a href="#WeakForm.set_problems-402"><span class="linenos">402</span></a>        <span class="n">pb_cst_name</span> <span class="o">=</span> <span class="s2">&quot;pb_</span><span class="si">{}</span><span class="s2">_cst&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="WeakForm.set_problems-403"><a href="#WeakForm.set_problems-403"><span class="linenos">403</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pb_cst</span> <span class="o">=</span> <span class="n">Problem</span><span class="p">(</span>
</span><span id="WeakForm.set_problems-404"><a href="#WeakForm.set_problems-404"><span class="linenos">404</span></a>            <span class="n">pb_cst_name</span><span class="p">,</span> <span class="n">equations</span><span class="o">=</span><span class="n">Equations</span><span class="p">([</span><span class="n">eq_cst</span><span class="p">]),</span> <span class="n">active_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="WeakForm.set_problems-405"><a href="#WeakForm.set_problems-405"><span class="linenos">405</span></a>        <span class="k">if</span> <span class="n">has_nonlinear_term</span><span class="p">:</span>
</span><span id="WeakForm.set_problems-406"><a href="#WeakForm.set_problems-406"><span class="linenos">406</span></a>            <span class="n">pb_mod_name</span> <span class="o">=</span> <span class="s2">&quot;pb_</span><span class="si">{}</span><span class="s2">_mod&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="WeakForm.set_problems-407"><a href="#WeakForm.set_problems-407"><span class="linenos">407</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pb_mod</span> <span class="o">=</span> <span class="n">Problem</span><span class="p">(</span>
</span><span id="WeakForm.set_problems-408"><a href="#WeakForm.set_problems-408"><span class="linenos">408</span></a>                <span class="n">pb_mod_name</span><span class="p">,</span> <span class="n">equations</span><span class="o">=</span><span class="n">Equations</span><span class="p">([</span><span class="n">eq_mod</span><span class="p">]),</span> <span class="n">active_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="WeakForm.set_problems-409"><a href="#WeakForm.set_problems-409"><span class="linenos">409</span></a>
</span><span id="WeakForm.set_problems-410"><a href="#WeakForm.set_problems-410"><span class="linenos">410</span></a>        <span class="c1"># Evaluate materials in physical quadrature points for the first time</span>
</span><span id="WeakForm.set_problems-411"><a href="#WeakForm.set_problems-411"><span class="linenos">411</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_materials</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s1">&#39;cst&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create Problem instance(s) and set corresponding attribute(s). As a
side effect, the <code>term</code> attribute of each <code>PreTerm</code> instance is set.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>pre_terms</strong> (list[PreTerm]):
List of <code>PreTerm</code> instances</li>
</ul>

<h6 id="notes">Notes</h6>

<p>If none of the <code>PreTerm</code> instances has tag 'mod', <code><a href="#WeakForm.pb_mod">pb_mod</a></code> attribute is
left to None.
Some parameters are hardcoded in this process, e.g.
    test function space = 'H1'
    basis of the FE space = 'lagrange'
    order of the polynomials to integrate = 2*fem_order + 1</p>
</div>


                            </div>
                            <div id="WeakForm.apply_bcs" class="classattr">
                                        <input id="WeakForm.apply_bcs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">apply_bcs</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="WeakForm.apply_bcs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeakForm.apply_bcs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeakForm.apply_bcs-96"><a href="#WeakForm.apply_bcs-96"><span class="linenos"> 96</span></a>            <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="WeakForm.apply_bcs-97"><a href="#WeakForm.apply_bcs-97"><span class="linenos"> 97</span></a>                <span class="bp">self</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="WeakForm.apply_bcs-98"><a href="#WeakForm.apply_bcs-98"><span class="linenos"> 98</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="WeakForm.apply_bcs-99"><a href="#WeakForm.apply_bcs-99"><span class="linenos"> 99</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pb_cst</span><span class="o">.</span><span class="n">equations</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">has_lcbc</span><span class="p">:</span>
</span><span id="WeakForm.apply_bcs-100"><a href="#WeakForm.apply_bcs-100"><span class="linenos">100</span></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="WeakForm.apply_bcs-101"><a href="#WeakForm.apply_bcs-101"><span class="linenos">101</span></a>                            <span class="sa">f</span><span class="s2">&quot;Method &#39;</span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; cannot be called on weak&quot;</span>
</span><span id="WeakForm.apply_bcs-102"><a href="#WeakForm.apply_bcs-102"><span class="linenos">102</span></a>                            <span class="sa">f</span><span class="s2">&quot; form &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; because it has lcbcs!&quot;</span><span class="p">)</span>
</span><span id="WeakForm.apply_bcs-103"><a href="#WeakForm.apply_bcs-103"><span class="linenos">103</span></a>                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span id="WeakForm.apply_bcs-104"><a href="#WeakForm.apply_bcs-104"><span class="linenos">104</span></a>                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;weak form </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is not fully set up!&quot;</span><span class="p">)</span>
</span><span id="WeakForm.apply_bcs-105"><a href="#WeakForm.apply_bcs-105"><span class="linenos">105</span></a>                <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Apply boundary conditions to the weak form <code>Problem</code> instance(s).
The 'tag' argument is used to select either <code><a href="#WeakForm.pb_cst">pb_cst</a></code> or <code><a href="#WeakForm.pb_mod">pb_mod</a></code>. Use
'tag'='both' to select both (default behavior).</p>
</div>


                            </div>
                            <div id="WeakForm.remove_bcs" class="classattr">
                                        <input id="WeakForm.remove_bcs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remove_bcs</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="WeakForm.remove_bcs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeakForm.remove_bcs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeakForm.remove_bcs-96"><a href="#WeakForm.remove_bcs-96"><span class="linenos"> 96</span></a>            <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="WeakForm.remove_bcs-97"><a href="#WeakForm.remove_bcs-97"><span class="linenos"> 97</span></a>                <span class="bp">self</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="WeakForm.remove_bcs-98"><a href="#WeakForm.remove_bcs-98"><span class="linenos"> 98</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="WeakForm.remove_bcs-99"><a href="#WeakForm.remove_bcs-99"><span class="linenos"> 99</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pb_cst</span><span class="o">.</span><span class="n">equations</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">has_lcbc</span><span class="p">:</span>
</span><span id="WeakForm.remove_bcs-100"><a href="#WeakForm.remove_bcs-100"><span class="linenos">100</span></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="WeakForm.remove_bcs-101"><a href="#WeakForm.remove_bcs-101"><span class="linenos">101</span></a>                            <span class="sa">f</span><span class="s2">&quot;Method &#39;</span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; cannot be called on weak&quot;</span>
</span><span id="WeakForm.remove_bcs-102"><a href="#WeakForm.remove_bcs-102"><span class="linenos">102</span></a>                            <span class="sa">f</span><span class="s2">&quot; form &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; because it has lcbcs!&quot;</span><span class="p">)</span>
</span><span id="WeakForm.remove_bcs-103"><a href="#WeakForm.remove_bcs-103"><span class="linenos">103</span></a>                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span id="WeakForm.remove_bcs-104"><a href="#WeakForm.remove_bcs-104"><span class="linenos">104</span></a>                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;weak form </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is not fully set up!&quot;</span><span class="p">)</span>
</span><span id="WeakForm.remove_bcs-105"><a href="#WeakForm.remove_bcs-105"><span class="linenos">105</span></a>                <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Remove boundary conditions to the weak form <code>Problem</code> instance(s).
The 'tag' argument is used to select either <code><a href="#WeakForm.pb_cst">pb_cst</a></code> or <code><a href="#WeakForm.pb_mod">pb_mod</a></code>. Use
'tag'='both' to select both (default behavior).</p>
</div>


                            </div>
                            <div id="WeakForm.update_materials" class="classattr">
                                        <input id="WeakForm.update_materials-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">update_materials</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">tag</span><span class="o">=</span><span class="s1">&#39;both&#39;</span>, </span><span class="param"><span class="n">force</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="WeakForm.update_materials-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeakForm.update_materials"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeakForm.update_materials-451"><a href="#WeakForm.update_materials-451"><span class="linenos">451</span></a>    <span class="k">def</span> <span class="nf">update_materials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="WeakForm.update_materials-452"><a href="#WeakForm.update_materials-452"><span class="linenos">452</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm.update_materials-453"><a href="#WeakForm.update_materials-453"><span class="linenos">453</span></a><span class="sd">        Wrapper for `update_materials` from Sfepy `Problem` class.</span>
</span><span id="WeakForm.update_materials-454"><a href="#WeakForm.update_materials-454"><span class="linenos">454</span></a>
</span><span id="WeakForm.update_materials-455"><a href="#WeakForm.update_materials-455"><span class="linenos">455</span></a><span class="sd">        Parameters</span>
</span><span id="WeakForm.update_materials-456"><a href="#WeakForm.update_materials-456"><span class="linenos">456</span></a><span class="sd">        ----------</span>
</span><span id="WeakForm.update_materials-457"><a href="#WeakForm.update_materials-457"><span class="linenos">457</span></a><span class="sd">        tag : str</span>
</span><span id="WeakForm.update_materials-458"><a href="#WeakForm.update_materials-458"><span class="linenos">458</span></a><span class="sd">            &#39;cst&#39;, &#39;mod&#39; or &#39;both&#39;</span>
</span><span id="WeakForm.update_materials-459"><a href="#WeakForm.update_materials-459"><span class="linenos">459</span></a><span class="sd">        force : bool</span>
</span><span id="WeakForm.update_materials-460"><a href="#WeakForm.update_materials-460"><span class="linenos">460</span></a><span class="sd">            If True, set materials data to None before calling</span>
</span><span id="WeakForm.update_materials-461"><a href="#WeakForm.update_materials-461"><span class="linenos">461</span></a><span class="sd">            `pb.update_materials`, which has the same effect as setting</span>
</span><span id="WeakForm.update_materials-462"><a href="#WeakForm.update_materials-462"><span class="linenos">462</span></a><span class="sd">            &#39;mode=force&#39; in `Material.time_update` method.</span>
</span><span id="WeakForm.update_materials-463"><a href="#WeakForm.update_materials-463"><span class="linenos">463</span></a>
</span><span id="WeakForm.update_materials-464"><a href="#WeakForm.update_materials-464"><span class="linenos">464</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WeakForm.update_materials-465"><a href="#WeakForm.update_materials-465"><span class="linenos">465</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_pb_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm.update_materials-466"><a href="#WeakForm.update_materials-466"><span class="linenos">466</span></a>        <span class="n">tag_list</span><span class="p">,</span> <span class="n">pb_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_tag_pb_lists</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm.update_materials-467"><a href="#WeakForm.update_materials-467"><span class="linenos">467</span></a>        <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">pb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tag_list</span><span class="p">,</span> <span class="n">pb_list</span><span class="p">):</span>
</span><span id="WeakForm.update_materials-468"><a href="#WeakForm.update_materials-468"><span class="linenos">468</span></a>            <span class="k">if</span> <span class="n">force</span><span class="p">:</span>
</span><span id="WeakForm.update_materials-469"><a href="#WeakForm.update_materials-469"><span class="linenos">469</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_deplete_mat_datas</span><span class="p">(</span><span class="n">pb</span><span class="p">)</span>
</span><span id="WeakForm.update_materials-470"><a href="#WeakForm.update_materials-470"><span class="linenos">470</span></a>            <span class="n">pb</span><span class="o">.</span><span class="n">update_materials</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Wrapper for <code><a href="#WeakForm.update_materials">update_materials</a></code> from Sfepy <code>Problem</code> class.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>tag</strong> (str):
'cst', 'mod' or 'both'</li>
<li><strong>force</strong> (bool):
If True, set materials data to None before calling
<code>pb.update_materials</code>, which has the same effect as setting
'mode=force' in <code>Material.time_update</code> method.</li>
</ul>
</div>


                            </div>
                            <div id="WeakForm.make_full_vec" class="classattr">
                                        <input id="WeakForm.make_full_vec-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">make_full_vec</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reduced_vec</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="WeakForm.make_full_vec-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeakForm.make_full_vec"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeakForm.make_full_vec-472"><a href="#WeakForm.make_full_vec-472"><span class="linenos">472</span></a>    <span class="k">def</span> <span class="nf">make_full_vec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reduced_vec</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="WeakForm.make_full_vec-473"><a href="#WeakForm.make_full_vec-473"><span class="linenos">473</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm.make_full_vec-474"><a href="#WeakForm.make_full_vec-474"><span class="linenos">474</span></a><span class="sd">        Reconstruct a full DOF vector satisfying E(P)BCs from a reduced DOF</span>
</span><span id="WeakForm.make_full_vec-475"><a href="#WeakForm.make_full_vec-475"><span class="linenos">475</span></a><span class="sd">        vector.</span>
</span><span id="WeakForm.make_full_vec-476"><a href="#WeakForm.make_full_vec-476"><span class="linenos">476</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WeakForm.make_full_vec-477"><a href="#WeakForm.make_full_vec-477"><span class="linenos">477</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_bcs</span><span class="p">[</span><span class="s1">&#39;cst&#39;</span><span class="p">]:</span>
</span><span id="WeakForm.make_full_vec-478"><a href="#WeakForm.make_full_vec-478"><span class="linenos">478</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">apply_bcs</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s1">&#39;cst&#39;</span><span class="p">)</span>
</span><span id="WeakForm.make_full_vec-479"><a href="#WeakForm.make_full_vec-479"><span class="linenos">479</span></a>        <span class="n">variables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pb_cst</span><span class="o">.</span><span class="n">get_variables</span><span class="p">()</span>
</span><span id="WeakForm.make_full_vec-480"><a href="#WeakForm.make_full_vec-480"><span class="linenos">480</span></a>        <span class="n">full_vec</span> <span class="o">=</span> <span class="n">variables</span><span class="o">.</span><span class="n">make_full_vec</span><span class="p">(</span><span class="n">reduced_vec</span><span class="p">)</span>
</span><span id="WeakForm.make_full_vec-481"><a href="#WeakForm.make_full_vec-481"><span class="linenos">481</span></a>        <span class="k">return</span> <span class="n">full_vec</span>
</span></pre></div>


            <div class="docstring"><p>Reconstruct a full DOF vector satisfying E(P)BCs from a reduced DOF
vector.</p>
</div>


                            </div>
                            <div id="WeakForm.make_reduced_vec" class="classattr">
                                        <input id="WeakForm.make_reduced_vec-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">make_reduced_vec</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">full_vec</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="WeakForm.make_reduced_vec-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeakForm.make_reduced_vec"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeakForm.make_reduced_vec-483"><a href="#WeakForm.make_reduced_vec-483"><span class="linenos">483</span></a>    <span class="k">def</span> <span class="nf">make_reduced_vec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">full_vec</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="WeakForm.make_reduced_vec-484"><a href="#WeakForm.make_reduced_vec-484"><span class="linenos">484</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm.make_reduced_vec-485"><a href="#WeakForm.make_reduced_vec-485"><span class="linenos">485</span></a><span class="sd">        Get the reduced DOF vector (with EBC DOFs removed) from a full vector.</span>
</span><span id="WeakForm.make_reduced_vec-486"><a href="#WeakForm.make_reduced_vec-486"><span class="linenos">486</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WeakForm.make_reduced_vec-487"><a href="#WeakForm.make_reduced_vec-487"><span class="linenos">487</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_bcs</span><span class="p">[</span><span class="s1">&#39;cst&#39;</span><span class="p">]:</span>
</span><span id="WeakForm.make_reduced_vec-488"><a href="#WeakForm.make_reduced_vec-488"><span class="linenos">488</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">apply_bcs</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s1">&#39;cst&#39;</span><span class="p">)</span>
</span><span id="WeakForm.make_reduced_vec-489"><a href="#WeakForm.make_reduced_vec-489"><span class="linenos">489</span></a>        <span class="n">variables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pb_cst</span><span class="o">.</span><span class="n">get_variables</span><span class="p">()</span>
</span><span id="WeakForm.make_reduced_vec-490"><a href="#WeakForm.make_reduced_vec-490"><span class="linenos">490</span></a>        <span class="n">reduced_vec</span> <span class="o">=</span> <span class="n">variables</span><span class="o">.</span><span class="n">reduce_vec</span><span class="p">(</span><span class="n">full_vec</span><span class="p">)</span>
</span><span id="WeakForm.make_reduced_vec-491"><a href="#WeakForm.make_reduced_vec-491"><span class="linenos">491</span></a>        <span class="k">return</span> <span class="n">reduced_vec</span>
</span></pre></div>


            <div class="docstring"><p>Get the reduced DOF vector (with EBC DOFs removed) from a full vector.</p>
</div>


                            </div>
                            <div id="WeakForm.set_mtx_vec_no_bc" class="classattr">
                                        <input id="WeakForm.set_mtx_vec_no_bc-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_mtx_vec_no_bc</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="WeakForm.set_mtx_vec_no_bc-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeakForm.set_mtx_vec_no_bc"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeakForm.set_mtx_vec_no_bc-96"><a href="#WeakForm.set_mtx_vec_no_bc-96"><span class="linenos"> 96</span></a>            <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="WeakForm.set_mtx_vec_no_bc-97"><a href="#WeakForm.set_mtx_vec_no_bc-97"><span class="linenos"> 97</span></a>                <span class="bp">self</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="WeakForm.set_mtx_vec_no_bc-98"><a href="#WeakForm.set_mtx_vec_no_bc-98"><span class="linenos"> 98</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="WeakForm.set_mtx_vec_no_bc-99"><a href="#WeakForm.set_mtx_vec_no_bc-99"><span class="linenos"> 99</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pb_cst</span><span class="o">.</span><span class="n">equations</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">has_lcbc</span><span class="p">:</span>
</span><span id="WeakForm.set_mtx_vec_no_bc-100"><a href="#WeakForm.set_mtx_vec_no_bc-100"><span class="linenos">100</span></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="WeakForm.set_mtx_vec_no_bc-101"><a href="#WeakForm.set_mtx_vec_no_bc-101"><span class="linenos">101</span></a>                            <span class="sa">f</span><span class="s2">&quot;Method &#39;</span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; cannot be called on weak&quot;</span>
</span><span id="WeakForm.set_mtx_vec_no_bc-102"><a href="#WeakForm.set_mtx_vec_no_bc-102"><span class="linenos">102</span></a>                            <span class="sa">f</span><span class="s2">&quot; form &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; because it has lcbcs!&quot;</span><span class="p">)</span>
</span><span id="WeakForm.set_mtx_vec_no_bc-103"><a href="#WeakForm.set_mtx_vec_no_bc-103"><span class="linenos">103</span></a>                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span id="WeakForm.set_mtx_vec_no_bc-104"><a href="#WeakForm.set_mtx_vec_no_bc-104"><span class="linenos">104</span></a>                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;weak form </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is not fully set up!&quot;</span><span class="p">)</span>
</span><span id="WeakForm.set_mtx_vec_no_bc-105"><a href="#WeakForm.set_mtx_vec_no_bc-105"><span class="linenos">105</span></a>                <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Set the 'no_bc' attributes of 'mtx_vec' (which is an instance of the
<code>MatrixVector</code> class). 'tag' must be either 'cst', 'mod' or 'both'.</p>

<p>todo: handle the case 'mod' terms are only vectors.</p>
</div>


                            </div>
                            <div id="WeakForm.set_mtx_vec_bc_reduced" class="classattr">
                                        <input id="WeakForm.set_mtx_vec_bc_reduced-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_mtx_vec_bc_reduced</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">tag</span><span class="o">=</span><span class="s1">&#39;both&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="WeakForm.set_mtx_vec_bc_reduced-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeakForm.set_mtx_vec_bc_reduced"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeakForm.set_mtx_vec_bc_reduced-519"><a href="#WeakForm.set_mtx_vec_bc_reduced-519"><span class="linenos">519</span></a>    <span class="k">def</span> <span class="nf">set_mtx_vec_bc_reduced</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">):</span>
</span><span id="WeakForm.set_mtx_vec_bc_reduced-520"><a href="#WeakForm.set_mtx_vec_bc_reduced-520"><span class="linenos">520</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm.set_mtx_vec_bc_reduced-521"><a href="#WeakForm.set_mtx_vec_bc_reduced-521"><span class="linenos">521</span></a><span class="sd">        Set the &#39;bc_reduced&#39; attributes of &#39;mtx_vec&#39; (which is an instance of</span>
</span><span id="WeakForm.set_mtx_vec_bc_reduced-522"><a href="#WeakForm.set_mtx_vec_bc_reduced-522"><span class="linenos">522</span></a><span class="sd">        the `MatrixVector` class). &#39;tag&#39; must be either &#39;cst&#39;, &#39;mod&#39; or &#39;both&#39;.</span>
</span><span id="WeakForm.set_mtx_vec_bc_reduced-523"><a href="#WeakForm.set_mtx_vec_bc_reduced-523"><span class="linenos">523</span></a>
</span><span id="WeakForm.set_mtx_vec_bc_reduced-524"><a href="#WeakForm.set_mtx_vec_bc_reduced-524"><span class="linenos">524</span></a><span class="sd">        todo: handle the case &#39;mod&#39; terms are only vectors.</span>
</span><span id="WeakForm.set_mtx_vec_bc_reduced-525"><a href="#WeakForm.set_mtx_vec_bc_reduced-525"><span class="linenos">525</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WeakForm.set_mtx_vec_bc_reduced-526"><a href="#WeakForm.set_mtx_vec_bc_reduced-526"><span class="linenos">526</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm.set_mtx_vec_bc_reduced-527"><a href="#WeakForm.set_mtx_vec_bc_reduced-527"><span class="linenos">527</span></a>        <span class="n">tag_list</span><span class="p">,</span> <span class="n">pb_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_tag_pb_lists</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm.set_mtx_vec_bc_reduced-528"><a href="#WeakForm.set_mtx_vec_bc_reduced-528"><span class="linenos">528</span></a>        <span class="n">mtx_vec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtx_vec</span>
</span><span id="WeakForm.set_mtx_vec_bc_reduced-529"><a href="#WeakForm.set_mtx_vec_bc_reduced-529"><span class="linenos">529</span></a>        <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">pb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tag_list</span><span class="p">,</span> <span class="n">pb_list</span><span class="p">):</span>
</span><span id="WeakForm.set_mtx_vec_bc_reduced-530"><a href="#WeakForm.set_mtx_vec_bc_reduced-530"><span class="linenos">530</span></a>            <span class="n">key_mtx</span> <span class="o">=</span> <span class="s1">&#39;mtx_bc_reduced_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm.set_mtx_vec_bc_reduced-531"><a href="#WeakForm.set_mtx_vec_bc_reduced-531"><span class="linenos">531</span></a>            <span class="n">key_vec</span> <span class="o">=</span> <span class="s1">&#39;vec_bc_reduced_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm.set_mtx_vec_bc_reduced-532"><a href="#WeakForm.set_mtx_vec_bc_reduced-532"><span class="linenos">532</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mtx_vec</span><span class="p">,</span> <span class="n">key_mtx</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mtx_vec</span><span class="p">,</span> <span class="n">key_vec</span><span class="p">):</span>
</span><span id="WeakForm.set_mtx_vec_bc_reduced-533"><a href="#WeakForm.set_mtx_vec_bc_reduced-533"><span class="linenos">533</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="WeakForm.set_mtx_vec_bc_reduced-534"><a href="#WeakForm.set_mtx_vec_bc_reduced-534"><span class="linenos">534</span></a>                    <span class="sa">f</span><span class="s2">&quot;&#39;mtx_vec&#39; does not have attr. (</span><span class="si">{</span><span class="n">key_mtx</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">key_vec</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="WeakForm.set_mtx_vec_bc_reduced-535"><a href="#WeakForm.set_mtx_vec_bc_reduced-535"><span class="linenos">535</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_bcs</span><span class="p">[</span><span class="n">tag</span><span class="p">]:</span>
</span><span id="WeakForm.set_mtx_vec_bc_reduced-536"><a href="#WeakForm.set_mtx_vec_bc_reduced-536"><span class="linenos">536</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">apply_bcs</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm.set_mtx_vec_bc_reduced-537"><a href="#WeakForm.set_mtx_vec_bc_reduced-537"><span class="linenos">537</span></a>            <span class="n">ev</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">get_evaluator</span><span class="p">()</span>
</span><span id="WeakForm.set_mtx_vec_bc_reduced-538"><a href="#WeakForm.set_mtx_vec_bc_reduced-538"><span class="linenos">538</span></a>            <span class="n">vec_r</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">get_variables</span><span class="p">()</span><span class="o">.</span><span class="n">get_state</span><span class="p">(</span><span class="n">reduced</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="WeakForm.set_mtx_vec_bc_reduced-539"><a href="#WeakForm.set_mtx_vec_bc_reduced-539"><span class="linenos">539</span></a>            <span class="n">mtx</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="n">eval_tangent_matrix</span><span class="p">(</span><span class="n">vec_r</span><span class="p">,</span> <span class="n">mtx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_full</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="WeakForm.set_mtx_vec_bc_reduced-540"><a href="#WeakForm.set_mtx_vec_bc_reduced-540"><span class="linenos">540</span></a>            <span class="n">rhs</span> <span class="o">=</span> <span class="o">-</span><span class="n">ev</span><span class="o">.</span><span class="n">eval_residual</span><span class="p">(</span><span class="n">vec_r</span><span class="p">,</span> <span class="n">is_full</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="WeakForm.set_mtx_vec_bc_reduced-541"><a href="#WeakForm.set_mtx_vec_bc_reduced-541"><span class="linenos">541</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="n">mtx_vec</span><span class="p">,</span> <span class="n">key_mtx</span><span class="p">,</span> <span class="n">mtx</span><span class="p">)</span>
</span><span id="WeakForm.set_mtx_vec_bc_reduced-542"><a href="#WeakForm.set_mtx_vec_bc_reduced-542"><span class="linenos">542</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="n">mtx_vec</span><span class="p">,</span> <span class="n">key_vec</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Set the 'bc_reduced' attributes of 'mtx_vec' (which is an instance of
the <code>MatrixVector</code> class). 'tag' must be either 'cst', 'mod' or 'both'.</p>

<p>todo: handle the case 'mod' terms are only vectors.</p>
</div>


                            </div>
                            <div id="WeakForm.set_mtx_vec_bc_full" class="classattr">
                                        <input id="WeakForm.set_mtx_vec_bc_full-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_mtx_vec_bc_full</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="WeakForm.set_mtx_vec_bc_full-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeakForm.set_mtx_vec_bc_full"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeakForm.set_mtx_vec_bc_full-96"><a href="#WeakForm.set_mtx_vec_bc_full-96"><span class="linenos"> 96</span></a>            <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="WeakForm.set_mtx_vec_bc_full-97"><a href="#WeakForm.set_mtx_vec_bc_full-97"><span class="linenos"> 97</span></a>                <span class="bp">self</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="WeakForm.set_mtx_vec_bc_full-98"><a href="#WeakForm.set_mtx_vec_bc_full-98"><span class="linenos"> 98</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="WeakForm.set_mtx_vec_bc_full-99"><a href="#WeakForm.set_mtx_vec_bc_full-99"><span class="linenos"> 99</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pb_cst</span><span class="o">.</span><span class="n">equations</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">has_lcbc</span><span class="p">:</span>
</span><span id="WeakForm.set_mtx_vec_bc_full-100"><a href="#WeakForm.set_mtx_vec_bc_full-100"><span class="linenos">100</span></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="WeakForm.set_mtx_vec_bc_full-101"><a href="#WeakForm.set_mtx_vec_bc_full-101"><span class="linenos">101</span></a>                            <span class="sa">f</span><span class="s2">&quot;Method &#39;</span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; cannot be called on weak&quot;</span>
</span><span id="WeakForm.set_mtx_vec_bc_full-102"><a href="#WeakForm.set_mtx_vec_bc_full-102"><span class="linenos">102</span></a>                            <span class="sa">f</span><span class="s2">&quot; form &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; because it has lcbcs!&quot;</span><span class="p">)</span>
</span><span id="WeakForm.set_mtx_vec_bc_full-103"><a href="#WeakForm.set_mtx_vec_bc_full-103"><span class="linenos">103</span></a>                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span id="WeakForm.set_mtx_vec_bc_full-104"><a href="#WeakForm.set_mtx_vec_bc_full-104"><span class="linenos">104</span></a>                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;weak form </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is not fully set up!&quot;</span><span class="p">)</span>
</span><span id="WeakForm.set_mtx_vec_bc_full-105"><a href="#WeakForm.set_mtx_vec_bc_full-105"><span class="linenos">105</span></a>                <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Set the 'bc_full' attributes of 'mtx_vec' (which is an instance of the
<code>MatrixVector</code> class). 'tag' must be either 'cst', 'mod' or 'both'.</p>

<p>todo: handle the case 'mod' terms are only vectors.</p>
</div>


                            </div>
                            <div id="WeakForm.get_field" class="classattr">
                                        <input id="WeakForm.get_field-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_field</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="WeakForm.get_field-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeakForm.get_field"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeakForm.get_field-573"><a href="#WeakForm.get_field-573"><span class="linenos">573</span></a>    <span class="k">def</span> <span class="nf">get_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WeakForm.get_field-574"><a href="#WeakForm.get_field-574"><span class="linenos">574</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pb_cst</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="WeakForm.get_field-575"><a href="#WeakForm.get_field-575"><span class="linenos">575</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sfepy &#39;Field&#39; has not yet been instantiated.&quot;</span><span class="p">)</span>
</span><span id="WeakForm.get_field-576"><a href="#WeakForm.get_field-576"><span class="linenos">576</span></a>        <span class="n">field_name</span> <span class="o">=</span> <span class="s2">&quot;field_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="WeakForm.get_field-577"><a href="#WeakForm.get_field-577"><span class="linenos">577</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pb_cst</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="WeakForm.get_unknown_name" class="classattr">
                                        <input id="WeakForm.get_unknown_name-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_unknown_name</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">tag</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="WeakForm.get_unknown_name-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeakForm.get_unknown_name"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeakForm.get_unknown_name-579"><a href="#WeakForm.get_unknown_name-579"><span class="linenos">579</span></a>    <span class="k">def</span> <span class="nf">get_unknown_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="WeakForm.get_unknown_name-580"><a href="#WeakForm.get_unknown_name-580"><span class="linenos">580</span></a>        <span class="k">if</span> <span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cst&#39;</span><span class="p">,</span> <span class="s1">&#39;mod&#39;</span><span class="p">]:</span>
</span><span id="WeakForm.get_unknown_name-581"><a href="#WeakForm.get_unknown_name-581"><span class="linenos">581</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">&#39; is not a valid tag, must be either &quot;</span>
</span><span id="WeakForm.get_unknown_name-582"><a href="#WeakForm.get_unknown_name-582"><span class="linenos">582</span></a>                             <span class="sa">f</span><span class="s2">&quot;&#39;cst&#39; or &#39;mod&#39;.&quot;</span><span class="p">)</span>
</span><span id="WeakForm.get_unknown_name-583"><a href="#WeakForm.get_unknown_name-583"><span class="linenos">583</span></a>        <span class="k">return</span> <span class="s1">&#39;u_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="WeakForm.get_test_name" class="classattr">
                                        <input id="WeakForm.get_test_name-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_test_name</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">tag</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="WeakForm.get_test_name-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeakForm.get_test_name"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeakForm.get_test_name-585"><a href="#WeakForm.get_test_name-585"><span class="linenos">585</span></a>    <span class="k">def</span> <span class="nf">get_test_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="WeakForm.get_test_name-586"><a href="#WeakForm.get_test_name-586"><span class="linenos">586</span></a>        <span class="k">if</span> <span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cst&#39;</span><span class="p">,</span> <span class="s1">&#39;mod&#39;</span><span class="p">]:</span>
</span><span id="WeakForm.get_test_name-587"><a href="#WeakForm.get_test_name-587"><span class="linenos">587</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">&#39; is not a valid tag, must be either &quot;</span>
</span><span id="WeakForm.get_test_name-588"><a href="#WeakForm.get_test_name-588"><span class="linenos">588</span></a>                             <span class="sa">f</span><span class="s2">&quot;&#39;cst&#39; or &#39;mod&#39;.&quot;</span><span class="p">)</span>
</span><span id="WeakForm.get_test_name-589"><a href="#WeakForm.get_test_name-589"><span class="linenos">589</span></a>        <span class="k">return</span> <span class="s1">&#39;v_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="WeakForm.create_sfepy_internal_mesh" class="classattr">
                                        <input id="WeakForm.create_sfepy_internal_mesh-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_sfepy_internal_mesh</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">pre_mesh</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">sfepy</span><span class="o">.</span><span class="n">discrete</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">Mesh</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">sfepy</span><span class="o">.</span><span class="n">discrete</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">Mesh</span>:</span></span>

                <label class="view-source-button" for="WeakForm.create_sfepy_internal_mesh-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeakForm.create_sfepy_internal_mesh"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeakForm.create_sfepy_internal_mesh-591"><a href="#WeakForm.create_sfepy_internal_mesh-591"><span class="linenos">591</span></a>    <span class="k">def</span> <span class="nf">create_sfepy_internal_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pre_mesh</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Mesh</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Mesh</span><span class="p">:</span>
</span><span id="WeakForm.create_sfepy_internal_mesh-592"><a href="#WeakForm.create_sfepy_internal_mesh-592"><span class="linenos">592</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm.create_sfepy_internal_mesh-593"><a href="#WeakForm.create_sfepy_internal_mesh-593"><span class="linenos">593</span></a><span class="sd">        Create a Sfepy `Mesh` instance and return it. The input `pre_mesh` must</span>
</span><span id="WeakForm.create_sfepy_internal_mesh-594"><a href="#WeakForm.create_sfepy_internal_mesh-594"><span class="linenos">594</span></a><span class="sd">        already be an instance of `sfepy.discrete.fem.mesh.Mesh` in 1D. For the</span>
</span><span id="WeakForm.create_sfepy_internal_mesh-595"><a href="#WeakForm.create_sfepy_internal_mesh-595"><span class="linenos">595</span></a><span class="sd">        2D or 3D case, it is the name of an already existing .vtk mesh file.</span>
</span><span id="WeakForm.create_sfepy_internal_mesh-596"><a href="#WeakForm.create_sfepy_internal_mesh-596"><span class="linenos">596</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WeakForm.create_sfepy_internal_mesh-597"><a href="#WeakForm.create_sfepy_internal_mesh-597"><span class="linenos">597</span></a>
</span><span id="WeakForm.create_sfepy_internal_mesh-598"><a href="#WeakForm.create_sfepy_internal_mesh-598"><span class="linenos">598</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="WeakForm.create_sfepy_internal_mesh-599"><a href="#WeakForm.create_sfepy_internal_mesh-599"><span class="linenos">599</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pre_mesh</span><span class="p">,</span> <span class="n">Mesh</span><span class="p">):</span>
</span><span id="WeakForm.create_sfepy_internal_mesh-600"><a href="#WeakForm.create_sfepy_internal_mesh-600"><span class="linenos">600</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;In the one-dimensional case, &#39;mesh&#39; should &quot;</span>
</span><span id="WeakForm.create_sfepy_internal_mesh-601"><a href="#WeakForm.create_sfepy_internal_mesh-601"><span class="linenos">601</span></a>                                <span class="sa">f</span><span class="s2">&quot;be an instance of </span><span class="si">{</span><span class="n">Mesh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="WeakForm.create_sfepy_internal_mesh-602"><a href="#WeakForm.create_sfepy_internal_mesh-602"><span class="linenos">602</span></a>            <span class="n">sfepy_mesh</span> <span class="o">=</span> <span class="n">pre_mesh</span>
</span><span id="WeakForm.create_sfepy_internal_mesh-603"><a href="#WeakForm.create_sfepy_internal_mesh-603"><span class="linenos">603</span></a>
</span><span id="WeakForm.create_sfepy_internal_mesh-604"><a href="#WeakForm.create_sfepy_internal_mesh-604"><span class="linenos">604</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="WeakForm.create_sfepy_internal_mesh-605"><a href="#WeakForm.create_sfepy_internal_mesh-605"><span class="linenos">605</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pre_mesh</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="WeakForm.create_sfepy_internal_mesh-606"><a href="#WeakForm.create_sfepy_internal_mesh-606"><span class="linenos">606</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;In the two- and three-dimensional case, &quot;</span>
</span><span id="WeakForm.create_sfepy_internal_mesh-607"><a href="#WeakForm.create_sfepy_internal_mesh-607"><span class="linenos">607</span></a>                                <span class="s2">&quot;&#39;mesh&#39; should be a string&quot;</span><span class="p">)</span>
</span><span id="WeakForm.create_sfepy_internal_mesh-608"><a href="#WeakForm.create_sfepy_internal_mesh-608"><span class="linenos">608</span></a>            <span class="n">mesh_path_name</span> <span class="o">=</span> <span class="n">make_absolute_mesh_name</span><span class="p">(</span><span class="n">pre_mesh</span><span class="p">)</span>
</span><span id="WeakForm.create_sfepy_internal_mesh-609"><a href="#WeakForm.create_sfepy_internal_mesh-609"><span class="linenos">609</span></a>            <span class="n">sfepy_mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">mesh_path_name</span><span class="p">)</span>
</span><span id="WeakForm.create_sfepy_internal_mesh-610"><a href="#WeakForm.create_sfepy_internal_mesh-610"><span class="linenos">610</span></a>
</span><span id="WeakForm.create_sfepy_internal_mesh-611"><a href="#WeakForm.create_sfepy_internal_mesh-611"><span class="linenos">611</span></a>        <span class="k">return</span> <span class="n">sfepy_mesh</span>
</span></pre></div>


            <div class="docstring"><p>Create a Sfepy <code>Mesh</code> instance and return it. The input <code>pre_mesh</code> must
already be an instance of <code>sfepy.discrete.fem.mesh.Mesh</code> in 1D. For the
2D or 3D case, it is the name of an already existing .vtk mesh file.</p>
</div>


                            </div>
                            <div id="WeakForm.fill_ebc_dict" class="classattr">
                                        <input id="WeakForm.fill_ebc_dict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">fill_ebc_dict</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">pre_ebc_dict</span><span class="p">:</span> <span class="nb">dict</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="WeakForm.fill_ebc_dict-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeakForm.fill_ebc_dict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeakForm.fill_ebc_dict-613"><a href="#WeakForm.fill_ebc_dict-613"><span class="linenos">613</span></a>    <span class="k">def</span> <span class="nf">fill_ebc_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pre_ebc_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="WeakForm.fill_ebc_dict-614"><a href="#WeakForm.fill_ebc_dict-614"><span class="linenos">614</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm.fill_ebc_dict-615"><a href="#WeakForm.fill_ebc_dict-615"><span class="linenos">615</span></a><span class="sd">        Fill the &#39;ebc_dict&#39; from user specified Dirichlet boundary conditions.</span>
</span><span id="WeakForm.fill_ebc_dict-616"><a href="#WeakForm.fill_ebc_dict-616"><span class="linenos">616</span></a>
</span><span id="WeakForm.fill_ebc_dict-617"><a href="#WeakForm.fill_ebc_dict-617"><span class="linenos">617</span></a><span class="sd">        Parameters</span>
</span><span id="WeakForm.fill_ebc_dict-618"><a href="#WeakForm.fill_ebc_dict-618"><span class="linenos">618</span></a><span class="sd">        ----------</span>
</span><span id="WeakForm.fill_ebc_dict-619"><a href="#WeakForm.fill_ebc_dict-619"><span class="linenos">619</span></a><span class="sd">        pre_ebc_dict : dict</span>
</span><span id="WeakForm.fill_ebc_dict-620"><a href="#WeakForm.fill_ebc_dict-620"><span class="linenos">620</span></a><span class="sd">            Dictionary that is used to assign some essential boundary conditions</span>
</span><span id="WeakForm.fill_ebc_dict-621"><a href="#WeakForm.fill_ebc_dict-621"><span class="linenos">621</span></a><span class="sd">            to some topological entities. Its keys are a subset of</span>
</span><span id="WeakForm.fill_ebc_dict-622"><a href="#WeakForm.fill_ebc_dict-622"><span class="linenos">622</span></a><span class="sd">            `region_dict`&#39;s ones and its values are either numbers or functions.</span>
</span><span id="WeakForm.fill_ebc_dict-623"><a href="#WeakForm.fill_ebc_dict-623"><span class="linenos">623</span></a>
</span><span id="WeakForm.fill_ebc_dict-624"><a href="#WeakForm.fill_ebc_dict-624"><span class="linenos">624</span></a><span class="sd">        Notes</span>
</span><span id="WeakForm.fill_ebc_dict-625"><a href="#WeakForm.fill_ebc_dict-625"><span class="linenos">625</span></a><span class="sd">        -----</span>
</span><span id="WeakForm.fill_ebc_dict-626"><a href="#WeakForm.fill_ebc_dict-626"><span class="linenos">626</span></a><span class="sd">        In order to match Sfepy&#39;s syntax, function signatures should be</span>
</span><span id="WeakForm.fill_ebc_dict-627"><a href="#WeakForm.fill_ebc_dict-627"><span class="linenos">627</span></a><span class="sd">            def func(ts, coors, **kwargs)</span>
</span><span id="WeakForm.fill_ebc_dict-628"><a href="#WeakForm.fill_ebc_dict-628"><span class="linenos">628</span></a>
</span><span id="WeakForm.fill_ebc_dict-629"><a href="#WeakForm.fill_ebc_dict-629"><span class="linenos">629</span></a><span class="sd">        In view of Sfepy&#39;s handling of essential boundary conditions, it is</span>
</span><span id="WeakForm.fill_ebc_dict-630"><a href="#WeakForm.fill_ebc_dict-630"><span class="linenos">630</span></a><span class="sd">        necessary to define pairs of ebcs (for &#39;u_cst&#39; and &#39;u_mod&#39;).</span>
</span><span id="WeakForm.fill_ebc_dict-631"><a href="#WeakForm.fill_ebc_dict-631"><span class="linenos">631</span></a>
</span><span id="WeakForm.fill_ebc_dict-632"><a href="#WeakForm.fill_ebc_dict-632"><span class="linenos">632</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WeakForm.fill_ebc_dict-633"><a href="#WeakForm.fill_ebc_dict-633"><span class="linenos">633</span></a>
</span><span id="WeakForm.fill_ebc_dict-634"><a href="#WeakForm.fill_ebc_dict-634"><span class="linenos">634</span></a>        <span class="k">if</span> <span class="n">pre_ebc_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="WeakForm.fill_ebc_dict-635"><a href="#WeakForm.fill_ebc_dict-635"><span class="linenos">635</span></a>            <span class="n">pre_ebc_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="WeakForm.fill_ebc_dict-636"><a href="#WeakForm.fill_ebc_dict-636"><span class="linenos">636</span></a>
</span><span id="WeakForm.fill_ebc_dict-637"><a href="#WeakForm.fill_ebc_dict-637"><span class="linenos">637</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">pre_ebc_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="WeakForm.fill_ebc_dict-638"><a href="#WeakForm.fill_ebc_dict-638"><span class="linenos">638</span></a>            <span class="n">ebc_pair</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cst&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;mod&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
</span><span id="WeakForm.fill_ebc_dict-639"><a href="#WeakForm.fill_ebc_dict-639"><span class="linenos">639</span></a>            <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cst&#39;</span><span class="p">,</span> <span class="s1">&#39;mod&#39;</span><span class="p">]:</span>
</span><span id="WeakForm.fill_ebc_dict-640"><a href="#WeakForm.fill_ebc_dict-640"><span class="linenos">640</span></a>                <span class="n">ebc_name</span> <span class="o">=</span> <span class="s1">&#39;ebc_</span><span class="si">{}{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm.fill_ebc_dict-641"><a href="#WeakForm.fill_ebc_dict-641"><span class="linenos">641</span></a>                <span class="n">unknown_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_unknown_name</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</span><span id="WeakForm.fill_ebc_dict-642"><a href="#WeakForm.fill_ebc_dict-642"><span class="linenos">642</span></a>
</span><span id="WeakForm.fill_ebc_dict-643"><a href="#WeakForm.fill_ebc_dict-643"><span class="linenos">643</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>  <span class="c1"># val is a single number</span>
</span><span id="WeakForm.fill_ebc_dict-644"><a href="#WeakForm.fill_ebc_dict-644"><span class="linenos">644</span></a>                    <span class="n">ebc</span> <span class="o">=</span> <span class="n">EssentialBC</span><span class="p">(</span><span class="n">ebc_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
</span><span id="WeakForm.fill_ebc_dict-645"><a href="#WeakForm.fill_ebc_dict-645"><span class="linenos">645</span></a>                                      <span class="p">{</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.all&#39;</span> <span class="o">%</span> <span class="n">unknown_name</span><span class="p">:</span> <span class="n">val</span><span class="p">})</span>
</span><span id="WeakForm.fill_ebc_dict-646"><a href="#WeakForm.fill_ebc_dict-646"><span class="linenos">646</span></a>
</span><span id="WeakForm.fill_ebc_dict-647"><a href="#WeakForm.fill_ebc_dict-647"><span class="linenos">647</span></a>                <span class="k">else</span><span class="p">:</span>  <span class="c1"># val is a function</span>
</span><span id="WeakForm.fill_ebc_dict-648"><a href="#WeakForm.fill_ebc_dict-648"><span class="linenos">648</span></a>                    <span class="n">ebc_func_name</span> <span class="o">=</span> <span class="s1">&#39;ebc_func_</span><span class="si">{}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="WeakForm.fill_ebc_dict-649"><a href="#WeakForm.fill_ebc_dict-649"><span class="linenos">649</span></a>                    <span class="n">ebc_func</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="n">ebc_func_name</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
</span><span id="WeakForm.fill_ebc_dict-650"><a href="#WeakForm.fill_ebc_dict-650"><span class="linenos">650</span></a>                    <span class="n">ebc</span> <span class="o">=</span> <span class="n">EssentialBC</span><span class="p">(</span><span class="n">ebc_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
</span><span id="WeakForm.fill_ebc_dict-651"><a href="#WeakForm.fill_ebc_dict-651"><span class="linenos">651</span></a>                                      <span class="p">{</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.all&#39;</span> <span class="o">%</span> <span class="n">unknown_name</span><span class="p">:</span> <span class="n">ebc_func</span><span class="p">})</span>
</span><span id="WeakForm.fill_ebc_dict-652"><a href="#WeakForm.fill_ebc_dict-652"><span class="linenos">652</span></a>
</span><span id="WeakForm.fill_ebc_dict-653"><a href="#WeakForm.fill_ebc_dict-653"><span class="linenos">653</span></a>                <span class="n">ebc_pair</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">ebc</span>
</span><span id="WeakForm.fill_ebc_dict-654"><a href="#WeakForm.fill_ebc_dict-654"><span class="linenos">654</span></a>
</span><span id="WeakForm.fill_ebc_dict-655"><a href="#WeakForm.fill_ebc_dict-655"><span class="linenos">655</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ebc_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ebc_pair</span>
</span></pre></div>


            <div class="docstring"><p>Fill the 'ebc_dict' from user specified Dirichlet boundary conditions.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>pre_ebc_dict</strong> (dict):
Dictionary that is used to assign some essential boundary conditions
to some topological entities. Its keys are a subset of
<code><a href="#WeakForm.region_dict">region_dict</a></code>'s ones and its values are either numbers or functions.</li>
</ul>

<h6 id="notes">Notes</h6>

<p>In order to match Sfepy's syntax, function signatures should be
    def func(ts, coors, **kwargs)</p>

<p>In view of Sfepy's handling of essential boundary conditions, it is
necessary to define pairs of ebcs (for 'u_cst' and 'u_mod').</p>
</div>


                            </div>
                            <div id="WeakForm.fill_region_dict" class="classattr">
                                        <input id="WeakForm.fill_region_dict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">fill_region_dict</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">domain</span><span class="p">:</span> <span class="n">sfepy</span><span class="o">.</span><span class="n">discrete</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">FEDomain</span>,</span><span class="param">	<span class="n">physical_group_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="n">dim_func_entities</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">tuple</span><span class="p">]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="WeakForm.fill_region_dict-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeakForm.fill_region_dict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeakForm.fill_region_dict-657"><a href="#WeakForm.fill_region_dict-657"><span class="linenos">657</span></a>    <span class="k">def</span> <span class="nf">fill_region_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">FEDomain</span><span class="p">,</span> <span class="n">physical_group_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
</span><span id="WeakForm.fill_region_dict-658"><a href="#WeakForm.fill_region_dict-658"><span class="linenos">658</span></a>                         <span class="n">dim_func_entities</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">tuple</span><span class="p">]):</span>
</span><span id="WeakForm.fill_region_dict-659"><a href="#WeakForm.fill_region_dict-659"><span class="linenos">659</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm.fill_region_dict-660"><a href="#WeakForm.fill_region_dict-660"><span class="linenos">660</span></a><span class="sd">        Fill the &#39;region_dict&#39; based on:</span>
</span><span id="WeakForm.fill_region_dict-661"><a href="#WeakForm.fill_region_dict-661"><span class="linenos">661</span></a><span class="sd">        1) the physical groups present in the mesh;</span>
</span><span id="WeakForm.fill_region_dict-662"><a href="#WeakForm.fill_region_dict-662"><span class="linenos">662</span></a><span class="sd">        2) the topological entities selected via a function of the coordinates.</span>
</span><span id="WeakForm.fill_region_dict-663"><a href="#WeakForm.fill_region_dict-663"><span class="linenos">663</span></a><span class="sd">        Each entry of &#39;region_dict&#39; is then an instance of the class</span>
</span><span id="WeakForm.fill_region_dict-664"><a href="#WeakForm.fill_region_dict-664"><span class="linenos">664</span></a><span class="sd">        `sfepy.discrete.common.region.Region`.</span>
</span><span id="WeakForm.fill_region_dict-665"><a href="#WeakForm.fill_region_dict-665"><span class="linenos">665</span></a>
</span><span id="WeakForm.fill_region_dict-666"><a href="#WeakForm.fill_region_dict-666"><span class="linenos">666</span></a><span class="sd">        Parameters</span>
</span><span id="WeakForm.fill_region_dict-667"><a href="#WeakForm.fill_region_dict-667"><span class="linenos">667</span></a><span class="sd">        ----------</span>
</span><span id="WeakForm.fill_region_dict-668"><a href="#WeakForm.fill_region_dict-668"><span class="linenos">668</span></a><span class="sd">        domain : FEDomain</span>
</span><span id="WeakForm.fill_region_dict-669"><a href="#WeakForm.fill_region_dict-669"><span class="linenos">669</span></a><span class="sd">            Sfepy Domain instance.</span>
</span><span id="WeakForm.fill_region_dict-670"><a href="#WeakForm.fill_region_dict-670"><span class="linenos">670</span></a><span class="sd">        physical_group_ids : list</span>
</span><span id="WeakForm.fill_region_dict-671"><a href="#WeakForm.fill_region_dict-671"><span class="linenos">671</span></a><span class="sd">            List of all the physical groups (int) readable from the mesh.</span>
</span><span id="WeakForm.fill_region_dict-672"><a href="#WeakForm.fill_region_dict-672"><span class="linenos">672</span></a><span class="sd">        dim_func_entities : list</span>
</span><span id="WeakForm.fill_region_dict-673"><a href="#WeakForm.fill_region_dict-673"><span class="linenos">673</span></a><span class="sd">            List of triplets (entity dimension, function selection, tag).</span>
</span><span id="WeakForm.fill_region_dict-674"><a href="#WeakForm.fill_region_dict-674"><span class="linenos">674</span></a>
</span><span id="WeakForm.fill_region_dict-675"><a href="#WeakForm.fill_region_dict-675"><span class="linenos">675</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WeakForm.fill_region_dict-676"><a href="#WeakForm.fill_region_dict-676"><span class="linenos">676</span></a>
</span><span id="WeakForm.fill_region_dict-677"><a href="#WeakForm.fill_region_dict-677"><span class="linenos">677</span></a>        <span class="c1"># Omega and Gamma regions</span>
</span><span id="WeakForm.fill_region_dict-678"><a href="#WeakForm.fill_region_dict-678"><span class="linenos">678</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span><span class="p">[(</span><span class="s1">&#39;omega&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span><span class="s1">&#39;omega&#39;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">)</span>
</span><span id="WeakForm.fill_region_dict-679"><a href="#WeakForm.fill_region_dict-679"><span class="linenos">679</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span><span class="p">[(</span><span class="s1">&#39;gamma&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span>
</span><span id="WeakForm.fill_region_dict-680"><a href="#WeakForm.fill_region_dict-680"><span class="linenos">680</span></a>            <span class="s1">&#39;gamma&#39;</span><span class="p">,</span> <span class="s1">&#39;vertices of surface&#39;</span><span class="p">,</span> <span class="s1">&#39;facet&#39;</span><span class="p">)</span>
</span><span id="WeakForm.fill_region_dict-681"><a href="#WeakForm.fill_region_dict-681"><span class="linenos">681</span></a>
</span><span id="WeakForm.fill_region_dict-682"><a href="#WeakForm.fill_region_dict-682"><span class="linenos">682</span></a>        <span class="n">topological_entities_counter</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;vertices&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="WeakForm.fill_region_dict-683"><a href="#WeakForm.fill_region_dict-683"><span class="linenos">683</span></a>                                        <span class="s1">&#39;edges&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="WeakForm.fill_region_dict-684"><a href="#WeakForm.fill_region_dict-684"><span class="linenos">684</span></a>                                        <span class="s1">&#39;facets&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="WeakForm.fill_region_dict-685"><a href="#WeakForm.fill_region_dict-685"><span class="linenos">685</span></a>                                        <span class="s1">&#39;subomegas&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="WeakForm.fill_region_dict-686"><a href="#WeakForm.fill_region_dict-686"><span class="linenos">686</span></a>
</span><span id="WeakForm.fill_region_dict-687"><a href="#WeakForm.fill_region_dict-687"><span class="linenos">687</span></a>        <span class="k">for</span> <span class="n">group_id</span> <span class="ow">in</span> <span class="n">physical_group_ids</span><span class="p">:</span>
</span><span id="WeakForm.fill_region_dict-688"><a href="#WeakForm.fill_region_dict-688"><span class="linenos">688</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_fill_region_dict_from_group_id</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">group_id</span><span class="p">,</span>
</span><span id="WeakForm.fill_region_dict-689"><a href="#WeakForm.fill_region_dict-689"><span class="linenos">689</span></a>                                                 <span class="n">topological_entities_counter</span><span class="p">)</span>
</span><span id="WeakForm.fill_region_dict-690"><a href="#WeakForm.fill_region_dict-690"><span class="linenos">690</span></a>
</span><span id="WeakForm.fill_region_dict-691"><a href="#WeakForm.fill_region_dict-691"><span class="linenos">691</span></a>        <span class="k">for</span> <span class="n">entity_dimension</span><span class="p">,</span> <span class="n">function_selection</span><span class="p">,</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">dim_func_entities</span><span class="p">:</span>
</span><span id="WeakForm.fill_region_dict-692"><a href="#WeakForm.fill_region_dict-692"><span class="linenos">692</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_fill_region_dict_from_dim_func</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">entity_dimension</span><span class="p">,</span>
</span><span id="WeakForm.fill_region_dict-693"><a href="#WeakForm.fill_region_dict-693"><span class="linenos">693</span></a>                                                 <span class="n">function_selection</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span>
</span><span id="WeakForm.fill_region_dict-694"><a href="#WeakForm.fill_region_dict-694"><span class="linenos">694</span></a>                                                 <span class="n">topological_entities_counter</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Fill the 'region_dict' based on:
1) the physical groups present in the mesh;
2) the topological entities selected via a function of the coordinates.
Each entry of 'region_dict' is then an instance of the class
<code>sfepy.discrete.common.region.Region</code>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>domain</strong> (FEDomain):
Sfepy Domain instance.</li>
<li><strong>physical_group_ids</strong> (list):
List of all the physical groups (int) readable from the mesh.</li>
<li><strong>dim_func_entities</strong> (list):
List of triplets (entity dimension, function selection, tag).</li>
</ul>
</div>


                            </div>
                            <div id="WeakForm.get_qps_coors_in_region" class="classattr">
                                        <input id="WeakForm.get_qps_coors_in_region-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_qps_coors_in_region</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">region_key</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;omega&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="WeakForm.get_qps_coors_in_region-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeakForm.get_qps_coors_in_region"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeakForm.get_qps_coors_in_region-696"><a href="#WeakForm.get_qps_coors_in_region-696"><span class="linenos">696</span></a>    <span class="k">def</span> <span class="nf">get_qps_coors_in_region</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">region_key</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;omega&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)):</span>
</span><span id="WeakForm.get_qps_coors_in_region-697"><a href="#WeakForm.get_qps_coors_in_region-697"><span class="linenos">697</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm.get_qps_coors_in_region-698"><a href="#WeakForm.get_qps_coors_in_region-698"><span class="linenos">698</span></a><span class="sd">        Fetch quadrature points coordinates in given region.</span>
</span><span id="WeakForm.get_qps_coors_in_region-699"><a href="#WeakForm.get_qps_coors_in_region-699"><span class="linenos">699</span></a>
</span><span id="WeakForm.get_qps_coors_in_region-700"><a href="#WeakForm.get_qps_coors_in_region-700"><span class="linenos">700</span></a><span class="sd">        Parameters</span>
</span><span id="WeakForm.get_qps_coors_in_region-701"><a href="#WeakForm.get_qps_coors_in_region-701"><span class="linenos">701</span></a><span class="sd">        ----------</span>
</span><span id="WeakForm.get_qps_coors_in_region-702"><a href="#WeakForm.get_qps_coors_in_region-702"><span class="linenos">702</span></a><span class="sd">        region_key : tuple, optional</span>
</span><span id="WeakForm.get_qps_coors_in_region-703"><a href="#WeakForm.get_qps_coors_in_region-703"><span class="linenos">703</span></a><span class="sd">            Region where to fetch the quadrature points. The default is</span>
</span><span id="WeakForm.get_qps_coors_in_region-704"><a href="#WeakForm.get_qps_coors_in_region-704"><span class="linenos">704</span></a><span class="sd">            (&#39;omega&#39;, -1), which corresponds to the whole domain.</span>
</span><span id="WeakForm.get_qps_coors_in_region-705"><a href="#WeakForm.get_qps_coors_in_region-705"><span class="linenos">705</span></a>
</span><span id="WeakForm.get_qps_coors_in_region-706"><a href="#WeakForm.get_qps_coors_in_region-706"><span class="linenos">706</span></a><span class="sd">        Returns</span>
</span><span id="WeakForm.get_qps_coors_in_region-707"><a href="#WeakForm.get_qps_coors_in_region-707"><span class="linenos">707</span></a><span class="sd">        -------</span>
</span><span id="WeakForm.get_qps_coors_in_region-708"><a href="#WeakForm.get_qps_coors_in_region-708"><span class="linenos">708</span></a><span class="sd">        qps_coors : np.ndarray</span>
</span><span id="WeakForm.get_qps_coors_in_region-709"><a href="#WeakForm.get_qps_coors_in_region-709"><span class="linenos">709</span></a><span class="sd">            Numpy array containing the coordinates of the qps in the specified</span>
</span><span id="WeakForm.get_qps_coors_in_region-710"><a href="#WeakForm.get_qps_coors_in_region-710"><span class="linenos">710</span></a><span class="sd">            region.</span>
</span><span id="WeakForm.get_qps_coors_in_region-711"><a href="#WeakForm.get_qps_coors_in_region-711"><span class="linenos">711</span></a>
</span><span id="WeakForm.get_qps_coors_in_region-712"><a href="#WeakForm.get_qps_coors_in_region-712"><span class="linenos">712</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WeakForm.get_qps_coors_in_region-713"><a href="#WeakForm.get_qps_coors_in_region-713"><span class="linenos">713</span></a>        <span class="n">region</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_dict</span><span class="p">[</span><span class="n">region_key</span><span class="p">]</span>
</span><span id="WeakForm.get_qps_coors_in_region-714"><a href="#WeakForm.get_qps_coors_in_region-714"><span class="linenos">714</span></a>        <span class="n">qps</span> <span class="o">=</span> <span class="n">get_physical_qps</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">integral</span><span class="p">)</span>
</span><span id="WeakForm.get_qps_coors_in_region-715"><a href="#WeakForm.get_qps_coors_in_region-715"><span class="linenos">715</span></a>        <span class="n">qps_coors</span> <span class="o">=</span> <span class="n">qps</span><span class="o">.</span><span class="n">values</span>
</span><span id="WeakForm.get_qps_coors_in_region-716"><a href="#WeakForm.get_qps_coors_in_region-716"><span class="linenos">716</span></a>        <span class="k">return</span> <span class="n">qps_coors</span>
</span></pre></div>


            <div class="docstring"><p>Fetch quadrature points coordinates in given region.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>region_key</strong> (tuple, optional):
Region where to fetch the quadrature points. The default is
('omega', -1), which corresponds to the whole domain.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>qps_coors</strong> (np.ndarray):
Numpy array containing the coordinates of the qps in the specified
region.</li>
</ul>
</div>


                            </div>
                            <div id="WeakForm.get_pickable_args_dict" class="classattr">
                                        <input id="WeakForm.get_pickable_args_dict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_pickable_args_dict</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="WeakForm.get_pickable_args_dict-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeakForm.get_pickable_args_dict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeakForm.get_pickable_args_dict-718"><a href="#WeakForm.get_pickable_args_dict-718"><span class="linenos">718</span></a>    <span class="k">def</span> <span class="nf">get_pickable_args_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="WeakForm.get_pickable_args_dict-719"><a href="#WeakForm.get_pickable_args_dict-719"><span class="linenos">719</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WeakForm.get_pickable_args_dict-720"><a href="#WeakForm.get_pickable_args_dict-720"><span class="linenos">720</span></a><span class="sd">        Construct a dictionary that</span>
</span><span id="WeakForm.get_pickable_args_dict-721"><a href="#WeakForm.get_pickable_args_dict-721"><span class="linenos">721</span></a><span class="sd">        (i) can be used to create a new weak form with `from_scratch` method;</span>
</span><span id="WeakForm.get_pickable_args_dict-722"><a href="#WeakForm.get_pickable_args_dict-722"><span class="linenos">722</span></a><span class="sd">        (ii) can be serialized and thus save using pickle.</span>
</span><span id="WeakForm.get_pickable_args_dict-723"><a href="#WeakForm.get_pickable_args_dict-723"><span class="linenos">723</span></a><span class="sd">        The second requirement implies that user defined functions are not</span>
</span><span id="WeakForm.get_pickable_args_dict-724"><a href="#WeakForm.get_pickable_args_dict-724"><span class="linenos">724</span></a><span class="sd">        registered in the process. We get rid of all &#39;pre_term&#39;s and replace</span>
</span><span id="WeakForm.get_pickable_args_dict-725"><a href="#WeakForm.get_pickable_args_dict-725"><span class="linenos">725</span></a><span class="sd">        them by a dummy &#39;dw_laplace&#39; term.</span>
</span><span id="WeakForm.get_pickable_args_dict-726"><a href="#WeakForm.get_pickable_args_dict-726"><span class="linenos">726</span></a>
</span><span id="WeakForm.get_pickable_args_dict-727"><a href="#WeakForm.get_pickable_args_dict-727"><span class="linenos">727</span></a><span class="sd">        Returns</span>
</span><span id="WeakForm.get_pickable_args_dict-728"><a href="#WeakForm.get_pickable_args_dict-728"><span class="linenos">728</span></a><span class="sd">        -------</span>
</span><span id="WeakForm.get_pickable_args_dict-729"><a href="#WeakForm.get_pickable_args_dict-729"><span class="linenos">729</span></a><span class="sd">        args_dict : dict</span>
</span><span id="WeakForm.get_pickable_args_dict-730"><a href="#WeakForm.get_pickable_args_dict-730"><span class="linenos">730</span></a>
</span><span id="WeakForm.get_pickable_args_dict-731"><a href="#WeakForm.get_pickable_args_dict-731"><span class="linenos">731</span></a><span class="sd">        Notes</span>
</span><span id="WeakForm.get_pickable_args_dict-732"><a href="#WeakForm.get_pickable_args_dict-732"><span class="linenos">732</span></a><span class="sd">        -----</span>
</span><span id="WeakForm.get_pickable_args_dict-733"><a href="#WeakForm.get_pickable_args_dict-733"><span class="linenos">733</span></a><span class="sd">        This function is a wrapper for `_reconstruct_args_dict` and</span>
</span><span id="WeakForm.get_pickable_args_dict-734"><a href="#WeakForm.get_pickable_args_dict-734"><span class="linenos">734</span></a><span class="sd">        `_remove_functions_from_args_dict`.</span>
</span><span id="WeakForm.get_pickable_args_dict-735"><a href="#WeakForm.get_pickable_args_dict-735"><span class="linenos">735</span></a>
</span><span id="WeakForm.get_pickable_args_dict-736"><a href="#WeakForm.get_pickable_args_dict-736"><span class="linenos">736</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WeakForm.get_pickable_args_dict-737"><a href="#WeakForm.get_pickable_args_dict-737"><span class="linenos">737</span></a>        <span class="n">args_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reconstruct_args_dict</span><span class="p">()</span>
</span><span id="WeakForm.get_pickable_args_dict-738"><a href="#WeakForm.get_pickable_args_dict-738"><span class="linenos">738</span></a>        <span class="n">_remove_functions_from_args_dict</span><span class="p">(</span><span class="n">args_dict</span><span class="p">)</span>
</span><span id="WeakForm.get_pickable_args_dict-739"><a href="#WeakForm.get_pickable_args_dict-739"><span class="linenos">739</span></a>        <span class="n">args_dict</span><span class="p">[</span><span class="s1">&#39;pre_terms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">PreTerm</span><span class="p">(</span><span class="s1">&#39;dw_laplace&#39;</span><span class="p">)]</span>
</span><span id="WeakForm.get_pickable_args_dict-740"><a href="#WeakForm.get_pickable_args_dict-740"><span class="linenos">740</span></a>        <span class="k">return</span> <span class="n">args_dict</span>
</span></pre></div>


            <div class="docstring"><p>Construct a dictionary that
(i) can be used to create a new weak form with <code><a href="#WeakForm.from_scratch">from_scratch</a></code> method;
(ii) can be serialized and thus save using pickle.
The second requirement implies that user defined functions are not
registered in the process. We get rid of all 'pre_term's and replace
them by a dummy 'dw_laplace' term.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>args_dict</strong> (dict):</li>
</ul>

<h6 id="notes">Notes</h6>

<p>This function is a wrapper for <code>_reconstruct_args_dict</code> and
<code>_remove_functions_from_args_dict</code>.</p>
</div>


                            </div>
                </section>
                <section id="WeakForm.Decorators">
                            <input id="WeakForm.Decorators-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">WeakForm.Decorators</span>:

                <label class="view-source-button" for="WeakForm.Decorators-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeakForm.Decorators"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeakForm.Decorators-91"><a href="#WeakForm.Decorators-91"><span class="linenos"> 91</span></a>    <span class="k">class</span> <span class="nc">Decorators</span><span class="p">:</span>
</span><span id="WeakForm.Decorators-92"><a href="#WeakForm.Decorators-92"><span class="linenos"> 92</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Inner class for defining decorators.&quot;&quot;&quot;</span>
</span><span id="WeakForm.Decorators-93"><a href="#WeakForm.Decorators-93"><span class="linenos"> 93</span></a>
</span><span id="WeakForm.Decorators-94"><a href="#WeakForm.Decorators-94"><span class="linenos"> 94</span></a>        <span class="nd">@staticmethod</span>
</span><span id="WeakForm.Decorators-95"><a href="#WeakForm.Decorators-95"><span class="linenos"> 95</span></a>        <span class="k">def</span> <span class="nf">check_lcbcs</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
</span><span id="WeakForm.Decorators-96"><a href="#WeakForm.Decorators-96"><span class="linenos"> 96</span></a>            <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="WeakForm.Decorators-97"><a href="#WeakForm.Decorators-97"><span class="linenos"> 97</span></a>                <span class="bp">self</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="WeakForm.Decorators-98"><a href="#WeakForm.Decorators-98"><span class="linenos"> 98</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="WeakForm.Decorators-99"><a href="#WeakForm.Decorators-99"><span class="linenos"> 99</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pb_cst</span><span class="o">.</span><span class="n">equations</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">has_lcbc</span><span class="p">:</span>
</span><span id="WeakForm.Decorators-100"><a href="#WeakForm.Decorators-100"><span class="linenos">100</span></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="WeakForm.Decorators-101"><a href="#WeakForm.Decorators-101"><span class="linenos">101</span></a>                            <span class="sa">f</span><span class="s2">&quot;Method &#39;</span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; cannot be called on weak&quot;</span>
</span><span id="WeakForm.Decorators-102"><a href="#WeakForm.Decorators-102"><span class="linenos">102</span></a>                            <span class="sa">f</span><span class="s2">&quot; form &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; because it has lcbcs!&quot;</span><span class="p">)</span>
</span><span id="WeakForm.Decorators-103"><a href="#WeakForm.Decorators-103"><span class="linenos">103</span></a>                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span id="WeakForm.Decorators-104"><a href="#WeakForm.Decorators-104"><span class="linenos">104</span></a>                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;weak form </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is not fully set up!&quot;</span><span class="p">)</span>
</span><span id="WeakForm.Decorators-105"><a href="#WeakForm.Decorators-105"><span class="linenos">105</span></a>                <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="WeakForm.Decorators-106"><a href="#WeakForm.Decorators-106"><span class="linenos">106</span></a>            <span class="k">return</span> <span class="n">wrapper</span>
</span></pre></div>


            <div class="docstring"><p>Inner class for defining decorators.</p>
</div>


                            <div id="WeakForm.Decorators.check_lcbcs" class="classattr">
                                        <input id="WeakForm.Decorators.check_lcbcs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">check_lcbcs</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">func</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="WeakForm.Decorators.check_lcbcs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeakForm.Decorators.check_lcbcs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeakForm.Decorators.check_lcbcs-94"><a href="#WeakForm.Decorators.check_lcbcs-94"><span class="linenos"> 94</span></a>        <span class="nd">@staticmethod</span>
</span><span id="WeakForm.Decorators.check_lcbcs-95"><a href="#WeakForm.Decorators.check_lcbcs-95"><span class="linenos"> 95</span></a>        <span class="k">def</span> <span class="nf">check_lcbcs</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
</span><span id="WeakForm.Decorators.check_lcbcs-96"><a href="#WeakForm.Decorators.check_lcbcs-96"><span class="linenos"> 96</span></a>            <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="WeakForm.Decorators.check_lcbcs-97"><a href="#WeakForm.Decorators.check_lcbcs-97"><span class="linenos"> 97</span></a>                <span class="bp">self</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="WeakForm.Decorators.check_lcbcs-98"><a href="#WeakForm.Decorators.check_lcbcs-98"><span class="linenos"> 98</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="WeakForm.Decorators.check_lcbcs-99"><a href="#WeakForm.Decorators.check_lcbcs-99"><span class="linenos"> 99</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pb_cst</span><span class="o">.</span><span class="n">equations</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">has_lcbc</span><span class="p">:</span>
</span><span id="WeakForm.Decorators.check_lcbcs-100"><a href="#WeakForm.Decorators.check_lcbcs-100"><span class="linenos">100</span></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="WeakForm.Decorators.check_lcbcs-101"><a href="#WeakForm.Decorators.check_lcbcs-101"><span class="linenos">101</span></a>                            <span class="sa">f</span><span class="s2">&quot;Method &#39;</span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; cannot be called on weak&quot;</span>
</span><span id="WeakForm.Decorators.check_lcbcs-102"><a href="#WeakForm.Decorators.check_lcbcs-102"><span class="linenos">102</span></a>                            <span class="sa">f</span><span class="s2">&quot; form &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; because it has lcbcs!&quot;</span><span class="p">)</span>
</span><span id="WeakForm.Decorators.check_lcbcs-103"><a href="#WeakForm.Decorators.check_lcbcs-103"><span class="linenos">103</span></a>                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span id="WeakForm.Decorators.check_lcbcs-104"><a href="#WeakForm.Decorators.check_lcbcs-104"><span class="linenos">104</span></a>                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;weak form </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is not fully set up!&quot;</span><span class="p">)</span>
</span><span id="WeakForm.Decorators.check_lcbcs-105"><a href="#WeakForm.Decorators.check_lcbcs-105"><span class="linenos">105</span></a>                <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="WeakForm.Decorators.check_lcbcs-106"><a href="#WeakForm.Decorators.check_lcbcs-106"><span class="linenos">106</span></a>            <span class="k">return</span> <span class="n">wrapper</span>
</span></pre></div>


    

                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>